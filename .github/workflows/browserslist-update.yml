name: Update Browserslist database

on:
    schedule:
        - cron: '0 0 5,15,25 * *'
    workflow_dispatch:

permissions:
    contents: write
    pull-requests: write

jobs:
    update-browserslist-database:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v3
              with:
                  fetch-depth: 0

            - name: Configure git
              run: |
                  # Setup for committing using built-in token. See https://github.com/actions/checkout#push-a-commit-using-the-built-in-token
                  git config user.name "github-actions[bot]"
                  git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

            - name: Install pnpm
              uses: pnpm/action-setup@v4

            - name: Set up Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 18.12.1

            - name: Update Browserslist database and create PR if applies
              uses: c2corg/browserslist-update-action@v2
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  base_branch: master
                  commit_message: 'build: update Browserslist db'
                  title: 'build: update Browserslist db'
                  body: 'Auto-generated by [browserslist-update-action](https://github.com/c2corg/browserslist-update-action/)'
                  labels: 'dependencies, automerge'
