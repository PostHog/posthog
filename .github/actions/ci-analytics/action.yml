name: Report workflow results to PostHog
inputs:
    posthog-token:
        required: true
        description: PostHog project API key
    github-token:
        required: true
        description: Token with access to GitHub Actions API
    scope:
        required: false
        default: job # <─ keep old behaviour for all existing calls
        description: |
            Granularity of the event(s) to emit.
            • “job”      – emit this job and its finished steps (default)  
            • “workflow” – emit a single workflow-level summary event only
runs:
    using: composite
    steps:
        - name: Report workflow to PostHog
          shell: bash
          run: python infra-scripts/gha/track_workflow_to_posthog.py
          env:
              GITHUB_TOKEN: ${{ inputs.github-token }}
              # This is the public key for a custom CI analytics project for testing, it's not a leaked secret.
              POSTHOG_API_KEY: phc_90rMRdTaAI6S4qijwl0HI18UypvRq73M8lZFm6uEFbl
              POSTHOG_HOST: https://internal-t.posthog.com
              CI_ANALYTICS_SCOPE: ${{ inputs.scope }}
