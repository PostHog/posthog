# Generated by Django 4.2.26 on 2026-01-05 14:18

from django.db import migrations


class Migration(migrations.Migration):
    dependencies = [
        ("data_warehouse", "0012_externaldatasource_description"),
    ]

    operations = [
        migrations.RunSQL(
            """
BEGIN;
    CREATE TEMP TABLE dwh_tmp_creds AS
        SELECT DISTINCT credential_id
        FROM posthog_datawarehousetable
        WHERE external_data_source_id IS NOT NULL
        AND credential_id IS NOT NULL;

    UPDATE posthog_datawarehousetable t
    SET credential_id = NULL
    WHERE t.credential_id IN (SELECT credential_id FROM dwh_tmp_creds);

    DELETE FROM posthog_datawarehousecredential c
    WHERE c.id IN (SELECT credential_id FROM dwh_tmp_creds);
COMMIT;""",
            reverse_sql=migrations.RunSQL.noop,
        )
    ]
