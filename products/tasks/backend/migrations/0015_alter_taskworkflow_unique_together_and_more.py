# Generated by Django 4.2.26 on 2025-11-18 16:44

from django.db import migrations, models


class Migration(migrations.Migration):
    dependencies = [
        ("tasks", "0014_make_fields_nullable_before_removal"),
    ]

    operations = [
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.AlterUniqueTogether(
                    name="taskworkflow",
                    unique_together=None,
                ),
                migrations.RemoveField(
                    model_name="taskworkflow",
                    name="team",
                ),
                migrations.AlterUniqueTogether(
                    name="workflowstage",
                    unique_together=None,
                ),
                migrations.RemoveField(
                    model_name="workflowstage",
                    name="fallback_stage",
                ),
                migrations.RemoveField(
                    model_name="workflowstage",
                    name="workflow",
                ),
                migrations.AlterModelOptions(
                    name="task",
                    options={"managed": True},
                ),
                migrations.RemoveField(
                    model_name="task",
                    name="current_stage",
                ),
                migrations.RemoveField(
                    model_name="task",
                    name="github_branch",
                ),
                migrations.RemoveField(
                    model_name="task",
                    name="github_pr_url",
                ),
                migrations.RemoveField(
                    model_name="task",
                    name="position",
                ),
                migrations.RemoveField(
                    model_name="task",
                    name="repository_config",
                ),
                migrations.RemoveField(
                    model_name="task",
                    name="workflow",
                ),
                migrations.RemoveField(
                    model_name="taskrun",
                    name="current_stage",
                ),
                migrations.RemoveField(
                    model_name="taskrun",
                    name="log",
                ),
                migrations.DeleteModel(
                    name="TaskProgress",
                ),
                migrations.DeleteModel(
                    name="TaskWorkflow",
                ),
                migrations.DeleteModel(
                    name="WorkflowStage",
                ),
            ],
            database_operations=[
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_task_progress DROP CONSTRAINT IF EXISTS posthog_task_progress_team_id_f7089d31_fk_posthog_team_id;",
                    reverse_sql="ALTER TABLE posthog_task_progress ADD CONSTRAINT posthog_task_progress_team_id_f7089d31_fk_posthog_team_id FOREIGN KEY (team_id) REFERENCES posthog_team(id) ON DELETE CASCADE;",
                ),
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_task_progress DROP CONSTRAINT IF EXISTS posthog_task_progress_task_id_29a9ae43_fk_posthog_task_id;",
                    reverse_sql="ALTER TABLE posthog_task_progress ADD CONSTRAINT posthog_task_progress_task_id_29a9ae43_fk_posthog_task_id FOREIGN KEY (task_id) REFERENCES posthog_task(id) ON DELETE CASCADE;",
                ),
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_task_workflow DROP CONSTRAINT IF EXISTS posthog_task_workflow_team_id_5ec1d2ee_fk_posthog_team_id;",
                    reverse_sql="ALTER TABLE posthog_task_workflow ADD CONSTRAINT posthog_task_workflow_team_id_5ec1d2ee_fk_posthog_team_id FOREIGN KEY (team_id) REFERENCES posthog_team(id) ON DELETE CASCADE;",
                ),
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_workflow_stage DROP CONSTRAINT IF EXISTS posthog_workflow_sta_fallback_stage_id_1afe2fd4_fk_posthog_w;",
                    reverse_sql="ALTER TABLE posthog_workflow_stage ADD CONSTRAINT posthog_workflow_sta_fallback_stage_id_1afe2fd4_fk_posthog_w FOREIGN KEY (fallback_stage_id) REFERENCES posthog_workflow_stage(id) ON DELETE SET NULL;",
                ),
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_workflow_stage DROP CONSTRAINT IF EXISTS posthog_workflow_sta_workflow_id_aab23a48_fk_posthog_t;",
                    reverse_sql="ALTER TABLE posthog_workflow_stage ADD CONSTRAINT posthog_workflow_sta_workflow_id_aab23a48_fk_posthog_t FOREIGN KEY (workflow_id) REFERENCES posthog_task_workflow(id) ON DELETE CASCADE;",
                ),
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_task DROP CONSTRAINT IF EXISTS posthog_task_current_stage_id_9f282f7b_fk_posthog_w;",
                    reverse_sql="ALTER TABLE posthog_task ADD CONSTRAINT posthog_task_current_stage_id_9f282f7b_fk_posthog_w FOREIGN KEY (current_stage_id) REFERENCES posthog_workflow_stage(id) ON DELETE SET NULL;",
                ),
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_task DROP CONSTRAINT IF EXISTS posthog_task_workflow_id_0b39c75b_fk_posthog_task_workflow_id;",
                    reverse_sql="ALTER TABLE posthog_task ADD CONSTRAINT posthog_task_workflow_id_0b39c75b_fk_posthog_task_workflow_id FOREIGN KEY (workflow_id) REFERENCES posthog_task_workflow(id) ON DELETE SET NULL;",
                ),
                migrations.RunSQL(
                    sql="ALTER TABLE posthog_task_run DROP CONSTRAINT IF EXISTS posthog_task_run_current_stage_id_2f86e8d0_fk_posthog_w;",
                    reverse_sql="ALTER TABLE posthog_task_run ADD CONSTRAINT posthog_task_run_current_stage_id_2f86e8d0_fk_posthog_w FOREIGN KEY (current_stage_id) REFERENCES posthog_workflow_stage(id) ON DELETE SET NULL;",
                ),
            ],
        ),
        migrations.AddField(
            model_name="task",
            name="json_schema",
            field=models.JSONField(
                blank=True,
                default=None,
                help_text="JSON schema for the task. This is used to validate the output of the task.",
                null=True,
            ),
        ),
        migrations.AddField(
            model_name="task",
            name="repository",
            field=models.CharField(blank=True, max_length=255, null=True),
        ),
        migrations.AlterField(
            model_name="taskrun",
            name="stage",
            field=models.CharField(
                blank=True,
                help_text="Current stage for this run (e.g., 'research', 'plan', 'build')",
                max_length=100,
                null=True,
            ),
        ),
    ]
