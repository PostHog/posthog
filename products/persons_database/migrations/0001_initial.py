# Generated by Django 4.2.22 on 2025-08-20 23:22

import django.db.models.deletion
from django.db import migrations, models

import posthog.models.utils


class Migration(migrations.Migration):
    initial = True

    dependencies = []

    operations = [
        migrations.CreateModel(
            name="CohortPeople",
            fields=[
                ("id", models.BigAutoField(primary_key=True, serialize=False)),
                ("cohort_id", models.IntegerField()),
                ("version", models.IntegerField(blank=True, null=True)),
            ],
            options={
                "db_table": "posthog_cohortpeople",
            },
        ),
        migrations.CreateModel(
            name="FeatureFlagHashKeyOverride",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("feature_flag_key", models.CharField(max_length=400)),
                ("team_id", models.IntegerField()),
                ("hash_key", models.CharField(max_length=400)),
            ],
            options={
                "db_table": "posthog_featureflaghashkeyoverride",
            },
        ),
        migrations.CreateModel(
            name="FlatPersonOverride",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("team_id", models.BigIntegerField()),
                ("old_person_id", models.UUIDField()),
                ("override_person_id", models.UUIDField()),
                ("oldest_event", models.DateTimeField()),
                ("version", models.BigIntegerField(blank=True, null=True)),
            ],
            options={
                "db_table": "posthog_flatpersonoverride",
            },
        ),
        migrations.CreateModel(
            name="Group",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("team_id", models.IntegerField()),
                ("group_key", models.CharField(max_length=400)),
                ("group_type_index", models.IntegerField()),
                ("group_properties", models.JSONField(default=dict)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("properties_last_updated_at", models.JSONField(default=dict)),
                ("properties_last_operation", models.JSONField(default=dict)),
                ("version", models.BigIntegerField()),
            ],
            options={
                "db_table": "posthog_group",
            },
        ),
        migrations.CreateModel(
            name="PendingPersonOverride",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("team_id", models.BigIntegerField()),
                ("old_person_id", models.UUIDField()),
                ("override_person_id", models.UUIDField()),
                ("oldest_event", models.DateTimeField()),
            ],
            options={
                "db_table": "posthog_pendingpersonoverride",
            },
        ),
        migrations.CreateModel(
            name="Person",
            fields=[
                ("id", models.BigAutoField(primary_key=True, serialize=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("properties_last_updated_at", models.JSONField(blank=True, default=dict, null=True)),
                ("properties_last_operation", models.JSONField(blank=True, null=True)),
                ("team_id", models.IntegerField(db_index=True)),
                ("properties", models.JSONField(default=dict)),
                ("is_user", models.IntegerField(blank=True, db_column="is_user_id", null=True)),
                ("is_identified", models.BooleanField(default=False)),
                ("uuid", models.UUIDField(db_index=True, default=posthog.models.utils.UUIDT, editable=False)),
                ("version", models.BigIntegerField(blank=True, null=True)),
            ],
            options={
                "db_table": "posthog_person",
            },
        ),
        migrations.CreateModel(
            name="PersonDistinctId",
            fields=[
                ("id", models.BigAutoField(primary_key=True, serialize=False)),
                ("team_id", models.IntegerField()),
                ("distinct_id", models.CharField(max_length=400)),
                ("version", models.BigIntegerField(blank=True, null=True)),
            ],
            options={
                "db_table": "posthog_persondistinctid",
            },
        ),
        migrations.CreateModel(
            name="PersonlessDistinctId",
            fields=[
                ("id", models.BigAutoField(primary_key=True, serialize=False)),
                ("team_id", models.IntegerField()),
                ("distinct_id", models.CharField(max_length=400)),
                ("is_merged", models.BooleanField(default=False)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
            ],
            options={
                "db_table": "posthog_personlessdistinctid",
            },
        ),
        migrations.CreateModel(
            name="PersonOverride",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("team_id", models.IntegerField()),
                ("oldest_event", models.DateTimeField()),
                ("version", models.BigIntegerField(blank=True, null=True)),
            ],
            options={
                "db_table": "posthog_personoverride",
            },
        ),
        migrations.CreateModel(
            name="PersonOverrideMapping",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("team_id", models.BigIntegerField()),
                ("uuid", models.UUIDField()),
            ],
            options={
                "db_table": "posthog_personoverridemapping",
            },
        ),
        migrations.AddConstraint(
            model_name="personoverridemapping",
            constraint=models.UniqueConstraint(fields=("team_id", "uuid"), name="personsdb_unique_uuid"),
        ),
        migrations.AddField(
            model_name="personoverride",
            name="old_person_id",
            field=models.ForeignKey(
                db_column="old_person_id",
                on_delete=django.db.models.deletion.CASCADE,
                related_name="person_override_old",
                to="persons_database.personoverridemapping",
            ),
        ),
        migrations.AddField(
            model_name="personoverride",
            name="override_person_id",
            field=models.ForeignKey(
                db_column="override_person_id",
                on_delete=django.db.models.deletion.CASCADE,
                related_name="person_override_override",
                to="persons_database.personoverridemapping",
            ),
        ),
        migrations.AddConstraint(
            model_name="personlessdistinctid",
            constraint=models.UniqueConstraint(
                fields=("team_id", "distinct_id"), name="personsdb_unique_personless_distinct_id"
            ),
        ),
        migrations.AddField(
            model_name="persondistinctid",
            name="person",
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="persons_database.person"),
        ),
        migrations.AddIndex(
            model_name="person",
            index=models.Index(fields=["team_id", "-id"], name="posthog_per_team_id_bec4e5_idx"),
        ),
        migrations.AddConstraint(
            model_name="group",
            constraint=models.UniqueConstraint(
                fields=("team_id", "group_key", "group_type_index"), name="personsdb_unique_team_group_type_combo"
            ),
        ),
        migrations.AddIndex(
            model_name="flatpersonoverride",
            index=models.Index(fields=["team_id", "override_person_id"], name="personsdb_fla_team_override"),
        ),
        migrations.AddConstraint(
            model_name="flatpersonoverride",
            constraint=models.UniqueConstraint(fields=("team_id", "old_person_id"), name="unique_flat_override"),
        ),
        migrations.AddField(
            model_name="featureflaghashkeyoverride",
            name="person",
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="persons_database.person"),
        ),
        migrations.AddField(
            model_name="cohortpeople",
            name="person",
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="persons_database.person"),
        ),
        migrations.AddConstraint(
            model_name="personoverride",
            constraint=models.UniqueConstraint(
                fields=("team_id", "old_person_id"), name="personsdb_unique_override_per_old_person_id"
            ),
        ),
        migrations.AddConstraint(
            model_name="persondistinctid",
            constraint=models.UniqueConstraint(
                fields=("team_id", "distinct_id"), name="personsdb_unique_distinct_id_for_team"
            ),
        ),
        migrations.AddConstraint(
            model_name="featureflaghashkeyoverride",
            constraint=models.UniqueConstraint(
                fields=("team_id", "person", "feature_flag_key"), name="personsdb_unique_hash_key_combo"
            ),
        ),
        migrations.AddIndex(
            model_name="cohortpeople",
            index=models.Index(fields=["cohort_id", "person_id"], name="personsdb_cohort_person_idx"),
        ),
    ]
