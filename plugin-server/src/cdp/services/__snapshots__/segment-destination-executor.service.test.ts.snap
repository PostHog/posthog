// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`SegmentDestinationExecutorService segment plugins should call the plugin perform method 1`] = `
[
  {
    "level": "debug",
    "message": "config, {"apiKey":"api-key","user_id":"user-id","secretKey":"secret-key","device_id":"device-id","endpoint":"north_america","user_properties":{"$os":"Mac OS X","_kx":null,"epik":null,"test":"abcdefge","$host":"localhost:8010","dclid":null,"email":"max@posthog.com","gclid":null,"qclid":null,"realm":"hosted-clickhouse","sccid":null,"fbclid":null,"gbraid":null,"gclsrc":null,"igshid":null,"irclid":null,"mc_cid":null,"ttclid":null,"twclid":null,"wbraid":null,"msclkid":null,"rdt_cid":"asdfsad","$browser":"Chrome","utm_term":null,"$pathname":"/project/1/activity/explore","$referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","joined_at":"2025-04-04T11:33:18.022897+00:00","li_fat_id":null,"strapi_id":null,"gad_source":null,"project_id":"01960093-a4e7-0000-8ff1-00a3c4b4207c","utm_medium":null,"utm_source":null,"$initial_os":"Mac OS X","$os_version":"10.15.7","utm_content":null,"$current_url":"http://localhost:8000/project/1/activity/explore","$device_type":"Desktop","$initial__kx":null,"instance_tag":"none","instance_url":"http://localhost:8010","is_signed_up":true,"utm_campaign":null,"$initial_epik":null,"$initial_host":"localhost:8010","$screen_width":2560,"project_count":1,"$initial_dclid":null,"$initial_gclid":null,"$initial_qclid":null,"$initial_sccid":null,"$screen_height":1440,"$search_engine":"google","anonymize_data":false,"$geoip_latitude":-33.8715,"$initial_fbclid":null,"$initial_gbraid":null,"$initial_gclsrc":null,"$initial_igshid":null,"$initial_irclid":null,"$initial_mc_cid":null,"$initial_ttclid":null,"$initial_twclid":null,"$initial_wbraid":null,"$raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","$viewport_width":1698,"has_social_auth":false,"organization_id":"01960093-9cea-0000-8c9a-def990d34fbf","$browser_version":135,"$geoip_city_name":"Sydney","$geoip_longitude":151.2006,"$geoip_time_zone":"Australia/Sydney","$initial_browser":"Chrome","$initial_msclkid":null,"$initial_rdt_cid":null,"$viewport_height":1328,"has_password_set":true,"social_providers":[],"$initial_pathname":"/organization/billing","$initial_referrer":"$direct","$initial_utm_term":null,"$referring_domain":"localhost:8000","is_email_verified":false,"$geoip_postal_code":"2000","$initial_li_fat_id":null,"organization_count":1,"$creator_event_uuid":"01960095-8a86-73c9-9adc-0d586ad50a6a","$geoip_country_code":"AU","$geoip_country_name":"Australia","$initial_gad_source":null,"$initial_os_version":"15.2","$initial_utm_medium":null,"$initial_utm_source":null,"$initial_current_url":"http://localhost:8010/organization/billing?cancel=true","$initial_device_type":"Desktop","$initial_utm_content":null,"$geoip_continent_code":"OC","$geoip_continent_name":"Oceania","$initial_screen_width":2560,"$initial_utm_campaign":null,"team_member_count_all":1,"$geoip_accuracy_radius":20,"$geoip_city_confidence":null,"$initial_screen_height":1440,"project_setup_complete":false,"$initial_geoip_latitude":-33.8715,"$initial_raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36","$initial_viewport_width":1619,"$initial_browser_version":134,"$initial_geoip_city_name":"Sydney","$initial_geoip_longitude":151.2006,"$initial_geoip_time_zone":"Australia/Sydney","$initial_viewport_height":1328,"$geoip_subdivision_1_code":"NSW","$geoip_subdivision_1_name":"New South Wales","$geoip_subdivision_2_code":null,"$geoip_subdivision_2_name":null,"$initial_referring_domain":"$direct","completed_onboarding_once":false,"$initial_geoip_postal_code":"2000","has_seen_product_intro_for":{"surveys":true},"$initial_geoip_country_code":"AU","$initial_geoip_country_name":"Australia","$initial_geoip_continent_code":"OC","$initial_geoip_continent_name":"Oceania","$initial_geoip_accuracy_radius":20,"$initial_geoip_city_confidence":null,"$initial_geoip_subdivision_1_code":"NSW","$initial_geoip_subdivision_1_name":"New South Wales","$initial_geoip_subdivision_2_code":null,"$initial_geoip_subdivision_2_name":null,"current_organization_membership_level":15},"groups":{},"app_version":null,"platform":"Desktop","os_name":"Mac OS X","os_version":"10.15.7","device_brand":"","device_manufacturer":null,"device_model":null,"carrier":"","country":"Australia","region":"","city":"Sydney","language":null,"userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","userAgentParsing":true,"includeRawUserAgent":false,"utm_properties":{"utm_term":null,"utm_medium":null,"utm_source":null,"utm_content":null,"utm_campaign":null},"referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","library":"web","userAgentData":{"model":"","platformVersion":""},"internal_partner_action":"logEventV2","debug_mode":true}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "endpoint, https://api2.amplitude.com/2/httpapi",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "options, {"method":"post","json":{"api_key":"api-key","events":[{"os_name":"Mac OS X","os_version":"10.15.7","device_manufacturer":null,"device_model":null,"apiKey":"api-key","user_id":"user-id","secretKey":"secret-key","device_id":"device-id","endpoint":"north_america","user_properties":{"$os":"Mac OS X","_kx":null,"epik":null,"test":"abcdefge","$host":"localhost:8010","dclid":null,"email":"max@posthog.com","gclid":null,"qclid":null,"realm":"hosted-clickhouse","sccid":null,"fbclid":null,"gbraid":null,"gclsrc":null,"igshid":null,"irclid":null,"mc_cid":null,"ttclid":null,"twclid":null,"wbraid":null,"msclkid":null,"rdt_cid":"asdfsad","$browser":"Chrome","utm_term":null,"$pathname":"/project/1/activity/explore","$referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","joined_at":"2025-04-04T11:33:18.022897+00:00","li_fat_id":null,"strapi_id":null,"gad_source":null,"project_id":"01960093-a4e7-0000-8ff1-00a3c4b4207c","utm_medium":null,"utm_source":null,"$initial_os":"Mac OS X","$os_version":"10.15.7","utm_content":null,"$current_url":"http://localhost:8000/project/1/activity/explore","$device_type":"Desktop","$initial__kx":null,"instance_tag":"none","instance_url":"http://localhost:8010","is_signed_up":true,"utm_campaign":null,"$initial_epik":null,"$initial_host":"localhost:8010","$screen_width":2560,"project_count":1,"$initial_dclid":null,"$initial_gclid":null,"$initial_qclid":null,"$initial_sccid":null,"$screen_height":1440,"$search_engine":"google","anonymize_data":false,"$geoip_latitude":-33.8715,"$initial_fbclid":null,"$initial_gbraid":null,"$initial_gclsrc":null,"$initial_igshid":null,"$initial_irclid":null,"$initial_mc_cid":null,"$initial_ttclid":null,"$initial_twclid":null,"$initial_wbraid":null,"$raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","$viewport_width":1698,"has_social_auth":false,"organization_id":"01960093-9cea-0000-8c9a-def990d34fbf","$browser_version":135,"$geoip_city_name":"Sydney","$geoip_longitude":151.2006,"$geoip_time_zone":"Australia/Sydney","$initial_browser":"Chrome","$initial_msclkid":null,"$initial_rdt_cid":null,"$viewport_height":1328,"has_password_set":true,"social_providers":[],"$initial_pathname":"/organization/billing","$initial_referrer":"$direct","$initial_utm_term":null,"$referring_domain":"localhost:8000","is_email_verified":false,"$geoip_postal_code":"2000","$initial_li_fat_id":null,"organization_count":1,"$creator_event_uuid":"01960095-8a86-73c9-9adc-0d586ad50a6a","$geoip_country_code":"AU","$geoip_country_name":"Australia","$initial_gad_source":null,"$initial_os_version":"15.2","$initial_utm_medium":null,"$initial_utm_source":null,"$initial_current_url":"http://localhost:8010/organization/billing?cancel=true","$initial_device_type":"Desktop","$initial_utm_content":null,"$geoip_continent_code":"OC","$geoip_continent_name":"Oceania","$initial_screen_width":2560,"$initial_utm_campaign":null,"team_member_count_all":1,"$geoip_accuracy_radius":20,"$geoip_city_confidence":null,"$initial_screen_height":1440,"project_setup_complete":false,"$initial_geoip_latitude":-33.8715,"$initial_raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36","$initial_viewport_width":1619,"$initial_browser_version":134,"$initial_geoip_city_name":"Sydney","$initial_geoip_longitude":151.2006,"$initial_geoip_time_zone":"Australia/Sydney","$initial_viewport_height":1328,"$geoip_subdivision_1_code":"NSW","$geoip_subdivision_1_name":"New South Wales","$geoip_subdivision_2_code":null,"$geoip_subdivision_2_name":null,"$initial_referring_domain":"$direct","completed_onboarding_once":false,"$initial_geoip_postal_code":"2000","has_seen_product_intro_for":{"surveys":true},"$initial_geoip_country_code":"AU","$initial_geoip_country_name":"Australia","$initial_geoip_continent_code":"OC","$initial_geoip_continent_name":"Oceania","$initial_geoip_accuracy_radius":20,"$initial_geoip_city_confidence":null,"$initial_geoip_subdivision_1_code":"NSW","$initial_geoip_subdivision_1_name":"New South Wales","$initial_geoip_subdivision_2_code":null,"$initial_geoip_subdivision_2_name":null,"current_organization_membership_level":15},"groups":{},"app_version":null,"platform":"Desktop","device_brand":"","carrier":"","country":"Australia","region":"","city":"Sydney","language":null,"utm_properties":{"utm_term":null,"utm_medium":null,"utm_source":null,"utm_content":null,"utm_campaign":null},"referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","internal_partner_action":"logEventV2","debug_mode":true,"library":"segment"}]}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "requestExtension, ",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "headers, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "fetchOptions, {"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"api_key\\":\\"api-key\\",\\"events\\":[{\\"os_name\\":\\"Mac OS X\\",\\"os_version\\":\\"10.15.7\\",\\"device_manufacturer\\":null,\\"device_model\\":null,\\"apiKey\\":\\"api-key\\",\\"user_id\\":\\"user-id\\",\\"secretKey\\":\\"secret-key\\",\\"device_id\\":\\"device-id\\",\\"endpoint\\":\\"north_america\\",\\"user_properties\\":{\\"$os\\":\\"Mac OS X\\",\\"_kx\\":null,\\"epik\\":null,\\"test\\":\\"abcdefge\\",\\"$host\\":\\"localhost:8010\\",\\"dclid\\":null,\\"email\\":\\"max@posthog.com\\",\\"gclid\\":null,\\"qclid\\":null,\\"realm\\":\\"hosted-clickhouse\\",\\"sccid\\":null,\\"fbclid\\":null,\\"gbraid\\":null,\\"gclsrc\\":null,\\"igshid\\":null,\\"irclid\\":null,\\"mc_cid\\":null,\\"ttclid\\":null,\\"twclid\\":null,\\"wbraid\\":null,\\"msclkid\\":null,\\"rdt_cid\\":\\"asdfsad\\",\\"$browser\\":\\"Chrome\\",\\"utm_term\\":null,\\"$pathname\\":\\"/project/1/activity/explore\\",\\"$referrer\\":\\"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta\\",\\"joined_at\\":\\"2025-04-04T11:33:18.022897+00:00\\",\\"li_fat_id\\":null,\\"strapi_id\\":null,\\"gad_source\\":null,\\"project_id\\":\\"01960093-a4e7-0000-8ff1-00a3c4b4207c\\",\\"utm_medium\\":null,\\"utm_source\\":null,\\"$initial_os\\":\\"Mac OS X\\",\\"$os_version\\":\\"10.15.7\\",\\"utm_content\\":null,\\"$current_url\\":\\"http://localhost:8000/project/1/activity/explore\\",\\"$device_type\\":\\"Desktop\\",\\"$initial__kx\\":null,\\"instance_tag\\":\\"none\\",\\"instance_url\\":\\"http://localhost:8010\\",\\"is_signed_up\\":true,\\"utm_campaign\\":null,\\"$initial_epik\\":null,\\"$initial_host\\":\\"localhost:8010\\",\\"$screen_width\\":2560,\\"project_count\\":1,\\"$initial_dclid\\":null,\\"$initial_gclid\\":null,\\"$initial_qclid\\":null,\\"$initial_sccid\\":null,\\"$screen_height\\":1440,\\"$search_engine\\":\\"google\\",\\"anonymize_data\\":false,\\"$geoip_latitude\\":-33.8715,\\"$initial_fbclid\\":null,\\"$initial_gbraid\\":null,\\"$initial_gclsrc\\":null,\\"$initial_igshid\\":null,\\"$initial_irclid\\":null,\\"$initial_mc_cid\\":null,\\"$initial_ttclid\\":null,\\"$initial_twclid\\":null,\\"$initial_wbraid\\":null,\\"$raw_user_agent\\":\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36\\",\\"$viewport_width\\":1698,\\"has_social_auth\\":false,\\"organization_id\\":\\"01960093-9cea-0000-8c9a-def990d34fbf\\",\\"$browser_version\\":135,\\"$geoip_city_name\\":\\"Sydney\\",\\"$geoip_longitude\\":151.2006,\\"$geoip_time_zone\\":\\"Australia/Sydney\\",\\"$initial_browser\\":\\"Chrome\\",\\"$initial_msclkid\\":null,\\"$initial_rdt_cid\\":null,\\"$viewport_height\\":1328,\\"has_password_set\\":true,\\"social_providers\\":[],\\"$initial_pathname\\":\\"/organization/billing\\",\\"$initial_referrer\\":\\"$direct\\",\\"$initial_utm_term\\":null,\\"$referring_domain\\":\\"localhost:8000\\",\\"is_email_verified\\":false,\\"$geoip_postal_code\\":\\"2000\\",\\"$initial_li_fat_id\\":null,\\"organization_count\\":1,\\"$creator_event_uuid\\":\\"01960095-8a86-73c9-9adc-0d586ad50a6a\\",\\"$geoip_country_code\\":\\"AU\\",\\"$geoip_country_name\\":\\"Australia\\",\\"$initial_gad_source\\":null,\\"$initial_os_version\\":\\"15.2\\",\\"$initial_utm_medium\\":null,\\"$initial_utm_source\\":null,\\"$initial_current_url\\":\\"http://localhost:8010/organization/billing?cancel=true\\",\\"$initial_device_type\\":\\"Desktop\\",\\"$initial_utm_content\\":null,\\"$geoip_continent_code\\":\\"OC\\",\\"$geoip_continent_name\\":\\"Oceania\\",\\"$initial_screen_width\\":2560,\\"$initial_utm_campaign\\":null,\\"team_member_count_all\\":1,\\"$geoip_accuracy_radius\\":20,\\"$geoip_city_confidence\\":null,\\"$initial_screen_height\\":1440,\\"project_setup_complete\\":false,\\"$initial_geoip_latitude\\":-33.8715,\\"$initial_raw_user_agent\\":\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\",\\"$initial_viewport_width\\":1619,\\"$initial_browser_version\\":134,\\"$initial_geoip_city_name\\":\\"Sydney\\",\\"$initial_geoip_longitude\\":151.2006,\\"$initial_geoip_time_zone\\":\\"Australia/Sydney\\",\\"$initial_viewport_height\\":1328,\\"$geoip_subdivision_1_code\\":\\"NSW\\",\\"$geoip_subdivision_1_name\\":\\"New South Wales\\",\\"$geoip_subdivision_2_code\\":null,\\"$geoip_subdivision_2_name\\":null,\\"$initial_referring_domain\\":\\"$direct\\",\\"completed_onboarding_once\\":false,\\"$initial_geoip_postal_code\\":\\"2000\\",\\"has_seen_product_intro_for\\":{\\"surveys\\":true},\\"$initial_geoip_country_code\\":\\"AU\\",\\"$initial_geoip_country_name\\":\\"Australia\\",\\"$initial_geoip_continent_code\\":\\"OC\\",\\"$initial_geoip_continent_name\\":\\"Oceania\\",\\"$initial_geoip_accuracy_radius\\":20,\\"$initial_geoip_city_confidence\\":null,\\"$initial_geoip_subdivision_1_code\\":\\"NSW\\",\\"$initial_geoip_subdivision_1_name\\":\\"New South Wales\\",\\"$initial_geoip_subdivision_2_code\\":null,\\"$initial_geoip_subdivision_2_name\\":null,\\"current_organization_membership_level\\":15},\\"groups\\":{},\\"app_version\\":null,\\"platform\\":\\"Desktop\\",\\"device_brand\\":\\"\\",\\"carrier\\":\\"\\",\\"country\\":\\"Australia\\",\\"region\\":\\"\\",\\"city\\":\\"Sydney\\",\\"language\\":null,\\"utm_properties\\":{\\"utm_term\\":null,\\"utm_medium\\":null,\\"utm_source\\":null,\\"utm_content\\":null,\\"utm_campaign\\":null},\\"referrer\\":\\"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta\\",\\"internal_partner_action\\":\\"logEventV2\\",\\"debug_mode\\":true,\\"library\\":\\"segment\\"}]}"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "convertedResponse, 200, {"code":200,"server_upload_time":1747910402315,"payload_size_bytes":22207,"events_ingested":1}, {"code":200,"server_upload_time":1747910402315,"payload_size_bytes":22207,"events_ingested":1}, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "info",
    "message": "Function completed in [REPLACED]",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
]
`;

exports[`SegmentDestinationExecutorService segment plugins should call the plugin perform method 2`] = `
{
  "payload": {
    "apiKey": "api-key",
    "app_version": null,
    "carrier": "",
    "city": "Sydney",
    "country": "Australia",
    "debug_mode": true,
    "device_brand": "",
    "device_id": "device-id",
    "device_manufacturer": null,
    "device_model": null,
    "endpoint": "north_america",
    "groups": {},
    "includeRawUserAgent": false,
    "internal_partner_action": "logEventV2",
    "language": null,
    "library": "web",
    "os_name": "Mac OS X",
    "os_version": "10.15.7",
    "platform": "Desktop",
    "referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
    "region": "",
    "secretKey": "secret-key",
    "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
    "userAgentData": {
      "model": "",
      "platformVersion": "",
    },
    "userAgentParsing": true,
    "user_id": "user-id",
    "user_properties": {
      "$browser": "Chrome",
      "$browser_version": 135,
      "$creator_event_uuid": "<REPLACED-UUID-2>",
      "$current_url": "http://localhost:8000/project/1/activity/explore",
      "$device_type": "Desktop",
      "$geoip_accuracy_radius": 20,
      "$geoip_city_confidence": null,
      "$geoip_city_name": "Sydney",
      "$geoip_continent_code": "OC",
      "$geoip_continent_name": "Oceania",
      "$geoip_country_code": "AU",
      "$geoip_country_name": "Australia",
      "$geoip_latitude": -33.8715,
      "$geoip_longitude": 151.2006,
      "$geoip_postal_code": "2000",
      "$geoip_subdivision_1_code": "NSW",
      "$geoip_subdivision_1_name": "New South Wales",
      "$geoip_subdivision_2_code": null,
      "$geoip_subdivision_2_name": null,
      "$geoip_time_zone": "Australia/Sydney",
      "$host": "localhost:8010",
      "$initial__kx": null,
      "$initial_browser": "Chrome",
      "$initial_browser_version": 134,
      "$initial_current_url": "http://localhost:8010/organization/billing?cancel=true",
      "$initial_dclid": null,
      "$initial_device_type": "Desktop",
      "$initial_epik": null,
      "$initial_fbclid": null,
      "$initial_gad_source": null,
      "$initial_gbraid": null,
      "$initial_gclid": null,
      "$initial_gclsrc": null,
      "$initial_geoip_accuracy_radius": 20,
      "$initial_geoip_city_confidence": null,
      "$initial_geoip_city_name": "Sydney",
      "$initial_geoip_continent_code": "OC",
      "$initial_geoip_continent_name": "Oceania",
      "$initial_geoip_country_code": "AU",
      "$initial_geoip_country_name": "Australia",
      "$initial_geoip_latitude": -33.8715,
      "$initial_geoip_longitude": 151.2006,
      "$initial_geoip_postal_code": "2000",
      "$initial_geoip_subdivision_1_code": "NSW",
      "$initial_geoip_subdivision_1_name": "New South Wales",
      "$initial_geoip_subdivision_2_code": null,
      "$initial_geoip_subdivision_2_name": null,
      "$initial_geoip_time_zone": "Australia/Sydney",
      "$initial_host": "localhost:8010",
      "$initial_igshid": null,
      "$initial_irclid": null,
      "$initial_li_fat_id": null,
      "$initial_mc_cid": null,
      "$initial_msclkid": null,
      "$initial_os": "Mac OS X",
      "$initial_os_version": "15.2",
      "$initial_pathname": "/organization/billing",
      "$initial_qclid": null,
      "$initial_raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
      "$initial_rdt_cid": null,
      "$initial_referrer": "$direct",
      "$initial_referring_domain": "$direct",
      "$initial_sccid": null,
      "$initial_screen_height": 1440,
      "$initial_screen_width": 2560,
      "$initial_ttclid": null,
      "$initial_twclid": null,
      "$initial_utm_campaign": null,
      "$initial_utm_content": null,
      "$initial_utm_medium": null,
      "$initial_utm_source": null,
      "$initial_utm_term": null,
      "$initial_viewport_height": 1328,
      "$initial_viewport_width": 1619,
      "$initial_wbraid": null,
      "$os": "Mac OS X",
      "$os_version": "10.15.7",
      "$pathname": "/project/1/activity/explore",
      "$raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
      "$referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
      "$referring_domain": "localhost:8000",
      "$screen_height": 1440,
      "$screen_width": 2560,
      "$search_engine": "google",
      "$viewport_height": 1328,
      "$viewport_width": 1698,
      "_kx": null,
      "anonymize_data": false,
      "completed_onboarding_once": false,
      "current_organization_membership_level": 15,
      "dclid": null,
      "email": "max@posthog.com",
      "epik": null,
      "fbclid": null,
      "gad_source": null,
      "gbraid": null,
      "gclid": null,
      "gclsrc": null,
      "has_password_set": true,
      "has_seen_product_intro_for": {
        "surveys": true,
      },
      "has_social_auth": false,
      "igshid": null,
      "instance_tag": "none",
      "instance_url": "http://localhost:8010",
      "irclid": null,
      "is_email_verified": false,
      "is_signed_up": true,
      "joined_at": "2025-04-04T11:33:18.022897+00:00",
      "li_fat_id": null,
      "mc_cid": null,
      "msclkid": null,
      "organization_count": 1,
      "organization_id": "<REPLACED-UUID-1>",
      "project_count": 1,
      "project_id": "<REPLACED-UUID-0>",
      "project_setup_complete": false,
      "qclid": null,
      "rdt_cid": "asdfsad",
      "realm": "hosted-clickhouse",
      "sccid": null,
      "social_providers": [],
      "strapi_id": null,
      "team_member_count_all": 1,
      "test": "abcdefge",
      "ttclid": null,
      "twclid": null,
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
      "wbraid": null,
    },
    "utm_properties": {
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
    },
  },
  "settings": {
    "apiKey": "api-key",
    "app_version": null,
    "carrier": "",
    "city": "Sydney",
    "country": "Australia",
    "debug_mode": true,
    "device_brand": "",
    "device_id": "device-id",
    "device_manufacturer": null,
    "device_model": null,
    "endpoint": "north_america",
    "groups": {},
    "includeRawUserAgent": false,
    "internal_partner_action": "logEventV2",
    "language": null,
    "library": "web",
    "os_name": "Mac OS X",
    "os_version": "10.15.7",
    "platform": "Desktop",
    "referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
    "region": "",
    "secretKey": "secret-key",
    "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
    "userAgentData": {
      "model": "",
      "platformVersion": "",
    },
    "userAgentParsing": true,
    "user_id": "user-id",
    "user_properties": {
      "$browser": "Chrome",
      "$browser_version": 135,
      "$creator_event_uuid": "<REPLACED-UUID-2>",
      "$current_url": "http://localhost:8000/project/1/activity/explore",
      "$device_type": "Desktop",
      "$geoip_accuracy_radius": 20,
      "$geoip_city_confidence": null,
      "$geoip_city_name": "Sydney",
      "$geoip_continent_code": "OC",
      "$geoip_continent_name": "Oceania",
      "$geoip_country_code": "AU",
      "$geoip_country_name": "Australia",
      "$geoip_latitude": -33.8715,
      "$geoip_longitude": 151.2006,
      "$geoip_postal_code": "2000",
      "$geoip_subdivision_1_code": "NSW",
      "$geoip_subdivision_1_name": "New South Wales",
      "$geoip_subdivision_2_code": null,
      "$geoip_subdivision_2_name": null,
      "$geoip_time_zone": "Australia/Sydney",
      "$host": "localhost:8010",
      "$initial__kx": null,
      "$initial_browser": "Chrome",
      "$initial_browser_version": 134,
      "$initial_current_url": "http://localhost:8010/organization/billing?cancel=true",
      "$initial_dclid": null,
      "$initial_device_type": "Desktop",
      "$initial_epik": null,
      "$initial_fbclid": null,
      "$initial_gad_source": null,
      "$initial_gbraid": null,
      "$initial_gclid": null,
      "$initial_gclsrc": null,
      "$initial_geoip_accuracy_radius": 20,
      "$initial_geoip_city_confidence": null,
      "$initial_geoip_city_name": "Sydney",
      "$initial_geoip_continent_code": "OC",
      "$initial_geoip_continent_name": "Oceania",
      "$initial_geoip_country_code": "AU",
      "$initial_geoip_country_name": "Australia",
      "$initial_geoip_latitude": -33.8715,
      "$initial_geoip_longitude": 151.2006,
      "$initial_geoip_postal_code": "2000",
      "$initial_geoip_subdivision_1_code": "NSW",
      "$initial_geoip_subdivision_1_name": "New South Wales",
      "$initial_geoip_subdivision_2_code": null,
      "$initial_geoip_subdivision_2_name": null,
      "$initial_geoip_time_zone": "Australia/Sydney",
      "$initial_host": "localhost:8010",
      "$initial_igshid": null,
      "$initial_irclid": null,
      "$initial_li_fat_id": null,
      "$initial_mc_cid": null,
      "$initial_msclkid": null,
      "$initial_os": "Mac OS X",
      "$initial_os_version": "15.2",
      "$initial_pathname": "/organization/billing",
      "$initial_qclid": null,
      "$initial_raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
      "$initial_rdt_cid": null,
      "$initial_referrer": "$direct",
      "$initial_referring_domain": "$direct",
      "$initial_sccid": null,
      "$initial_screen_height": 1440,
      "$initial_screen_width": 2560,
      "$initial_ttclid": null,
      "$initial_twclid": null,
      "$initial_utm_campaign": null,
      "$initial_utm_content": null,
      "$initial_utm_medium": null,
      "$initial_utm_source": null,
      "$initial_utm_term": null,
      "$initial_viewport_height": 1328,
      "$initial_viewport_width": 1619,
      "$initial_wbraid": null,
      "$os": "Mac OS X",
      "$os_version": "10.15.7",
      "$pathname": "/project/1/activity/explore",
      "$raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
      "$referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
      "$referring_domain": "localhost:8000",
      "$screen_height": 1440,
      "$screen_width": 2560,
      "$search_engine": "google",
      "$viewport_height": 1328,
      "$viewport_width": 1698,
      "_kx": null,
      "anonymize_data": false,
      "completed_onboarding_once": false,
      "current_organization_membership_level": 15,
      "dclid": null,
      "email": "max@posthog.com",
      "epik": null,
      "fbclid": null,
      "gad_source": null,
      "gbraid": null,
      "gclid": null,
      "gclsrc": null,
      "has_password_set": true,
      "has_seen_product_intro_for": {
        "surveys": true,
      },
      "has_social_auth": false,
      "igshid": null,
      "instance_tag": "none",
      "instance_url": "http://localhost:8010",
      "irclid": null,
      "is_email_verified": false,
      "is_signed_up": true,
      "joined_at": "2025-04-04T11:33:18.022897+00:00",
      "li_fat_id": null,
      "mc_cid": null,
      "msclkid": null,
      "organization_count": 1,
      "organization_id": "<REPLACED-UUID-1>",
      "project_count": 1,
      "project_id": "<REPLACED-UUID-0>",
      "project_setup_complete": false,
      "qclid": null,
      "rdt_cid": "asdfsad",
      "realm": "hosted-clickhouse",
      "sccid": null,
      "social_providers": [],
      "strapi_id": null,
      "team_member_count_all": 1,
      "test": "abcdefge",
      "ttclid": null,
      "twclid": null,
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
      "wbraid": null,
    },
    "utm_properties": {
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
    },
  },
}
`;

exports[`SegmentDestinationExecutorService segment plugins should handle non retryable fetch errors 1`] = `
[
  {
    "level": "debug",
    "message": "config, {"apiKey":"api-key","user_id":"user-id","secretKey":"secret-key","device_id":"device-id","endpoint":"north_america","user_properties":{"$os":"Mac OS X","_kx":null,"epik":null,"test":"abcdefge","$host":"localhost:8010","dclid":null,"email":"max@posthog.com","gclid":null,"qclid":null,"realm":"hosted-clickhouse","sccid":null,"fbclid":null,"gbraid":null,"gclsrc":null,"igshid":null,"irclid":null,"mc_cid":null,"ttclid":null,"twclid":null,"wbraid":null,"msclkid":null,"rdt_cid":"asdfsad","$browser":"Chrome","utm_term":null,"$pathname":"/project/1/activity/explore","$referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","joined_at":"2025-04-04T11:33:18.022897+00:00","li_fat_id":null,"strapi_id":null,"gad_source":null,"project_id":"<REPLACED-UUID-0>","utm_medium":null,"utm_source":null,"$initial_os":"Mac OS X","$os_version":"10.15.7","utm_content":null,"$current_url":"http://localhost:8000/project/1/activity/explore","$device_type":"Desktop","$initial__kx":null,"instance_tag":"none","instance_url":"http://localhost:8010","is_signed_up":true,"utm_campaign":null,"$initial_epik":null,"$initial_host":"localhost:8010","$screen_width":2560,"project_count":1,"$initial_dclid":null,"$initial_gclid":null,"$initial_qclid":null,"$initial_sccid":null,"$screen_height":1440,"$search_engine":"google","anonymize_data":false,"$geoip_latitude":-33.8715,"$initial_fbclid":null,"$initial_gbraid":null,"$initial_gclsrc":null,"$initial_igshid":null,"$initial_irclid":null,"$initial_mc_cid":null,"$initial_ttclid":null,"$initial_twclid":null,"$initial_wbraid":null,"$raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","$viewport_width":1698,"has_social_auth":false,"organization_id":"<REPLACED-UUID-1>","$browser_version":135,"$geoip_city_name":"Sydney","$geoip_longitude":151.2006,"$geoip_time_zone":"Australia/Sydney","$initial_browser":"Chrome","$initial_msclkid":null,"$initial_rdt_cid":null,"$viewport_height":1328,"has_password_set":true,"social_providers":[],"$initial_pathname":"/organization/billing","$initial_referrer":"$direct","$initial_utm_term":null,"$referring_domain":"localhost:8000","is_email_verified":false,"$geoip_postal_code":"2000","$initial_li_fat_id":null,"organization_count":1,"$creator_event_uuid":"<REPLACED-UUID-2>","$geoip_country_code":"AU","$geoip_country_name":"Australia","$initial_gad_source":null,"$initial_os_version":"15.2","$initial_utm_medium":null,"$initial_utm_source":null,"$initial_current_url":"http://localhost:8010/organization/billing?cancel=true","$initial_device_type":"Desktop","$initial_utm_content":null,"$geoip_continent_code":"OC","$geoip_continent_name":"Oceania","$initial_screen_width":2560,"$initial_utm_campaign":null,"team_member_count_all":1,"$geoip_accuracy_radius":20,"$geoip_city_confidence":null,"$initial_screen_height":1440,"project_setup_complete":false,"$initial_geoip_latitude":-33.8715,"$initial_raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36","$initial_viewport_width":1619,"$initial_browser_version":134,"$initial_geoip_city_name":"Sydney","$initial_geoip_longitude":151.2006,"$initial_geoip_time_zone":"Australia/Sydney","$initial_viewport_height":1328,"$geoip_subdivision_1_code":"NSW","$geoip_subdivision_1_name":"New South Wales","$geoip_subdivision_2_code":null,"$geoip_subdivision_2_name":null,"$initial_referring_domain":"$direct","completed_onboarding_once":false,"$initial_geoip_postal_code":"2000","has_seen_product_intro_for":{"surveys":true},"$initial_geoip_country_code":"AU","$initial_geoip_country_name":"Australia","$initial_geoip_continent_code":"OC","$initial_geoip_continent_name":"Oceania","$initial_geoip_accuracy_radius":20,"$initial_geoip_city_confidence":null,"$initial_geoip_subdivision_1_code":"NSW","$initial_geoip_subdivision_1_name":"New South Wales","$initial_geoip_subdivision_2_code":null,"$initial_geoip_subdivision_2_name":null,"current_organization_membership_level":15},"groups":{},"app_version":null,"platform":"Desktop","os_name":"Mac OS X","os_version":"10.15.7","device_brand":"","device_manufacturer":null,"device_model":null,"carrier":"","country":"Australia","region":"","city":"Sydney","language":null,"userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","userAgentParsing":true,"includeRawUserAgent":false,"utm_properties":{"utm_term":null,"utm_medium":null,"utm_source":null,"utm_content":null,"utm_campaign":null},"referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","library":"web","userAgentData":{"model":"","platformVersion":""},"internal_partner_action":"logEventV2","debug_mode":true}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "endpoint, https://api2.amplitude.com/2/httpapi",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "options, {"method":"post","json":{"api_key":"api-key","events":[{"os_name":"Mac OS X","os_version":"10.15.7","device_manufacturer":null,"device_model":null,"apiKey":"api-key","user_id":"user-id","secretKey":"secret-key","device_id":"device-id","endpoint":"north_america","user_properties":{"$os":"Mac OS X","_kx":null,"epik":null,"test":"abcdefge","$host":"localhost:8010","dclid":null,"email":"max@posthog.com","gclid":null,"qclid":null,"realm":"hosted-clickhouse","sccid":null,"fbclid":null,"gbraid":null,"gclsrc":null,"igshid":null,"irclid":null,"mc_cid":null,"ttclid":null,"twclid":null,"wbraid":null,"msclkid":null,"rdt_cid":"asdfsad","$browser":"Chrome","utm_term":null,"$pathname":"/project/1/activity/explore","$referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","joined_at":"2025-04-04T11:33:18.022897+00:00","li_fat_id":null,"strapi_id":null,"gad_source":null,"project_id":"<REPLACED-UUID-0>","utm_medium":null,"utm_source":null,"$initial_os":"Mac OS X","$os_version":"10.15.7","utm_content":null,"$current_url":"http://localhost:8000/project/1/activity/explore","$device_type":"Desktop","$initial__kx":null,"instance_tag":"none","instance_url":"http://localhost:8010","is_signed_up":true,"utm_campaign":null,"$initial_epik":null,"$initial_host":"localhost:8010","$screen_width":2560,"project_count":1,"$initial_dclid":null,"$initial_gclid":null,"$initial_qclid":null,"$initial_sccid":null,"$screen_height":1440,"$search_engine":"google","anonymize_data":false,"$geoip_latitude":-33.8715,"$initial_fbclid":null,"$initial_gbraid":null,"$initial_gclsrc":null,"$initial_igshid":null,"$initial_irclid":null,"$initial_mc_cid":null,"$initial_ttclid":null,"$initial_twclid":null,"$initial_wbraid":null,"$raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","$viewport_width":1698,"has_social_auth":false,"organization_id":"<REPLACED-UUID-1>","$browser_version":135,"$geoip_city_name":"Sydney","$geoip_longitude":151.2006,"$geoip_time_zone":"Australia/Sydney","$initial_browser":"Chrome","$initial_msclkid":null,"$initial_rdt_cid":null,"$viewport_height":1328,"has_password_set":true,"social_providers":[],"$initial_pathname":"/organization/billing","$initial_referrer":"$direct","$initial_utm_term":null,"$referring_domain":"localhost:8000","is_email_verified":false,"$geoip_postal_code":"2000","$initial_li_fat_id":null,"organization_count":1,"$creator_event_uuid":"<REPLACED-UUID-2>","$geoip_country_code":"AU","$geoip_country_name":"Australia","$initial_gad_source":null,"$initial_os_version":"15.2","$initial_utm_medium":null,"$initial_utm_source":null,"$initial_current_url":"http://localhost:8010/organization/billing?cancel=true","$initial_device_type":"Desktop","$initial_utm_content":null,"$geoip_continent_code":"OC","$geoip_continent_name":"Oceania","$initial_screen_width":2560,"$initial_utm_campaign":null,"team_member_count_all":1,"$geoip_accuracy_radius":20,"$geoip_city_confidence":null,"$initial_screen_height":1440,"project_setup_complete":false,"$initial_geoip_latitude":-33.8715,"$initial_raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36","$initial_viewport_width":1619,"$initial_browser_version":134,"$initial_geoip_city_name":"Sydney","$initial_geoip_longitude":151.2006,"$initial_geoip_time_zone":"Australia/Sydney","$initial_viewport_height":1328,"$geoip_subdivision_1_code":"NSW","$geoip_subdivision_1_name":"New South Wales","$geoip_subdivision_2_code":null,"$geoip_subdivision_2_name":null,"$initial_referring_domain":"$direct","completed_onboarding_once":false,"$initial_geoip_postal_code":"2000","has_seen_product_intro_for":{"surveys":true},"$initial_geoip_country_code":"AU","$initial_geoip_country_name":"Australia","$initial_geoip_continent_code":"OC","$initial_geoip_continent_name":"Oceania","$initial_geoip_accuracy_radius":20,"$initial_geoip_city_confidence":null,"$initial_geoip_subdivision_1_code":"NSW","$initial_geoip_subdivision_1_name":"New South Wales","$initial_geoip_subdivision_2_code":null,"$initial_geoip_subdivision_2_name":null,"current_organization_membership_level":15},"groups":{},"app_version":null,"platform":"Desktop","device_brand":"","carrier":"","country":"Australia","region":"","city":"Sydney","language":null,"utm_properties":{"utm_term":null,"utm_medium":null,"utm_source":null,"utm_content":null,"utm_campaign":null},"referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","internal_partner_action":"logEventV2","debug_mode":true,"library":"segment"}]}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "requestExtension, ",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "headers, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "fetchOptions, {"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"api_key\\":\\"api-key\\",\\"events\\":[{\\"os_name\\":\\"Mac OS X\\",\\"os_version\\":\\"10.15.7\\",\\"device_manufacturer\\":null,\\"device_model\\":null,\\"apiKey\\":\\"api-key\\",\\"user_id\\":\\"user-id\\",\\"secretKey\\":\\"secret-key\\",\\"device_id\\":\\"device-id\\",\\"endpoint\\":\\"north_america\\",\\"user_properties\\":{\\"$os\\":\\"Mac OS X\\",\\"_kx\\":null,\\"epik\\":null,\\"test\\":\\"abcdefge\\",\\"$host\\":\\"localhost:8010\\",\\"dclid\\":null,\\"email\\":\\"max@posthog.com\\",\\"gclid\\":null,\\"qclid\\":null,\\"realm\\":\\"hosted-clickhouse\\",\\"sccid\\":null,\\"fbclid\\":null,\\"gbraid\\":null,\\"gclsrc\\":null,\\"igshid\\":null,\\"irclid\\":null,\\"mc_cid\\":null,\\"ttclid\\":null,\\"twclid\\":null,\\"wbraid\\":null,\\"msclkid\\":null,\\"rdt_cid\\":\\"asdfsad\\",\\"$browser\\":\\"Chrome\\",\\"utm_term\\":null,\\"$pathname\\":\\"/project/1/activity/explore\\",\\"$referrer\\":\\"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta\\",\\"joined_at\\":\\"2025-04-04T11:33:18.022897+00:00\\",\\"li_fat_id\\":null,\\"strapi_id\\":null,\\"gad_source\\":null,\\"project_id\\":\\"<REPLACED-UUID-0>\\",\\"utm_medium\\":null,\\"utm_source\\":null,\\"$initial_os\\":\\"Mac OS X\\",\\"$os_version\\":\\"10.15.7\\",\\"utm_content\\":null,\\"$current_url\\":\\"http://localhost:8000/project/1/activity/explore\\",\\"$device_type\\":\\"Desktop\\",\\"$initial__kx\\":null,\\"instance_tag\\":\\"none\\",\\"instance_url\\":\\"http://localhost:8010\\",\\"is_signed_up\\":true,\\"utm_campaign\\":null,\\"$initial_epik\\":null,\\"$initial_host\\":\\"localhost:8010\\",\\"$screen_width\\":2560,\\"project_count\\":1,\\"$initial_dclid\\":null,\\"$initial_gclid\\":null,\\"$initial_qclid\\":null,\\"$initial_sccid\\":null,\\"$screen_height\\":1440,\\"$search_engine\\":\\"google\\",\\"anonymize_data\\":false,\\"$geoip_latitude\\":-33.8715,\\"$initial_fbclid\\":null,\\"$initial_gbraid\\":null,\\"$initial_gclsrc\\":null,\\"$initial_igshid\\":null,\\"$initial_irclid\\":null,\\"$initial_mc_cid\\":null,\\"$initial_ttclid\\":null,\\"$initial_twclid\\":null,\\"$initial_wbraid\\":null,\\"$raw_user_agent\\":\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36\\",\\"$viewport_width\\":1698,\\"has_social_auth\\":false,\\"organization_id\\":\\"<REPLACED-UUID-1>\\",\\"$browser_version\\":135,\\"$geoip_city_name\\":\\"Sydney\\",\\"$geoip_longitude\\":151.2006,\\"$geoip_time_zone\\":\\"Australia/Sydney\\",\\"$initial_browser\\":\\"Chrome\\",\\"$initial_msclkid\\":null,\\"$initial_rdt_cid\\":null,\\"$viewport_height\\":1328,\\"has_password_set\\":true,\\"social_providers\\":[],\\"$initial_pathname\\":\\"/organization/billing\\",\\"$initial_referrer\\":\\"$direct\\",\\"$initial_utm_term\\":null,\\"$referring_domain\\":\\"localhost:8000\\",\\"is_email_verified\\":false,\\"$geoip_postal_code\\":\\"2000\\",\\"$initial_li_fat_id\\":null,\\"organization_count\\":1,\\"$creator_event_uuid\\":\\"<REPLACED-UUID-2>\\",\\"$geoip_country_code\\":\\"AU\\",\\"$geoip_country_name\\":\\"Australia\\",\\"$initial_gad_source\\":null,\\"$initial_os_version\\":\\"15.2\\",\\"$initial_utm_medium\\":null,\\"$initial_utm_source\\":null,\\"$initial_current_url\\":\\"http://localhost:8010/organization/billing?cancel=true\\",\\"$initial_device_type\\":\\"Desktop\\",\\"$initial_utm_content\\":null,\\"$geoip_continent_code\\":\\"OC\\",\\"$geoip_continent_name\\":\\"Oceania\\",\\"$initial_screen_width\\":2560,\\"$initial_utm_campaign\\":null,\\"team_member_count_all\\":1,\\"$geoip_accuracy_radius\\":20,\\"$geoip_city_confidence\\":null,\\"$initial_screen_height\\":1440,\\"project_setup_complete\\":false,\\"$initial_geoip_latitude\\":-33.8715,\\"$initial_raw_user_agent\\":\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\",\\"$initial_viewport_width\\":1619,\\"$initial_browser_version\\":134,\\"$initial_geoip_city_name\\":\\"Sydney\\",\\"$initial_geoip_longitude\\":151.2006,\\"$initial_geoip_time_zone\\":\\"Australia/Sydney\\",\\"$initial_viewport_height\\":1328,\\"$geoip_subdivision_1_code\\":\\"NSW\\",\\"$geoip_subdivision_1_name\\":\\"New South Wales\\",\\"$geoip_subdivision_2_code\\":null,\\"$geoip_subdivision_2_name\\":null,\\"$initial_referring_domain\\":\\"$direct\\",\\"completed_onboarding_once\\":false,\\"$initial_geoip_postal_code\\":\\"2000\\",\\"has_seen_product_intro_for\\":{\\"surveys\\":true},\\"$initial_geoip_country_code\\":\\"AU\\",\\"$initial_geoip_country_name\\":\\"Australia\\",\\"$initial_geoip_continent_code\\":\\"OC\\",\\"$initial_geoip_continent_name\\":\\"Oceania\\",\\"$initial_geoip_accuracy_radius\\":20,\\"$initial_geoip_city_confidence\\":null,\\"$initial_geoip_subdivision_1_code\\":\\"NSW\\",\\"$initial_geoip_subdivision_1_name\\":\\"New South Wales\\",\\"$initial_geoip_subdivision_2_code\\":null,\\"$initial_geoip_subdivision_2_name\\":null,\\"current_organization_membership_level\\":15},\\"groups\\":{},\\"app_version\\":null,\\"platform\\":\\"Desktop\\",\\"device_brand\\":\\"\\",\\"carrier\\":\\"\\",\\"country\\":\\"Australia\\",\\"region\\":\\"\\",\\"city\\":\\"Sydney\\",\\"language\\":null,\\"utm_properties\\":{\\"utm_term\\":null,\\"utm_medium\\":null,\\"utm_source\\":null,\\"utm_content\\":null,\\"utm_campaign\\":null},\\"referrer\\":\\"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta\\",\\"internal_partner_action\\":\\"logEventV2\\",\\"debug_mode\\":true,\\"library\\":\\"segment\\"}]}"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "warn",
    "message": "HTTP request failed with status 403 ({"error":"Forbidden"}).  max retries: 3",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "error",
    "message": "Function failed: Error executing function on event uuid: Request failed with status 403 ({"error":"Forbidden"})",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
]
`;

exports[`SegmentDestinationExecutorService segment plugins should handle non retryable fetch errors 2`] = `
{
  "payload": {
    "apiKey": "api-key",
    "app_version": null,
    "carrier": "",
    "city": "Sydney",
    "country": "Australia",
    "debug_mode": true,
    "device_brand": "",
    "device_id": "device-id",
    "device_manufacturer": null,
    "device_model": null,
    "endpoint": "north_america",
    "groups": {},
    "includeRawUserAgent": false,
    "internal_partner_action": "logEventV2",
    "language": null,
    "library": "web",
    "os_name": "Mac OS X",
    "os_version": "10.15.7",
    "platform": "Desktop",
    "referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
    "region": "",
    "secretKey": "secret-key",
    "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
    "userAgentData": {
      "model": "",
      "platformVersion": "",
    },
    "userAgentParsing": true,
    "user_id": "user-id",
    "user_properties": {
      "$browser": "Chrome",
      "$browser_version": 135,
      "$creator_event_uuid": "<REPLACED-UUID-2>",
      "$current_url": "http://localhost:8000/project/1/activity/explore",
      "$device_type": "Desktop",
      "$geoip_accuracy_radius": 20,
      "$geoip_city_confidence": null,
      "$geoip_city_name": "Sydney",
      "$geoip_continent_code": "OC",
      "$geoip_continent_name": "Oceania",
      "$geoip_country_code": "AU",
      "$geoip_country_name": "Australia",
      "$geoip_latitude": -33.8715,
      "$geoip_longitude": 151.2006,
      "$geoip_postal_code": "2000",
      "$geoip_subdivision_1_code": "NSW",
      "$geoip_subdivision_1_name": "New South Wales",
      "$geoip_subdivision_2_code": null,
      "$geoip_subdivision_2_name": null,
      "$geoip_time_zone": "Australia/Sydney",
      "$host": "localhost:8010",
      "$initial__kx": null,
      "$initial_browser": "Chrome",
      "$initial_browser_version": 134,
      "$initial_current_url": "http://localhost:8010/organization/billing?cancel=true",
      "$initial_dclid": null,
      "$initial_device_type": "Desktop",
      "$initial_epik": null,
      "$initial_fbclid": null,
      "$initial_gad_source": null,
      "$initial_gbraid": null,
      "$initial_gclid": null,
      "$initial_gclsrc": null,
      "$initial_geoip_accuracy_radius": 20,
      "$initial_geoip_city_confidence": null,
      "$initial_geoip_city_name": "Sydney",
      "$initial_geoip_continent_code": "OC",
      "$initial_geoip_continent_name": "Oceania",
      "$initial_geoip_country_code": "AU",
      "$initial_geoip_country_name": "Australia",
      "$initial_geoip_latitude": -33.8715,
      "$initial_geoip_longitude": 151.2006,
      "$initial_geoip_postal_code": "2000",
      "$initial_geoip_subdivision_1_code": "NSW",
      "$initial_geoip_subdivision_1_name": "New South Wales",
      "$initial_geoip_subdivision_2_code": null,
      "$initial_geoip_subdivision_2_name": null,
      "$initial_geoip_time_zone": "Australia/Sydney",
      "$initial_host": "localhost:8010",
      "$initial_igshid": null,
      "$initial_irclid": null,
      "$initial_li_fat_id": null,
      "$initial_mc_cid": null,
      "$initial_msclkid": null,
      "$initial_os": "Mac OS X",
      "$initial_os_version": "15.2",
      "$initial_pathname": "/organization/billing",
      "$initial_qclid": null,
      "$initial_raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
      "$initial_rdt_cid": null,
      "$initial_referrer": "$direct",
      "$initial_referring_domain": "$direct",
      "$initial_sccid": null,
      "$initial_screen_height": 1440,
      "$initial_screen_width": 2560,
      "$initial_ttclid": null,
      "$initial_twclid": null,
      "$initial_utm_campaign": null,
      "$initial_utm_content": null,
      "$initial_utm_medium": null,
      "$initial_utm_source": null,
      "$initial_utm_term": null,
      "$initial_viewport_height": 1328,
      "$initial_viewport_width": 1619,
      "$initial_wbraid": null,
      "$os": "Mac OS X",
      "$os_version": "10.15.7",
      "$pathname": "/project/1/activity/explore",
      "$raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
      "$referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
      "$referring_domain": "localhost:8000",
      "$screen_height": 1440,
      "$screen_width": 2560,
      "$search_engine": "google",
      "$viewport_height": 1328,
      "$viewport_width": 1698,
      "_kx": null,
      "anonymize_data": false,
      "completed_onboarding_once": false,
      "current_organization_membership_level": 15,
      "dclid": null,
      "email": "max@posthog.com",
      "epik": null,
      "fbclid": null,
      "gad_source": null,
      "gbraid": null,
      "gclid": null,
      "gclsrc": null,
      "has_password_set": true,
      "has_seen_product_intro_for": {
        "surveys": true,
      },
      "has_social_auth": false,
      "igshid": null,
      "instance_tag": "none",
      "instance_url": "http://localhost:8010",
      "irclid": null,
      "is_email_verified": false,
      "is_signed_up": true,
      "joined_at": "2025-04-04T11:33:18.022897+00:00",
      "li_fat_id": null,
      "mc_cid": null,
      "msclkid": null,
      "organization_count": 1,
      "organization_id": "<REPLACED-UUID-1>",
      "project_count": 1,
      "project_id": "<REPLACED-UUID-0>",
      "project_setup_complete": false,
      "qclid": null,
      "rdt_cid": "asdfsad",
      "realm": "hosted-clickhouse",
      "sccid": null,
      "social_providers": [],
      "strapi_id": null,
      "team_member_count_all": 1,
      "test": "abcdefge",
      "ttclid": null,
      "twclid": null,
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
      "wbraid": null,
    },
    "utm_properties": {
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
    },
  },
  "settings": {
    "apiKey": "api-key",
    "app_version": null,
    "carrier": "",
    "city": "Sydney",
    "country": "Australia",
    "debug_mode": true,
    "device_brand": "",
    "device_id": "device-id",
    "device_manufacturer": null,
    "device_model": null,
    "endpoint": "north_america",
    "groups": {},
    "includeRawUserAgent": false,
    "internal_partner_action": "logEventV2",
    "language": null,
    "library": "web",
    "os_name": "Mac OS X",
    "os_version": "10.15.7",
    "platform": "Desktop",
    "referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
    "region": "",
    "secretKey": "secret-key",
    "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
    "userAgentData": {
      "model": "",
      "platformVersion": "",
    },
    "userAgentParsing": true,
    "user_id": "user-id",
    "user_properties": {
      "$browser": "Chrome",
      "$browser_version": 135,
      "$creator_event_uuid": "<REPLACED-UUID-2>",
      "$current_url": "http://localhost:8000/project/1/activity/explore",
      "$device_type": "Desktop",
      "$geoip_accuracy_radius": 20,
      "$geoip_city_confidence": null,
      "$geoip_city_name": "Sydney",
      "$geoip_continent_code": "OC",
      "$geoip_continent_name": "Oceania",
      "$geoip_country_code": "AU",
      "$geoip_country_name": "Australia",
      "$geoip_latitude": -33.8715,
      "$geoip_longitude": 151.2006,
      "$geoip_postal_code": "2000",
      "$geoip_subdivision_1_code": "NSW",
      "$geoip_subdivision_1_name": "New South Wales",
      "$geoip_subdivision_2_code": null,
      "$geoip_subdivision_2_name": null,
      "$geoip_time_zone": "Australia/Sydney",
      "$host": "localhost:8010",
      "$initial__kx": null,
      "$initial_browser": "Chrome",
      "$initial_browser_version": 134,
      "$initial_current_url": "http://localhost:8010/organization/billing?cancel=true",
      "$initial_dclid": null,
      "$initial_device_type": "Desktop",
      "$initial_epik": null,
      "$initial_fbclid": null,
      "$initial_gad_source": null,
      "$initial_gbraid": null,
      "$initial_gclid": null,
      "$initial_gclsrc": null,
      "$initial_geoip_accuracy_radius": 20,
      "$initial_geoip_city_confidence": null,
      "$initial_geoip_city_name": "Sydney",
      "$initial_geoip_continent_code": "OC",
      "$initial_geoip_continent_name": "Oceania",
      "$initial_geoip_country_code": "AU",
      "$initial_geoip_country_name": "Australia",
      "$initial_geoip_latitude": -33.8715,
      "$initial_geoip_longitude": 151.2006,
      "$initial_geoip_postal_code": "2000",
      "$initial_geoip_subdivision_1_code": "NSW",
      "$initial_geoip_subdivision_1_name": "New South Wales",
      "$initial_geoip_subdivision_2_code": null,
      "$initial_geoip_subdivision_2_name": null,
      "$initial_geoip_time_zone": "Australia/Sydney",
      "$initial_host": "localhost:8010",
      "$initial_igshid": null,
      "$initial_irclid": null,
      "$initial_li_fat_id": null,
      "$initial_mc_cid": null,
      "$initial_msclkid": null,
      "$initial_os": "Mac OS X",
      "$initial_os_version": "15.2",
      "$initial_pathname": "/organization/billing",
      "$initial_qclid": null,
      "$initial_raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
      "$initial_rdt_cid": null,
      "$initial_referrer": "$direct",
      "$initial_referring_domain": "$direct",
      "$initial_sccid": null,
      "$initial_screen_height": 1440,
      "$initial_screen_width": 2560,
      "$initial_ttclid": null,
      "$initial_twclid": null,
      "$initial_utm_campaign": null,
      "$initial_utm_content": null,
      "$initial_utm_medium": null,
      "$initial_utm_source": null,
      "$initial_utm_term": null,
      "$initial_viewport_height": 1328,
      "$initial_viewport_width": 1619,
      "$initial_wbraid": null,
      "$os": "Mac OS X",
      "$os_version": "10.15.7",
      "$pathname": "/project/1/activity/explore",
      "$raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
      "$referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
      "$referring_domain": "localhost:8000",
      "$screen_height": 1440,
      "$screen_width": 2560,
      "$search_engine": "google",
      "$viewport_height": 1328,
      "$viewport_width": 1698,
      "_kx": null,
      "anonymize_data": false,
      "completed_onboarding_once": false,
      "current_organization_membership_level": 15,
      "dclid": null,
      "email": "max@posthog.com",
      "epik": null,
      "fbclid": null,
      "gad_source": null,
      "gbraid": null,
      "gclid": null,
      "gclsrc": null,
      "has_password_set": true,
      "has_seen_product_intro_for": {
        "surveys": true,
      },
      "has_social_auth": false,
      "igshid": null,
      "instance_tag": "none",
      "instance_url": "http://localhost:8010",
      "irclid": null,
      "is_email_verified": false,
      "is_signed_up": true,
      "joined_at": "2025-04-04T11:33:18.022897+00:00",
      "li_fat_id": null,
      "mc_cid": null,
      "msclkid": null,
      "organization_count": 1,
      "organization_id": "<REPLACED-UUID-1>",
      "project_count": 1,
      "project_id": "<REPLACED-UUID-0>",
      "project_setup_complete": false,
      "qclid": null,
      "rdt_cid": "asdfsad",
      "realm": "hosted-clickhouse",
      "sccid": null,
      "social_providers": [],
      "strapi_id": null,
      "team_member_count_all": 1,
      "test": "abcdefge",
      "ttclid": null,
      "twclid": null,
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
      "wbraid": null,
    },
    "utm_properties": {
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
    },
  },
}
`;

exports[`SegmentDestinationExecutorService segment plugins should handle throwHttpErrors flag 1`] = `
[
  {
    "level": "debug",
    "message": "config, {"apiKey":"abc","name":"$web_vitals","secretKey":"def","metadata":{"$geoip_city_name":"Aylesbury","$geoip_country_name":"United Kingdom","$geoip_country_code":"GB","$geoip_continent_name":"Europe","$geoip_continent_code":"EU","$geoip_postal_code":"HP21","$geoip_latitude":51.8053,"$geoip_longitude":-0.8086,"$geoip_accuracy_radius":500,"$geoip_time_zone":"Europe/London","$geoip_subdivision_1_code":"ENG","$geoip_subdivision_1_name":"England","$geoip_subdivision_2_code":"BKM","$geoip_subdivision_2_name":"Buckinghamshire"},"debug_mode":true,"playerUniqueId":"8a47919a-858e-5de5-8772-86e2fdfa5806","mobile":null,"email":null,"internal_partner_action":"trackEvent"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "endpoint, https://api.gameball.co/api/v3.0/integrations/event",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "options, {"json":{"events":{"$web_vitals":{"$geoip_city_name":"Aylesbury","$geoip_country_name":"United Kingdom","$geoip_country_code":"GB","$geoip_continent_name":"Europe","$geoip_continent_code":"EU","$geoip_postal_code":"HP21","$geoip_latitude":51.8053,"$geoip_longitude":-0.8086,"$geoip_accuracy_radius":500,"$geoip_time_zone":"Europe/London","$geoip_subdivision_1_code":"ENG","$geoip_subdivision_1_name":"England","$geoip_subdivision_2_code":"BKM","$geoip_subdivision_2_name":"Buckinghamshire"}},"playerUniqueId":"8a47919a-858e-5de5-8772-86e2fdfa5806"},"headers":{"APIKey":"abc","Content-Type":"application/json","x-gb-agent":"GB/Segment"},"throwHttpErrors":false,"method":"POST"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "requestExtension, ",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "headers, {"APIKey":"abc","Content-Type":"application/json","x-gb-agent":"GB/Segment"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "fetchOptions, {"method":"POST","headers":{"APIKey":"abc","Content-Type":"application/json","x-gb-agent":"GB/Segment"},"body":"{\\"events\\":{\\"$web_vitals\\":{\\"$geoip_city_name\\":\\"Aylesbury\\",\\"$geoip_country_name\\":\\"United Kingdom\\",\\"$geoip_country_code\\":\\"GB\\",\\"$geoip_continent_name\\":\\"Europe\\",\\"$geoip_continent_code\\":\\"EU\\",\\"$geoip_postal_code\\":\\"HP21\\",\\"$geoip_latitude\\":51.8053,\\"$geoip_longitude\\":-0.8086,\\"$geoip_accuracy_radius\\":500,\\"$geoip_time_zone\\":\\"Europe/London\\",\\"$geoip_subdivision_1_code\\":\\"ENG\\",\\"$geoip_subdivision_1_name\\":\\"England\\",\\"$geoip_subdivision_2_code\\":\\"BKM\\",\\"$geoip_subdivision_2_name\\":\\"Buckinghamshire\\"}},\\"playerUniqueId\\":\\"8a47919a-858e-5de5-8772-86e2fdfa5806\\"}"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "warn",
    "message": "HTTP request failed with status 403 ({"error":"Forbidden"}).  max retries: 3",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "convertedResponse, 403, {"error":"Forbidden"}, {"error":"Forbidden"}, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "info",
    "message": "Function completed in [REPLACED]",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
]
`;

exports[`SegmentDestinationExecutorService segment plugins should handle throwHttpErrors flag 2`] = `
{
  "payload": {
    "apiKey": "abc",
    "debug_mode": true,
    "email": null,
    "internal_partner_action": "trackEvent",
    "metadata": {
      "$geoip_accuracy_radius": 500,
      "$geoip_city_name": "Aylesbury",
      "$geoip_continent_code": "EU",
      "$geoip_continent_name": "Europe",
      "$geoip_country_code": "GB",
      "$geoip_country_name": "United Kingdom",
      "$geoip_latitude": 51.8053,
      "$geoip_longitude": -0.8086,
      "$geoip_postal_code": "HP21",
      "$geoip_subdivision_1_code": "ENG",
      "$geoip_subdivision_1_name": "England",
      "$geoip_subdivision_2_code": "BKM",
      "$geoip_subdivision_2_name": "Buckinghamshire",
      "$geoip_time_zone": "Europe/London",
    },
    "mobile": null,
    "name": "$web_vitals",
    "playerUniqueId": "<REPLACED-UUID-0>",
    "secretKey": "def",
  },
  "settings": {
    "apiKey": "abc",
    "debug_mode": true,
    "email": null,
    "internal_partner_action": "trackEvent",
    "metadata": {
      "$geoip_accuracy_radius": 500,
      "$geoip_city_name": "Aylesbury",
      "$geoip_continent_code": "EU",
      "$geoip_continent_name": "Europe",
      "$geoip_country_code": "GB",
      "$geoip_country_name": "United Kingdom",
      "$geoip_latitude": 51.8053,
      "$geoip_longitude": -0.8086,
      "$geoip_postal_code": "HP21",
      "$geoip_subdivision_1_code": "ENG",
      "$geoip_subdivision_1_name": "England",
      "$geoip_subdivision_2_code": "BKM",
      "$geoip_subdivision_2_name": "Buckinghamshire",
      "$geoip_time_zone": "Europe/London",
    },
    "mobile": null,
    "name": "$web_vitals",
    "playerUniqueId": "<REPLACED-UUID-0>",
    "secretKey": "def",
  },
}
`;

exports[`SegmentDestinationExecutorService segment plugins should retry retryable fetch errors 1`] = `
[
  {
    "level": "debug",
    "message": "config, {"apiKey":"api-key","user_id":"user-id","secretKey":"secret-key","device_id":"device-id","endpoint":"north_america","user_properties":{"$os":"Mac OS X","_kx":null,"epik":null,"test":"abcdefge","$host":"localhost:8010","dclid":null,"email":"max@posthog.com","gclid":null,"qclid":null,"realm":"hosted-clickhouse","sccid":null,"fbclid":null,"gbraid":null,"gclsrc":null,"igshid":null,"irclid":null,"mc_cid":null,"ttclid":null,"twclid":null,"wbraid":null,"msclkid":null,"rdt_cid":"asdfsad","$browser":"Chrome","utm_term":null,"$pathname":"/project/1/activity/explore","$referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","joined_at":"2025-04-04T11:33:18.022897+00:00","li_fat_id":null,"strapi_id":null,"gad_source":null,"project_id":"<REPLACED-UUID-0>","utm_medium":null,"utm_source":null,"$initial_os":"Mac OS X","$os_version":"10.15.7","utm_content":null,"$current_url":"http://localhost:8000/project/1/activity/explore","$device_type":"Desktop","$initial__kx":null,"instance_tag":"none","instance_url":"http://localhost:8010","is_signed_up":true,"utm_campaign":null,"$initial_epik":null,"$initial_host":"localhost:8010","$screen_width":2560,"project_count":1,"$initial_dclid":null,"$initial_gclid":null,"$initial_qclid":null,"$initial_sccid":null,"$screen_height":1440,"$search_engine":"google","anonymize_data":false,"$geoip_latitude":-33.8715,"$initial_fbclid":null,"$initial_gbraid":null,"$initial_gclsrc":null,"$initial_igshid":null,"$initial_irclid":null,"$initial_mc_cid":null,"$initial_ttclid":null,"$initial_twclid":null,"$initial_wbraid":null,"$raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","$viewport_width":1698,"has_social_auth":false,"organization_id":"<REPLACED-UUID-1>","$browser_version":135,"$geoip_city_name":"Sydney","$geoip_longitude":151.2006,"$geoip_time_zone":"Australia/Sydney","$initial_browser":"Chrome","$initial_msclkid":null,"$initial_rdt_cid":null,"$viewport_height":1328,"has_password_set":true,"social_providers":[],"$initial_pathname":"/organization/billing","$initial_referrer":"$direct","$initial_utm_term":null,"$referring_domain":"localhost:8000","is_email_verified":false,"$geoip_postal_code":"2000","$initial_li_fat_id":null,"organization_count":1,"$creator_event_uuid":"<REPLACED-UUID-2>","$geoip_country_code":"AU","$geoip_country_name":"Australia","$initial_gad_source":null,"$initial_os_version":"15.2","$initial_utm_medium":null,"$initial_utm_source":null,"$initial_current_url":"http://localhost:8010/organization/billing?cancel=true","$initial_device_type":"Desktop","$initial_utm_content":null,"$geoip_continent_code":"OC","$geoip_continent_name":"Oceania","$initial_screen_width":2560,"$initial_utm_campaign":null,"team_member_count_all":1,"$geoip_accuracy_radius":20,"$geoip_city_confidence":null,"$initial_screen_height":1440,"project_setup_complete":false,"$initial_geoip_latitude":-33.8715,"$initial_raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36","$initial_viewport_width":1619,"$initial_browser_version":134,"$initial_geoip_city_name":"Sydney","$initial_geoip_longitude":151.2006,"$initial_geoip_time_zone":"Australia/Sydney","$initial_viewport_height":1328,"$geoip_subdivision_1_code":"NSW","$geoip_subdivision_1_name":"New South Wales","$geoip_subdivision_2_code":null,"$geoip_subdivision_2_name":null,"$initial_referring_domain":"$direct","completed_onboarding_once":false,"$initial_geoip_postal_code":"2000","has_seen_product_intro_for":{"surveys":true},"$initial_geoip_country_code":"AU","$initial_geoip_country_name":"Australia","$initial_geoip_continent_code":"OC","$initial_geoip_continent_name":"Oceania","$initial_geoip_accuracy_radius":20,"$initial_geoip_city_confidence":null,"$initial_geoip_subdivision_1_code":"NSW","$initial_geoip_subdivision_1_name":"New South Wales","$initial_geoip_subdivision_2_code":null,"$initial_geoip_subdivision_2_name":null,"current_organization_membership_level":15},"groups":{},"app_version":null,"platform":"Desktop","os_name":"Mac OS X","os_version":"10.15.7","device_brand":"","device_manufacturer":null,"device_model":null,"carrier":"","country":"Australia","region":"","city":"Sydney","language":null,"userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","userAgentParsing":true,"includeRawUserAgent":false,"utm_properties":{"utm_term":null,"utm_medium":null,"utm_source":null,"utm_content":null,"utm_campaign":null},"referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","library":"web","userAgentData":{"model":"","platformVersion":""},"internal_partner_action":"logEventV2","debug_mode":true}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "endpoint, https://api2.amplitude.com/2/httpapi",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "options, {"method":"post","json":{"api_key":"api-key","events":[{"os_name":"Mac OS X","os_version":"10.15.7","device_manufacturer":null,"device_model":null,"apiKey":"api-key","user_id":"user-id","secretKey":"secret-key","device_id":"device-id","endpoint":"north_america","user_properties":{"$os":"Mac OS X","_kx":null,"epik":null,"test":"abcdefge","$host":"localhost:8010","dclid":null,"email":"max@posthog.com","gclid":null,"qclid":null,"realm":"hosted-clickhouse","sccid":null,"fbclid":null,"gbraid":null,"gclsrc":null,"igshid":null,"irclid":null,"mc_cid":null,"ttclid":null,"twclid":null,"wbraid":null,"msclkid":null,"rdt_cid":"asdfsad","$browser":"Chrome","utm_term":null,"$pathname":"/project/1/activity/explore","$referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","joined_at":"2025-04-04T11:33:18.022897+00:00","li_fat_id":null,"strapi_id":null,"gad_source":null,"project_id":"<REPLACED-UUID-0>","utm_medium":null,"utm_source":null,"$initial_os":"Mac OS X","$os_version":"10.15.7","utm_content":null,"$current_url":"http://localhost:8000/project/1/activity/explore","$device_type":"Desktop","$initial__kx":null,"instance_tag":"none","instance_url":"http://localhost:8010","is_signed_up":true,"utm_campaign":null,"$initial_epik":null,"$initial_host":"localhost:8010","$screen_width":2560,"project_count":1,"$initial_dclid":null,"$initial_gclid":null,"$initial_qclid":null,"$initial_sccid":null,"$screen_height":1440,"$search_engine":"google","anonymize_data":false,"$geoip_latitude":-33.8715,"$initial_fbclid":null,"$initial_gbraid":null,"$initial_gclsrc":null,"$initial_igshid":null,"$initial_irclid":null,"$initial_mc_cid":null,"$initial_ttclid":null,"$initial_twclid":null,"$initial_wbraid":null,"$raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36","$viewport_width":1698,"has_social_auth":false,"organization_id":"<REPLACED-UUID-1>","$browser_version":135,"$geoip_city_name":"Sydney","$geoip_longitude":151.2006,"$geoip_time_zone":"Australia/Sydney","$initial_browser":"Chrome","$initial_msclkid":null,"$initial_rdt_cid":null,"$viewport_height":1328,"has_password_set":true,"social_providers":[],"$initial_pathname":"/organization/billing","$initial_referrer":"$direct","$initial_utm_term":null,"$referring_domain":"localhost:8000","is_email_verified":false,"$geoip_postal_code":"2000","$initial_li_fat_id":null,"organization_count":1,"$creator_event_uuid":"<REPLACED-UUID-2>","$geoip_country_code":"AU","$geoip_country_name":"Australia","$initial_gad_source":null,"$initial_os_version":"15.2","$initial_utm_medium":null,"$initial_utm_source":null,"$initial_current_url":"http://localhost:8010/organization/billing?cancel=true","$initial_device_type":"Desktop","$initial_utm_content":null,"$geoip_continent_code":"OC","$geoip_continent_name":"Oceania","$initial_screen_width":2560,"$initial_utm_campaign":null,"team_member_count_all":1,"$geoip_accuracy_radius":20,"$geoip_city_confidence":null,"$initial_screen_height":1440,"project_setup_complete":false,"$initial_geoip_latitude":-33.8715,"$initial_raw_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36","$initial_viewport_width":1619,"$initial_browser_version":134,"$initial_geoip_city_name":"Sydney","$initial_geoip_longitude":151.2006,"$initial_geoip_time_zone":"Australia/Sydney","$initial_viewport_height":1328,"$geoip_subdivision_1_code":"NSW","$geoip_subdivision_1_name":"New South Wales","$geoip_subdivision_2_code":null,"$geoip_subdivision_2_name":null,"$initial_referring_domain":"$direct","completed_onboarding_once":false,"$initial_geoip_postal_code":"2000","has_seen_product_intro_for":{"surveys":true},"$initial_geoip_country_code":"AU","$initial_geoip_country_name":"Australia","$initial_geoip_continent_code":"OC","$initial_geoip_continent_name":"Oceania","$initial_geoip_accuracy_radius":20,"$initial_geoip_city_confidence":null,"$initial_geoip_subdivision_1_code":"NSW","$initial_geoip_subdivision_1_name":"New South Wales","$initial_geoip_subdivision_2_code":null,"$initial_geoip_subdivision_2_name":null,"current_organization_membership_level":15},"groups":{},"app_version":null,"platform":"Desktop","device_brand":"","carrier":"","country":"Australia","region":"","city":"Sydney","language":null,"utm_properties":{"utm_term":null,"utm_medium":null,"utm_source":null,"utm_content":null,"utm_campaign":null},"referrer":"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta","internal_partner_action":"logEventV2","debug_mode":true,"library":"segment"}]}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "requestExtension, ",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "headers, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "fetchOptions, {"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"api_key\\":\\"api-key\\",\\"events\\":[{\\"os_name\\":\\"Mac OS X\\",\\"os_version\\":\\"10.15.7\\",\\"device_manufacturer\\":null,\\"device_model\\":null,\\"apiKey\\":\\"api-key\\",\\"user_id\\":\\"user-id\\",\\"secretKey\\":\\"secret-key\\",\\"device_id\\":\\"device-id\\",\\"endpoint\\":\\"north_america\\",\\"user_properties\\":{\\"$os\\":\\"Mac OS X\\",\\"_kx\\":null,\\"epik\\":null,\\"test\\":\\"abcdefge\\",\\"$host\\":\\"localhost:8010\\",\\"dclid\\":null,\\"email\\":\\"max@posthog.com\\",\\"gclid\\":null,\\"qclid\\":null,\\"realm\\":\\"hosted-clickhouse\\",\\"sccid\\":null,\\"fbclid\\":null,\\"gbraid\\":null,\\"gclsrc\\":null,\\"igshid\\":null,\\"irclid\\":null,\\"mc_cid\\":null,\\"ttclid\\":null,\\"twclid\\":null,\\"wbraid\\":null,\\"msclkid\\":null,\\"rdt_cid\\":\\"asdfsad\\",\\"$browser\\":\\"Chrome\\",\\"utm_term\\":null,\\"$pathname\\":\\"/project/1/activity/explore\\",\\"$referrer\\":\\"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta\\",\\"joined_at\\":\\"2025-04-04T11:33:18.022897+00:00\\",\\"li_fat_id\\":null,\\"strapi_id\\":null,\\"gad_source\\":null,\\"project_id\\":\\"<REPLACED-UUID-0>\\",\\"utm_medium\\":null,\\"utm_source\\":null,\\"$initial_os\\":\\"Mac OS X\\",\\"$os_version\\":\\"10.15.7\\",\\"utm_content\\":null,\\"$current_url\\":\\"http://localhost:8000/project/1/activity/explore\\",\\"$device_type\\":\\"Desktop\\",\\"$initial__kx\\":null,\\"instance_tag\\":\\"none\\",\\"instance_url\\":\\"http://localhost:8010\\",\\"is_signed_up\\":true,\\"utm_campaign\\":null,\\"$initial_epik\\":null,\\"$initial_host\\":\\"localhost:8010\\",\\"$screen_width\\":2560,\\"project_count\\":1,\\"$initial_dclid\\":null,\\"$initial_gclid\\":null,\\"$initial_qclid\\":null,\\"$initial_sccid\\":null,\\"$screen_height\\":1440,\\"$search_engine\\":\\"google\\",\\"anonymize_data\\":false,\\"$geoip_latitude\\":-33.8715,\\"$initial_fbclid\\":null,\\"$initial_gbraid\\":null,\\"$initial_gclsrc\\":null,\\"$initial_igshid\\":null,\\"$initial_irclid\\":null,\\"$initial_mc_cid\\":null,\\"$initial_ttclid\\":null,\\"$initial_twclid\\":null,\\"$initial_wbraid\\":null,\\"$raw_user_agent\\":\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36\\",\\"$viewport_width\\":1698,\\"has_social_auth\\":false,\\"organization_id\\":\\"<REPLACED-UUID-1>\\",\\"$browser_version\\":135,\\"$geoip_city_name\\":\\"Sydney\\",\\"$geoip_longitude\\":151.2006,\\"$geoip_time_zone\\":\\"Australia/Sydney\\",\\"$initial_browser\\":\\"Chrome\\",\\"$initial_msclkid\\":null,\\"$initial_rdt_cid\\":null,\\"$viewport_height\\":1328,\\"has_password_set\\":true,\\"social_providers\\":[],\\"$initial_pathname\\":\\"/organization/billing\\",\\"$initial_referrer\\":\\"$direct\\",\\"$initial_utm_term\\":null,\\"$referring_domain\\":\\"localhost:8000\\",\\"is_email_verified\\":false,\\"$geoip_postal_code\\":\\"2000\\",\\"$initial_li_fat_id\\":null,\\"organization_count\\":1,\\"$creator_event_uuid\\":\\"<REPLACED-UUID-2>\\",\\"$geoip_country_code\\":\\"AU\\",\\"$geoip_country_name\\":\\"Australia\\",\\"$initial_gad_source\\":null,\\"$initial_os_version\\":\\"15.2\\",\\"$initial_utm_medium\\":null,\\"$initial_utm_source\\":null,\\"$initial_current_url\\":\\"http://localhost:8010/organization/billing?cancel=true\\",\\"$initial_device_type\\":\\"Desktop\\",\\"$initial_utm_content\\":null,\\"$geoip_continent_code\\":\\"OC\\",\\"$geoip_continent_name\\":\\"Oceania\\",\\"$initial_screen_width\\":2560,\\"$initial_utm_campaign\\":null,\\"team_member_count_all\\":1,\\"$geoip_accuracy_radius\\":20,\\"$geoip_city_confidence\\":null,\\"$initial_screen_height\\":1440,\\"project_setup_complete\\":false,\\"$initial_geoip_latitude\\":-33.8715,\\"$initial_raw_user_agent\\":\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36\\",\\"$initial_viewport_width\\":1619,\\"$initial_browser_version\\":134,\\"$initial_geoip_city_name\\":\\"Sydney\\",\\"$initial_geoip_longitude\\":151.2006,\\"$initial_geoip_time_zone\\":\\"Australia/Sydney\\",\\"$initial_viewport_height\\":1328,\\"$geoip_subdivision_1_code\\":\\"NSW\\",\\"$geoip_subdivision_1_name\\":\\"New South Wales\\",\\"$geoip_subdivision_2_code\\":null,\\"$geoip_subdivision_2_name\\":null,\\"$initial_referring_domain\\":\\"$direct\\",\\"completed_onboarding_once\\":false,\\"$initial_geoip_postal_code\\":\\"2000\\",\\"has_seen_product_intro_for\\":{\\"surveys\\":true},\\"$initial_geoip_country_code\\":\\"AU\\",\\"$initial_geoip_country_name\\":\\"Australia\\",\\"$initial_geoip_continent_code\\":\\"OC\\",\\"$initial_geoip_continent_name\\":\\"Oceania\\",\\"$initial_geoip_accuracy_radius\\":20,\\"$initial_geoip_city_confidence\\":null,\\"$initial_geoip_subdivision_1_code\\":\\"NSW\\",\\"$initial_geoip_subdivision_1_name\\":\\"New South Wales\\",\\"$initial_geoip_subdivision_2_code\\":null,\\"$initial_geoip_subdivision_2_name\\":null,\\"current_organization_membership_level\\":15},\\"groups\\":{},\\"app_version\\":null,\\"platform\\":\\"Desktop\\",\\"device_brand\\":\\"\\",\\"carrier\\":\\"\\",\\"country\\":\\"Australia\\",\\"region\\":\\"\\",\\"city\\":\\"Sydney\\",\\"language\\":null,\\"utm_properties\\":{\\"utm_term\\":null,\\"utm_medium\\":null,\\"utm_source\\":null,\\"utm_content\\":null,\\"utm_campaign\\":null},\\"referrer\\":\\"http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta\\",\\"internal_partner_action\\":\\"logEventV2\\",\\"debug_mode\\":true,\\"library\\":\\"segment\\"}]}"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "warn",
    "message": "HTTP request failed with status 429 ({"error":"Too many requests"}). Scheduling retry... max retries: 3",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
]
`;

exports[`SegmentDestinationExecutorService segment plugins should retry retryable fetch errors 2`] = `
{
  "payload": {
    "apiKey": "api-key",
    "app_version": null,
    "carrier": "",
    "city": "Sydney",
    "country": "Australia",
    "debug_mode": true,
    "device_brand": "",
    "device_id": "device-id",
    "device_manufacturer": null,
    "device_model": null,
    "endpoint": "north_america",
    "groups": {},
    "includeRawUserAgent": false,
    "internal_partner_action": "logEventV2",
    "language": null,
    "library": "web",
    "os_name": "Mac OS X",
    "os_version": "10.15.7",
    "platform": "Desktop",
    "referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
    "region": "",
    "secretKey": "secret-key",
    "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
    "userAgentData": {
      "model": "",
      "platformVersion": "",
    },
    "userAgentParsing": true,
    "user_id": "user-id",
    "user_properties": {
      "$browser": "Chrome",
      "$browser_version": 135,
      "$creator_event_uuid": "<REPLACED-UUID-2>",
      "$current_url": "http://localhost:8000/project/1/activity/explore",
      "$device_type": "Desktop",
      "$geoip_accuracy_radius": 20,
      "$geoip_city_confidence": null,
      "$geoip_city_name": "Sydney",
      "$geoip_continent_code": "OC",
      "$geoip_continent_name": "Oceania",
      "$geoip_country_code": "AU",
      "$geoip_country_name": "Australia",
      "$geoip_latitude": -33.8715,
      "$geoip_longitude": 151.2006,
      "$geoip_postal_code": "2000",
      "$geoip_subdivision_1_code": "NSW",
      "$geoip_subdivision_1_name": "New South Wales",
      "$geoip_subdivision_2_code": null,
      "$geoip_subdivision_2_name": null,
      "$geoip_time_zone": "Australia/Sydney",
      "$host": "localhost:8010",
      "$initial__kx": null,
      "$initial_browser": "Chrome",
      "$initial_browser_version": 134,
      "$initial_current_url": "http://localhost:8010/organization/billing?cancel=true",
      "$initial_dclid": null,
      "$initial_device_type": "Desktop",
      "$initial_epik": null,
      "$initial_fbclid": null,
      "$initial_gad_source": null,
      "$initial_gbraid": null,
      "$initial_gclid": null,
      "$initial_gclsrc": null,
      "$initial_geoip_accuracy_radius": 20,
      "$initial_geoip_city_confidence": null,
      "$initial_geoip_city_name": "Sydney",
      "$initial_geoip_continent_code": "OC",
      "$initial_geoip_continent_name": "Oceania",
      "$initial_geoip_country_code": "AU",
      "$initial_geoip_country_name": "Australia",
      "$initial_geoip_latitude": -33.8715,
      "$initial_geoip_longitude": 151.2006,
      "$initial_geoip_postal_code": "2000",
      "$initial_geoip_subdivision_1_code": "NSW",
      "$initial_geoip_subdivision_1_name": "New South Wales",
      "$initial_geoip_subdivision_2_code": null,
      "$initial_geoip_subdivision_2_name": null,
      "$initial_geoip_time_zone": "Australia/Sydney",
      "$initial_host": "localhost:8010",
      "$initial_igshid": null,
      "$initial_irclid": null,
      "$initial_li_fat_id": null,
      "$initial_mc_cid": null,
      "$initial_msclkid": null,
      "$initial_os": "Mac OS X",
      "$initial_os_version": "15.2",
      "$initial_pathname": "/organization/billing",
      "$initial_qclid": null,
      "$initial_raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
      "$initial_rdt_cid": null,
      "$initial_referrer": "$direct",
      "$initial_referring_domain": "$direct",
      "$initial_sccid": null,
      "$initial_screen_height": 1440,
      "$initial_screen_width": 2560,
      "$initial_ttclid": null,
      "$initial_twclid": null,
      "$initial_utm_campaign": null,
      "$initial_utm_content": null,
      "$initial_utm_medium": null,
      "$initial_utm_source": null,
      "$initial_utm_term": null,
      "$initial_viewport_height": 1328,
      "$initial_viewport_width": 1619,
      "$initial_wbraid": null,
      "$os": "Mac OS X",
      "$os_version": "10.15.7",
      "$pathname": "/project/1/activity/explore",
      "$raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
      "$referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
      "$referring_domain": "localhost:8000",
      "$screen_height": 1440,
      "$screen_width": 2560,
      "$search_engine": "google",
      "$viewport_height": 1328,
      "$viewport_width": 1698,
      "_kx": null,
      "anonymize_data": false,
      "completed_onboarding_once": false,
      "current_organization_membership_level": 15,
      "dclid": null,
      "email": "max@posthog.com",
      "epik": null,
      "fbclid": null,
      "gad_source": null,
      "gbraid": null,
      "gclid": null,
      "gclsrc": null,
      "has_password_set": true,
      "has_seen_product_intro_for": {
        "surveys": true,
      },
      "has_social_auth": false,
      "igshid": null,
      "instance_tag": "none",
      "instance_url": "http://localhost:8010",
      "irclid": null,
      "is_email_verified": false,
      "is_signed_up": true,
      "joined_at": "2025-04-04T11:33:18.022897+00:00",
      "li_fat_id": null,
      "mc_cid": null,
      "msclkid": null,
      "organization_count": 1,
      "organization_id": "<REPLACED-UUID-1>",
      "project_count": 1,
      "project_id": "<REPLACED-UUID-0>",
      "project_setup_complete": false,
      "qclid": null,
      "rdt_cid": "asdfsad",
      "realm": "hosted-clickhouse",
      "sccid": null,
      "social_providers": [],
      "strapi_id": null,
      "team_member_count_all": 1,
      "test": "abcdefge",
      "ttclid": null,
      "twclid": null,
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
      "wbraid": null,
    },
    "utm_properties": {
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
    },
  },
  "settings": {
    "apiKey": "api-key",
    "app_version": null,
    "carrier": "",
    "city": "Sydney",
    "country": "Australia",
    "debug_mode": true,
    "device_brand": "",
    "device_id": "device-id",
    "device_manufacturer": null,
    "device_model": null,
    "endpoint": "north_america",
    "groups": {},
    "includeRawUserAgent": false,
    "internal_partner_action": "logEventV2",
    "language": null,
    "library": "web",
    "os_name": "Mac OS X",
    "os_version": "10.15.7",
    "platform": "Desktop",
    "referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
    "region": "",
    "secretKey": "secret-key",
    "userAgent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
    "userAgentData": {
      "model": "",
      "platformVersion": "",
    },
    "userAgentParsing": true,
    "user_id": "user-id",
    "user_properties": {
      "$browser": "Chrome",
      "$browser_version": 135,
      "$creator_event_uuid": "<REPLACED-UUID-2>",
      "$current_url": "http://localhost:8000/project/1/activity/explore",
      "$device_type": "Desktop",
      "$geoip_accuracy_radius": 20,
      "$geoip_city_confidence": null,
      "$geoip_city_name": "Sydney",
      "$geoip_continent_code": "OC",
      "$geoip_continent_name": "Oceania",
      "$geoip_country_code": "AU",
      "$geoip_country_name": "Australia",
      "$geoip_latitude": -33.8715,
      "$geoip_longitude": 151.2006,
      "$geoip_postal_code": "2000",
      "$geoip_subdivision_1_code": "NSW",
      "$geoip_subdivision_1_name": "New South Wales",
      "$geoip_subdivision_2_code": null,
      "$geoip_subdivision_2_name": null,
      "$geoip_time_zone": "Australia/Sydney",
      "$host": "localhost:8010",
      "$initial__kx": null,
      "$initial_browser": "Chrome",
      "$initial_browser_version": 134,
      "$initial_current_url": "http://localhost:8010/organization/billing?cancel=true",
      "$initial_dclid": null,
      "$initial_device_type": "Desktop",
      "$initial_epik": null,
      "$initial_fbclid": null,
      "$initial_gad_source": null,
      "$initial_gbraid": null,
      "$initial_gclid": null,
      "$initial_gclsrc": null,
      "$initial_geoip_accuracy_radius": 20,
      "$initial_geoip_city_confidence": null,
      "$initial_geoip_city_name": "Sydney",
      "$initial_geoip_continent_code": "OC",
      "$initial_geoip_continent_name": "Oceania",
      "$initial_geoip_country_code": "AU",
      "$initial_geoip_country_name": "Australia",
      "$initial_geoip_latitude": -33.8715,
      "$initial_geoip_longitude": 151.2006,
      "$initial_geoip_postal_code": "2000",
      "$initial_geoip_subdivision_1_code": "NSW",
      "$initial_geoip_subdivision_1_name": "New South Wales",
      "$initial_geoip_subdivision_2_code": null,
      "$initial_geoip_subdivision_2_name": null,
      "$initial_geoip_time_zone": "Australia/Sydney",
      "$initial_host": "localhost:8010",
      "$initial_igshid": null,
      "$initial_irclid": null,
      "$initial_li_fat_id": null,
      "$initial_mc_cid": null,
      "$initial_msclkid": null,
      "$initial_os": "Mac OS X",
      "$initial_os_version": "15.2",
      "$initial_pathname": "/organization/billing",
      "$initial_qclid": null,
      "$initial_raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Safari/537.36",
      "$initial_rdt_cid": null,
      "$initial_referrer": "$direct",
      "$initial_referring_domain": "$direct",
      "$initial_sccid": null,
      "$initial_screen_height": 1440,
      "$initial_screen_width": 2560,
      "$initial_ttclid": null,
      "$initial_twclid": null,
      "$initial_utm_campaign": null,
      "$initial_utm_content": null,
      "$initial_utm_medium": null,
      "$initial_utm_source": null,
      "$initial_utm_term": null,
      "$initial_viewport_height": 1328,
      "$initial_viewport_width": 1619,
      "$initial_wbraid": null,
      "$os": "Mac OS X",
      "$os_version": "10.15.7",
      "$pathname": "/project/1/activity/explore",
      "$raw_user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36",
      "$referrer": "http://localhost:8000/project/1/pipeline/new/destination/hog-template-meta-ads?showPaused=true&kind&search=meta",
      "$referring_domain": "localhost:8000",
      "$screen_height": 1440,
      "$screen_width": 2560,
      "$search_engine": "google",
      "$viewport_height": 1328,
      "$viewport_width": 1698,
      "_kx": null,
      "anonymize_data": false,
      "completed_onboarding_once": false,
      "current_organization_membership_level": 15,
      "dclid": null,
      "email": "max@posthog.com",
      "epik": null,
      "fbclid": null,
      "gad_source": null,
      "gbraid": null,
      "gclid": null,
      "gclsrc": null,
      "has_password_set": true,
      "has_seen_product_intro_for": {
        "surveys": true,
      },
      "has_social_auth": false,
      "igshid": null,
      "instance_tag": "none",
      "instance_url": "http://localhost:8010",
      "irclid": null,
      "is_email_verified": false,
      "is_signed_up": true,
      "joined_at": "2025-04-04T11:33:18.022897+00:00",
      "li_fat_id": null,
      "mc_cid": null,
      "msclkid": null,
      "organization_count": 1,
      "organization_id": "<REPLACED-UUID-1>",
      "project_count": 1,
      "project_id": "<REPLACED-UUID-0>",
      "project_setup_complete": false,
      "qclid": null,
      "rdt_cid": "asdfsad",
      "realm": "hosted-clickhouse",
      "sccid": null,
      "social_providers": [],
      "strapi_id": null,
      "team_member_count_all": 1,
      "test": "abcdefge",
      "ttclid": null,
      "twclid": null,
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
      "wbraid": null,
    },
    "utm_properties": {
      "utm_campaign": null,
      "utm_content": null,
      "utm_medium": null,
      "utm_source": null,
      "utm_term": null,
    },
  },
}
`;

exports[`SegmentDestinationExecutorService segment plugins works with multiple fetches 1`] = `
[
  {
    "level": "debug",
    "message": "config, {"domain":"posthog-sandbox","match_field":"email","apiToken":"api-key","match_value":"max@posthog.com","personField":"id","name":"Max","organizationField":"id","email":"max@posthog.com","dealField":"id","phone":null,"custom_fields":{},"internal_partner_action":"createUpdatePerson","debug_mode":true}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "endpoint, https://posthog-sandbox.pipedrive.com/api/v1/itemSearch/field",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "options, {"searchParams":{"term":"max@posthog.com","field_key":"email","exact_match":true,"field_type":"personField","return_item_ids":true}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "requestExtension, {"searchParams":{"api_token":"api-key"}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "headers, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "fetchOptions, {"method":"GET","headers":{}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "convertedResponse, 200, {"success":true,"data":{"id":20,"owner_id":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true,"value":1234},"org_id":null,"name":"Max","first_name":"Max","last_name":null,"open_deals_count":0,"related_open_deals_count":0,"closed_deals_count":0,"related_closed_deals_count":0,"participant_open_deals_count":0,"participant_closed_deals_count":0,"email_messages_count":0,"activities_count":0,"done_activities_count":0,"undone_activities_count":0,"files_count":0,"notes_count":0,"followers_count":0,"won_deals_count":0,"related_won_deals_count":0,"lost_deals_count":0,"related_lost_deals_count":0,"active_flag":true,"phone":[{"value":"","primary":true}],"email":[{"label":"work","value":"max@posthog.com","primary":true}],"first_char":"m","update_time":"2025-05-22 11:45:51","delete_time":null,"add_time":"2025-05-22 11:45:51","visible_to":"3","picture_id":null,"next_activity_date":null,"next_activity_time":null,"next_activity_id":null,"last_activity_id":null,"last_activity_date":null,"last_incoming_mail_time":null,"last_outgoing_mail_time":null,"label":null,"label_ids":[],"im":[{"value":"","primary":true}],"postal_address":null,"postal_address_lat":null,"postal_address_long":null,"postal_address_subpremise":null,"postal_address_street_number":null,"postal_address_route":null,"postal_address_sublocality":null,"postal_address_locality":null,"postal_address_admin_area_level_1":null,"postal_address_admin_area_level_2":null,"postal_address_country":null,"postal_address_postal_code":null,"postal_address_formatted_address":null,"notes":null,"birthday":null,"job_title":null,"org_name":null,"cc_email":"posthog-sandbox@pipedrivemail.com","primary_email":"max@posthog.com","owner_name":"Max","company_id":1234},"additional_data":{"didMerge":false},"related_objects":{"user":{"1234":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true}}}}, {"success":true,"data":{"id":20,"owner_id":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true,"value":1234},"org_id":null,"name":"Max","first_name":"Max","last_name":null,"open_deals_count":0,"related_open_deals_count":0,"closed_deals_count":0,"related_closed_deals_count":0,"participant_open_deals_count":0,"participant_closed_deals_count":0,"email_messages_count":0,"activities_count":0,"done_activities_count":0,"undone_activities_count":0,"files_count":0,"notes_count":0,"followers_count":0,"won_deals_count":0,"related_won_deals_count":0,"lost_deals_count":0,"related_lost_deals_count":0,"active_flag":true,"phone":[{"value":"","primary":true}],"email":[{"label":"work","value":"max@posthog.com","primary":true}],"first_char":"m","update_time":"2025-05-22 11:45:51","delete_time":null,"add_time":"2025-05-22 11:45:51","visible_to":"3","picture_id":null,"next_activity_date":null,"next_activity_time":null,"next_activity_id":null,"last_activity_id":null,"last_activity_date":null,"last_incoming_mail_time":null,"last_outgoing_mail_time":null,"label":null,"label_ids":[],"im":[{"value":"","primary":true}],"postal_address":null,"postal_address_lat":null,"postal_address_long":null,"postal_address_subpremise":null,"postal_address_street_number":null,"postal_address_route":null,"postal_address_sublocality":null,"postal_address_locality":null,"postal_address_admin_area_level_1":null,"postal_address_admin_area_level_2":null,"postal_address_country":null,"postal_address_postal_code":null,"postal_address_formatted_address":null,"notes":null,"birthday":null,"job_title":null,"org_name":null,"cc_email":"posthog-sandbox@pipedrivemail.com","primary_email":"max@posthog.com","owner_name":"Max","company_id":1234},"additional_data":{"didMerge":false},"related_objects":{"user":{"1234":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true}}}}, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "endpoint, https://posthog-sandbox.pipedrive.com/api/v1/persons",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "options, {"method":"post","json":{"name":"Max","email":"max@posthog.com","phone":null}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "requestExtension, {"searchParams":{"api_token":"api-key"}}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "headers, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "fetchOptions, {"method":"POST","headers":{"Content-Type":"application/json"},"body":"{\\"name\\":\\"Max\\",\\"email\\":\\"max@posthog.com\\",\\"phone\\":null}"}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "debug",
    "message": "convertedResponse, 200, {"success":true,"data":{"id":20,"owner_id":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true,"value":1234},"org_id":null,"name":"Max","first_name":"Max","last_name":null,"open_deals_count":0,"related_open_deals_count":0,"closed_deals_count":0,"related_closed_deals_count":0,"participant_open_deals_count":0,"participant_closed_deals_count":0,"email_messages_count":0,"activities_count":0,"done_activities_count":0,"undone_activities_count":0,"files_count":0,"notes_count":0,"followers_count":0,"won_deals_count":0,"related_won_deals_count":0,"lost_deals_count":0,"related_lost_deals_count":0,"active_flag":true,"phone":[{"value":"","primary":true}],"email":[{"label":"work","value":"max@posthog.com","primary":true}],"first_char":"m","update_time":"2025-05-22 11:45:51","delete_time":null,"add_time":"2025-05-22 11:45:51","visible_to":"3","picture_id":null,"next_activity_date":null,"next_activity_time":null,"next_activity_id":null,"last_activity_id":null,"last_activity_date":null,"last_incoming_mail_time":null,"last_outgoing_mail_time":null,"label":null,"label_ids":[],"im":[{"value":"","primary":true}],"postal_address":null,"postal_address_lat":null,"postal_address_long":null,"postal_address_subpremise":null,"postal_address_street_number":null,"postal_address_route":null,"postal_address_sublocality":null,"postal_address_locality":null,"postal_address_admin_area_level_1":null,"postal_address_admin_area_level_2":null,"postal_address_country":null,"postal_address_postal_code":null,"postal_address_formatted_address":null,"notes":null,"birthday":null,"job_title":null,"org_name":null,"cc_email":"posthog-sandbox@pipedrivemail.com","primary_email":"max@posthog.com","owner_name":"Max","company_id":1234},"additional_data":{"didMerge":false},"related_objects":{"user":{"1234":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true}}}}, {"success":true,"data":{"id":20,"owner_id":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true,"value":1234},"org_id":null,"name":"Max","first_name":"Max","last_name":null,"open_deals_count":0,"related_open_deals_count":0,"closed_deals_count":0,"related_closed_deals_count":0,"participant_open_deals_count":0,"participant_closed_deals_count":0,"email_messages_count":0,"activities_count":0,"done_activities_count":0,"undone_activities_count":0,"files_count":0,"notes_count":0,"followers_count":0,"won_deals_count":0,"related_won_deals_count":0,"lost_deals_count":0,"related_lost_deals_count":0,"active_flag":true,"phone":[{"value":"","primary":true}],"email":[{"label":"work","value":"max@posthog.com","primary":true}],"first_char":"m","update_time":"2025-05-22 11:45:51","delete_time":null,"add_time":"2025-05-22 11:45:51","visible_to":"3","picture_id":null,"next_activity_date":null,"next_activity_time":null,"next_activity_id":null,"last_activity_id":null,"last_activity_date":null,"last_incoming_mail_time":null,"last_outgoing_mail_time":null,"label":null,"label_ids":[],"im":[{"value":"","primary":true}],"postal_address":null,"postal_address_lat":null,"postal_address_long":null,"postal_address_subpremise":null,"postal_address_street_number":null,"postal_address_route":null,"postal_address_sublocality":null,"postal_address_locality":null,"postal_address_admin_area_level_1":null,"postal_address_admin_area_level_2":null,"postal_address_country":null,"postal_address_postal_code":null,"postal_address_formatted_address":null,"notes":null,"birthday":null,"job_title":null,"org_name":null,"cc_email":"posthog-sandbox@pipedrivemail.com","primary_email":"max@posthog.com","owner_name":"Max","company_id":1234},"additional_data":{"didMerge":false},"related_objects":{"user":{"1234":{"id":1234,"name":"Max","email":"max@posthog.com","has_pic":0,"pic_hash":null,"active_flag":true}}}}, {}",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
  {
    "level": "info",
    "message": "Function completed in [REPLACED]",
    "timestamp": "2025-01-01T00:00:00.000Z",
  },
]
`;

exports[`SegmentDestinationExecutorService segment plugins works with multiple fetches 2`] = `
{
  "payload": {
    "apiToken": "api-key",
    "custom_fields": {},
    "dealField": "id",
    "debug_mode": true,
    "domain": "posthog-sandbox",
    "email": "max@posthog.com",
    "internal_partner_action": "createUpdatePerson",
    "match_field": "email",
    "match_value": "max@posthog.com",
    "name": "Max",
    "organizationField": "id",
    "personField": "id",
    "phone": null,
  },
  "settings": {
    "apiToken": "api-key",
    "custom_fields": {},
    "dealField": "id",
    "debug_mode": true,
    "domain": "posthog-sandbox",
    "email": "max@posthog.com",
    "internal_partner_action": "createUpdatePerson",
    "match_field": "email",
    "match_value": "max@posthog.com",
    "name": "Max",
    "organizationField": "id",
    "personField": "id",
    "phone": null,
  },
}
`;
