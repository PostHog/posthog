set -e

cleanup() {
    echo "ğŸ§¹ Cleaning up..."
    docker compose -f docker-compose.dev.yml -p evals down -v --remove-orphans || true
}
trap cleanup EXIT INT TERM

echo "127.0.0.1 kafka clickhouse" >> /etc/hosts

echo "ğŸš€ Starting services..."

docker compose -f docker-compose.dev.yml -p evals up -d db clickhouse kafka

echo "â³ Waiting for services..."
bin/check_kafka_clickhouse_up

echo "âœ… Services ready! Running tests..."

$EVAL_SCRIPT
