#!/bin/bash
set -e

if [[ "$@" == *"--python"* ]]; then
  set -- "${@/--python/}"
  exec python3 -m hogvm.python.cli "$@"

elif [[ "$@" == *"--debug"* ]]; then
  echo "Running in Python VM with debug mode"
  exec python3 -m hogvm.python.cli "$@"

else
  VM_PATH="$(dirname "$0")/../hogvm/typescript"
  CLI_PATH="$(dirname "$0")/../hogvm/typescript/dist/cli.js"
  if [ ! -f $CLI_PATH ]; then
    echo "Building TypeScript HogVM"
    cd $VM_PATH
    pnpm run build
    cd -
  fi
  exec node $CLI_PATH "$@"
fi
