#!/usr/bin/env bash

set -euo pipefail

# Dev-only script to ensure persons postgres database is up
# for services NOT managed by Docker Compose

DB_HOST=localhost
DB_PORT=5434
DB_NAME=posthog_persons
DB_USER=posthog
export PGPASSWORD=posthog

# Loop until PostgreSQL is up and accepting connections
until psql -h $DB_HOST -p $DB_PORT -U $DB_USER -d $DB_NAME -c '\q' > /dev/null 2>&1; do
  echo "Awaiting Persons PostgresSQL warmup..."
  sleep 1
done

echo "Persons PostgreSQL is up!"
exit 0