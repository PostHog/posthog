#!/usr/bin/env bash

set -e

# Generate schema.py from schema.json
datamodel-codegen \
    --class-name='SchemaRoot' --collapse-root-models --target-python-version 3.12 --disable-timestamp \
    --use-one-literal-as-default --use-default --use-default-kwarg --use-subclass-enum \
    --use-union-operator --use-standard-collections \
    --input frontend/src/queries/schema.json --input-file-type jsonschema \
    --output posthog/schema.py --output-model-type pydantic_v2.BaseModel \
    --custom-file-header $'# mypy: disable-error-code="assignment"\n# DO NOT EDIT THIS FILE DIRECTLY.\n# INSTEAD, EDIT frontend/src/types.ts or frontend/src/queries/schema/schema-general.ts\n# THEN RUN hogli build:schema TO REBUILD' \
    --set-default-enum-member --capitalise-enum-members \
    --wrap-string-literal

# Format and lint
ruff format posthog/schema.py
ruff check --fix posthog/schema.py
