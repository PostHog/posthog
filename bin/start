#!/bin/bash
set -e

trap "trap - SIGTERM && kill -- -$$" SIGINT SIGTERM EXIT

export DEBUG=$DEBUG || 1
export KAFKA_HOSTS=$KAFKA_HOSTS || kafka:9092
export DATABASE_URL=$DATABASE_URL || postgres://posthog:posthog@localhost:5432/posthog


nc -z localhost 9092 || ( echo -e "\033[0;31mKafka isn't running. Please run\n\tdocker compose -f ee/docker-compose.ch.arm64.yml up zookeeper kafka clickhouse db redis\nI'll wait while you do that.\033[0m" ; bin/check_kafka_clickhouse_up )
wget -nv -t1 --spider 'http://localhost:8123/' || ( echo -e "\033[0;31mClickhouse isn't running. Please run\n\tdocker compose -f ee/docker-compose.ch.arm64.yml up zookeeper kafka clickhouse db redis.\nI'll wait while you do that.\033[0m" ; bin/check_kafka_clickhouse_up )



./bin/start-worker &
./bin/start-backend &
./bin/start-frontend &

wait
