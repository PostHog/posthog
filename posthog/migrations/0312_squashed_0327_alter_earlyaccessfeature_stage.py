# Generated by Django 4.2.28 on 2026-02-18 08:16

import django.utils.timezone
import django.db.models.deletion
import django.contrib.postgres.fields
from django.conf import settings
from django.db import migrations, models

import posthog.utils
import posthog.models.utils


class Migration(migrations.Migration):
    replaces = [
        ("posthog", "0312_organization_available_product_features"),
        ("posthog", "0313_early_access_feature"),
        ("posthog", "0314_sharingconfiguration_recording"),
        ("posthog", "0315_notebook"),
        ("posthog", "0316_action_href_text_matching"),
        ("posthog", "0317_batch_export_models"),
        ("posthog", "0318_alter_earlyaccessfeature_stage"),
        ("posthog", "0319_user_requested_password_reset_at"),
        ("posthog", "0320_survey"),
        ("posthog", "0321_add_exception_autocapture_optin"),
        ("posthog", "0322_auto_20230531_1904"),
        ("posthog", "0323_alter_batchexportdestination_type"),
        ("posthog", "0324_user_has_seen_product_intro_for"),
        ("posthog", "0325_alter_dashboardtemplate_scope"),
        ("posthog", "0326_team_extra_settings"),
        ("posthog", "0327_alter_earlyaccessfeature_stage"),
    ]

    dependencies = [
        ("posthog", "0311_dashboard_template_scope"),
    ]

    operations = [
        migrations.AddField(
            model_name="organization",
            name="available_product_features",
            field=django.contrib.postgres.fields.ArrayField(
                base_field=models.JSONField(), blank=True, null=True, size=None
            ),
        ),
        migrations.AddField(
            model_name="sharingconfiguration",
            name="recording",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="sharing_configurations",
                to="posthog.sessionrecording",
                to_field="session_id",
            ),
        ),
        migrations.CreateModel(
            name="Notebook",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("short_id", models.CharField(blank=True, default=posthog.utils.generate_short_id, max_length=12)),
                ("title", models.CharField(blank=True, max_length=256, null=True)),
                ("content", models.JSONField(blank=True, default=None, null=True)),
                ("deleted", models.BooleanField(default=False)),
                ("version", models.IntegerField(default=0)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("last_modified_at", models.DateTimeField(default=django.utils.timezone.now)),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL
                    ),
                ),
                (
                    "last_modified_by",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="modified_notebooks",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                ("team", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
            ],
            options={
                "unique_together": {("team", "short_id")},
            },
        ),
        migrations.AddField(
            model_name="actionstep",
            name="href_matching",
            field=models.CharField(
                blank=True,
                choices=[("contains", "contains"), ("regex", "regex"), ("exact", "exact")],
                max_length=400,
                null=True,
            ),
        ),
        migrations.AddField(
            model_name="actionstep",
            name="text_matching",
            field=models.CharField(
                blank=True,
                choices=[("contains", "contains"), ("regex", "regex"), ("exact", "exact")],
                max_length=400,
                null=True,
            ),
        ),
        migrations.CreateModel(
            name="BatchExportDestination",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                (
                    "type",
                    models.CharField(
                        choices=[("S3", "S3")],
                        help_text="A choice of supported BatchExportDestination types.",
                        max_length=64,
                    ),
                ),
                (
                    "config",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="A JSON field to store all configuration parameters required to access a BatchExportDestination.",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="The timestamp at which this BatchExportDestination was created."
                    ),
                ),
                (
                    "last_updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="The timestamp at which this BatchExportDestination was last updated."
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="BatchExport",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                (
                    "team",
                    models.ForeignKey(
                        help_text="The team this belongs to.",
                        on_delete=django.db.models.deletion.CASCADE,
                        to="posthog.team",
                    ),
                ),
                ("name", models.TextField(help_text="A human-readable name for this BatchExport.")),
                (
                    "destination",
                    models.ForeignKey(
                        help_text="The destination to export data to.",
                        on_delete=django.db.models.deletion.CASCADE,
                        to="posthog.batchexportdestination",
                    ),
                ),
                (
                    "interval",
                    models.CharField(
                        choices=[("hour", "hour"), ("day", "day"), ("week", "week")],
                        default="hour",
                        help_text="The interval at which to export data.",
                        max_length=64,
                    ),
                ),
                ("paused", models.BooleanField(default=False, help_text="Whether this BatchExport is paused or not.")),
                (
                    "deleted",
                    models.BooleanField(default=False, help_text="Whether this BatchExport is deleted or not."),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="The timestamp at which this BatchExport was created."
                    ),
                ),
                (
                    "last_updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="The timestamp at which this BatchExport was last updated."
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="BatchExportRun",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("Cancelled", "Cancelled"),
                            ("Completed", "Completed"),
                            ("ContinuedAsNew", "Continuedasnew"),
                            ("Failed", "Failed"),
                            ("Terminated", "Terminated"),
                            ("TimedOut", "Timedout"),
                            ("Running", "Running"),
                            ("Starting", "Starting"),
                        ],
                        help_text="The status of this run.",
                        max_length=64,
                    ),
                ),
                (
                    "records_completed",
                    models.IntegerField(help_text="The number of records that have been exported.", null=True),
                ),
                (
                    "latest_error",
                    models.TextField(help_text="The latest error that occurred during this run.", null=True),
                ),
                ("data_interval_start", models.DateTimeField(help_text="The start of the data interval.")),
                ("data_interval_end", models.DateTimeField(help_text="The end of the data interval.")),
                ("cursor", models.TextField(help_text="An opaque cursor that may be used to resume.", null=True)),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True, help_text="The timestamp at which this BatchExportRun was created."
                    ),
                ),
                (
                    "finished_at",
                    models.DateTimeField(
                        help_text="The timestamp at which this BatchExportRun finished, successfully or not.", null=True
                    ),
                ),
                (
                    "last_updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="The timestamp at which this BatchExportRun was last updated."
                    ),
                ),
                (
                    "batch_export",
                    models.ForeignKey(
                        help_text="The BatchExport this run belongs to.",
                        on_delete=django.db.models.deletion.CASCADE,
                        to="posthog.batchexport",
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="EarlyAccessFeature",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("name", models.CharField(max_length=200)),
                ("description", models.TextField(blank=True)),
                (
                    "stage",
                    models.CharField(
                        choices=[
                            ("draft", "draft"),
                            ("concept", "concept"),
                            ("alpha", "alpha"),
                            ("beta", "beta"),
                            ("general-availability", "general availability"),
                        ],
                        max_length=40,
                    ),
                ),
                ("documentation_url", models.URLField(blank=True, max_length=800)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "feature_flag",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.PROTECT,
                        related_name="features",
                        related_query_name="feature",
                        to="posthog.featureflag",
                    ),
                ),
                (
                    "team",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="features",
                        related_query_name="feature",
                        to="posthog.team",
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.AddField(
            model_name="user",
            name="requested_password_reset_at",
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name="Survey",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("name", models.CharField(max_length=400)),
                ("description", models.TextField(blank=True)),
                (
                    "type",
                    models.CharField(
                        choices=[
                            ("popover", "popover"),
                            ("button", "button"),
                            ("email", "email"),
                            ("full_screen", "full screen"),
                        ],
                        max_length=40,
                    ),
                ),
                ("conditions", models.JSONField(blank=True, null=True)),
                ("questions", models.JSONField(blank=True, null=True)),
                ("appearance", models.JSONField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("start_date", models.DateTimeField(null=True)),
                ("end_date", models.DateTimeField(null=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("archived", models.BooleanField(default=False)),
                (
                    "created_by",
                    models.ForeignKey(
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="surveys",
                        related_query_name="survey",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
                (
                    "linked_flag",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="surveys_linked_flag",
                        related_query_name="survey",
                        to="posthog.featureflag",
                    ),
                ),
                (
                    "targeting_flag",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="surveys_targeting_flag",
                        related_query_name="survey",
                        to="posthog.featureflag",
                    ),
                ),
                (
                    "team",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="surveys",
                        related_query_name="survey",
                        to="posthog.team",
                    ),
                ),
            ],
        ),
        migrations.AddConstraint(
            model_name="survey",
            constraint=models.UniqueConstraint(fields=("team", "name"), name="unique survey name for team"),
        ),
        migrations.AddField(
            model_name="team",
            name="autocapture_exceptions_opt_in",
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name="FeatureFlagDashboards",
            fields=[
                ("id", models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("created_at", models.DateTimeField(auto_now_add=True, null=True)),
                ("updated_at", models.DateTimeField(auto_now=True, null=True)),
                ("dashboard", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.dashboard")),
                (
                    "feature_flag",
                    models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.featureflag"),
                ),
            ],
        ),
        migrations.AddField(
            model_name="featureflag",
            name="analytics_dashboards",
            field=models.ManyToManyField(
                related_name="analytics_dashboards",
                related_query_name="analytics_dashboard",
                through="posthog.FeatureFlagDashboards",
                to="posthog.dashboard",
            ),
        ),
        migrations.AddConstraint(
            model_name="featureflagdashboards",
            constraint=models.UniqueConstraint(
                fields=("feature_flag", "dashboard"), name="unique feature flag for a dashboard"
            ),
        ),
        migrations.AlterField(
            model_name="batchexportdestination",
            name="type",
            field=models.CharField(
                choices=[("S3", "S3"), ("Snowflake", "Snowflake")],
                help_text="A choice of supported BatchExportDestination types.",
                max_length=64,
            ),
        ),
        migrations.AddField(
            model_name="user",
            name="has_seen_product_intro_for",
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name="dashboardtemplate",
            name="scope",
            field=models.CharField(
                blank=True,
                choices=[("team", "Only team"), ("global", "Global"), ("feature_flag", "Feature Flag")],
                max_length=24,
                null=True,
            ),
        ),
        migrations.AddField(
            model_name="team",
            name="extra_settings",
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name="earlyaccessfeature",
            name="stage",
            field=models.CharField(
                choices=[
                    ("draft", "draft"),
                    ("concept", "concept"),
                    ("alpha", "alpha"),
                    ("beta", "beta"),
                    ("general-availability", "general availability"),
                    ("archived", "archived"),
                ],
                max_length=40,
            ),
        ),
    ]
