# Generated by Django 4.2.28 on 2026-02-18 08:16

import django.db.models.deletion
import django.contrib.postgres.fields
from django.db import migrations, models

import posthog.models.utils


class Migration(migrations.Migration):
    replaces = [
        ("posthog", "0288_add_session_recording_persistence"),
        ("posthog", "0289_add_tags_to_feature_flags"),
        ("posthog", "0290_add_dashboard_templates"),
        ("posthog", "0291_create_person_override_model"),
    ]

    dependencies = [
        ("posthog", "0287_add_session_recording_model"),
    ]

    operations = [
        migrations.AddField(
            model_name="sessionrecording",
            name="click_count",
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="deleted",
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="distinct_id",
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="duration",
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="end_time",
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="keypress_count",
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="object_storage_path",
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="start_time",
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecording",
            name="start_url",
            field=models.CharField(blank=True, max_length=512, null=True),
        ),
        migrations.RemoveConstraint(
            model_name="taggeditem",
            name="exactly_one_related_object",
        ),
        migrations.AddField(
            model_name="taggeditem",
            name="feature_flag",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.CASCADE,
                related_name="tagged_items",
                to="posthog.featureflag",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="taggeditem",
            unique_together={
                ("tag", "dashboard", "insight", "event_definition", "property_definition", "action", "feature_flag")
            },
        ),
        migrations.AddConstraint(
            model_name="taggeditem",
            constraint=models.UniqueConstraint(
                condition=models.Q(("feature_flag__isnull", False)),
                fields=("tag", "feature_flag"),
                name="unique_feature_flag_tagged_item",
            ),
        ),
        migrations.AddConstraint(
            model_name="taggeditem",
            constraint=models.CheckConstraint(
                check=models.Q(
                    models.Q(
                        ("dashboard__isnull", False),
                        ("insight__isnull", True),
                        ("event_definition__isnull", True),
                        ("property_definition__isnull", True),
                        ("action__isnull", True),
                        ("feature_flag__isnull", True),
                    ),
                    models.Q(
                        ("dashboard__isnull", True),
                        ("insight__isnull", False),
                        ("event_definition__isnull", True),
                        ("property_definition__isnull", True),
                        ("action__isnull", True),
                        ("feature_flag__isnull", True),
                    ),
                    models.Q(
                        ("dashboard__isnull", True),
                        ("insight__isnull", True),
                        ("event_definition__isnull", False),
                        ("property_definition__isnull", True),
                        ("action__isnull", True),
                        ("feature_flag__isnull", True),
                    ),
                    models.Q(
                        ("dashboard__isnull", True),
                        ("insight__isnull", True),
                        ("event_definition__isnull", True),
                        ("property_definition__isnull", False),
                        ("action__isnull", True),
                        ("feature_flag__isnull", True),
                    ),
                    models.Q(
                        ("dashboard__isnull", True),
                        ("insight__isnull", True),
                        ("event_definition__isnull", True),
                        ("property_definition__isnull", True),
                        ("action__isnull", False),
                        ("feature_flag__isnull", True),
                    ),
                    models.Q(
                        ("dashboard__isnull", True),
                        ("insight__isnull", True),
                        ("event_definition__isnull", True),
                        ("property_definition__isnull", True),
                        ("action__isnull", True),
                        ("feature_flag__isnull", False),
                    ),
                    _connector="OR",
                ),
                name="exactly_one_related_object",
            ),
        ),
        migrations.CreateModel(
            name="DashboardTemplate",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("template_name", models.CharField(max_length=400, null=True)),
                ("dashboard_description", models.CharField(max_length=400, null=True)),
                ("dashboard_filters", models.JSONField(null=True)),
                ("tiles", models.JSONField(default=list)),
                (
                    "tags",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(max_length=255), default=list, size=None
                    ),
                ),
                ("github_url", models.CharField(max_length=8201, null=True)),
                ("team", models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
            ],
        ),
        migrations.AddConstraint(
            model_name="dashboardtemplate",
            constraint=models.UniqueConstraint(fields=("template_name", "team"), name="unique_template_name_per_team"),
        ),
        migrations.CreateModel(
            name="PersonOverride",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("old_person_id", models.UUIDField(db_index=True)),
                ("override_person_id", models.UUIDField(db_index=True)),
                ("oldest_event", models.DateTimeField()),
                ("version", models.BigIntegerField(blank=True, null=True)),
                ("team", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
            ],
        ),
        migrations.AddConstraint(
            model_name="personoverride",
            constraint=models.UniqueConstraint(
                fields=("team", "old_person_id"), name="unique override per old_person_id"
            ),
        ),
    ]
