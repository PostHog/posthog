# Generated by Django 4.2.28 on 2026-02-18 08:16

import django.db.models.deletion
import django.contrib.postgres.operations
import django.db.models.functions.comparison
from django.db import migrations, models


class Migration(migrations.Migration):
    atomic = False

    replaces = [
        ("posthog", "0293_property_definitions_drop_old_constraint"),
        ("posthog", "0294_plugin_blank_fields"),
        ("posthog", "0295_plugin_allow_blank_config_schema"),
        ("posthog", "0296_team_allow_blank_fields"),
        ("posthog", "0297_property_definitions_index_query"),
        ("posthog", "0298_add_insight_queries"),
    ]

    dependencies = [
        ("posthog", "0292_property_definitions_persons_and_groups_support"),
    ]

    operations = [
        migrations.AlterUniqueTogether(
            name="propertydefinition",
            unique_together=set(),
        ),
        migrations.AlterField(
            model_name="plugin",
            name="error",
            field=models.JSONField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name="plugin",
            name="metrics",
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AlterField(
            model_name="plugin",
            name="public_jobs",
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AlterField(
            model_name="plugin",
            name="config_schema",
            field=models.JSONField(blank=True, default=dict),
        ),
        migrations.AlterField(
            model_name="team",
            name="event_names",
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name="team",
            name="event_names_with_usage",
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name="team",
            name="event_properties",
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name="team",
            name="event_properties_numerical",
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name="team",
            name="event_properties_with_usage",
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name="team",
            name="primary_dashboard",
            field=models.ForeignKey(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="primary_dashboard_teams",
                to="posthog.dashboard",
            ),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name="propertydefinition",
            index=models.Index(
                models.F("team_id"),
                models.F("type"),
                django.db.models.functions.comparison.Coalesce(models.F("group_type_index"), -1),
                models.OrderBy(models.F("query_usage_30_day"), descending=True, nulls_last=True),
                models.OrderBy(models.F("name")),
                name="index_property_def_query",
            ),
        ),
        migrations.AddField(
            model_name="insight",
            name="query",
            field=models.JSONField(blank=True, null=True),
        ),
    ]
