# Generated by Django 4.2.28 on 2026-02-20 11:25

import datetime
from django.conf import settings
import django.contrib.postgres.fields
import django.contrib.postgres.indexes
import django.contrib.postgres.operations
from django.db import migrations, models
import django.db.migrations.operations.special
import django.db.models.deletion
import django.utils.timezone
import posthog.helpers.encrypted_fields
import posthog.models.event_ingestion_restriction_config
import posthog.models.utils
import posthog.utils


class Migration(migrations.Migration):

    atomic = False

    replaces = [('posthog', '0797_batchexportrun_bytes_exported'), ('posthog', '0798_alter_integration_kind'), ('posthog', '0799_migrate_playlist_types_take_2'), ('posthog', '0800_add_sharing_token_rotation_fields'), ('posthog', '0801_messagecategory_category_type_and_more'), ('posthog', '0802_messagecategory_category_type_and_more_fix'), ('posthog', '0803_move_recording_annotation_to_comments'), ('posthog', '0804_add_rich_content_json_to_comment'), ('posthog', '0805_alter_survey_type'), ('posthog', '0806_scheduledchange_failure_count_and_more'), ('posthog', '0807_dwh_source_refactor'), ('posthog', '0808_add_evaluation_environment_to_feature_flag'), ('posthog', '0809_insight_query_metadata'), ('posthog', '0810_alter_hogfunctiontemplate_icon_url'), ('posthog', '0811_personalapikey_last_rolled_at'), ('posthog', '0812_sessionrecordingviewed_bulk_viewed'), ('posthog', '0813_alter_messagecategory_category_type_and_more'), ('posthog', '0814_datawarehousesavedquerydraft'), ('posthog', '0815_sharingconfiguration_settings'), ('posthog', '0816_notebook_visibility'), ('posthog', '0817_resourcenotebook_and_more'), ('posthog', '0818_alter_integration_kind'), ('posthog', '0819_alter_integration_kind'), ('posthog', '0820_organization_allow_publicly_shared_resources'), ('posthog', '0821_batchimport_backoff_columns'), ('posthog', '0822_person_properties_size_constraint'), ('posthog', '0823_add_cohort_types'), ('posthog', '0824_team_session_recording_retention_period'), ('posthog', '0825_groupusagemetric_groupusagemetric_unique_metric_name'), ('posthog', '0826_organizationintegration_and_more'), ('posthog', '0827_add_web_analytics_pre_aggregated_tables_enabled_to_team'), ('posthog', '0828_grouptypemapping_created_at'), ('posthog', '0829_organization_default_role'), ('posthog', '0830_add_evaluation_runtimes_to_featureflags'), ('posthog', '0831_alter_groupusagemetric_bytecode_and_more'), ('posthog', '0832_alter_exportedasset_export_format'), ('posthog', '0833_experiment_primary_metrics_ordered_uuids_and_more'), ('posthog', '0834_alter_resourcenotebook_group'), ('posthog', '0835_alter_externaldatasource_source_type'), ('posthog', '0836_sessionrecording_retention_period_days'), ('posthog', '0837_alter_externaldatasource_source_type'), ('posthog', '0838_remove_null_values_from_team_arrays'), ('posthog', '0839_alter_integration_kind'), ('posthog', '0840_externaldatasourcerevenueanalyticsconfig'), ('posthog', '0841_backfill_eds_revenue_analytics_config'), ('posthog', '0842_alter_externaldatasourcerevenueanalyticsconfig_external_data_source'), ('posthog', '0843_datawarehousesavedquery_is_materialized'), ('posthog', '0844_alter_externaldatasource_source_type'), ('posthog', '0845_delete_invalid_personalapikeys'), ('posthog', '0846_add_share_password_model'), ('posthog', '0847_alter_batchexportrun_status'), ('posthog', '0848_activitylog_detail_gin_index'), ('posthog', '0849_duplicate_warehouse_tables'), ('posthog', '0850_add_activitylog_org_scope_created_at'), ('posthog', '0851_add_activitylog_org_detail_exists_index'), ('posthog', '0852_alter_integration_kind'), ('posthog', '0853_create_index_populate_updated_at_flags'), ('posthog', '0854_add_activitylog_detail_gin_path_ops_index'), ('posthog', '0855_alter_exportedasset_export_format'), ('posthog', '0856_add_web_analytics_tables_version'), ('posthog', '0857_dashboardtile_filters_overrides'), ('posthog', '0858_datamodelingjob_storage_delta_mib_and_more'), ('posthog', '0859_alter_team_session_recording_retention_period'), ('posthog', '0860_add_namedquery'), ('posthog', '0861_alter_survey_questions'), ('posthog', '0862_alter_team_session_recording_retention_period'), ('posthog', '0863_experimentmetricresult'), ('posthog', '0864_create_feature_flag_evaluation_tag_table'), ('posthog', '0865_remove_experimentmetricresult_posthog_exp_experim_b5f6d4_idx_and_more'), ('posthog', '0866_add_integration_to_batch_export_destination'), ('posthog', '0867_add_updated_at_to_feature_flags'), ('posthog', '0868_move_recording_activity_log_to_replay'), ('posthog', '0869_create_cohort_calculation_history'), ('posthog', '0870_move_recording_coment_to_replay'), ('posthog', '0871_team_experiment_recalculation_time'), ('posthog', '0872_alter_externaldatasource_source_type'), ('posthog', '0873_alter_cohortpeople_options_and_more'), ('posthog', '0874_activitylog_idx_alog_org_created_at_and_more'), ('posthog', '0875_activitylog_idx_alog_team_scope_created'), ('posthog', '0876_add_marketing_analytics_attribution_settings'), ('posthog', '0877_delete_named_query_from_state'), ('posthog', '0878_alter_externaldatasource_source_type'), ('posthog', '0879_migrate_error_tracking_models'), ('posthog', '0880_datawarehousetable_queryable_folder'), ('posthog', '0881_alter_integration_kind'), ('posthog', '0882_add_team_default_evaluation_tags'), ('posthog', '0883_featureflag_last_called_at'), ('posthog', '0884_experimenttimeseriesrecalculation_and_more'), ('posthog', '0885_migrate_notebooks_models'), ('posthog', '0886_fake_social_django_jsonfield_migrations'), ('posthog', '0887_drop_named_query'), ('posthog', '0888_datawarehousemanagedviewset_and_more'), ('posthog', '0889_add_schema_models'), ('posthog', '0890_add_campaign_name_mappings'), ('posthog', '0891_file_system_view_log'), ('posthog', '0892_alter_integration_kind'), ('posthog', '0893_add_ingestion_lane_fields_to_event_ingestion_restriction'), ('posthog', '0894_organizationdomain_scim_bearer_token_and_more'), ('posthog', '0895_savedheatmap_heatmapsnapshot_and_more'), ('posthog', '0896_alter_externaldatasource_source_type'), ('posthog', '0897_migrate_data_warehouse_models'), ('posthog', '0898_hogflow_variables'), ('posthog', '0899_add_cohort_type'), ('posthog', '0900_team_receive_org_level_activity_logs'), ('posthog', '0901_add_object_property_type'), ('posthog', '0902_user_pinned_scene_tabs'), ('posthog', '0903_organization_default_anonymize_ips'), ('posthog', '0904_alter_dashboard_creation_mode'), ('posthog', '0905_alter_person_table'), ('posthog', '0906_user_allow_sidebar_suggestions'), ('posthog', '0907_alter_persistedfolder_type'), ('posthog', '0908_userproductlist'), ('posthog', '0909_survey_add_linked_insight_id'), ('posthog', '0910_userproductlist_reason_text'), ('posthog', '0911_surveyresponsearchive_and_more'), ('posthog', '0912_alter_survey_linked_insight_type'), ('posthog', '0913_alter_survey_linked_insight'), ('posthog', '0914_alter_userproductlist_reason'), ('posthog', '0915_alter_userproductlist_reason'), ('posthog', '0916_alter_userproductlist_reason'), ('posthog', '0917_alter_survey_linked_insight'), ('posthog', '0918_add_column_configurator'), ('posthog', '0919_teammarketinganalyticsconfig__custom_source_mappings'), ('posthog', '0920_alter_integration_kind'), ('posthog', '0921_teammarketinganalyticsconfig__campaign_field_preferences_and_more'), ('posthog', '0922_remove_persons_db_team_fks'), ('posthog', '0923_add_quick_filters'), ('posthog', '0924_alter_survey_questions'), ('posthog', '0925_team_business_model'), ('posthog', '0926_featureflag_bucketing_identifier'), ('posthog', '0927_changerequest_approvalpolicy_approval_and_more'), ('posthog', '0928_add_team_require_evaluation_tags'), ('posthog', '0929_remove_legacy_batch_export_notification_setting'), ('posthog', '0930_user_shortcut_position'), ('posthog', '0931_materialized_column_slots'), ('posthog', '0932_add_session_ids_to_restriction_config'), ('posthog', '0933_add_event_names_and_uuids_to_restriction_config'), ('posthog', '0934_cohortcalculationhistory_cohort_started_idx'), ('posthog', '0935_cohortcalculationhistory_error_code'), ('posthog', '0936_survey_headline_response_count_and_more'), ('posthog', '0937_remove_redundant_cohortcalculationhistory_indexes'), ('posthog', '0938_add_redirect_to_dlq_restriction_type'), ('posthog', '0939_team_product_tours_opt_in'), ('posthog', '0940_user_allow_impersonation'), ('posthog', '0941_add_exported_recording_model'), ('posthog', '0942_llm_prompt'), ('posthog', '0943_llm_prompt_unique_name'), ('posthog', '0944_organization_is_active_and_more'), ('posthog', '0945_scheduledchange_recurring_fields'), ('posthog', '0946_fix_insightviewed_null_duplicates'), ('posthog', '0947_insightviewed_null_unique_index'), ('posthog', '0948_hogfunction_batch_export_and_more'), ('posthog', '0949_alter_batchexportdestination_type'), ('posthog', '0950_add_exception_type_to_exported_asset'), ('posthog', '0951_hogflowtemplate'), ('posthog', '0952_add_billable_action_to_hogflows'), ('posthog', '0953_create_core_event'), ('posthog', '0954_experiment_scheduling_config'), ('posthog', '0955_alter_organization_is_ai_data_processing_approved'), ('posthog', '0956_team_conversations_enabled_and_more'), ('posthog', '0957_refactor_core_events_to_table'), ('posthog', '0958_drop_teamcoreeventsconfig_table'), ('posthog', '0959_survey_question_summaries'), ('posthog', '0960_remove_dashboardtemplate_unique_template_name_per_team_and_more'), ('posthog', '0961_session_recording_external_reference'), ('posthog', '0962_webanalyticsfilterpreset'), ('posthog', '0963_add_azure_blob_destination'), ('posthog', '0964_webauthncredential'), ('posthog', '0967_oauth_dcr_fields'), ('posthog', '0969_add_oauth_is_verified'), ('posthog', '0970_add_session_recording_encryption'), ('posthog', '0971_exportedasset_failure_type'), ('posthog', '0972_team_logs_settings'), ('posthog', '0973_alter_integration_kind'), ('posthog', '0974_alter_scheduledchange_recurrence_interval'), ('posthog', '0975_add_evaluation_contexts_fields'), ('posthog', '0976_copy_evaluation_contexts_data'), ('posthog', '0977_alter_team_default_evaluation_environments_enabled_and_more'), ('posthog', '0978_add_user_passkeys_enabled_for_2fa'), ('posthog', '0979_survey_enable_iframe_embedding'), ('posthog', '0980_team_default_experiment_confidence_level'), ('posthog', '0981_batchexport_interval_offset_batchexport_timezone'), ('posthog', '0982_comment_conversations_index'), ('posthog', '0983_alter_integration_kind'), ('posthog', '0984_clear_temporary_tokens'), ('posthog', '0985_drop_column_configuration_unique_constraint'), ('posthog', '0986_add_column_configuration_fields'), ('posthog', '0987_add_column_configuration_constraints'), ('posthog', '0988_ducklakecatalog'), ('posthog', '0989_add_tags_to_hogflow_template'), ('posthog', '0990_projectsecretapikey'), ('posthog', '0991_remove_approvalpolicy_bypass_roles'), ('posthog', '0992_drop_approvalpolicy_bypass_roles_column'), ('posthog', '0993_approvalpolicy_bypass_options'), ('posthog', '0994_user_requested_2fa_reset_at'), ('posthog', '0995_team_default_experiment_stats_method'), ('posthog', '0996_oauthapplication_is_first_party'), ('posthog', '0997_oauthapplication_auth_brand'), ('posthog', '0998_team_proactive_tasks_enabled'), ('posthog', '0999_remove_presorted_events_modifier'), ('posthog', '1000_create_healthissue_table'), ('posthog', '1001_fix_person_property_in_operator'), ('posthog', '1002_experiment_exposure_preaggregation_enabled'), ('posthog', '1003_clean_up_stale_alert_subscriptions'), ('posthog', '1004_resource_transfer'), ('posthog', '1005_objectmediapreview_and_more'), ('posthog', '1006_resource_transfer_duplicated_resource_id'), ('posthog', '1007_resourcetransfer_created_by'), ('posthog', '1008_resourcetransfer_created_by_index'), ('posthog', '1009_healthissue_dismissed'), ('posthog', '1010_hogflowtemplate_org_scope')]

    dependencies = [
        ('ee', '0025_role_members'),
        ('ee', '0026_conversation_created_at_conversation_title_and_more'),
        ('posthog', '0001_initial_squashed_0284_improved_caching_state_idx'),
        ('posthog', '0796_fix_revenue_analytics_modifiers_in_queries'),
        ('social_django', '0010_uid_db_index'),
    ]

    operations = [
        migrations.AddField(
            model_name='batchexportrun',
            name='bytes_exported',
            field=models.BigIntegerField(blank=True, help_text='The number of bytes that have been exported in this BatchExportRun.', null=True),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio')], max_length=20),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_sessionrecordingplaylist'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0799_migrate_playlist_types_take_2 op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0799_migrate_playlist_types_take_2 op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AddField(
            model_name='sharingconfiguration',
            name='expires_at',
            field=models.DateTimeField(blank=True, help_text='When this sharing configuration expires (null = active)', null=True),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.AddField(
                    model_name='messagecategory',
                    name='category_type',
                    field=models.CharField(choices=[('marketing', 'MARKETING'), ('transactional', 'TRANSACTIONAL')], default='marketing', max_length=32),
                ),
                migrations.AddField(
                    model_name='messagetemplate',
                    name='message_category',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.messagecategory'),
                ),
            ],
            state_operations=[
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY "posthog_messagetemplate_message_category_id_3a1fda4d" ON "posthog_messagetemplate" ("message_category_id");\n                    ',
                    reverse_sql='\n                        DROP INDEX IF EXISTS "posthog_messagetemplate_message_category_id_3a1fda4d";\n                    ',
                ),
            ],
        ),
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.AddField(
                    model_name='messagecategory',
                    name='category_type',
                    field=models.CharField(choices=[('marketing', 'MARKETING'), ('transactional', 'TRANSACTIONAL')], default='marketing', max_length=32),
                ),
                migrations.AddField(
                    model_name='messagetemplate',
                    name='message_category',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.messagecategory'),
                ),
            ],
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_annotation'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0803_move_recording_annotation_to_comments op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0803_move_recording_annotation_to_comments op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AddField(
            model_name='comment',
            name='rich_content',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='survey',
            name='type',
            field=models.CharField(choices=[('popover', 'popover'), ('widget', 'widget'), ('external_survey', 'external survey'), ('api', 'api')], max_length=40),
        ),
        migrations.AddField(
            model_name='scheduledchange',
            name='failure_count',
            field=models.IntegerField(default=0),
        ),
        migrations.AlterField(
            model_name='scheduledchange',
            name='updated_at',
            field=models.DateTimeField(auto_now=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_externaldatasource'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0807_dwh_source_refactor op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0807_dwh_source_refactor op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AddField(
            model_name='featureflag',
            name='evaluation_runtime',
            field=models.CharField(blank=True, choices=[('server', 'Server'), ('client', 'Client'), ('all', 'All')], help_text='Specifies where this feature flag should be evaluated', max_length=10, null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_featureflag'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0808_add_evaluation_environment_to_feature_flag op#2';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0808_add_evaluation_environment_to_feature_flag op#2';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='featureflag',
            name='evaluation_runtime',
            field=models.CharField(blank=True, choices=[('server', 'Server'), ('client', 'Client'), ('all', 'All')], default='all', help_text='Specifies where this feature flag should be evaluated', max_length=10, null=True),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='ALTER TABLE "posthog_dashboarditem" ADD COLUMN IF NOT EXISTS "query_metadata" jsonb NULL;',
                    reverse_sql='ALTER TABLE "posthog_dashboarditem" DROP COLUMN IF EXISTS "query_metadata";',
                ),
                migrations.RunSQL(
                    sql='CREATE INDEX CONCURRENTLY IF NOT EXISTS dashboarditem_query_metadata ON posthog_dashboarditem USING GIN (query_metadata jsonb_ops);',
                    reverse_sql='DROP INDEX CONCURRENTLY IF EXISTS dashboarditem_query_metadata;',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='insight',
                    name='query_metadata',
                    field=models.JSONField(blank=True, null=True),
                ),
                migrations.AddIndex(
                    model_name='insight',
                    index=django.contrib.postgres.indexes.GinIndex(fields=['query_metadata'], name='dashboarditem_query_metadata', opclasses=['jsonb_ops']),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='hogfunctiontemplate',
            name='icon_url',
            field=models.CharField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='personalapikey',
            name='last_rolled_at',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecordingviewed',
            name='bulk_viewed',
            field=models.BooleanField(default=False),
        ),
        migrations.AlterField(
            model_name='messagecategory',
            name='category_type',
            field=models.CharField(choices=[('marketing', 'Marketing'), ('transactional', 'Transactional')], default='marketing', max_length=32),
        ),
        migrations.AlterField(
            model_name='messagerecipientpreference',
            name='preferences',
            field=models.JSONField(default=dict),
        ),
        migrations.CreateModel(
            name='DataWarehouseSavedQueryDraft',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('deleted', models.BooleanField(blank=True, default=False, null=True)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('query', models.JSONField(blank=True, default=dict, help_text='HogQL query draft')),
                ('name', models.CharField(blank=True, help_text='Name of the draft', max_length=255, null=True)),
                ('edited_history_id', models.CharField(blank=True, help_text='view history id that the draft branched from', max_length=255, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('saved_query', models.ForeignKey(blank=True, help_text='Original saved query this draft is editing (optional)', null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.datawarehousesavedquery')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='sharingconfiguration',
            name='settings',
            field=models.JSONField(blank=True, help_text='JSON settings for storing configuration options', null=True),
        ),
        migrations.AddField(
            model_name='notebook',
            name='visibility',
            field=models.CharField(choices=[('internal', 'internal'), ('default', 'default')], default='default', max_length=20),
        ),
        migrations.CreateModel(
            name='ResourceNotebook',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('group', models.IntegerField(blank=True, db_column='group_id', null=True)),
                ('notebook', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='resources', to='posthog.notebook')),
            ],
        ),
        migrations.AddConstraint(
            model_name='resourcenotebook',
            constraint=models.UniqueConstraint(condition=models.Q(('group__isnull', False)), fields=('notebook', 'group'), name='unique_notebook_group'),
        ),
        migrations.AddConstraint(
            model_name='resourcenotebook',
            constraint=models.CheckConstraint(check=models.Q(models.Q(('group__isnull', False)), _connector='OR'), name='exactly_one_notebook_related_resource'),
        ),
        migrations.AlterUniqueTogether(
            name='resourcenotebook',
            unique_together={('notebook', 'group')},
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio')], max_length=20),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup')], max_length=20),
        ),
        migrations.AddField(
            model_name='organization',
            name='allow_publicly_shared_resources',
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name='batchimport',
            name='backoff_attempt',
            field=models.IntegerField(default=0),
        ),
        migrations.AddField(
            model_name='batchimport',
            name='backoff_until',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.RunSQL(
            sql="\n            DO $$\n            BEGIN\n                IF NOT EXISTS (\n                    SELECT 1\n                    FROM pg_constraint c\n                    WHERE c.conname = 'check_properties_size'\n                      AND c.conrelid = 'posthog_person'::regclass\n                ) THEN\n                    ALTER TABLE posthog_person\n                    ADD CONSTRAINT check_properties_size\n                    CHECK (pg_column_size(properties) <= 655360) NOT VALID;\n                END IF;\n            END\n            $$ LANGUAGE plpgsql;\n            ",
            reverse_sql='\n            ALTER TABLE posthog_person\n            DROP CONSTRAINT IF EXISTS check_properties_size;\n            ',
        ),
        migrations.AddField(
            model_name='cohort',
            name='cohort_type',
            field=models.CharField(blank=True, choices=[('static', 'static'), ('person_property', 'person_property'), ('behavioral', 'behavioral'), ('analytical', 'analytical')], help_text='Type of cohort based on filter complexity', max_length=50, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='session_recording_retention_period',
            field=models.CharField(choices=[('legacy', 'Legacy Retention'), ('30d', '30 Days'), ('90d', '90 Days'), ('1y', '1 Year'), ('5y', '5 Years')], default='legacy', max_length=6),
        ),
        migrations.CreateModel(
            name='GroupUsageMetric',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('group_type_index', models.IntegerField()),
                ('name', models.CharField(max_length=255, verbose_name='Name')),
                ('format', models.CharField(choices=[('numeric', 'numeric'), ('currency', 'currency')], default='numeric', max_length=64)),
                ('interval', models.IntegerField(default=7, help_text='In days')),
                ('display', models.CharField(choices=[('number', 'number'), ('sparkline', 'sparkline')], default='number', max_length=64)),
                ('filters', models.JSONField()),
                ('bytecode', models.JSONField()),
                ('bytecode_error', models.TextField()),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='groupusagemetric',
            constraint=models.UniqueConstraint(fields=('team', 'group_type_index', 'name'), name='unique_metric_name'),
        ),
        migrations.CreateModel(
            name='OrganizationIntegration',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('kind', models.CharField(choices=[('vercel', 'Vercel')], max_length=50)),
                ('integration_id', models.TextField(blank=True, null=True)),
                ('config', models.JSONField(default=dict)),
                ('sensitive_config', posthog.helpers.encrypted_fields.EncryptedJSONField(default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.organization')),
            ],
        ),
        migrations.AddConstraint(
            model_name='organizationintegration',
            constraint=models.UniqueConstraint(fields=('organization', 'kind', 'integration_id'), name='posthog_organization_integration_kind_id_unique'),
        ),
        migrations.AddField(
            model_name='team',
            name='web_analytics_pre_aggregated_tables_enabled',
            field=models.BooleanField(default=False, null=True),
        ),
        migrations.AddField(
            model_name='grouptypemapping',
            name='created_at',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    ALTER TABLE "posthog_organization" ADD COLUMN "default_role_id" uuid NULL CONSTRAINT "posthog_organization_default_role_id_03bcd28b_fk_ee_role_id" REFERENCES "ee_role"("id") DEFERRABLE INITIALLY DEFERRED; -- existing-table-constraint-ignore\n                    SET CONSTRAINTS "posthog_organization_default_role_id_03bcd28b_fk_ee_role_id" IMMEDIATE; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_organization" DROP COLUMN IF EXISTS "default_role_id";\n                    ',
                ),
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY "posthog_organization_default_role_id_03bcd28b" ON "posthog_organization" ("default_role_id");\n                    ',
                    reverse_sql='\n                        DROP INDEX IF EXISTS "posthog_organization_default_role_id_03bcd28b";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='organization',
                    name='default_role',
                    field=models.ForeignKey(blank=True, help_text='Role automatically assigned to new members joining the organization', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='default_for_organizations', to='ee.role'),
                ),
            ],
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_featureflag'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0830_add_evaluation_runtimes_to_featureflags op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0830_add_evaluation_runtimes_to_featureflags op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='groupusagemetric',
            name='bytecode',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='groupusagemetric',
            name='bytecode_error',
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='exportedasset',
            name='export_format',
            field=models.CharField(choices=[('image/png', 'image/png'), ('application/pdf', 'application/pdf'), ('text/csv', 'text/csv'), ('application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'), ('video/webm', 'video/webm'), ('video/mp4', 'video/mp4'), ('image/gif', 'image/gif')], max_length=100),
        ),
        migrations.AddField(
            model_name='experiment',
            name='primary_metrics_ordered_uuids',
            field=models.JSONField(blank=True, default=None, null=True),
        ),
        migrations.AddField(
            model_name='experiment',
            name='secondary_metrics_ordered_uuids',
            field=models.JSONField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk'), ('Snowflake', 'Snowflake'), ('Salesforce', 'Salesforce'), ('MySQL', 'MySQL'), ('MongoDB', 'MongoDB'), ('MSSQL', 'MSSQL'), ('Vitally', 'Vitally'), ('BigQuery', 'BigQuery'), ('Chargebee', 'Chargebee'), ('GoogleAds', 'GoogleAds'), ('TemporalIO', 'TemporalIO'), ('DoIt', 'DoIt'), ('GoogleSheets', 'GoogleSheets'), ('MetaAds', 'MetaAds'), ('Klaviyo', 'Klaviyo'), ('Mailchimp', 'Mailchimp'), ('Braze', 'Braze'), ('Mailjet', 'Mailjet'), ('Redshift', 'Redshift'), ('Polar', 'Polar'), ('RevenueCat', 'RevenueCat')], max_length=128),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='retention_period_days',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk'), ('Snowflake', 'Snowflake'), ('Salesforce', 'Salesforce'), ('MySQL', 'MySQL'), ('MongoDB', 'MongoDB'), ('MSSQL', 'MSSQL'), ('Vitally', 'Vitally'), ('BigQuery', 'BigQuery'), ('Chargebee', 'Chargebee'), ('GoogleAds', 'GoogleAds'), ('TemporalIO', 'TemporalIO'), ('DoIt', 'DoIt'), ('GoogleSheets', 'GoogleSheets'), ('MetaAds', 'MetaAds'), ('Klaviyo', 'Klaviyo'), ('Mailchimp', 'Mailchimp'), ('Braze', 'Braze'), ('Mailjet', 'Mailjet'), ('Redshift', 'Redshift'), ('Polar', 'Polar'), ('RevenueCat', 'RevenueCat'), ('LinkedinAds', 'LinkedinAds')], max_length=128),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_team'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0838_remove_null_values_from_team_arrays op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0838_remove_null_values_from_team_arrays op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_team'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0838_remove_null_values_from_team_arrays op#2';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0838_remove_null_values_from_team_arrays op#2';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel')], max_length=20),
        ),
        migrations.CreateModel(
            name='ExternalDataSourceRevenueAnalyticsConfig',
            fields=[
                ('external_data_source', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, primary_key=True, serialize=False, to='posthog.externaldatasource')),
                ('enabled', models.BooleanField(default=True)),
                ('include_invoiceless_charges', models.BooleanField(default=True)),
            ],
        ),
        migrations.RunSQL(
            sql='ALTER TABLE posthog_externaldatasourcerevenueanalyticsconfig ALTER COLUMN enabled SET DEFAULT true;',
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql='ALTER TABLE posthog_externaldatasourcerevenueanalyticsconfig ALTER COLUMN include_invoiceless_charges SET DEFAULT true;',
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_externaldatasource'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0841_backfill_eds_revenue_analytics_config op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0841_backfill_eds_revenue_analytics_config op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='externaldatasourcerevenueanalyticsconfig',
            name='external_data_source',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, primary_key=True, related_name='revenue_analytics_config', serialize=False, to='posthog.externaldatasource'),
        ),
        migrations.AddField(
            model_name='datawarehousesavedquery',
            name='is_materialized',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_datawarehousesavedquery'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0843_datawarehousesavedquery_is_materialized op#2';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0843_datawarehousesavedquery_is_materialized op#2';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk'), ('Snowflake', 'Snowflake'), ('Salesforce', 'Salesforce'), ('MySQL', 'MySQL'), ('MongoDB', 'MongoDB'), ('MSSQL', 'MSSQL'), ('Vitally', 'Vitally'), ('BigQuery', 'BigQuery'), ('Chargebee', 'Chargebee'), ('GoogleAds', 'GoogleAds'), ('TemporalIO', 'TemporalIO'), ('DoIt', 'DoIt'), ('GoogleSheets', 'GoogleSheets'), ('MetaAds', 'MetaAds'), ('Klaviyo', 'Klaviyo'), ('Mailchimp', 'Mailchimp'), ('Braze', 'Braze'), ('Mailjet', 'Mailjet'), ('Redshift', 'Redshift'), ('Polar', 'Polar'), ('RevenueCat', 'RevenueCat'), ('LinkedinAds', 'LinkedinAds'), ('RedditAds', 'RedditAds')], max_length=128),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_personalapikey'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0845_delete_invalid_personalapikeys op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0845_delete_invalid_personalapikeys op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AddField(
            model_name='sharingconfiguration',
            name='password_required',
            field=models.BooleanField(default=False),
        ),
        migrations.CreateModel(
            name='SharePassword',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password_hash', models.CharField(max_length=128)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('note', models.CharField(blank=True, max_length=100, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_share_passwords', to=settings.AUTH_USER_MODEL)),
                ('sharing_configuration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='share_passwords', to='posthog.sharingconfiguration')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AlterField(
            model_name='batchexportrun',
            name='status',
            field=models.CharField(choices=[('Cancelled', 'Cancelled'), ('Completed', 'Completed'), ('ContinuedAsNew', 'Continued As New'), ('Failed', 'Failed'), ('FailedRetryable', 'Failed Retryable'), ('FailedBilling', 'Failed Billing'), ('Terminated', 'Terminated'), ('TimedOut', 'Timedout'), ('Running', 'Running'), ('Starting', 'Starting')], help_text='The status of this run.', max_length=64),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql=['CREATE INDEX CONCURRENTLY IF NOT EXISTS activitylog_detail_gin ON posthog_activitylog USING GIN (detail jsonb_ops);'],
                    reverse_sql=['DROP INDEX IF EXISTS activitylog_detail_gin;'],
                ),
            ],
            state_operations=[
                migrations.AddIndex(
                    model_name='activitylog',
                    index=django.contrib.postgres.indexes.GinIndex(fields=['detail'], name='activitylog_detail_gin', opclasses=['jsonb_ops']),
                ),
            ],
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_datawarehousetable'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0849_duplicate_warehouse_tables op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0849_duplicate_warehouse_tables op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql=["CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_alog_org_scope_created_at ON posthog_activitylog (organization_id, scope, created_at DESC) WHERE detail IS NOT NULL AND jsonb_typeof(detail) = 'object';"],
                    reverse_sql=['DROP INDEX IF EXISTS idx_alog_org_scope_created_at;'],
                ),
            ],
            state_operations=[
                migrations.AddIndex(
                    model_name='activitylog',
                    index=models.Index(condition=models.Q(('detail__isnull', False), ('detail__jsonb_typeof', 'object')), fields=['organization_id', 'scope', '-created_at'], name='idx_alog_org_scope_created_at'),
                ),
            ],
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql=["CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_alog_org_detail_exists ON posthog_activitylog (organization_id) WHERE detail IS NOT NULL AND jsonb_typeof(detail) = 'object';"],
                    reverse_sql=['DROP INDEX IF EXISTS idx_alog_org_detail_exists;'],
                ),
            ],
            state_operations=[
                migrations.AddIndex(
                    model_name='activitylog',
                    index=models.Index(condition=models.Q(('detail__isnull', False), ('detail__jsonb_typeof', 'object')), fields=['organization_id'], name='idx_alog_org_detail_exists'),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel')], max_length=20),
        ),
        migrations.RunSQL(
            sql="\n            CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_activitylog_featureflag_updates\n            ON posthog_activitylog (team_id, item_id, created_at DESC)\n            WHERE scope = 'FeatureFlag' AND activity = 'updated';\n            ",
            reverse_sql='DROP INDEX IF EXISTS idx_activitylog_featureflag_updates;',
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql=['CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_alog_detail_gin_path_ops ON posthog_activitylog USING GIN (detail jsonb_path_ops);'],
                    reverse_sql=['DROP INDEX IF EXISTS idx_alog_detail_gin_path_ops;'],
                ),
            ],
            state_operations=[
                migrations.AddIndex(
                    model_name='activitylog',
                    index=django.contrib.postgres.indexes.GinIndex(condition=models.Q(('detail__isnull', False)), fields=['detail'], name='idx_alog_detail_gin_path_ops', opclasses=['jsonb_path_ops']),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='exportedasset',
            name='export_format',
            field=models.CharField(choices=[('image/png', 'image/png'), ('application/pdf', 'application/pdf'), ('text/csv', 'text/csv'), ('application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'), ('video/webm', 'video/webm'), ('video/mp4', 'video/mp4'), ('image/gif', 'image/gif'), ('application/json', 'application/json')], max_length=100),
        ),
        migrations.AddField(
            model_name='team',
            name='web_analytics_pre_aggregated_tables_version',
            field=models.CharField(choices=[('v1', 'v1'), ('v2', 'v2')], default='v2', max_length=10, null=True),
        ),
        migrations.AddField(
            model_name='dashboardtile',
            name='filters_overrides',
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AddField(
            model_name='datamodelingjob',
            name='storage_delta_mib',
            field=models.FloatField(blank=True, default=0, null=True),
        ),
        migrations.AddField(
            model_name='externaldatajob',
            name='storage_delta_mib',
            field=models.FloatField(blank=True, default=0, null=True),
        ),
        migrations.AlterField(
            model_name='team',
            name='session_recording_retention_period',
            field=models.CharField(choices=[('legacy', 'Legacy Retention'), ('30d', '30 Days'), ('90d', '90 Days'), ('1y', '1 Year'), ('5y', '5 Years')], default='30d', max_length=6),
        ),
        migrations.AlterField(
            model_name='survey',
            name='questions',
            field=models.JSONField(blank=True, help_text='\n        The `array` of questions included in the survey. Each question must conform to one of the defined question types: Basic, Link, Rating, or Multiple Choice.\n\n        Basic (open-ended question)\n        - `id`: The question ID\n        - `type`: `open`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Link (a question with a link)\n        - `id`: The question ID\n        - `type`: `link`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `link`: The URL associated with the question.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Rating (a question with a rating scale)\n        - `id`: The question ID\n        - `type`: `rating`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `display`: Display style of the rating (`number` or `emoji`).\n        - `scale`: The scale of the rating (`number`).\n        - `lowerBoundLabel`: Label for the lower bound of the scale.\n        - `upperBoundLabel`: Label for the upper bound of the scale.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Multiple choice\n        - `id`: The question ID\n        - `type`: `single_choice` or `multiple_choice`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `choices`: An array of choices for the question.\n        - `shuffleOptions`: Whether to shuffle the order of the choices (`boolean`).\n        - `hasOpenChoice`: Whether the question allows an open-ended response (`boolean`).\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Branching logic can be one of the following types:\n\n        Next question: Proceeds to the next question\n        ```json\n        {\n            "type": "next_question"\n        }\n        ```\n\n        End: Ends the survey, optionally displaying a confirmation message.\n        ```json\n        {\n            "type": "end"\n        }\n        ```\n\n        Response-based: Branches based on the response values. Available for the `rating` and `single_choice` question types.\n        ```json\n        {\n            "type": "response_based",\n            "responseValues": {\n                "responseKey": "value"\n            }\n        }\n        ```\n\n        Specific question: Proceeds to a specific question by index.\n        ```json\n        {\n            "type": "specific_question",\n            "index": 2\n        }\n        ```\n        ', null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_team'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0862_alter_team_session_recording_retention_period op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0862_alter_team_session_recording_retention_period op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='team',
            name='session_recording_retention_period',
            field=models.CharField(choices=[('30d', '30 Days'), ('90d', '90 Days'), ('1y', '1 Year'), ('5y', '5 Years')], default='30d', max_length=3),
        ),
        migrations.CreateModel(
            name='FeatureFlagEvaluationTag',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('feature_flag', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evaluation_tags', to='posthog.featureflag')),
                ('tag', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evaluation_flags', to='posthog.tag')),
            ],
            options={
                'unique_together': {('feature_flag', 'tag')},
            },
        ),
        migrations.CreateModel(
            name='ExperimentMetricResult',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('metric_uuid', models.CharField(max_length=255)),
                ('query_from', models.DateTimeField()),
                ('query_to', models.DateTimeField()),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('result', models.JSONField(blank=True, default=None, null=True)),
                ('query_id', models.CharField(blank=True, max_length=255, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.experiment')),
                ('fingerprint', models.CharField(blank=True, max_length=64, null=True)),
            ],
            options={
                'indexes': [models.Index(fields=['experiment', 'metric_uuid', 'query_to'], name='posthog_exp_experim_b5f6d4_idx')],
                'unique_together': {('experiment', 'metric_uuid', 'query_to')},
            },
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    ALTER TABLE "posthog_batchexportdestination" ADD COLUMN "integration_id" integer NULL CONSTRAINT "posthog_batchexportd_integration_id_7927a172_fk_posthog_i" REFERENCES "posthog_integration"("id") DEFERRABLE INITIALLY DEFERRED;  -- existing-table-constraint-ignore\n                    SET CONSTRAINTS "posthog_batchexportd_integration_id_7927a172_fk_posthog_i" IMMEDIATE;  -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_batchexportdestination" DROP COLUMN IF EXISTS "integration_id";\n                    ',
                ),
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY "posthog_batchexportdestination_integration_id_7927a172" ON "posthog_batchexportdestination" ("integration_id");\n                    ',
                    reverse_sql='\n                        DROP INDEX IF EXISTS "posthog_batchexportdestination_integration_id_7927a172";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='batchexportdestination',
                    name='integration',
                    field=models.ForeignKey(blank=True, help_text='The integration for this destination.', null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.integration'),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres'), ('Redshift', 'Redshift'), ('BigQuery', 'Bigquery'), ('Databricks', 'Databricks'), ('HTTP', 'Http'), ('NoOp', 'Noop')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel'), ('databricks', 'Databricks')], max_length=20),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.AddField(
                    model_name='featureflag',
                    name='updated_at',
                    field=models.DateTimeField(null=True),
                ),
                migrations.RunSQL(
                    sql="\n                    UPDATE posthog_featureflag flag\n                    SET updated_at = last_flag_activity.latest_created_at\n                    FROM (\n                        SELECT log.item_id, log.team_id, MAX(log.created_at) AS latest_created_at\n                        FROM posthog_activitylog log\n                        WHERE log.scope = 'FeatureFlag'\n                        AND log.activity = 'updated'\n                        GROUP BY log.team_id, log.item_id\n                    ) last_flag_activity\n                    WHERE CAST(flag.id AS VARCHAR) = last_flag_activity.item_id\n                    AND flag.team_id = last_flag_activity.team_id;\n                    ",
                    reverse_sql='UPDATE posthog_featureflag SET updated_at = NULL WHERE updated_at IS NOT NULL;',
                ),
                migrations.RunSQL(
                    sql='\n                    UPDATE posthog_featureflag\n                    SET updated_at = created_at\n                    WHERE updated_at IS NULL;\n                    ',
                    reverse_sql='UPDATE posthog_featureflag SET updated_at = NULL WHERE updated_at IS NOT NULL;',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='featureflag',
                    name='updated_at',
                    field=models.DateTimeField(null=True),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='featureflag',
            name='updated_at',
            field=models.DateTimeField(auto_now=True, null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_activitylog'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0868_move_recording_activity_log_to_replay op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0868_move_recording_activity_log_to_replay op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.CreateModel(
            name='CohortCalculationHistory',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('filters', models.JSONField(help_text='Cohort filters/properties at time of calculation')),
                ('count', models.PositiveIntegerField(blank=True, help_text='Number of people in cohort', null=True)),
                ('started_at', models.DateTimeField(default=django.utils.timezone.now, help_text='When calculation started')),
                ('finished_at', models.DateTimeField(blank=True, help_text='When calculation finished', null=True)),
                ('queries', models.JSONField(blank=True, default=None, help_text='Array of query information (query, query_id, query_ms, memory_mb, read_rows, written_rows)', null=True)),
                ('error', models.TextField(blank=True, help_text='Error message if calculation failed', null=True)),
                ('cohort', models.ForeignKey(db_index=False, on_delete=django.db.models.deletion.CASCADE, to='posthog.cohort')),
                ('team', models.ForeignKey(db_index=False, on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'db_table': 'posthog_cohortcalculationhistory',
                'indexes': [models.Index(fields=['team', 'cohort'], name='posthog_coh_team_id_0ba00c_idx'), models.Index(fields=['team', 'started_at'], name='posthog_coh_team_id_762cc7_idx')],
            },
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_comment'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0870_move_recording_coment_to_replay op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0870_move_recording_coment_to_replay op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AddField(
            model_name='team',
            name='experiment_recalculation_time',
            field=models.TimeField(blank=True, help_text='Time of day (UTC) when experiment metrics should be recalculated. If not set, uses the default recalculation time.', null=True),
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk'), ('Snowflake', 'Snowflake'), ('Salesforce', 'Salesforce'), ('MySQL', 'MySQL'), ('MongoDB', 'MongoDB'), ('MSSQL', 'MSSQL'), ('Vitally', 'Vitally'), ('BigQuery', 'BigQuery'), ('Chargebee', 'Chargebee'), ('GoogleAds', 'GoogleAds'), ('TemporalIO', 'TemporalIO'), ('DoIt', 'DoIt'), ('GoogleSheets', 'GoogleSheets'), ('MetaAds', 'MetaAds'), ('Klaviyo', 'Klaviyo'), ('Mailchimp', 'Mailchimp'), ('Braze', 'Braze'), ('Mailjet', 'Mailjet'), ('Redshift', 'Redshift'), ('Polar', 'Polar'), ('RevenueCat', 'RevenueCat'), ('LinkedinAds', 'LinkedinAds'), ('RedditAds', 'RedditAds'), ('TikTokAds', 'TikTokAds')], max_length=128),
        ),
        migrations.AlterModelOptions(
            name='cohortpeople',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='featureflaghashkeyoverride',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='flatpersonoverride',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='group',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='grouptypemapping',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='pendingpersonoverride',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='person',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='persondistinctid',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='personlessdistinctid',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='personoverride',
            options={'managed': False},
        ),
        migrations.AlterModelOptions(
            name='personoverridemapping',
            options={'managed': False},
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql=['CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_alog_team_scp_act_crtd ON posthog_activitylog (team_id, scope, activity, created_at DESC) WHERE (NOT was_impersonated) AND (NOT is_system);'],
                    reverse_sql=['DROP INDEX CONCURRENTLY IF EXISTS idx_alog_team_scp_act_crtd;'],
                ),
            ],
            state_operations=[
                migrations.AddIndex(
                    model_name='activitylog',
                    index=models.Index(condition=models.Q(('was_impersonated', False), ('is_system', False)), fields=['team_id', 'scope', 'activity', '-created_at'], name='idx_alog_team_scp_act_crtd'),
                ),
            ],
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql=['CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_alog_team_scope_created ON posthog_activitylog (team_id, scope, created_at DESC) WHERE (NOT was_impersonated) AND (NOT is_system);'],
                    reverse_sql=['DROP INDEX CONCURRENTLY IF EXISTS idx_alog_team_scope_created;'],
                ),
            ],
            state_operations=[
                migrations.AddIndex(
                    model_name='activitylog',
                    index=models.Index(condition=models.Q(('was_impersonated', False), ('is_system', False)), fields=['team_id', 'scope', '-created_at'], name='idx_alog_team_scope_created'),
                ),
            ],
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql=['CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_alog_team_act_scope_usr ON posthog_activitylog (team_id, activity, scope, user_id) WHERE (NOT was_impersonated) AND (NOT is_system);'],
                    reverse_sql=['DROP INDEX CONCURRENTLY IF EXISTS idx_alog_team_act_scope_usr;'],
                ),
            ],
            state_operations=[
                migrations.AddIndex(
                    model_name='activitylog',
                    index=models.Index(condition=models.Q(('was_impersonated', False), ('is_system', False)), fields=['team_id', 'activity', 'scope', 'user'], name='idx_alog_team_act_scope_usr'),
                ),
            ],
        ),
        migrations.AddField(
            model_name='teammarketinganalyticsconfig',
            name='attribution_mode',
            field=models.CharField(choices=[('first_touch', 'First Touch'), ('last_touch', 'Last Touch')], default='last_touch', help_text='Attribution mode: first_touch or last_touch', max_length=20),
        ),
        migrations.AddField(
            model_name='teammarketinganalyticsconfig',
            name='attribution_window_days',
            field=models.IntegerField(default=90, help_text='Attribution window in days (1-90)'),
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk'), ('Snowflake', 'Snowflake'), ('Salesforce', 'Salesforce'), ('MySQL', 'MySQL'), ('MongoDB', 'MongoDB'), ('MSSQL', 'MSSQL'), ('Vitally', 'Vitally'), ('BigQuery', 'BigQuery'), ('Chargebee', 'Chargebee'), ('GoogleAds', 'GoogleAds'), ('TemporalIO', 'TemporalIO'), ('DoIt', 'DoIt'), ('GoogleSheets', 'GoogleSheets'), ('MetaAds', 'MetaAds'), ('Klaviyo', 'Klaviyo'), ('Mailchimp', 'Mailchimp'), ('Braze', 'Braze'), ('Mailjet', 'Mailjet'), ('Redshift', 'Redshift'), ('Polar', 'Polar'), ('RevenueCat', 'RevenueCat'), ('LinkedinAds', 'LinkedinAds'), ('RedditAds', 'RedditAds'), ('TikTokAds', 'TikTokAds'), ('Shopify', 'Shopify')], max_length=128),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunPython(
                    code=django.db.migrations.operations.special.RunPython.noop,
                    reverse_code=django.db.migrations.operations.special.RunPython.noop,
                ),
            ],
            state_operations=[
                migrations.RemoveField(
                    model_name='errortrackingexternalreference',
                    name='integration',
                ),
                migrations.RemoveField(
                    model_name='errortrackingexternalreference',
                    name='issue',
                ),
                migrations.RemoveField(
                    model_name='errortrackinggroup',
                    name='assignee',
                ),
                migrations.RemoveField(
                    model_name='errortrackinggroup',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackinggroupingrule',
                    name='role',
                ),
                migrations.RemoveField(
                    model_name='errortrackinggroupingrule',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackinggroupingrule',
                    name='user',
                ),
                migrations.RemoveField(
                    model_name='errortrackinggroupingrule',
                    name='user_group',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissue',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissueassignment',
                    name='issue',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissueassignment',
                    name='role',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissueassignment',
                    name='user',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissueassignment',
                    name='user_group',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissuefingerprint',
                    name='issue',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissuefingerprint',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissuefingerprintv2',
                    name='issue',
                ),
                migrations.RemoveField(
                    model_name='errortrackingissuefingerprintv2',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackingrelease',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackingstackframe',
                    name='symbol_set',
                ),
                migrations.RemoveField(
                    model_name='errortrackingstackframe',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackingsuppressionrule',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='errortrackingsymbolset',
                    name='release',
                ),
                migrations.RemoveField(
                    model_name='errortrackingsymbolset',
                    name='team',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingAssignmentRule',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingExternalReference',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingGroup',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingGroupingRule',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingIssue',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingIssueAssignment',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingIssueFingerprint',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingIssueFingerprintV2',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingRelease',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingStackFrame',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingSuppressionRule',
                ),
                migrations.DeleteModel(
                    name='ErrorTrackingSymbolSet',
                ),
            ],
        ),
        migrations.AddField(
            model_name='datawarehousetable',
            name='queryable_folder',
            field=models.CharField(blank=True, max_length=500, null=True),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('tiktok-ads', 'Tiktok Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel'), ('databricks', 'Databricks')], max_length=20),
        ),
        migrations.AddField(
            model_name='team',
            name='default_evaluation_environments_enabled',
            field=models.BooleanField(blank=True, default=False, help_text='Whether to automatically apply default evaluation environments to new feature flags', null=True),
        ),
        migrations.CreateModel(
            name='TeamDefaultEvaluationTag',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('tag', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='team_defaults', to='posthog.tag')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='default_evaluation_tags', to='posthog.team')),
            ],
            options={
                'unique_together': {('team', 'tag')},
            },
        ),
        migrations.AddField(
            model_name='featureflag',
            name='last_called_at',
            field=models.DateTimeField(blank=True, help_text='Last time this feature flag was called (from $feature_flag_called events)', null=True),
        ),
        migrations.CreateModel(
            name='ExperimentTimeseriesRecalculation',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('metric', models.JSONField()),
                ('fingerprint', models.CharField(max_length=64)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('last_successful_date', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('experiment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.experiment')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'indexes': [models.Index(fields=['status'], name='posthog_exp_status_01657f_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='experimenttimeseriesrecalculation',
            constraint=models.UniqueConstraint(condition=models.Q(('status__in', ['pending', 'in_progress'])), fields=('experiment', 'fingerprint'), name='unique_active_recalculation_per_experiment_metric'),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunPython(
                    code=django.db.migrations.operations.special.RunPython.noop,
                    reverse_code=django.db.migrations.operations.special.RunPython.noop,
                ),
            ],
            state_operations=[
                migrations.AlterUniqueTogether(
                    name='resourcenotebook',
                    unique_together=None,
                ),
                migrations.RemoveField(
                    model_name='resourcenotebook',
                    name='notebook',
                ),
                migrations.DeleteModel(
                    name='Notebook',
                ),
                migrations.DeleteModel(
                    name='ResourceNotebook',
                ),
            ],
        ),
        migrations.RunPython(
            code=django.db.migrations.operations.special.RunPython.noop,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.CreateModel(
            name='DataWarehouseManagedViewSet',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('kind', models.CharField(choices=[('revenue_analytics', 'Revenue Analytics')], max_length=64)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='datawarehousemanagedviewset',
            constraint=models.UniqueConstraint(fields=('team', 'kind'), name='datawarehouse_unique_managed_viewset_team_kind'),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    ALTER TABLE "posthog_datawarehousesavedquery" ADD COLUMN "managed_viewset_id" uuid NULL CONSTRAINT "posthog_datawarehousesavedquery_managed_viewset_id_1cbf8562_fk_posthog_a" REFERENCES "posthog_datawarehousemanagedviewset"("id") DEFERRABLE INITIALLY DEFERRED; -- existing-table-constraint-ignore\n                    SET CONSTRAINTS "posthog_datawarehousesavedquery_managed_viewset_id_1cbf8562_fk_posthog_a" IMMEDIATE; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_datawarehousesavedquery" DROP COLUMN IF EXISTS "managed_viewset_id";\n                    ',
                ),
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY "posthog_datawarehousesavedquery_managed_viewset_id_1cbf8562" ON "posthog_datawarehousesavedquery" ("managed_viewset_id");\n                    ',
                    reverse_sql='\n                        DROP INDEX IF EXISTS "posthog_datawarehousesavedquery_managed_viewset_id_1cbf8562";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='datawarehousesavedquery',
                    name='managed_viewset',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='saved_queries', to='posthog.datawarehousemanagedviewset'),
                ),
            ],
        ),
        migrations.CreateModel(
            name='SchemaPropertyGroup',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=400)),
                ('description', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_schema_property_groups', to=settings.AUTH_USER_MODEL)),
                ('project', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.project')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schema_property_groups', related_query_name='schema_property_group', to='posthog.team')),
            ],
        ),
        migrations.CreateModel(
            name='EventSchema',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('event_definition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schemas', related_query_name='schema', to='posthog.eventdefinition')),
                ('property_group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='event_schemas', related_query_name='event_schema', to='posthog.schemapropertygroup')),
            ],
        ),
        migrations.CreateModel(
            name='SchemaPropertyGroupProperty',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=400)),
                ('property_type', models.CharField(choices=[('DateTime', 'DateTime'), ('String', 'String'), ('Numeric', 'Numeric'), ('Boolean', 'Boolean'), ('Duration', 'Duration')], max_length=50)),
                ('is_required', models.BooleanField(default=False)),
                ('description', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('property_group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='properties', related_query_name='property', to='posthog.schemapropertygroup')),
            ],
            options={
                'ordering': ['name'],
                'indexes': [models.Index(fields=['property_group', 'name'], name='schema_pgp_group_name_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='schemapropertygroupproperty',
            constraint=models.UniqueConstraint(fields=('property_group', 'name'), name='unique_property_group_property_name'),
        ),
        migrations.AddConstraint(
            model_name='schemapropertygroupproperty',
            constraint=models.CheckConstraint(check=models.Q(('property_type__in', ['DateTime', 'String', 'Numeric', 'Boolean', 'Duration'])), name='property_type_is_valid_schema'),
        ),
        migrations.AddIndex(
            model_name='schemapropertygroup',
            index=models.Index(fields=['team', 'name'], name='schema_pg_team_name_idx'),
        ),
        migrations.AddConstraint(
            model_name='schemapropertygroup',
            constraint=models.UniqueConstraint(fields=('team', 'name'), name='unique_schema_property_group_team_name'),
        ),
        migrations.AddConstraint(
            model_name='eventschema',
            constraint=models.UniqueConstraint(fields=('event_definition', 'property_group'), name='unique_event_schema'),
        ),
        migrations.AddField(
            model_name='teammarketinganalyticsconfig',
            name='_campaign_name_mappings',
            field=models.JSONField(blank=True, db_column='campaign_name_mappings', default=dict, help_text='Maps campaign names to lists of raw UTM values per data source'),
        ),
        migrations.CreateModel(
            name='FileSystemViewLog',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('type', models.CharField(max_length=150)),
                ('ref', models.CharField(max_length=200)),
                ('viewed_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'indexes': [models.Index(fields=['team', 'user', '-viewed_at'], name='posthog_fsvl_recent_user_views'), models.Index(fields=['team', 'type', 'ref', '-viewed_at'], name='posthog_fsvl_recent_item_views')],
            },
        ),
        migrations.AddConstraint(
            model_name='filesystemviewlog',
            constraint=models.UniqueConstraint(fields=('team', 'user', 'type', 'ref'), name='posthog_fsvl_unique_user_item'),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('tiktok-ads', 'Tiktok Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('gitlab', 'Gitlab'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel'), ('databricks', 'Databricks')], max_length=20),
        ),
        migrations.AddField(
            model_name='eventingestionrestrictionconfig',
            name='pipelines',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=50), blank=True, default=posthog.models.event_ingestion_restriction_config.default_pipelines, help_text="List of ingestion pipelines this restriction applies to (e.g., 'analytics', 'session_recordings')", size=None),
        ),
        migrations.AddField(
            model_name='organizationdomain',
            name='scim_bearer_token',
            field=models.CharField(blank=True, help_text='Hashed bearer token for SCIM authentication', max_length=255, null=True),
        ),
        migrations.AddField(
            model_name='organizationdomain',
            name='scim_enabled',
            field=models.BooleanField(default=False),
        ),
        migrations.CreateModel(
            name='SavedHeatmap',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('short_id', models.CharField(blank=True, default=posthog.utils.generate_short_id, max_length=12)),
                ('name', models.CharField(blank=True, max_length=400, null=True)),
                ('url', models.URLField(max_length=2000)),
                ('data_url', models.URLField(blank=True, help_text='URL for fetching heatmap data', max_length=2000, null=True)),
                ('target_widths', models.JSONField(default=list)),
                ('type', models.CharField(choices=[('screenshot', 'Screenshot'), ('iframe', 'Iframe'), ('recording', 'Recording')], default='screenshot', max_length=20)),
                ('status', models.CharField(choices=[('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed')], default='processing', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('exception', models.TextField(blank=True, null=True)),
                ('deleted', models.BooleanField(default=False)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'db_table': 'posthog_heatmapsaved',
            },
        ),
        migrations.CreateModel(
            name='HeatmapSnapshot',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('width', models.IntegerField()),
                ('content', models.BinaryField(null=True)),
                ('content_location', models.TextField(blank=True, max_length=1000, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('heatmap', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='snapshots', to='posthog.savedheatmap')),
            ],
        ),
        migrations.AddIndex(
            model_name='savedheatmap',
            index=models.Index(fields=['team', 'url'], name='posthog_hea_team_id_7540ce_idx'),
        ),
        migrations.AddIndex(
            model_name='savedheatmap',
            index=models.Index(fields=['status'], name='posthog_hea_status_851064_idx'),
        ),
        migrations.AddIndex(
            model_name='savedheatmap',
            index=models.Index(fields=['deleted'], name='posthog_hea_deleted_9942b0_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='savedheatmap',
            unique_together={('team', 'short_id')},
        ),
        migrations.AddIndex(
            model_name='heatmapsnapshot',
            index=models.Index(fields=['heatmap', 'width'], name='posthog_hea_heatmap_9543e8_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='heatmapsnapshot',
            unique_together={('heatmap', 'width')},
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Github', 'Github'), ('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk'), ('Snowflake', 'Snowflake'), ('Salesforce', 'Salesforce'), ('MySQL', 'MySQL'), ('MongoDB', 'MongoDB'), ('MSSQL', 'MSSQL'), ('Vitally', 'Vitally'), ('BigQuery', 'BigQuery'), ('Chargebee', 'Chargebee'), ('GoogleAds', 'GoogleAds'), ('TemporalIO', 'TemporalIO'), ('DoIt', 'DoIt'), ('GoogleSheets', 'GoogleSheets'), ('MetaAds', 'MetaAds'), ('Klaviyo', 'Klaviyo'), ('Mailchimp', 'Mailchimp'), ('Braze', 'Braze'), ('Mailjet', 'Mailjet'), ('Redshift', 'Redshift'), ('Polar', 'Polar'), ('RevenueCat', 'RevenueCat'), ('LinkedinAds', 'LinkedinAds'), ('RedditAds', 'RedditAds'), ('TikTokAds', 'TikTokAds'), ('Shopify', 'Shopify')], max_length=128),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunPython(
                    code=django.db.migrations.operations.special.RunPython.noop,
                    reverse_code=django.db.migrations.operations.special.RunPython.noop,
                ),
            ],
            state_operations=[
                migrations.RemoveField(
                    model_name='datawarehousecredential',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehousecredential',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='datawarehousejoin',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehousejoin',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='datawarehousemanagedviewset',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehousemanagedviewset',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='datawarehousemodelpath',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehousemodelpath',
                    name='saved_query',
                ),
                migrations.RemoveField(
                    model_name='datawarehousemodelpath',
                    name='table',
                ),
                migrations.RemoveField(
                    model_name='datawarehousemodelpath',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='datawarehousesavedquery',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehousesavedquery',
                    name='managed_viewset',
                ),
                migrations.RemoveField(
                    model_name='datawarehousesavedquery',
                    name='table',
                ),
                migrations.RemoveField(
                    model_name='datawarehousesavedquery',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='datawarehousesavedquerydraft',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehousesavedquerydraft',
                    name='saved_query',
                ),
                migrations.RemoveField(
                    model_name='datawarehousesavedquerydraft',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='datawarehousetable',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehousetable',
                    name='credential',
                ),
                migrations.RemoveField(
                    model_name='datawarehousetable',
                    name='external_data_source',
                ),
                migrations.RemoveField(
                    model_name='datawarehousetable',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='datawarehouseviewlink',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='datawarehouseviewlink',
                    name='saved_query',
                ),
                migrations.RemoveField(
                    model_name='datawarehouseviewlink',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='externaldatajob',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='externaldatajob',
                    name='pipeline',
                ),
                migrations.RemoveField(
                    model_name='externaldatajob',
                    name='schema',
                ),
                migrations.RemoveField(
                    model_name='externaldatajob',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='externaldataschema',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='externaldataschema',
                    name='source',
                ),
                migrations.RemoveField(
                    model_name='externaldataschema',
                    name='table',
                ),
                migrations.RemoveField(
                    model_name='externaldataschema',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='externaldatasource',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='externaldatasource',
                    name='team',
                ),
                migrations.RemoveField(
                    model_name='externaldatasourcerevenueanalyticsconfig',
                    name='external_data_source',
                ),
                migrations.RemoveField(
                    model_name='querytabstate',
                    name='created_by',
                ),
                migrations.RemoveField(
                    model_name='querytabstate',
                    name='team',
                ),
                migrations.DeleteModel(
                    name='DataModelingJob',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseCredential',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseJoin',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseManagedViewSet',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseModelPath',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseSavedQuery',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseSavedQueryDraft',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseTable',
                ),
                migrations.DeleteModel(
                    name='DataWarehouseViewLink',
                ),
                migrations.DeleteModel(
                    name='ExternalDataJob',
                ),
                migrations.DeleteModel(
                    name='ExternalDataSchema',
                ),
                migrations.DeleteModel(
                    name='ExternalDataSource',
                ),
                migrations.DeleteModel(
                    name='ExternalDataSourceRevenueAnalyticsConfig',
                ),
                migrations.DeleteModel(
                    name='QueryTabState',
                ),
            ],
        ),
        migrations.AddField(
            model_name='hogflow',
            name='variables',
            field=models.JSONField(blank=True, default=list, null=True),
        ),
        migrations.AlterField(
            model_name='cohort',
            name='cohort_type',
            field=models.CharField(blank=True, choices=[('static', 'static'), ('person_property', 'person_property'), ('behavioral', 'behavioral'), ('realtime', 'realtime'), ('analytical', 'analytical')], help_text='Type of cohort based on filter complexity', max_length=50, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='receive_org_level_activity_logs',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.RemoveConstraint(
            model_name='schemapropertygroupproperty',
            name='property_type_is_valid_schema',
        ),
        migrations.AlterField(
            model_name='schemapropertygroupproperty',
            name='property_type',
            field=models.CharField(choices=[('DateTime', 'DateTime'), ('String', 'String'), ('Numeric', 'Numeric'), ('Boolean', 'Boolean'), ('Object', 'Object')], max_length=50),
        ),
        migrations.CreateModel(
            name='UserHomeSettings',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('tabs', models.JSONField(blank=True, default=list)),
                ('homepage', models.JSONField(blank=True, default=dict, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('team', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='home_settings', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddConstraint(
            model_name='userhomesettings',
            constraint=models.UniqueConstraint(fields=('team', 'user'), name='posthog_unique_user_home_settings'),
        ),
        migrations.AddField(
            model_name='organization',
            name='default_anonymize_ips',
            field=models.BooleanField(default=False, help_text="Default setting for 'Discard client IP data' for new projects in this organization."),
        ),
        migrations.AlterField(
            model_name='dashboard',
            name='creation_mode',
            field=models.CharField(choices=[('default', 'Default'), ('template', 'Template'), ('duplicate', 'Duplicate'), ('unlisted', 'Unlisted (product-embedded)')], default='default', max_length=16),
        ),
        migrations.AlterModelTable(
            name='person',
            table='posthog_person',
        ),
        migrations.AddField(
            model_name='user',
            name='allow_sidebar_suggestions',
            field=models.BooleanField(blank=True, default=True, null=True),
        ),
        migrations.RunPython(
            code=django.db.migrations.operations.special.RunPython.noop,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.AlterField(
            model_name='persistedfolder',
            name='type',
            field=models.CharField(choices=[('home', 'Home'), ('pinned', 'Pinned'), ('custom_products', 'Custom Products')], max_length=32),
        ),
        migrations.AddField(
            model_name='survey',
            name='linked_insight_id',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name='UserProductList',
            fields=[
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('product_path', models.CharField(max_length=200)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('reason', models.CharField(choices=[('usage', 'Usage'), ('new_product', 'New Product'), ('sales_led', 'Sales Led')], max_length=32, null=True)),
                ('enabled', models.BooleanField(default=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('reason_text', models.TextField(null=True)),
            ],
            options={
                'verbose_name': 'User Product List',
                'verbose_name_plural': 'User Product Lists',
                'indexes': [models.Index(models.F('team_id'), models.F('user_id'), name='posthog_upl_team_user')],
                'unique_together': {('team', 'user', 'product_path')},
            },
        ),
        migrations.CreateModel(
            name='SurveyResponseArchive',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('response_uuid', models.UUIDField(help_text='UUID of the ClickHouse event representing the survey response')),
                ('archived_at', models.DateTimeField(auto_now_add=True)),
                ('survey', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='response_archives', related_query_name='response_archive', to='posthog.survey')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='survey_response_archives', related_query_name='survey_response_archive', to='posthog.team')),
            ],
            options={
                'indexes': [models.Index(fields=['survey', 'team'], name='posthog_sur_survey__f78fc7_idx'), models.Index(fields=['team', 'response_uuid'], name='posthog_sur_team_id_2c59a2_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='surveyresponsearchive',
            constraint=models.UniqueConstraint(fields=('team', 'response_uuid'), name='unique_archived_response_per_team'),
        ),
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.RemoveField(
                    model_name='survey',
                    name='linked_insight_id',
                ),
                migrations.AddField(
                    model_name='survey',
                    name='linked_insight',
                    field=models.ForeignKey(blank=True, db_constraint=False, db_index=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_linked_insight', related_query_name='survey_linked_insight', to='posthog.insight'),
                ),
            ],
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                        ALTER TABLE "posthog_survey" ADD CONSTRAINT "posthog_survey_linked_insight_id_586524f3_fk_posthog_d" FOREIGN KEY ("linked_insight_id") REFERENCES "posthog_dashboarditem" ("id") DEFERRABLE INITIALLY DEFERRED NOT VALID; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_survey" DROP CONSTRAINT IF EXISTS "posthog_survey_linked_insight_id_586524f3_fk_posthog_d";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AlterField(
                    model_name='survey',
                    name='linked_insight',
                    field=models.ForeignKey(blank=True, db_index=False, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_linked_insight', related_query_name='survey_linked_insight', to='posthog.insight'),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='userproductlist',
            name='reason',
            field=models.CharField(choices=[('product_intent', 'Product Intent'), ('used_by_colleagues', 'Used by Colleagues'), ('used_similar_products', 'Used Similar Products'), ('new_product', 'New Product'), ('sales_led', 'Sales Led')], max_length=32, null=True),
        ),
        migrations.AlterField(
            model_name='userproductlist',
            name='reason',
            field=models.CharField(choices=[('onboarding', 'Onboarding'), ('product_intent', 'Product Intent'), ('used_by_colleagues', 'Used by Colleagues'), ('used_similar_products', 'Used Similar Products'), ('new_product', 'New Product'), ('sales_led', 'Sales Led')], max_length=32, null=True),
        ),
        migrations.AlterField(
            model_name='userproductlist',
            name='reason',
            field=models.CharField(choices=[('onboarding', 'Onboarding'), ('product_intent', 'Product Intent'), ('used_by_colleagues', 'Used by Colleagues'), ('used_similar_products', 'Used Similar Products'), ('used_on_separate_team', 'Used on Separate Team'), ('new_product', 'New Product'), ('sales_led', 'Sales Led')], max_length=32, null=True),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY IF NOT EXISTS "posthog_survey_linked_insight_id_586524f3" ON "posthog_survey" ("linked_insight_id"); -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        DROP INDEX IF EXISTS "posthog_survey_linked_insight_id_586524f3";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AlterField(
                    model_name='survey',
                    name='linked_insight',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_linked_insight', related_query_name='survey_linked_insight', to='posthog.insight'),
                ),
            ],
        ),
        migrations.CreateModel(
            name='ColumnConfiguration',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('context_key', models.CharField(db_index=True, max_length=255)),
                ('columns', django.contrib.postgres.fields.ArrayField(base_field=models.TextField(), default=list, size=None)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'indexes': [models.Index(fields=['team', 'context_key'], name='posthog_col_team_id_0cba64_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='columnconfiguration',
            constraint=models.UniqueConstraint(fields=('team', 'context_key'), name='unique_team_context_key'),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('tiktok-ads', 'Tiktok Ads'), ('bing-ads', 'Bing Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('gitlab', 'Gitlab'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel'), ('databricks', 'Databricks')], max_length=20),
        ),
        migrations.AddField(
            model_name='teammarketinganalyticsconfig',
            name='_campaign_field_preferences',
            field=models.JSONField(blank=True, db_column='campaign_field_preferences', default=dict, help_text='Campaign field matching preferences: defines which field (campaign_name or campaign_id) to match utm_campaign against per integration. Manual mappings always take precedence.'),
        ),
        migrations.AddField(
            model_name='teammarketinganalyticsconfig',
            name='_custom_source_mappings',
            field=models.JSONField(blank=True, db_column='custom_source_mappings', default=dict, help_text='Custom UTM source mappings: maps integration types to lists of custom UTM source values'),
        ),
        migrations.RunSQL(
            sql='\n                ALTER TABLE posthog_persondistinctid\n                DROP CONSTRAINT IF EXISTS "posthog_persondistinctid_team_id_46330ec9_fk_posthog_team_id";\n            ',
            reverse_sql='\n                ALTER TABLE posthog_persondistinctid\n                ADD CONSTRAINT "posthog_persondistinctid_team_id_46330ec9_fk_posthog_team_id"\n                FOREIGN KEY (team_id)\n                REFERENCES posthog_team(id)\n                DEFERRABLE INITIALLY DEFERRED;\n            ',
        ),
        migrations.RunSQL(
            sql='\n                ALTER TABLE posthog_personlessdistinctid\n                DROP CONSTRAINT IF EXISTS "posthog_personlessdi_team_id_99211fb1_fk_posthog_t";\n            ',
            reverse_sql='\n                ALTER TABLE posthog_personlessdistinctid\n                ADD CONSTRAINT "posthog_personlessdi_team_id_99211fb1_fk_posthog_t"\n                FOREIGN KEY (team_id)\n                REFERENCES posthog_team(id)\n                DEFERRABLE INITIALLY DEFERRED;\n            ',
        ),
        migrations.RunSQL(
            sql='\n                ALTER TABLE posthog_personoverride\n                DROP CONSTRAINT IF EXISTS "posthog_personoverride_team_id_92291e67_fk_posthog_team_id";\n            ',
            reverse_sql='\n                ALTER TABLE posthog_personoverride\n                ADD CONSTRAINT "posthog_personoverride_team_id_92291e67_fk_posthog_team_id"\n                FOREIGN KEY (team_id)\n                REFERENCES posthog_team(id)\n                DEFERRABLE INITIALLY DEFERRED;\n            ',
        ),
        migrations.RunSQL(
            sql='\n                ALTER TABLE posthog_featureflaghashkeyoverride\n                DROP CONSTRAINT IF EXISTS "posthog_featureflagh_team_id_b626eed2_fk_posthog_t";\n            ',
            reverse_sql='\n                ALTER TABLE posthog_featureflaghashkeyoverride\n                ADD CONSTRAINT "posthog_featureflagh_team_id_b626eed2_fk_posthog_t"\n                FOREIGN KEY (team_id)\n                REFERENCES posthog_team(id)\n                DEFERRABLE INITIALLY DEFERRED;\n            ',
        ),
        migrations.RunSQL(
            sql='\n                ALTER TABLE posthog_grouptypemapping\n                DROP CONSTRAINT IF EXISTS "posthog_grouptypemapping_team_id_5fb54d04_fk_posthog_team_id";\n            ',
            reverse_sql='\n                ALTER TABLE posthog_grouptypemapping\n                ADD CONSTRAINT "posthog_grouptypemapping_team_id_5fb54d04_fk_posthog_team_id"\n                FOREIGN KEY (team_id)\n                REFERENCES posthog_team(id)\n                DEFERRABLE INITIALLY DEFERRED;\n            ',
        ),
        migrations.CreateModel(
            name='QuickFilter',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=200)),
                ('property_name', models.CharField(max_length=500)),
                ('type', models.CharField(choices=[('manual-options', 'manual-options'), ('auto-discovery', 'auto-discovery')], default='manual-options', max_length=50)),
                ('options', models.JSONField(blank=True, default=list, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'db_table': 'posthog_quickfilter',
            },
        ),
        migrations.CreateModel(
            name='QuickFilterContext',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('context', models.CharField(max_length=100)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('quick_filter', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='context_memberships', to='posthog.quickfilter')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'db_table': 'posthog_quickfiltercontext',
                'indexes': [models.Index(fields=['team', 'context'], name='posthog_qui_team_id_3d3d27_idx'), models.Index(fields=['quick_filter', 'context'], name='posthog_qui_quick_f_ff6325_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='quickfiltercontext',
            constraint=models.UniqueConstraint(fields=('team', 'quick_filter', 'context'), name='unique_filter_context'),
        ),
        migrations.AddIndex(
            model_name='quickfilter',
            index=models.Index(fields=['team'], name='posthog_qui_team_id_24fea4_idx'),
        ),
        migrations.AlterField(
            model_name='survey',
            name='questions',
            field=models.JSONField(blank=True, help_text='\n        The `array` of questions included in the survey. Each question must conform to one of the defined question types: Basic, Link, Rating, or Multiple Choice.\n\n        Basic (open-ended question)\n        - `id`: The question ID\n        - `type`: `open`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Link (a question with a link)\n        - `id`: The question ID\n        - `type`: `link`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `link`: The URL associated with the question.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Rating (a question with a rating scale)\n        - `id`: The question ID\n        - `type`: `rating`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `display`: Display style of the rating (`number` or `emoji`).\n        - `scale`: The scale of the rating (`number`).\n        - `lowerBoundLabel`: Label for the lower bound of the scale.\n        - `upperBoundLabel`: Label for the upper bound of the scale.\n        - `isNpsQuestion`: Whether the question is an NPS rating.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Multiple choice\n        - `id`: The question ID\n        - `type`: `single_choice` or `multiple_choice`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `choices`: An array of choices for the question.\n        - `shuffleOptions`: Whether to shuffle the order of the choices (`boolean`).\n        - `hasOpenChoice`: Whether the question allows an open-ended response (`boolean`).\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Branching logic can be one of the following types:\n\n        Next question: Proceeds to the next question\n        ```json\n        {\n            "type": "next_question"\n        }\n        ```\n\n        End: Ends the survey, optionally displaying a confirmation message.\n        ```json\n        {\n            "type": "end"\n        }\n        ```\n\n        Response-based: Branches based on the response values. Available for the `rating` and `single_choice` question types.\n        ```json\n        {\n            "type": "response_based",\n            "responseValues": {\n                "responseKey": "value"\n            }\n        }\n        ```\n\n        Specific question: Proceeds to a specific question by index.\n        ```json\n        {\n            "type": "specific_question",\n            "index": 2\n        }\n        ```\n        ', null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='business_model',
            field=models.CharField(blank=True, choices=[('b2b', 'B2B'), ('b2c', 'B2C'), ('other', 'Other')], help_text='Whether this project serves B2B or B2C customers, used to optimize the UI layout.', max_length=10, null=True),
        ),
        migrations.AddField(
            model_name='featureflag',
            name='bucketing_identifier',
            field=models.CharField(blank=True, choices=[('distinct_id', 'User ID (default)'), ('device_id', 'Device ID')], default='distinct_id', help_text='Identifier used for bucketing users into rollout and variants', max_length=50, null=True),
        ),
        migrations.CreateModel(
            name='ChangeRequest',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('action_key', models.CharField(max_length=128)),
                ('action_version', models.IntegerField(default=1)),
                ('resource_type', models.CharField(max_length=64)),
                ('resource_id', models.CharField(blank=True, max_length=128, null=True)),
                ('intent', models.JSONField()),
                ('intent_display', models.JSONField()),
                ('policy_snapshot', models.JSONField()),
                ('validation_status', models.CharField(choices=[('valid', 'Valid'), ('invalid', 'Invalid'), ('expired', 'Expired'), ('stale', 'Stale (resource changed)')], default='valid', max_length=16)),
                ('validation_errors', models.JSONField(blank=True, null=True)),
                ('validated_at', models.DateTimeField(blank=True, null=True)),
                ('state', models.CharField(choices=[('pending', 'Pending'), ('approved', 'Approved (awaiting application)'), ('applied', 'Applied'), ('rejected', 'Rejected'), ('expired', 'Expired'), ('failed', 'Failed to apply')], default='pending', max_length=16)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('expires_at', models.DateTimeField()),
                ('applied_at', models.DateTimeField(blank=True, null=True)),
                ('apply_error', models.TextField(blank=True)),
                ('result_data', models.JSONField(blank=True, null=True)),
                ('applied_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='change_requests_applied', to=settings.AUTH_USER_MODEL)),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.organization')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ApprovalPolicy',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('action_key', models.CharField(max_length=128)),
                ('conditions', models.JSONField(default=dict)),
                ('approver_config', models.JSONField()),
                ('allow_self_approve', models.BooleanField(default=False)),
                ('bypass_roles', models.JSONField(default=list)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('expires_after', models.DurationField(default=datetime.timedelta(days=14), help_text='Auto-expire change requests after this duration')),
                ('enabled', models.BooleanField(default=True)),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.organization')),
                ('team', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'verbose_name_plural': 'Approval policies',
            },
        ),
        migrations.CreateModel(
            name='Approval',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('decision', models.CharField(choices=[('approved', 'Approved'), ('rejected', 'Rejected')], max_length=16)),
                ('reason', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('change_request', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='approvals', to='posthog.changerequest')),
            ],
        ),
        migrations.AddIndex(
            model_name='changerequest',
            index=models.Index(fields=['team', 'state'], name='posthog_cha_team_id_0a5974_idx'),
        ),
        migrations.AddIndex(
            model_name='changerequest',
            index=models.Index(fields=['action_key', 'state'], name='posthog_cha_action__2d384d_idx'),
        ),
        migrations.AddIndex(
            model_name='changerequest',
            index=models.Index(fields=['expires_at'], name='posthog_cha_expires_0a6444_idx'),
        ),
        migrations.AddIndex(
            model_name='changerequest',
            index=models.Index(fields=['validation_status', 'state'], name='posthog_cha_validat_24672f_idx'),
        ),
        migrations.AddIndex(
            model_name='approvalpolicy',
            index=models.Index(fields=['action_key', 'enabled'], name='posthog_app_action__871059_idx'),
        ),
        migrations.AddIndex(
            model_name='approvalpolicy',
            index=models.Index(fields=['organization', 'enabled'], name='posthog_app_organiz_36e124_idx'),
        ),
        migrations.AddIndex(
            model_name='approvalpolicy',
            index=models.Index(fields=['team', 'enabled'], name='posthog_app_team_id_9f077f_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='approvalpolicy',
            unique_together={('organization', 'team', 'action_key')},
        ),
        migrations.AddIndex(
            model_name='approval',
            index=models.Index(fields=['change_request', 'decision'], name='posthog_app_change__5af5e4_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='approval',
            unique_together={('change_request', 'created_by')},
        ),
        migrations.AddField(
            model_name='team',
            name='require_evaluation_environment_tags',
            field=models.BooleanField(blank=True, default=False, help_text='Whether to require at least one evaluation environment tag when creating new feature flags', null=True),
        ),
        migrations.RunPython(
            code=django.db.migrations.operations.special.RunPython.noop,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.AddField(
            model_name='user',
            name='shortcut_position',
            field=models.CharField(blank=True, choices=[('above', 'Above'), ('below', 'Below'), ('hidden', 'Hidden')], default='above', max_length=20, null=True),
        ),
        migrations.CreateModel(
            name='MaterializedColumnSlot',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='materialized_column_slots', related_query_name='materialized_column_slot', to='posthog.team')),
                ('property_definition', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='materialized_column_slots', related_query_name='materialized_column_slot', to='posthog.propertydefinition')),
                ('property_type', models.CharField(choices=[('DateTime', 'DateTime'), ('String', 'String'), ('Numeric', 'Numeric'), ('Boolean', 'Boolean'), ('Duration', 'Duration')], max_length=50)),
                ('slot_index', models.PositiveSmallIntegerField()),
                ('state', models.CharField(choices=[('BACKFILL', 'Backfill'), ('READY', 'Ready'), ('ERROR', 'Error')], default='BACKFILL', max_length=20)),
                ('backfill_temporal_workflow_id', models.CharField(blank=True, max_length=400, null=True)),
                ('error_message', models.TextField(blank=True, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddConstraint(
            model_name='materializedcolumnslot',
            constraint=models.UniqueConstraint(fields=('team', 'property_definition'), name='unique_team_property_definition'),
        ),
        migrations.AddConstraint(
            model_name='materializedcolumnslot',
            constraint=models.UniqueConstraint(fields=('team', 'property_type', 'slot_index'), name='unique_team_property_type_slot_index'),
        ),
        migrations.AddConstraint(
            model_name='materializedcolumnslot',
            constraint=models.CheckConstraint(check=models.Q(('slot_index__gte', 0), ('slot_index__lte', 9)), name='valid_slot_index'),
        ),
        migrations.AddIndex(
            model_name='materializedcolumnslot',
            index=models.Index(fields=['team', 'state'], name='posthog_mat_team_st_idx'),
        ),
        migrations.AddIndex(
            model_name='materializedcolumnslot',
            index=models.Index(fields=['team', 'property_definition'], name='posthog_mat_team_pr_idx'),
        ),
        migrations.AddIndex(
            model_name='materializedcolumnslot',
            index=models.Index(fields=['team', 'property_type', 'slot_index'], name='posthog_mat_team_ty_idx'),
        ),
        migrations.AddIndex(
            model_name='materializedcolumnslot',
            index=models.Index(fields=['backfill_temporal_workflow_id'], name='posthog_mat_backfi_idx'),
        ),
        migrations.AddField(
            model_name='eventingestionrestrictionconfig',
            name='session_ids',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=450), blank=True, default=list, null=True, size=None),
        ),
        migrations.AddField(
            model_name='eventingestionrestrictionconfig',
            name='event_names',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=450), blank=True, default=list, null=True, size=None),
        ),
        migrations.AddField(
            model_name='eventingestionrestrictionconfig',
            name='event_uuids',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=450), blank=True, default=list, null=True, size=None),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name='cohortcalculationhistory',
            index=models.Index(fields=['cohort', '-started_at'], name='posthog_coh_cohort__cbac1b_idx'),
        ),
        migrations.AddField(
            model_name='cohortcalculationhistory',
            name='error_code',
            field=models.CharField(blank=True, help_text="Error code for categorizing failures (e.g., 'timeout', 'memory_limit'), used for displaying errors to end-users", max_length=64, null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='headline_response_count',
            field=models.PositiveIntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='headline_summary',
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='eventingestionrestrictionconfig',
            name='restriction_type',
            field=models.CharField(choices=[('skip_person_processing', 'Skip Person Processing'), ('drop_event_from_ingestion', 'Drop Event From Ingestion'), ('force_overflow_from_ingestion', 'Force Overflow From Ingestion'), ('redirect_to_dlq', 'Redirect To Dlq')], max_length=100),
        ),
        migrations.AddField(
            model_name='team',
            name='product_tours_opt_in',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='user',
            name='allow_impersonation',
            field=models.BooleanField(blank=True, default=True, null=True),
        ),
        migrations.CreateModel(
            name='ExportedRecording',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('session_id', models.CharField(max_length=200)),
                ('reason', models.TextField()),
                ('export_location', models.CharField(blank=True, max_length=1000, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('running', 'Running'), ('complete', 'Complete'), ('failed', 'Failed')], default='pending', max_length=20)),
                ('error_message', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='exported_recordings', to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='exported_recordings', to='posthog.team')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LLMPrompt',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255)),
                ('prompt', models.JSONField()),
                ('version', models.PositiveIntegerField(default=1)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('deleted', models.BooleanField(default=False)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddConstraint(
            model_name='llmprompt',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted', False)), fields=('team', 'name'), name='unique_llm_prompt_name_per_team'),
        ),
        migrations.AddField(
            model_name='organization',
            name='is_active',
            field=models.BooleanField(blank=True, default=True, help_text="Set this to 'No' to temporarily disable an organization.", null=True, verbose_name='active'),
        ),
        migrations.AddField(
            model_name='organization',
            name='is_not_active_reason',
            field=models.TextField(blank=True, help_text='(optional) reason for why the organization has been de-activated. This will be displayed to users on the web app.', max_length=200, null=True, verbose_name='de-activated reason'),
        ),
        migrations.AddField(
            model_name='scheduledchange',
            name='end_date',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='scheduledchange',
            name='is_recurring',
            field=models.BooleanField(default=False),
        ),
        migrations.AddField(
            model_name='scheduledchange',
            name='last_executed_at',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='scheduledchange',
            name='recurrence_interval',
            field=models.CharField(blank=True, choices=[('daily', 'daily'), ('weekly', 'weekly'), ('monthly', 'monthly')], max_length=20, null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_insightviewed'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0946_fix_insightviewed_null_duplicates op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0946_fix_insightviewed_null_duplicates op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql='\n                CREATE UNIQUE INDEX CONCURRENTLY IF NOT EXISTS "posthog_insightviewed_null_team_user_unique"\n                ON "posthog_insightviewed" ("insight_id")\n                WHERE "team_id" IS NULL AND "user_id" IS NULL\n            ',
            reverse_sql='DROP INDEX CONCURRENTLY IF EXISTS "posthog_insightviewed_null_team_user_unique"',
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                        ALTER TABLE "posthog_hogfunction" ADD COLUMN "batch_export_id" uuid NULL CONSTRAINT "posthog_hogfunction_batch_export_id_d64c3403_fk_posthog_b" REFERENCES "posthog_batchexport"("id") DEFERRABLE INITIALLY DEFERRED; -- existing-table-constraint-ignore\n                        SET CONSTRAINTS "posthog_hogfunction_batch_export_id_d64c3403_fk_posthog_b" IMMEDIATE; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_hogfunction" DROP COLUMN IF EXISTS "batch_export_id";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='hogfunction',
                    name='batch_export',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.batchexport'),
                ),
                migrations.AlterField(
                    model_name='batchexportdestination',
                    name='type',
                    field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres'), ('Redshift', 'Redshift'), ('BigQuery', 'Bigquery'), ('Databricks', 'Databricks'), ('Workflows', 'Workflows'), ('HTTP', 'Http'), ('NoOp', 'Noop')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
                ),
            ],
        ),
        migrations.RunSQL(
            sql='\n            CREATE INDEX CONCURRENTLY IF NOT EXISTS "posthog_hogfunction_batch_export_id_d64c3403" ON "posthog_hogfunction" ("batch_export_id");\n            ',
            reverse_sql='\n                DROP INDEX CONCURRENTLY IF EXISTS "posthog_hogfunction_batch_export_id_d64c3403";\n            ',
        ),
        migrations.AddField(
            model_name='exportedasset',
            name='exception_type',
            field=models.CharField(blank=True, max_length=255, null=True),
        ),
        migrations.CreateModel(
            name='HogFlowTemplate',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=400)),
                ('description', models.TextField(blank=True, default='')),
                ('image_url', models.CharField(blank=True, max_length=8201, null=True)),
                ('scope', models.CharField(choices=[('team', 'Only team'), ('global', 'Global')], max_length=24)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('trigger', models.JSONField(default=dict)),
                ('trigger_masking', models.JSONField(blank=True, null=True)),
                ('conversion', models.JSONField(blank=True, null=True)),
                ('exit_condition', models.CharField(choices=[('exit_on_conversion', 'Conversion'), ('exit_on_trigger_not_matched', 'Trigger Not Matched'), ('exit_on_trigger_not_matched_or_conversion', 'Trigger Not Matched Or Conversion'), ('exit_only_at_end', 'Only At End')], default='exit_on_conversion', max_length=100)),
                ('edges', models.JSONField(default=dict)),
                ('actions', models.JSONField(default=dict)),
                ('abort_action', models.CharField(blank=True, max_length=400, null=True)),
                ('variables', models.JSONField(blank=True, default=list, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'db_table': 'hogflow_templates',
                'indexes': [models.Index(fields=['team'], name='hogflow_tem_team_id_cb8b2b_idx')],
            },
        ),
        migrations.AddField(
            model_name='hogflow',
            name='billable_action_types',
            field=models.JSONField(blank=True, default=list, null=True),
        ),
        migrations.AddField(
            model_name='experiment',
            name='scheduling_config',
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AlterField(
            model_name='organization',
            name='is_ai_data_processing_approved',
            field=models.BooleanField(blank=True, default=True, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='conversations_enabled',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='conversations_settings',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name='CoreEvent',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(help_text='Display name for this core event', max_length=255)),
                ('description', models.TextField(blank=True, default='', help_text='Optional description')),
                ('category', models.CharField(choices=[('acquisition', 'Acquisition'), ('activation', 'Activation'), ('monetization', 'Monetization'), ('expansion', 'Expansion'), ('referral', 'Referral'), ('retention', 'Retention'), ('churn', 'Churn'), ('reactivation', 'Reactivation')], help_text='Lifecycle category for this core event', max_length=20)),
                ('filter', models.JSONField(help_text='Filter configuration - event, action, or data warehouse node')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='core_events', to='posthog.team')),
            ],
            options={
                'verbose_name': 'Core Event',
                'verbose_name_plural': 'Core Events',
                'ordering': ['created_at'],
            },
        ),
        migrations.AddField(
            model_name='survey',
            name='question_summaries',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.RemoveConstraint(
            model_name='dashboardtemplate',
            name='unique_template_name_per_team',
        ),
        migrations.AddConstraint(
            model_name='dashboardtemplate',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted__isnull', True), ('deleted', False), _connector='OR'), fields=('template_name', 'team'), name='unique_template_name_per_team'),
        ),
        migrations.CreateModel(
            name='SessionRecordingExternalReference',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('external_context', models.JSONField(blank=True, null=True)),
                ('integration', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='external_references', to='posthog.integration')),
                ('session_recording', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='external_references', related_query_name='external_reference', to='posthog.sessionrecording')),
            ],
            options={
                'db_table': 'posthog_sessionrecordingexternalreference',
            },
        ),
        migrations.CreateModel(
            name='WebAnalyticsFilterPreset',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('short_id', models.CharField(blank=True, default=posthog.utils.generate_short_id, max_length=12)),
                ('name', models.CharField(max_length=400)),
                ('description', models.TextField(blank=True)),
                ('pinned', models.BooleanField(default=False)),
                ('deleted', models.BooleanField(default=False)),
                ('filters', models.JSONField(default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_modified_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('last_modified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='modified_web_analytics_filter_presets', to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'indexes': [models.Index(fields=['deleted', '-last_modified_at'], name='wa_preset_del_mod_idx')],
                'unique_together': {('team', 'short_id')},
            },
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres'), ('Redshift', 'Redshift'), ('BigQuery', 'Bigquery'), ('Databricks', 'Databricks'), ('AzureBlob', 'Azure Blob'), ('Workflows', 'Workflows'), ('HTTP', 'Http'), ('NoOp', 'Noop')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('tiktok-ads', 'Tiktok Ads'), ('bing-ads', 'Bing Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('gitlab', 'Gitlab'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel'), ('databricks', 'Databricks'), ('azure-blob', 'Azure Blob')], max_length=20),
        ),
        migrations.CreateModel(
            name='WebauthnCredential',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('credential_id', models.BinaryField(help_text="ID generated by the user's authenticator during credential creation. Stored as bytes.")),
                ('label', models.CharField(help_text='The user-facing label assigned to this credential.', max_length=200)),
                ('public_key', models.BinaryField(help_text="The public key used to verify attestations from the user's authenticator. Stored as bytes.")),
                ('algorithm', models.IntegerField(help_text='The COSE algorithm identifier used for public-key verification (e.g., -7 for ES256, -257 for RS256).')),
                ('counter', models.IntegerField(default=0, help_text='Tracks the counter of the credential. Traditionally used to detect cloned authenticators, however for our use case we expect to see some inconsistencies here because of the behavior of different passkey managers.')),
                ('transports', models.JSONField(default=list, help_text="The transport methods that the authenticator uses to communicate with the browser (e.g., ['internal', 'hybrid']).")),
                ('verified', models.BooleanField(default=False, help_text='Whether the credential has been verified by the user after registration. Only verified credentials can be used for login.')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='webauthn_credentials', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'unique_together': {('user', 'credential_id')},
            },
        ),
        migrations.AddField(
            model_name='oauthapplication',
            name='dcr_client_id_issued_at',
            field=models.DateTimeField(blank=True, help_text='When the client_id was issued (for DCR clients)', null=True),
        ),
        migrations.AddField(
            model_name='oauthapplication',
            name='is_dcr_client',
            field=models.BooleanField(default=False, help_text='True if this client was registered via Dynamic Client Registration'),
        ),
        migrations.AddField(
            model_name='oauthapplication',
            name='is_verified',
            field=models.BooleanField(default=False, help_text='True if this application has been verified by PostHog'),
        ),
        migrations.AddField(
            model_name='team',
            name='session_recording_encryption',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.AddField(
            model_name='exportedasset',
            name='failure_type',
            field=models.CharField(blank=True, max_length=255, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='logs_settings',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.AlterField(
                    model_name='integration',
                    name='kind',
                    field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('tiktok-ads', 'Tiktok Ads'), ('bing-ads', 'Bing Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('gitlab', 'Gitlab'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel'), ('databricks', 'Databricks'), ('azure-blob', 'Azure Blob'), ('firebase', 'Firebase')], max_length=20),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='scheduledchange',
            name='recurrence_interval',
            field=models.CharField(blank=True, choices=[('daily', 'daily'), ('weekly', 'weekly'), ('monthly', 'monthly'), ('yearly', 'yearly')], max_length=20, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='default_evaluation_contexts_enabled',
            field=models.BooleanField(blank=True, default=False, help_text='Whether to automatically apply default evaluation contexts to new feature flags', null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='require_evaluation_contexts',
            field=models.BooleanField(blank=True, default=False, help_text='Whether to require at least one evaluation context tag when creating new feature flags', null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_team'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0976_copy_evaluation_contexts_data op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0976_copy_evaluation_contexts_data op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='team',
            name='default_evaluation_environments_enabled',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.AlterField(
            model_name='team',
            name='require_evaluation_environment_tags',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.AlterField(
            model_name='teamdefaultevaluationtag',
            name='team',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='default_evaluation_contexts', to='posthog.team'),
        ),
        migrations.AddField(
            model_name='user',
            name='passkeys_enabled_for_2fa',
            field=models.BooleanField(blank=True, default=False, help_text='Whether passkeys are enabled for 2FA authentication. Users can disable this to use only TOTP for 2FA while keeping passkeys for login.', null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='enable_iframe_embedding',
            field=models.BooleanField(default=False),
        ),
        migrations.AddField(
            model_name='team',
            name='default_experiment_confidence_level',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='Default confidence level for new experiments in this environment. Valid values: 0.90, 0.95, 0.99.', max_digits=3, null=True),
        ),
        migrations.AddField(
            model_name='batchexport',
            name='interval_offset',
            field=models.IntegerField(blank=True, help_text='The offset in seconds from the start of the default interval that this batch export should run at.', null=True),
        ),
        migrations.AddField(
            model_name='batchexport',
            name='timezone',
            field=models.CharField(choices=[('Africa/Abidjan', 'Africa/Abidjan'), ('Africa/Accra', 'Africa/Accra'), ('Africa/Addis_Ababa', 'Africa/Addis_Ababa'), ('Africa/Algiers', 'Africa/Algiers'), ('Africa/Asmara', 'Africa/Asmara'), ('Africa/Asmera', 'Africa/Asmera'), ('Africa/Bamako', 'Africa/Bamako'), ('Africa/Bangui', 'Africa/Bangui'), ('Africa/Banjul', 'Africa/Banjul'), ('Africa/Bissau', 'Africa/Bissau'), ('Africa/Blantyre', 'Africa/Blantyre'), ('Africa/Brazzaville', 'Africa/Brazzaville'), ('Africa/Bujumbura', 'Africa/Bujumbura'), ('Africa/Cairo', 'Africa/Cairo'), ('Africa/Casablanca', 'Africa/Casablanca'), ('Africa/Ceuta', 'Africa/Ceuta'), ('Africa/Conakry', 'Africa/Conakry'), ('Africa/Dakar', 'Africa/Dakar'), ('Africa/Dar_es_Salaam', 'Africa/Dar_es_Salaam'), ('Africa/Djibouti', 'Africa/Djibouti'), ('Africa/Douala', 'Africa/Douala'), ('Africa/El_Aaiun', 'Africa/El_Aaiun'), ('Africa/Freetown', 'Africa/Freetown'), ('Africa/Gaborone', 'Africa/Gaborone'), ('Africa/Harare', 'Africa/Harare'), ('Africa/Johannesburg', 'Africa/Johannesburg'), ('Africa/Juba', 'Africa/Juba'), ('Africa/Kampala', 'Africa/Kampala'), ('Africa/Khartoum', 'Africa/Khartoum'), ('Africa/Kigali', 'Africa/Kigali'), ('Africa/Kinshasa', 'Africa/Kinshasa'), ('Africa/Lagos', 'Africa/Lagos'), ('Africa/Libreville', 'Africa/Libreville'), ('Africa/Lome', 'Africa/Lome'), ('Africa/Luanda', 'Africa/Luanda'), ('Africa/Lubumbashi', 'Africa/Lubumbashi'), ('Africa/Lusaka', 'Africa/Lusaka'), ('Africa/Malabo', 'Africa/Malabo'), ('Africa/Maputo', 'Africa/Maputo'), ('Africa/Maseru', 'Africa/Maseru'), ('Africa/Mbabane', 'Africa/Mbabane'), ('Africa/Mogadishu', 'Africa/Mogadishu'), ('Africa/Monrovia', 'Africa/Monrovia'), ('Africa/Nairobi', 'Africa/Nairobi'), ('Africa/Ndjamena', 'Africa/Ndjamena'), ('Africa/Niamey', 'Africa/Niamey'), ('Africa/Nouakchott', 'Africa/Nouakchott'), ('Africa/Ouagadougou', 'Africa/Ouagadougou'), ('Africa/Porto-Novo', 'Africa/Porto-Novo'), ('Africa/Sao_Tome', 'Africa/Sao_Tome'), ('Africa/Timbuktu', 'Africa/Timbuktu'), ('Africa/Tripoli', 'Africa/Tripoli'), ('Africa/Tunis', 'Africa/Tunis'), ('Africa/Windhoek', 'Africa/Windhoek'), ('America/Adak', 'America/Adak'), ('America/Anchorage', 'America/Anchorage'), ('America/Anguilla', 'America/Anguilla'), ('America/Antigua', 'America/Antigua'), ('America/Araguaina', 'America/Araguaina'), ('America/Argentina/Buenos_Aires', 'America/Argentina/Buenos_Aires'), ('America/Argentina/Catamarca', 'America/Argentina/Catamarca'), ('America/Argentina/ComodRivadavia', 'America/Argentina/ComodRivadavia'), ('America/Argentina/Cordoba', 'America/Argentina/Cordoba'), ('America/Argentina/Jujuy', 'America/Argentina/Jujuy'), ('America/Argentina/La_Rioja', 'America/Argentina/La_Rioja'), ('America/Argentina/Mendoza', 'America/Argentina/Mendoza'), ('America/Argentina/Rio_Gallegos', 'America/Argentina/Rio_Gallegos'), ('America/Argentina/Salta', 'America/Argentina/Salta'), ('America/Argentina/San_Juan', 'America/Argentina/San_Juan'), ('America/Argentina/San_Luis', 'America/Argentina/San_Luis'), ('America/Argentina/Tucuman', 'America/Argentina/Tucuman'), ('America/Argentina/Ushuaia', 'America/Argentina/Ushuaia'), ('America/Aruba', 'America/Aruba'), ('America/Asuncion', 'America/Asuncion'), ('America/Atikokan', 'America/Atikokan'), ('America/Atka', 'America/Atka'), ('America/Bahia', 'America/Bahia'), ('America/Bahia_Banderas', 'America/Bahia_Banderas'), ('America/Barbados', 'America/Barbados'), ('America/Belem', 'America/Belem'), ('America/Belize', 'America/Belize'), ('America/Blanc-Sablon', 'America/Blanc-Sablon'), ('America/Boa_Vista', 'America/Boa_Vista'), ('America/Bogota', 'America/Bogota'), ('America/Boise', 'America/Boise'), ('America/Buenos_Aires', 'America/Buenos_Aires'), ('America/Cambridge_Bay', 'America/Cambridge_Bay'), ('America/Campo_Grande', 'America/Campo_Grande'), ('America/Cancun', 'America/Cancun'), ('America/Caracas', 'America/Caracas'), ('America/Catamarca', 'America/Catamarca'), ('America/Cayenne', 'America/Cayenne'), ('America/Cayman', 'America/Cayman'), ('America/Chicago', 'America/Chicago'), ('America/Chihuahua', 'America/Chihuahua'), ('America/Ciudad_Juarez', 'America/Ciudad_Juarez'), ('America/Coral_Harbour', 'America/Coral_Harbour'), ('America/Cordoba', 'America/Cordoba'), ('America/Costa_Rica', 'America/Costa_Rica'), ('America/Creston', 'America/Creston'), ('America/Cuiaba', 'America/Cuiaba'), ('America/Curacao', 'America/Curacao'), ('America/Danmarkshavn', 'America/Danmarkshavn'), ('America/Dawson', 'America/Dawson'), ('America/Dawson_Creek', 'America/Dawson_Creek'), ('America/Denver', 'America/Denver'), ('America/Detroit', 'America/Detroit'), ('America/Dominica', 'America/Dominica'), ('America/Edmonton', 'America/Edmonton'), ('America/Eirunepe', 'America/Eirunepe'), ('America/El_Salvador', 'America/El_Salvador'), ('America/Ensenada', 'America/Ensenada'), ('America/Fort_Nelson', 'America/Fort_Nelson'), ('America/Fort_Wayne', 'America/Fort_Wayne'), ('America/Fortaleza', 'America/Fortaleza'), ('America/Glace_Bay', 'America/Glace_Bay'), ('America/Godthab', 'America/Godthab'), ('America/Goose_Bay', 'America/Goose_Bay'), ('America/Grand_Turk', 'America/Grand_Turk'), ('America/Grenada', 'America/Grenada'), ('America/Guadeloupe', 'America/Guadeloupe'), ('America/Guatemala', 'America/Guatemala'), ('America/Guayaquil', 'America/Guayaquil'), ('America/Guyana', 'America/Guyana'), ('America/Halifax', 'America/Halifax'), ('America/Havana', 'America/Havana'), ('America/Hermosillo', 'America/Hermosillo'), ('America/Indiana/Indianapolis', 'America/Indiana/Indianapolis'), ('America/Indiana/Knox', 'America/Indiana/Knox'), ('America/Indiana/Marengo', 'America/Indiana/Marengo'), ('America/Indiana/Petersburg', 'America/Indiana/Petersburg'), ('America/Indiana/Tell_City', 'America/Indiana/Tell_City'), ('America/Indiana/Vevay', 'America/Indiana/Vevay'), ('America/Indiana/Vincennes', 'America/Indiana/Vincennes'), ('America/Indiana/Winamac', 'America/Indiana/Winamac'), ('America/Indianapolis', 'America/Indianapolis'), ('America/Inuvik', 'America/Inuvik'), ('America/Iqaluit', 'America/Iqaluit'), ('America/Jamaica', 'America/Jamaica'), ('America/Jujuy', 'America/Jujuy'), ('America/Juneau', 'America/Juneau'), ('America/Kentucky/Louisville', 'America/Kentucky/Louisville'), ('America/Kentucky/Monticello', 'America/Kentucky/Monticello'), ('America/Knox_IN', 'America/Knox_IN'), ('America/Kralendijk', 'America/Kralendijk'), ('America/La_Paz', 'America/La_Paz'), ('America/Lima', 'America/Lima'), ('America/Los_Angeles', 'America/Los_Angeles'), ('America/Louisville', 'America/Louisville'), ('America/Lower_Princes', 'America/Lower_Princes'), ('America/Maceio', 'America/Maceio'), ('America/Managua', 'America/Managua'), ('America/Manaus', 'America/Manaus'), ('America/Marigot', 'America/Marigot'), ('America/Martinique', 'America/Martinique'), ('America/Matamoros', 'America/Matamoros'), ('America/Mazatlan', 'America/Mazatlan'), ('America/Mendoza', 'America/Mendoza'), ('America/Menominee', 'America/Menominee'), ('America/Merida', 'America/Merida'), ('America/Metlakatla', 'America/Metlakatla'), ('America/Mexico_City', 'America/Mexico_City'), ('America/Miquelon', 'America/Miquelon'), ('America/Moncton', 'America/Moncton'), ('America/Monterrey', 'America/Monterrey'), ('America/Montevideo', 'America/Montevideo'), ('America/Montreal', 'America/Montreal'), ('America/Montserrat', 'America/Montserrat'), ('America/Nassau', 'America/Nassau'), ('America/New_York', 'America/New_York'), ('America/Nipigon', 'America/Nipigon'), ('America/Nome', 'America/Nome'), ('America/Noronha', 'America/Noronha'), ('America/North_Dakota/Beulah', 'America/North_Dakota/Beulah'), ('America/North_Dakota/Center', 'America/North_Dakota/Center'), ('America/North_Dakota/New_Salem', 'America/North_Dakota/New_Salem'), ('America/Nuuk', 'America/Nuuk'), ('America/Ojinaga', 'America/Ojinaga'), ('America/Panama', 'America/Panama'), ('America/Pangnirtung', 'America/Pangnirtung'), ('America/Paramaribo', 'America/Paramaribo'), ('America/Phoenix', 'America/Phoenix'), ('America/Port-au-Prince', 'America/Port-au-Prince'), ('America/Port_of_Spain', 'America/Port_of_Spain'), ('America/Porto_Acre', 'America/Porto_Acre'), ('America/Porto_Velho', 'America/Porto_Velho'), ('America/Puerto_Rico', 'America/Puerto_Rico'), ('America/Punta_Arenas', 'America/Punta_Arenas'), ('America/Rainy_River', 'America/Rainy_River'), ('America/Rankin_Inlet', 'America/Rankin_Inlet'), ('America/Recife', 'America/Recife'), ('America/Regina', 'America/Regina'), ('America/Resolute', 'America/Resolute'), ('America/Rio_Branco', 'America/Rio_Branco'), ('America/Rosario', 'America/Rosario'), ('America/Santa_Isabel', 'America/Santa_Isabel'), ('America/Santarem', 'America/Santarem'), ('America/Santiago', 'America/Santiago'), ('America/Santo_Domingo', 'America/Santo_Domingo'), ('America/Sao_Paulo', 'America/Sao_Paulo'), ('America/Scoresbysund', 'America/Scoresbysund'), ('America/Shiprock', 'America/Shiprock'), ('America/Sitka', 'America/Sitka'), ('America/St_Barthelemy', 'America/St_Barthelemy'), ('America/St_Johns', 'America/St_Johns'), ('America/St_Kitts', 'America/St_Kitts'), ('America/St_Lucia', 'America/St_Lucia'), ('America/St_Thomas', 'America/St_Thomas'), ('America/St_Vincent', 'America/St_Vincent'), ('America/Swift_Current', 'America/Swift_Current'), ('America/Tegucigalpa', 'America/Tegucigalpa'), ('America/Thule', 'America/Thule'), ('America/Thunder_Bay', 'America/Thunder_Bay'), ('America/Tijuana', 'America/Tijuana'), ('America/Toronto', 'America/Toronto'), ('America/Tortola', 'America/Tortola'), ('America/Vancouver', 'America/Vancouver'), ('America/Virgin', 'America/Virgin'), ('America/Whitehorse', 'America/Whitehorse'), ('America/Winnipeg', 'America/Winnipeg'), ('America/Yakutat', 'America/Yakutat'), ('America/Yellowknife', 'America/Yellowknife'), ('Antarctica/Casey', 'Antarctica/Casey'), ('Antarctica/Davis', 'Antarctica/Davis'), ('Antarctica/DumontDUrville', 'Antarctica/DumontDUrville'), ('Antarctica/Macquarie', 'Antarctica/Macquarie'), ('Antarctica/Mawson', 'Antarctica/Mawson'), ('Antarctica/McMurdo', 'Antarctica/McMurdo'), ('Antarctica/Palmer', 'Antarctica/Palmer'), ('Antarctica/Rothera', 'Antarctica/Rothera'), ('Antarctica/South_Pole', 'Antarctica/South_Pole'), ('Antarctica/Syowa', 'Antarctica/Syowa'), ('Antarctica/Troll', 'Antarctica/Troll'), ('Antarctica/Vostok', 'Antarctica/Vostok'), ('Arctic/Longyearbyen', 'Arctic/Longyearbyen'), ('Asia/Aden', 'Asia/Aden'), ('Asia/Almaty', 'Asia/Almaty'), ('Asia/Amman', 'Asia/Amman'), ('Asia/Anadyr', 'Asia/Anadyr'), ('Asia/Aqtau', 'Asia/Aqtau'), ('Asia/Aqtobe', 'Asia/Aqtobe'), ('Asia/Ashgabat', 'Asia/Ashgabat'), ('Asia/Ashkhabad', 'Asia/Ashkhabad'), ('Asia/Atyrau', 'Asia/Atyrau'), ('Asia/Baghdad', 'Asia/Baghdad'), ('Asia/Bahrain', 'Asia/Bahrain'), ('Asia/Baku', 'Asia/Baku'), ('Asia/Bangkok', 'Asia/Bangkok'), ('Asia/Barnaul', 'Asia/Barnaul'), ('Asia/Beirut', 'Asia/Beirut'), ('Asia/Bishkek', 'Asia/Bishkek'), ('Asia/Brunei', 'Asia/Brunei'), ('Asia/Calcutta', 'Asia/Calcutta'), ('Asia/Chita', 'Asia/Chita'), ('Asia/Choibalsan', 'Asia/Choibalsan'), ('Asia/Chongqing', 'Asia/Chongqing'), ('Asia/Chungking', 'Asia/Chungking'), ('Asia/Colombo', 'Asia/Colombo'), ('Asia/Dacca', 'Asia/Dacca'), ('Asia/Damascus', 'Asia/Damascus'), ('Asia/Dhaka', 'Asia/Dhaka'), ('Asia/Dili', 'Asia/Dili'), ('Asia/Dubai', 'Asia/Dubai'), ('Asia/Dushanbe', 'Asia/Dushanbe'), ('Asia/Famagusta', 'Asia/Famagusta'), ('Asia/Gaza', 'Asia/Gaza'), ('Asia/Harbin', 'Asia/Harbin'), ('Asia/Hebron', 'Asia/Hebron'), ('Asia/Ho_Chi_Minh', 'Asia/Ho_Chi_Minh'), ('Asia/Hong_Kong', 'Asia/Hong_Kong'), ('Asia/Hovd', 'Asia/Hovd'), ('Asia/Irkutsk', 'Asia/Irkutsk'), ('Asia/Istanbul', 'Asia/Istanbul'), ('Asia/Jakarta', 'Asia/Jakarta'), ('Asia/Jayapura', 'Asia/Jayapura'), ('Asia/Jerusalem', 'Asia/Jerusalem'), ('Asia/Kabul', 'Asia/Kabul'), ('Asia/Kamchatka', 'Asia/Kamchatka'), ('Asia/Karachi', 'Asia/Karachi'), ('Asia/Kashgar', 'Asia/Kashgar'), ('Asia/Kathmandu', 'Asia/Kathmandu'), ('Asia/Katmandu', 'Asia/Katmandu'), ('Asia/Khandyga', 'Asia/Khandyga'), ('Asia/Kolkata', 'Asia/Kolkata'), ('Asia/Krasnoyarsk', 'Asia/Krasnoyarsk'), ('Asia/Kuala_Lumpur', 'Asia/Kuala_Lumpur'), ('Asia/Kuching', 'Asia/Kuching'), ('Asia/Kuwait', 'Asia/Kuwait'), ('Asia/Macao', 'Asia/Macao'), ('Asia/Macau', 'Asia/Macau'), ('Asia/Magadan', 'Asia/Magadan'), ('Asia/Makassar', 'Asia/Makassar'), ('Asia/Manila', 'Asia/Manila'), ('Asia/Muscat', 'Asia/Muscat'), ('Asia/Nicosia', 'Asia/Nicosia'), ('Asia/Novokuznetsk', 'Asia/Novokuznetsk'), ('Asia/Novosibirsk', 'Asia/Novosibirsk'), ('Asia/Omsk', 'Asia/Omsk'), ('Asia/Oral', 'Asia/Oral'), ('Asia/Phnom_Penh', 'Asia/Phnom_Penh'), ('Asia/Pontianak', 'Asia/Pontianak'), ('Asia/Pyongyang', 'Asia/Pyongyang'), ('Asia/Qatar', 'Asia/Qatar'), ('Asia/Qostanay', 'Asia/Qostanay'), ('Asia/Qyzylorda', 'Asia/Qyzylorda'), ('Asia/Rangoon', 'Asia/Rangoon'), ('Asia/Riyadh', 'Asia/Riyadh'), ('Asia/Saigon', 'Asia/Saigon'), ('Asia/Sakhalin', 'Asia/Sakhalin'), ('Asia/Samarkand', 'Asia/Samarkand'), ('Asia/Seoul', 'Asia/Seoul'), ('Asia/Shanghai', 'Asia/Shanghai'), ('Asia/Singapore', 'Asia/Singapore'), ('Asia/Srednekolymsk', 'Asia/Srednekolymsk'), ('Asia/Taipei', 'Asia/Taipei'), ('Asia/Tashkent', 'Asia/Tashkent'), ('Asia/Tbilisi', 'Asia/Tbilisi'), ('Asia/Tehran', 'Asia/Tehran'), ('Asia/Tel_Aviv', 'Asia/Tel_Aviv'), ('Asia/Thimbu', 'Asia/Thimbu'), ('Asia/Thimphu', 'Asia/Thimphu'), ('Asia/Tokyo', 'Asia/Tokyo'), ('Asia/Tomsk', 'Asia/Tomsk'), ('Asia/Ujung_Pandang', 'Asia/Ujung_Pandang'), ('Asia/Ulaanbaatar', 'Asia/Ulaanbaatar'), ('Asia/Ulan_Bator', 'Asia/Ulan_Bator'), ('Asia/Urumqi', 'Asia/Urumqi'), ('Asia/Ust-Nera', 'Asia/Ust-Nera'), ('Asia/Vientiane', 'Asia/Vientiane'), ('Asia/Vladivostok', 'Asia/Vladivostok'), ('Asia/Yakutsk', 'Asia/Yakutsk'), ('Asia/Yangon', 'Asia/Yangon'), ('Asia/Yekaterinburg', 'Asia/Yekaterinburg'), ('Asia/Yerevan', 'Asia/Yerevan'), ('Atlantic/Azores', 'Atlantic/Azores'), ('Atlantic/Bermuda', 'Atlantic/Bermuda'), ('Atlantic/Canary', 'Atlantic/Canary'), ('Atlantic/Cape_Verde', 'Atlantic/Cape_Verde'), ('Atlantic/Faeroe', 'Atlantic/Faeroe'), ('Atlantic/Faroe', 'Atlantic/Faroe'), ('Atlantic/Jan_Mayen', 'Atlantic/Jan_Mayen'), ('Atlantic/Madeira', 'Atlantic/Madeira'), ('Atlantic/Reykjavik', 'Atlantic/Reykjavik'), ('Atlantic/South_Georgia', 'Atlantic/South_Georgia'), ('Atlantic/St_Helena', 'Atlantic/St_Helena'), ('Atlantic/Stanley', 'Atlantic/Stanley'), ('Australia/ACT', 'Australia/ACT'), ('Australia/Adelaide', 'Australia/Adelaide'), ('Australia/Brisbane', 'Australia/Brisbane'), ('Australia/Broken_Hill', 'Australia/Broken_Hill'), ('Australia/Canberra', 'Australia/Canberra'), ('Australia/Currie', 'Australia/Currie'), ('Australia/Darwin', 'Australia/Darwin'), ('Australia/Eucla', 'Australia/Eucla'), ('Australia/Hobart', 'Australia/Hobart'), ('Australia/LHI', 'Australia/LHI'), ('Australia/Lindeman', 'Australia/Lindeman'), ('Australia/Lord_Howe', 'Australia/Lord_Howe'), ('Australia/Melbourne', 'Australia/Melbourne'), ('Australia/NSW', 'Australia/NSW'), ('Australia/North', 'Australia/North'), ('Australia/Perth', 'Australia/Perth'), ('Australia/Queensland', 'Australia/Queensland'), ('Australia/South', 'Australia/South'), ('Australia/Sydney', 'Australia/Sydney'), ('Australia/Tasmania', 'Australia/Tasmania'), ('Australia/Victoria', 'Australia/Victoria'), ('Australia/West', 'Australia/West'), ('Australia/Yancowinna', 'Australia/Yancowinna'), ('Brazil/Acre', 'Brazil/Acre'), ('Brazil/DeNoronha', 'Brazil/DeNoronha'), ('Brazil/East', 'Brazil/East'), ('Brazil/West', 'Brazil/West'), ('CET', 'CET'), ('CST6CDT', 'CST6CDT'), ('Canada/Atlantic', 'Canada/Atlantic'), ('Canada/Central', 'Canada/Central'), ('Canada/Eastern', 'Canada/Eastern'), ('Canada/Mountain', 'Canada/Mountain'), ('Canada/Newfoundland', 'Canada/Newfoundland'), ('Canada/Pacific', 'Canada/Pacific'), ('Canada/Saskatchewan', 'Canada/Saskatchewan'), ('Canada/Yukon', 'Canada/Yukon'), ('Chile/Continental', 'Chile/Continental'), ('Chile/EasterIsland', 'Chile/EasterIsland'), ('Cuba', 'Cuba'), ('EET', 'EET'), ('EST', 'EST'), ('EST5EDT', 'EST5EDT'), ('Egypt', 'Egypt'), ('Eire', 'Eire'), ('Etc/GMT', 'Etc/GMT'), ('Etc/GMT+0', 'Etc/GMT+0'), ('Etc/GMT+1', 'Etc/GMT+1'), ('Etc/GMT+10', 'Etc/GMT+10'), ('Etc/GMT+11', 'Etc/GMT+11'), ('Etc/GMT+12', 'Etc/GMT+12'), ('Etc/GMT+2', 'Etc/GMT+2'), ('Etc/GMT+3', 'Etc/GMT+3'), ('Etc/GMT+4', 'Etc/GMT+4'), ('Etc/GMT+5', 'Etc/GMT+5'), ('Etc/GMT+6', 'Etc/GMT+6'), ('Etc/GMT+7', 'Etc/GMT+7'), ('Etc/GMT+8', 'Etc/GMT+8'), ('Etc/GMT+9', 'Etc/GMT+9'), ('Etc/GMT-0', 'Etc/GMT-0'), ('Etc/GMT-1', 'Etc/GMT-1'), ('Etc/GMT-10', 'Etc/GMT-10'), ('Etc/GMT-11', 'Etc/GMT-11'), ('Etc/GMT-12', 'Etc/GMT-12'), ('Etc/GMT-13', 'Etc/GMT-13'), ('Etc/GMT-14', 'Etc/GMT-14'), ('Etc/GMT-2', 'Etc/GMT-2'), ('Etc/GMT-3', 'Etc/GMT-3'), ('Etc/GMT-4', 'Etc/GMT-4'), ('Etc/GMT-5', 'Etc/GMT-5'), ('Etc/GMT-6', 'Etc/GMT-6'), ('Etc/GMT-7', 'Etc/GMT-7'), ('Etc/GMT-8', 'Etc/GMT-8'), ('Etc/GMT-9', 'Etc/GMT-9'), ('Etc/GMT0', 'Etc/GMT0'), ('Etc/Greenwich', 'Etc/Greenwich'), ('Etc/UCT', 'Etc/UCT'), ('Etc/UTC', 'Etc/UTC'), ('Etc/Universal', 'Etc/Universal'), ('Etc/Zulu', 'Etc/Zulu'), ('Europe/Amsterdam', 'Europe/Amsterdam'), ('Europe/Andorra', 'Europe/Andorra'), ('Europe/Astrakhan', 'Europe/Astrakhan'), ('Europe/Athens', 'Europe/Athens'), ('Europe/Belfast', 'Europe/Belfast'), ('Europe/Belgrade', 'Europe/Belgrade'), ('Europe/Berlin', 'Europe/Berlin'), ('Europe/Bratislava', 'Europe/Bratislava'), ('Europe/Brussels', 'Europe/Brussels'), ('Europe/Bucharest', 'Europe/Bucharest'), ('Europe/Budapest', 'Europe/Budapest'), ('Europe/Busingen', 'Europe/Busingen'), ('Europe/Chisinau', 'Europe/Chisinau'), ('Europe/Copenhagen', 'Europe/Copenhagen'), ('Europe/Dublin', 'Europe/Dublin'), ('Europe/Gibraltar', 'Europe/Gibraltar'), ('Europe/Guernsey', 'Europe/Guernsey'), ('Europe/Helsinki', 'Europe/Helsinki'), ('Europe/Isle_of_Man', 'Europe/Isle_of_Man'), ('Europe/Istanbul', 'Europe/Istanbul'), ('Europe/Jersey', 'Europe/Jersey'), ('Europe/Kaliningrad', 'Europe/Kaliningrad'), ('Europe/Kiev', 'Europe/Kiev'), ('Europe/Kirov', 'Europe/Kirov'), ('Europe/Kyiv', 'Europe/Kyiv'), ('Europe/Lisbon', 'Europe/Lisbon'), ('Europe/Ljubljana', 'Europe/Ljubljana'), ('Europe/London', 'Europe/London'), ('Europe/Luxembourg', 'Europe/Luxembourg'), ('Europe/Madrid', 'Europe/Madrid'), ('Europe/Malta', 'Europe/Malta'), ('Europe/Mariehamn', 'Europe/Mariehamn'), ('Europe/Minsk', 'Europe/Minsk'), ('Europe/Monaco', 'Europe/Monaco'), ('Europe/Moscow', 'Europe/Moscow'), ('Europe/Nicosia', 'Europe/Nicosia'), ('Europe/Oslo', 'Europe/Oslo'), ('Europe/Paris', 'Europe/Paris'), ('Europe/Podgorica', 'Europe/Podgorica'), ('Europe/Prague', 'Europe/Prague'), ('Europe/Riga', 'Europe/Riga'), ('Europe/Rome', 'Europe/Rome'), ('Europe/Samara', 'Europe/Samara'), ('Europe/San_Marino', 'Europe/San_Marino'), ('Europe/Sarajevo', 'Europe/Sarajevo'), ('Europe/Saratov', 'Europe/Saratov'), ('Europe/Simferopol', 'Europe/Simferopol'), ('Europe/Skopje', 'Europe/Skopje'), ('Europe/Sofia', 'Europe/Sofia'), ('Europe/Stockholm', 'Europe/Stockholm'), ('Europe/Tallinn', 'Europe/Tallinn'), ('Europe/Tirane', 'Europe/Tirane'), ('Europe/Tiraspol', 'Europe/Tiraspol'), ('Europe/Ulyanovsk', 'Europe/Ulyanovsk'), ('Europe/Uzhgorod', 'Europe/Uzhgorod'), ('Europe/Vaduz', 'Europe/Vaduz'), ('Europe/Vatican', 'Europe/Vatican'), ('Europe/Vienna', 'Europe/Vienna'), ('Europe/Vilnius', 'Europe/Vilnius'), ('Europe/Volgograd', 'Europe/Volgograd'), ('Europe/Warsaw', 'Europe/Warsaw'), ('Europe/Zagreb', 'Europe/Zagreb'), ('Europe/Zaporozhye', 'Europe/Zaporozhye'), ('Europe/Zurich', 'Europe/Zurich'), ('GB', 'GB'), ('GB-Eire', 'GB-Eire'), ('GMT', 'GMT'), ('GMT+0', 'GMT+0'), ('GMT-0', 'GMT-0'), ('GMT0', 'GMT0'), ('Greenwich', 'Greenwich'), ('HST', 'HST'), ('Hongkong', 'Hongkong'), ('Iceland', 'Iceland'), ('Indian/Antananarivo', 'Indian/Antananarivo'), ('Indian/Chagos', 'Indian/Chagos'), ('Indian/Christmas', 'Indian/Christmas'), ('Indian/Cocos', 'Indian/Cocos'), ('Indian/Comoro', 'Indian/Comoro'), ('Indian/Kerguelen', 'Indian/Kerguelen'), ('Indian/Mahe', 'Indian/Mahe'), ('Indian/Maldives', 'Indian/Maldives'), ('Indian/Mauritius', 'Indian/Mauritius'), ('Indian/Mayotte', 'Indian/Mayotte'), ('Indian/Reunion', 'Indian/Reunion'), ('Iran', 'Iran'), ('Israel', 'Israel'), ('Jamaica', 'Jamaica'), ('Japan', 'Japan'), ('Kwajalein', 'Kwajalein'), ('Libya', 'Libya'), ('MET', 'MET'), ('MST', 'MST'), ('MST7MDT', 'MST7MDT'), ('Mexico/BajaNorte', 'Mexico/BajaNorte'), ('Mexico/BajaSur', 'Mexico/BajaSur'), ('Mexico/General', 'Mexico/General'), ('NZ', 'NZ'), ('NZ-CHAT', 'NZ-CHAT'), ('Navajo', 'Navajo'), ('PRC', 'PRC'), ('PST8PDT', 'PST8PDT'), ('Pacific/Apia', 'Pacific/Apia'), ('Pacific/Auckland', 'Pacific/Auckland'), ('Pacific/Bougainville', 'Pacific/Bougainville'), ('Pacific/Chatham', 'Pacific/Chatham'), ('Pacific/Chuuk', 'Pacific/Chuuk'), ('Pacific/Easter', 'Pacific/Easter'), ('Pacific/Efate', 'Pacific/Efate'), ('Pacific/Enderbury', 'Pacific/Enderbury'), ('Pacific/Fakaofo', 'Pacific/Fakaofo'), ('Pacific/Fiji', 'Pacific/Fiji'), ('Pacific/Funafuti', 'Pacific/Funafuti'), ('Pacific/Galapagos', 'Pacific/Galapagos'), ('Pacific/Gambier', 'Pacific/Gambier'), ('Pacific/Guadalcanal', 'Pacific/Guadalcanal'), ('Pacific/Guam', 'Pacific/Guam'), ('Pacific/Honolulu', 'Pacific/Honolulu'), ('Pacific/Johnston', 'Pacific/Johnston'), ('Pacific/Kanton', 'Pacific/Kanton'), ('Pacific/Kiritimati', 'Pacific/Kiritimati'), ('Pacific/Kosrae', 'Pacific/Kosrae'), ('Pacific/Kwajalein', 'Pacific/Kwajalein'), ('Pacific/Majuro', 'Pacific/Majuro'), ('Pacific/Marquesas', 'Pacific/Marquesas'), ('Pacific/Midway', 'Pacific/Midway'), ('Pacific/Nauru', 'Pacific/Nauru'), ('Pacific/Niue', 'Pacific/Niue'), ('Pacific/Norfolk', 'Pacific/Norfolk'), ('Pacific/Noumea', 'Pacific/Noumea'), ('Pacific/Pago_Pago', 'Pacific/Pago_Pago'), ('Pacific/Palau', 'Pacific/Palau'), ('Pacific/Pitcairn', 'Pacific/Pitcairn'), ('Pacific/Pohnpei', 'Pacific/Pohnpei'), ('Pacific/Ponape', 'Pacific/Ponape'), ('Pacific/Port_Moresby', 'Pacific/Port_Moresby'), ('Pacific/Rarotonga', 'Pacific/Rarotonga'), ('Pacific/Saipan', 'Pacific/Saipan'), ('Pacific/Samoa', 'Pacific/Samoa'), ('Pacific/Tahiti', 'Pacific/Tahiti'), ('Pacific/Tarawa', 'Pacific/Tarawa'), ('Pacific/Tongatapu', 'Pacific/Tongatapu'), ('Pacific/Truk', 'Pacific/Truk'), ('Pacific/Wake', 'Pacific/Wake'), ('Pacific/Wallis', 'Pacific/Wallis'), ('Pacific/Yap', 'Pacific/Yap'), ('Poland', 'Poland'), ('Portugal', 'Portugal'), ('ROC', 'ROC'), ('ROK', 'ROK'), ('Singapore', 'Singapore'), ('Turkey', 'Turkey'), ('UCT', 'UCT'), ('US/Alaska', 'US/Alaska'), ('US/Aleutian', 'US/Aleutian'), ('US/Arizona', 'US/Arizona'), ('US/Central', 'US/Central'), ('US/East-Indiana', 'US/East-Indiana'), ('US/Eastern', 'US/Eastern'), ('US/Hawaii', 'US/Hawaii'), ('US/Indiana-Starke', 'US/Indiana-Starke'), ('US/Michigan', 'US/Michigan'), ('US/Mountain', 'US/Mountain'), ('US/Pacific', 'US/Pacific'), ('US/Samoa', 'US/Samoa'), ('UTC', 'UTC'), ('Universal', 'Universal'), ('W-SU', 'W-SU'), ('WET', 'WET'), ('Zulu', 'Zulu')], default='UTC', max_length=240),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name='comment',
            index=models.Index(fields=['team_id', 'scope', 'item_id', 'deleted', '-created_at'], name='posthog_comment_convo_idx'),
        ),
        migrations.AlterField(
            model_name='integration',
            name='kind',
            field=models.CharField(choices=[('slack', 'Slack'), ('salesforce', 'Salesforce'), ('hubspot', 'Hubspot'), ('google-pubsub', 'Google Pubsub'), ('google-cloud-storage', 'Google Cloud Storage'), ('google-ads', 'Google Ads'), ('google-sheets', 'Google Sheets'), ('snapchat', 'Snapchat'), ('linkedin-ads', 'Linkedin Ads'), ('reddit-ads', 'Reddit Ads'), ('tiktok-ads', 'Tiktok Ads'), ('bing-ads', 'Bing Ads'), ('intercom', 'Intercom'), ('email', 'Email'), ('linear', 'Linear'), ('github', 'Github'), ('gitlab', 'Gitlab'), ('meta-ads', 'Meta Ads'), ('twilio', 'Twilio'), ('clickup', 'Clickup'), ('vercel', 'Vercel'), ('databricks', 'Databricks'), ('azure-blob', 'Azure Blob'), ('firebase', 'Firebase'), ('jira', 'Jira')], max_length=20),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_user'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0984_clear_temporary_tokens op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0984_clear_temporary_tokens op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='ALTER TABLE posthog_columnconfiguration DROP CONSTRAINT IF EXISTS unique_team_context_key',
                ),
            ],
            state_operations=[
                migrations.RemoveConstraint(
                    model_name='columnconfiguration',
                    name='unique_team_context_key',
                ),
            ],
        ),
        migrations.AddField(
            model_name='columnconfiguration',
            name='name',
            field=models.CharField(default='Column configuration', max_length=255),
        ),
        migrations.AddField(
            model_name='columnconfiguration',
            name='visibility',
            field=models.CharField(choices=[('private', 'Private (only visible to creator)'), ('shared', 'Shared with team')], default='shared', max_length=10),
        ),
        migrations.AddField(
            model_name='columnconfiguration',
            name='filters',
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AddField(
            model_name='columnconfiguration',
            name='created_by',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                        CREATE UNIQUE INDEX CONCURRENTLY IF NOT EXISTS "unique_user_view_name"\n                            ON "posthog_columnconfiguration" ("team_id", "context_key", "name", "created_by_id")\n                            WHERE "visibility" = \'private\';\n                        ',
                    reverse_sql='DROP INDEX CONCURRENTLY IF EXISTS unique_user_view_name',
                ),
                migrations.RunSQL(
                    sql='\n                        CREATE UNIQUE INDEX CONCURRENTLY IF NOT EXISTS "unique_team_view_name"\n                            ON "posthog_columnconfiguration" ("team_id", "context_key", "name")\n                            WHERE "visibility" = \'shared\';\n                        ',
                    reverse_sql='DROP INDEX CONCURRENTLY IF EXISTS unique_team_view_name',
                ),
            ],
            state_operations=[
                migrations.AddConstraint(
                    model_name='columnconfiguration',
                    constraint=models.UniqueConstraint(condition=models.Q(('visibility', 'private')), fields=('team', 'context_key', 'name', 'created_by'), name='unique_user_view_name'),
                ),
                migrations.AddConstraint(
                    model_name='columnconfiguration',
                    constraint=models.UniqueConstraint(condition=models.Q(('visibility', 'shared')), fields=('team', 'context_key', 'name'), name='unique_team_view_name'),
                ),
            ],
        ),
        migrations.CreateModel(
            name='DuckLakeCatalog',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('db_host', models.CharField(max_length=255)),
                ('db_port', models.IntegerField(default=5432)),
                ('db_database', models.CharField(default='ducklake', max_length=255)),
                ('db_username', models.CharField(max_length=255)),
                ('db_password', posthog.helpers.encrypted_fields.EncryptedTextField(max_length=500)),
                ('bucket', models.CharField(max_length=255)),
                ('bucket_region', models.CharField(default='us-east-1', max_length=50)),
                ('cross_account_role_arn', models.CharField(help_text='ARN of the IAM role to assume for cross-account S3 access', max_length=255)),
                ('cross_account_external_id', posthog.helpers.encrypted_fields.EncryptedTextField(help_text='External ID for cross-account role assumption (encrypted)', max_length=500)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='ducklake_catalog', to='posthog.team')),
            ],
            options={
                'verbose_name': 'DuckLake catalog',
                'verbose_name_plural': 'DuckLake catalogs',
                'db_table': 'posthog_ducklakecatalog',
            },
        ),
        migrations.AddField(
            model_name='hogflowtemplate',
            name='tags',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), blank=True, default=list, size=None),
        ),
        migrations.CreateModel(
            name='ProjectSecretAPIKey',
            fields=[
                ('id', models.CharField(default=posthog.models.utils.generate_random_token, max_length=50, primary_key=True, serialize=False)),
                ('label', models.CharField(max_length=40)),
                ('mask_value', models.CharField(editable=False, max_length=11, null=True)),
                ('secure_value', models.CharField(editable=False, max_length=300, null=True, unique=True)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('last_used_at', models.DateTimeField(blank=True, null=True)),
                ('last_rolled_at', models.DateTimeField(blank=True, null=True)),
                ('scopes', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), null=True, size=None)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_project_secret_api_keys', to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='project_secret_api_keys', to='posthog.team')),
            ],
            options={
                'db_table': 'posthog_projectsecretapikey',
                'indexes': [models.Index(fields=['team', 'created_at'], name='posthog_pro_team_id_d4c925_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='projectsecretapikey',
            constraint=models.UniqueConstraint(fields=('team', 'label'), name='unique_team_label'),
        ),
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.RemoveField(
                    model_name='approvalpolicy',
                    name='bypass_roles',
                ),
            ],
        ),
        migrations.RunSQL(
            sql='ALTER TABLE posthog_approvalpolicy DROP COLUMN IF EXISTS bypass_roles;',
            reverse_sql="ALTER TABLE posthog_approvalpolicy ADD COLUMN IF NOT EXISTS bypass_roles jsonb DEFAULT '[]'::jsonb;",
        ),
        migrations.AddField(
            model_name='approvalpolicy',
            name='bypass_org_membership_levels',
            field=models.JSONField(default=list),
        ),
        migrations.AddField(
            model_name='approvalpolicy',
            name='bypass_roles',
            field=models.ManyToManyField(blank=True, related_name='bypass_policies', to='ee.role'),
        ),
        migrations.AddField(
            model_name='user',
            name='requested_2fa_reset_at',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='default_experiment_stats_method',
            field=models.CharField(blank=True, choices=[('bayesian', 'Bayesian'), ('frequentist', 'Frequentist')], default='bayesian', help_text='Default statistical method for new experiments in this environment.', max_length=20, null=True),
        ),
        migrations.AddField(
            model_name='oauthapplication',
            name='is_first_party',
            field=models.BooleanField(default=False, help_text='True if this is a first-party PostHog application that skips OAuth consent'),
        ),
        migrations.AddField(
            model_name='oauthapplication',
            name='auth_brand',
            field=models.CharField(choices=[('posthog', 'posthog'), ('twig', 'twig')], default='posthog', help_text='Branding to use on authentication pages', max_length=32),
        ),
        migrations.AddField(
            model_name='team',
            name='proactive_tasks_enabled',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_dashboarditem'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0999_remove_presorted_events_modifier op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0999_remove_presorted_events_modifier op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.CreateModel(
            name='HealthIssue',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('kind', models.CharField(max_length=100)),
                ('severity', models.CharField(choices=[('critical', 'Critical'), ('warning', 'Warning'), ('info', 'Info')], max_length=20)),
                ('status', models.CharField(choices=[('active', 'Active'), ('resolved', 'Resolved'), ('dismissed', 'Dismissed')], default='active', max_length=20)),
                ('payload', models.JSONField(default=dict)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('resolved_at', models.DateTimeField(blank=True, null=True)),
                ('unique_hash', models.CharField(max_length=64)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='health_issues', to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='healthissue',
            constraint=models.UniqueConstraint(condition=models.Q(('status', 'active')), fields=('team_id', 'kind', 'unique_hash'), name='unique_active_health_issue'),
        ),
        migrations.AddField(
            model_name='experiment',
            name='exposure_preaggregation_enabled',
            field=models.BooleanField(default=False),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_alertsubscription'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.1003_clean_up_stale_alert_subscriptions op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.1003_clean_up_stale_alert_subscriptions op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.CreateModel(
            name='ResourceTransfer',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('resource_kind', models.CharField(max_length=100)),
                ('resource_id', models.CharField(max_length=100)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_transferred_at', models.DateTimeField(auto_now=True)),
                ('destination_team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='inbound_resource_transfers', to='posthog.team')),
                ('source_team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='outbound_resource_transfers', to='posthog.team')),
            ],
            options={
                'abstract': False,
                'indexes': [models.Index(fields=['resource_kind', 'resource_id', '-last_transferred_at'], name='idx_restransfer_kind_id_time')],
            },
        ),
        migrations.CreateModel(
            name='ObjectMediaPreview',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False)),
                ('metadata', models.JSONField(blank=True, default=dict)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('event_definition', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='media_previews', to='posthog.eventdefinition')),
                ('exported_asset', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='object_previews', to='posthog.exportedasset')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('uploaded_media', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='object_previews', to='posthog.uploadedmedia')),
            ],
            options={
                'indexes': [models.Index(fields=['team', 'event_definition'], name='posthog_obj_team_id_e93ae8_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='objectmediapreview',
            constraint=models.CheckConstraint(check=models.Q(models.Q(('exported_asset__isnull', True), ('uploaded_media__isnull', False)), models.Q(('exported_asset__isnull', False), ('uploaded_media__isnull', True)), _connector='OR'), name='exactly_one_media'),
        ),
        migrations.AddConstraint(
            model_name='objectmediapreview',
            constraint=models.CheckConstraint(check=models.Q(('event_definition__isnull', False)), name='exactly_one_object'),
        ),
        migrations.AddField(
            model_name='resourcetransfer',
            name='duplicated_resource_id',
            field=models.CharField(default='', max_length=100),
            preserve_default=False,
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    ALTER TABLE "posthog_resourcetransfer" ADD COLUMN "created_by_id" integer NULL CONSTRAINT "posthog_resourcetran_created_by_id_cfdd93a0_fk_posthog_u" REFERENCES "posthog_user"("id") DEFERRABLE INITIALLY DEFERRED;  -- existing-table-constraint-ignore\n                    SET CONSTRAINTS "posthog_resourcetran_created_by_id_cfdd93a0_fk_posthog_u" IMMEDIATE;  -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_resourcetransfer" DROP COLUMN IF EXISTS "created_by_id";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='resourcetransfer',
                    name='created_by',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
                ),
            ],
        ),
        migrations.RunSQL(
            sql='\n            CREATE INDEX CONCURRENTLY IF NOT EXISTS "posthog_resourcetransfer_created_by_id_cfdd93a0" ON "posthog_resourcetransfer" ("created_by_id");\n            ',
            reverse_sql='\n                DROP INDEX IF EXISTS "posthog_resourcetransfer_created_by_id_cfdd93a0";\n            ',
        ),
        migrations.AddField(
            model_name='healthissue',
            name='dismissed',
            field=models.BooleanField(default=False),
        ),
        migrations.AlterField(
            model_name='healthissue',
            name='status',
            field=models.CharField(choices=[('active', 'Active'), ('resolved', 'Resolved')], default='active', max_length=20),
        ),
        migrations.AlterField(
            model_name='hogflowtemplate',
            name='scope',
            field=models.CharField(choices=[('team', 'Only team'), ('organization', 'Organization'), ('global', 'Global')], max_length=24),
        ),
    ]
