# Generated by Django 4.2.22 on 2025-09-23 11:42

import django.db.models.deletion
from django.db import migrations, models


def update_content_type(apps, schema_editor):
    ContentType = apps.get_model("contenttypes", "ContentType")
    for model in [
        "webexperiment",
        "experiment",
        "experimentholdout",
        "experimentmetricresult",
        "experimentsavedmetric",
        "experimenttosavedmetric",
    ]:
        try:
            ct = ContentType.objects.get(app_label="posthog", model=model)
            ct.app_label = "experiments"
            ct.save()
        except ContentType.DoesNotExist:
            pass


class Migration(migrations.Migration):
    dependencies = [
        ("experiments", "0001_initial_migration"),
        ("posthog", "0863_experimentmetricresult"),
    ]

    operations = [
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunPython(update_content_type),
            ],
            state_operations=[
                migrations.RemoveField(
                    model_name="experiment",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="experiment",
                    name="exposure_cohort",
                ),
                migrations.RemoveField(
                    model_name="experiment",
                    name="feature_flag",
                ),
                migrations.RemoveField(
                    model_name="experiment",
                    name="holdout",
                ),
                migrations.RemoveField(
                    model_name="experiment",
                    name="saved_metrics",
                ),
                migrations.RemoveField(
                    model_name="experiment",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="experimentholdout",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="experimentholdout",
                    name="team",
                ),
                migrations.AlterUniqueTogether(
                    name="experimentmetricresult",
                    unique_together=None,
                ),
                migrations.RemoveField(
                    model_name="experimentmetricresult",
                    name="experiment",
                ),
                migrations.RemoveField(
                    model_name="experimentsavedmetric",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="experimentsavedmetric",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="experimenttosavedmetric",
                    name="experiment",
                ),
                migrations.RemoveField(
                    model_name="experimenttosavedmetric",
                    name="saved_metric",
                ),
                migrations.DeleteModel(
                    name="WebExperiment",
                ),
                migrations.AlterField(
                    model_name="taggeditem",
                    name="experiment_saved_metric",
                    field=models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="tagged_items",
                        to="experiments.experimentsavedmetric",
                    ),
                ),
                migrations.DeleteModel(
                    name="Experiment",
                ),
                migrations.DeleteModel(
                    name="ExperimentHoldout",
                ),
                migrations.DeleteModel(
                    name="ExperimentMetricResult",
                ),
                migrations.DeleteModel(
                    name="ExperimentSavedMetric",
                ),
                migrations.DeleteModel(
                    name="ExperimentToSavedMetric",
                ),
            ],
        ),
    ]
