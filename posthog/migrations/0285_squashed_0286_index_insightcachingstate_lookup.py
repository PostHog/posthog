# Generated by Django 4.2.28 on 2026-02-18 08:16

from django.db import migrations, models


class Migration(migrations.Migration):
    atomic = False

    replaces = [("posthog", "0285_capture_performance_opt_in"), ("posthog", "0286_index_insightcachingstate_lookup")]

    dependencies = [
        ("posthog", "0001_initial_squashed_0284_improved_caching_state_idx"),
    ]

    operations = [
        migrations.AddField(
            model_name="team",
            name="capture_performance_opt_in",
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.RunSQL(
            sql="\n            -- not-null-ignore\n            CREATE INDEX CONCURRENTLY IF NOT EXISTS posthog_insightcachingstate_lookup ON posthog_insightcachingstate (\n                last_refresh DESC NULLS LAST,\n                last_refresh_queued_at DESC NULLS LAST,\n                target_cache_age_seconds,\n                refresh_attempt,\n                team_id,\n                cache_key,\n                id\n            )\n            WHERE (target_cache_age_seconds IS NOT NULL) AND (refresh_attempt < 2)\n            ",
            reverse_sql='DROP INDEX CONCURRENTLY IF EXISTS "posthog_insightcachingstate_lookup"',
        ),
    ]
