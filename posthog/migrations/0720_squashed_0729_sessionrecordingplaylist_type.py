# Generated by Django 4.2.28 on 2026-02-18 08:16

import django.utils.timezone
import django.db.models.deletion
import django.contrib.postgres.operations
from django.conf import settings
from django.db import migrations, models

import posthog.models.utils


class Migration(migrations.Migration):
    atomic = False

    replaces = [
        ("posthog", "0720_add_hog_function_template_model"),
        ("posthog", "0721_eventingestionrestrictionconfig_note"),
        ("posthog", "0722_alter_datamodelingjob_status"),
        ("posthog", "0723_add_help_text_to_cohorts"),
        ("posthog", "0724_errortrackinggroupingrule"),
        ("posthog", "0725_file_system_cleanup"),
        ("posthog", "0726_team_secret_api_token_and_backup"),
        ("posthog", "0727_team_secret_api_token_unique"),
        ("posthog", "0728_experiment_conclusion_experiment_conclusion_comment"),
        ("posthog", "0729_sessionrecordingplaylist_type"),
    ]

    dependencies = [
        ("posthog", "0719_replace_person_with_person_display_name_in_live_events_columns"),
    ]

    operations = [
        migrations.CreateModel(
            name="HogFunctionTemplate",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("template_id", models.CharField(db_index=True, max_length=255)),
                ("sha", models.CharField(db_index=True, max_length=100)),
                ("name", models.CharField(max_length=400)),
                ("description", models.TextField(blank=True, null=True)),
                ("code", models.TextField()),
                ("code_language", models.CharField(default="hog", max_length=20)),
                ("inputs_schema", models.JSONField()),
                ("bytecode", models.JSONField(blank=True, null=True)),
                ("type", models.CharField(max_length=50)),
                ("status", models.CharField(default="alpha", max_length=20)),
                ("category", models.JSONField(default=list)),
                ("kind", models.CharField(blank=True, max_length=50, null=True)),
                ("free", models.BooleanField(default=False)),
                ("icon_url", models.URLField(blank=True, null=True)),
                ("filters", models.JSONField(blank=True, null=True)),
                ("masking", models.JSONField(blank=True, null=True)),
                ("mappings", models.JSONField(blank=True, null=True)),
                ("mapping_templates", models.JSONField(blank=True, null=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "indexes": [
                    models.Index(fields=["template_id", "sha"], name="posthog_hog_templat_55950b_idx"),
                    models.Index(fields=["type", "status"], name="posthog_hog_type_8cac9a_idx"),
                    models.Index(fields=["created_at"], name="posthog_hog_created_6a9df3_idx"),
                    models.Index(fields=["template_id", "created_at"], name="posthog_hog_templat_d1778e_idx"),
                ],
                "unique_together": {("template_id", "sha")},
            },
        ),
        migrations.AddField(
            model_name="eventingestionrestrictionconfig",
            name="note",
            field=models.TextField(
                blank=True, help_text="Optional note explaining why this restriction was put in place", null=True
            ),
        ),
        migrations.AlterField(
            model_name="datamodelingjob",
            name="status",
            field=models.CharField(
                choices=[
                    ("Running", "Running"),
                    ("Completed", "Completed"),
                    ("Failed", "Failed"),
                    ("Cancelled", "Cancelled"),
                ],
                default="Running",
                max_length=400,
            ),
        ),
        migrations.AlterField(
            model_name="cohort",
            name="filters",
            field=models.JSONField(
                blank=True,
                help_text='Filters for the cohort. Examples:\n\n        # Behavioral filter (performed event)\n        {\n            "properties": {\n                "type": "OR",\n                "values": [{\n                    "type": "OR",\n                    "values": [{\n                        "key": "address page viewed",\n                        "type": "behavioral",\n                        "value": "performed_event",\n                        "negation": false,\n                        "event_type": "events",\n                        "time_value": "30",\n                        "time_interval": "day"\n                    }]\n                }]\n            }\n        }\n\n        # Person property filter\n        {\n            "properties": {\n                "type": "OR",\n                "values": [{\n                    "type": "AND",\n                    "values": [{\n                        "key": "promoCodes",\n                        "type": "person",\n                        "value": ["1234567890"],\n                        "negation": false,\n                        "operator": "exact"\n                    }]\n                }]\n            }\n        }\n\n        # Cohort filter\n        {\n            "properties": {\n                "type": "OR",\n                "values": [{\n                    "type": "AND",\n                    "values": [{\n                        "key": "id",\n                        "type": "cohort",\n                        "value": 8814,\n                        "negation": false\n                    }]\n                }]\n            }\n        }',
                null=True,
            ),
        ),
        migrations.CreateModel(
            name="ErrorTrackingGroupingRule",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("bytecode", models.JSONField()),
                ("filters", models.JSONField()),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("disabled_data", models.JSONField(blank=True, null=True)),
                ("order_key", models.IntegerField()),
                ("description", models.TextField(null=True)),
                ("role", models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to="ee.role")),
                ("team", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
                (
                    "user",
                    models.ForeignKey(
                        null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL
                    ),
                ),
                (
                    "user_group",
                    models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to="posthog.usergroup"),
                ),
            ],
            options={
                "indexes": [models.Index(fields=["team_id"], name="posthog_err_team_id_bf614f_idx")],
            },
        ),
        django.contrib.postgres.operations.RemoveIndexConcurrently(
            model_name="filesystem",
            name="posthog_fil_project_840481_idx",
        ),
        django.contrib.postgres.operations.RemoveIndexConcurrently(
            model_name="filesystem",
            name="posthog_fs_project_path",
        ),
        django.contrib.postgres.operations.RemoveIndexConcurrently(
            model_name="filesystem",
            name="posthog_fs_project_depth",
        ),
        django.contrib.postgres.operations.RemoveIndexConcurrently(
            model_name="filesystem",
            name="posthog_fs_project_typeref",
        ),
        migrations.AlterField(
            model_name="filesystem",
            name="created_at",
            field=models.DateTimeField(default=django.utils.timezone.now, editable=False),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name="filesystem",
            index=models.Index(models.F("team_id"), models.F("path"), name="posthog_fs_team_path"),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name="filesystem",
            index=models.Index(models.F("team_id"), models.F("depth"), name="posthog_fs_team_depth"),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name="filesystem",
            index=models.Index(models.F("team_id"), models.F("type"), models.F("ref"), name="posthog_fs_team_typeref"),
        ),
        migrations.AddField(
            model_name="team",
            name="secret_api_token",
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name="team",
            name="secret_api_token_backup",
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.RunSQL(
            sql="CREATE UNIQUE INDEX CONCURRENTLY team_secret_api_token_unique_idx ON posthog_team (secret_api_token);",
            reverse_sql="DROP INDEX CONCURRENTLY team_secret_api_token_unique_idx;",
        ),
        migrations.RunSQL(
            sql="CREATE UNIQUE INDEX CONCURRENTLY team_secret_api_token_backup_unique_idx ON posthog_team (secret_api_token_backup);",
            reverse_sql="DROP INDEX CONCURRENTLY team_secret_api_token_backup_unique_idx;",
        ),
        migrations.AddField(
            model_name="experiment",
            name="conclusion",
            field=models.CharField(
                blank=True,
                choices=[
                    ("won", "Won"),
                    ("lost", "Lost"),
                    ("inconclusive", "Inconclusive"),
                    ("stopped_early", "Stopped Early"),
                    ("invalid", "Invalid"),
                ],
                max_length=30,
                null=True,
            ),
        ),
        migrations.AddField(
            model_name="experiment",
            name="conclusion_comment",
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecordingplaylist",
            name="type",
            field=models.CharField(
                blank=True, choices=[("collection", "Collection"), ("filters", "Filters")], max_length=50, null=True
            ),
        ),
    ]
