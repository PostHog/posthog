# Generated by Django 4.2.28 on 2026-02-20 11:25

from decimal import Decimal
from django.conf import settings
import django.contrib.postgres.fields
import django.contrib.postgres.operations
import django.core.validators
from django.db import migrations, models
import django.db.migrations.operations.special
import django.db.models.deletion
import django.db.models.functions.comparison
import django.utils.timezone
import posthog.helpers.encrypted_fields
import posthog.helpers.migration_seeds
import posthog.models.organization_invite
import posthog.models.utils
import posthog.utils
import products.data_warehouse.backend.models.datawarehouse_saved_query


class Migration(migrations.Migration):

    atomic = False

    replaces = [('posthog', '0285_capture_performance_opt_in'), ('posthog', '0286_index_insightcachingstate_lookup'), ('posthog', '0287_add_session_recording_model'), ('posthog', '0288_add_session_recording_persistence'), ('posthog', '0289_add_tags_to_feature_flags'), ('posthog', '0290_add_dashboard_templates'), ('posthog', '0291_create_person_override_model'), ('posthog', '0292_property_definitions_persons_and_groups_support'), ('posthog', '0293_property_definitions_drop_old_constraint'), ('posthog', '0294_plugin_blank_fields'), ('posthog', '0295_plugin_allow_blank_config_schema'), ('posthog', '0296_team_allow_blank_fields'), ('posthog', '0297_property_definitions_index_query'), ('posthog', '0298_add_insight_queries'), ('posthog', '0299_set_templates_global'), ('posthog', '0300_add_constraints_to_person_override'), ('posthog', '0301_organization_enforce_2fa'), ('posthog', '0302_add_user_pending_email_and_is_verified'), ('posthog', '0303_team_session_recording_version'), ('posthog', '0304_store_dashboard_template_in_db'), ('posthog', '0305_rework_person_overrides'), ('posthog', '0306_featureflag_dashboard'), ('posthog', '0307_pluginconfig_admin'), ('posthog', '0308_add_indirect_person_override_constraints'), ('posthog', '0309_team_autocapture_opt_out'), ('posthog', '0310_add_starter_dashboard_template'), ('posthog', '0311_dashboard_template_scope'), ('posthog', '0312_organization_available_product_features'), ('posthog', '0313_early_access_feature'), ('posthog', '0314_sharingconfiguration_recording'), ('posthog', '0315_notebook'), ('posthog', '0316_action_href_text_matching'), ('posthog', '0317_batch_export_models'), ('posthog', '0318_alter_earlyaccessfeature_stage'), ('posthog', '0319_user_requested_password_reset_at'), ('posthog', '0320_survey'), ('posthog', '0321_add_exception_autocapture_optin'), ('posthog', '0322_auto_20230531_1904'), ('posthog', '0323_alter_batchexportdestination_type'), ('posthog', '0324_user_has_seen_product_intro_for'), ('posthog', '0325_alter_dashboardtemplate_scope'), ('posthog', '0326_team_extra_settings'), ('posthog', '0327_alter_earlyaccessfeature_stage'), ('posthog', '0328_add_starter_feature_flag_template'), ('posthog', '0329_datawarehousecredential_datawarehousetable'), ('posthog', '0330_add_autocapture_exceptions_events_to_ignore'), ('posthog', '0331_add_missing_property_definition_index'), ('posthog', '0332_featureflag_has_enriched_analytics'), ('posthog', '0333_add_timestamp_fields_to_batch_exports'), ('posthog', '0334_add_asset_ttl'), ('posthog', '0335_alter_asyncdeletion_deletion_type'), ('posthog', '0336_alter_survey_type'), ('posthog', '0337_more_session_recording_fields'), ('posthog', '0338_datawarehouse_saved_query'), ('posthog', '0339_add_user_scene_personalisation'), ('posthog', '0340_action_bytecode'), ('posthog', '0341_add_session_recording_storage_version'), ('posthog', '0342_alter_featureflag_usage_dashboard'), ('posthog', '0343_team_has_completed_onboarding_for'), ('posthog', '0344_add_new_export_type'), ('posthog', '0345_view_link_and_s3_table_update'), ('posthog', '0346_team_week_start_day'), ('posthog', '0347_add_bigquery_export_type'), ('posthog', '0348_alter_datawarehousetable_format'), ('posthog', '0349_update_survey_query_name'), ('posthog', '0350_add_notebook_text_content'), ('posthog', '0351_team_surveys_opt_in'), ('posthog', '0352_auto_20230926_1833'), ('posthog', '0353_add_5_minute_interval_to_batch_exports'), ('posthog', '0354_organization_never_drop_data'), ('posthog', '0355_add_batch_export_backfill_model'), ('posthog', '0356_add_replay_cost_control'), ('posthog', '0357_add_redshift_batch_export_destination'), ('posthog', '0358_externaldatasource'), ('posthog', '0359_team_external_data_workspace_id'), ('posthog', '0360_externaldatasource_destination_id'), ('posthog', '0361_add_plugin_config_ui_fields'), ('posthog', '0362_alter_experiment_feature_flag'), ('posthog', '0363_add_replay_payload_capture_config'), ('posthog', '0364_team_external_data_workspace_rows'), ('posthog', '0365_update_created_by_flag_constraint'), ('posthog', '0366_alter_action_created_by'), ('posthog', '0367_job_inputs'), ('posthog', '0368_externaldatasource_prefix'), ('posthog', '0369_user_theme_mode'), ('posthog', '0370_externaldatajob_workflow_id'), ('posthog', '0371_pendingpersonoverride'), ('posthog', '0372_cohort_query'), ('posthog', '0373_externaldataschema'), ('posthog', '0374_scheduled_change'), ('posthog', '0375_alter_survey_type'), ('posthog', '0376_externaldataschema_last_synced_at'), ('posthog', '0377_flatpersonoverride'), ('posthog', '0378_alter_user_theme_mode'), ('posthog', '0379_alter_scheduledchange'), ('posthog', '0380_add_comments'), ('posthog', '0381_alter_externaldatasource_source_type'), ('posthog', '0382_user_strapi_id'), ('posthog', '0383_externaldatasource_cascade'), ('posthog', '0384_activity_log_was_impersonated'), ('posthog', '0385_exception_autocapture_off_for_all'), ('posthog', '0386_add_session_replay_config_to_team'), ('posthog', '0387_alter_externaldatasource_source_type'), ('posthog', '0388_add_schema_to_batch_exports'), ('posthog', '0389_alter_batchexportdestination_type'), ('posthog', '0390_personalapikey_scopes'), ('posthog', '0391_alter_batchexportbackfill_status_and_more'), ('posthog', '0392_alter_exportedasset_export_format'), ('posthog', '0393_datawarehousejoin_delete_datawarehouseviewlink'), ('posthog', '0394_organization_customer_trust_scores_and_more'), ('posthog', '0395_alter_batchexportbackfill_end_at'), ('posthog', '0396_projects_and_environments'), ('posthog', '0397_projects_backfill'), ('posthog', '0398_alter_externaldatasource_source_type'), ('posthog', '0399_batchexportrun_records_total_count'), ('posthog', '0400_datawarehousetable_row_count'), ('posthog', '0401_experiment_exposure_cohort'), ('posthog', '0402_externaldatajob_schema'), ('posthog', '0403_plugin_has_private_access'), ('posthog', '0404_remove_propertydefinition_property_type_is_valid_and_more'), ('posthog', '0405_team_heatmaps_opt_in'), ('posthog', '0406_survey_responses_limit'), ('posthog', '0407_verbose_name_for_team_model'), ('posthog', '0408_team_modifiers'), ('posthog', '0409_action_steps_json_alter_actionstep_action'), ('posthog', '0410_action_steps_population'), ('posthog', '0411_eventproperty_indexes'), ('posthog', '0412_proxyrecord'), ('posthog', '0413_user_hedgehog_config'), ('posthog', '0414_personalapikey_mask_value'), ('posthog', '0415_pluginconfig_match_action'), ('posthog', '0416_survey_internal_targeting_flag'), ('posthog', '0417_remove_organizationmembership_only_one_owner_per_organization_and_more'), ('posthog', '0418_pluginconfig_filters'), ('posthog', '0419_remove_organization_available_features'), ('posthog', '0420_alert'), ('posthog', '0421_set_all_survey_responses_to_be_strings'), ('posthog', '0422_proxyrecord_message'), ('posthog', '0423_alter_externaldatasource_source_type'), ('posthog', '0424_survey_current_iteration_and_more'), ('posthog', '0425_hogfunction'), ('posthog', '0426_externaldatasource_sync_frequency'), ('posthog', '0427_hogfunction_icon_url_hogfunction_template_id'), ('posthog', '0428_externaldataschema_sync_type'), ('posthog', '0429_alter_datawarehousetable_format'), ('posthog', '0430_batchexport_model'), ('posthog', '0431_externaldataschema_sync_type_payload'), ('posthog', '0432_personlessdistinctid'), ('posthog', '0433_dashboard_idx_dashboard_deleted_team_id'), ('posthog', '0434_add_web_vitals_opt_in'), ('posthog', '0435_alter_action_slack_message_format'), ('posthog', '0436_alter_proxyrecord_status'), ('posthog', '0437_externaldataschema_sync_frequency'), ('posthog', '0438_errortrackinggroup'), ('posthog', '0439_survey_actions'), ('posthog', '0440_organizationinvite_private_project_access'), ('posthog', '0441_alter_datawarehousetable_format'), ('posthog', '0442_alter_survey_questions'), ('posthog', '0443_externaldatajob_workflow_run_id')]

    dependencies = [
        ('posthog', '0001_initial_squashed_0284_improved_caching_state_idx'),
    ]

    operations = [
        migrations.AddField(
            model_name='team',
            name='capture_performance_opt_in',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.RunSQL(
            sql='\n            -- not-null-ignore\n            CREATE INDEX CONCURRENTLY IF NOT EXISTS posthog_insightcachingstate_lookup ON posthog_insightcachingstate (\n                last_refresh DESC NULLS LAST,\n                last_refresh_queued_at DESC NULLS LAST,\n                target_cache_age_seconds,\n                refresh_attempt,\n                team_id,\n                cache_key,\n                id\n            )\n            WHERE (target_cache_age_seconds IS NOT NULL) AND (refresh_attempt < 2)\n            ',
            reverse_sql='DROP INDEX CONCURRENTLY IF EXISTS "posthog_insightcachingstate_lookup"',
        ),
        migrations.AlterField(
            model_name='sessionrecordingplaylist',
            name='last_modified_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='modified_playlists', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterField(
            model_name='sessionrecordingplaylistitem',
            name='session_id',
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.CreateModel(
            name='SessionRecording',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('session_id', models.CharField(max_length=200, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, null=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'unique_together': {('team', 'session_id')},
            },
        ),
        migrations.AddField(
            model_name='sessionrecordingplaylistitem',
            name='recording',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='playlist_items', to='posthog.sessionrecording', to_field='session_id'),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_sessionrecordingplaylistitem'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0287_add_session_recording_model op#5';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0287_add_session_recording_model op#5';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterUniqueTogether(
            name='sessionrecordingplaylistitem',
            unique_together={('recording', 'playlist')},
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='click_count',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='deleted',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='distinct_id',
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='duration',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='end_time',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='keypress_count',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='object_storage_path',
            field=models.CharField(blank=True, max_length=200, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='start_time',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='start_url',
            field=models.CharField(blank=True, max_length=512, null=True),
        ),
        migrations.RemoveConstraint(
            model_name='taggeditem',
            name='exactly_one_related_object',
        ),
        migrations.AddField(
            model_name='taggeditem',
            name='feature_flag',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tagged_items', to='posthog.featureflag'),
        ),
        migrations.AlterUniqueTogether(
            name='taggeditem',
            unique_together={('tag', 'dashboard', 'insight', 'event_definition', 'property_definition', 'action', 'feature_flag')},
        ),
        migrations.AddConstraint(
            model_name='taggeditem',
            constraint=models.UniqueConstraint(condition=models.Q(('feature_flag__isnull', False)), fields=('tag', 'feature_flag'), name='unique_feature_flag_tagged_item'),
        ),
        migrations.AddConstraint(
            model_name='taggeditem',
            constraint=models.CheckConstraint(check=models.Q(models.Q(('dashboard__isnull', False), ('insight__isnull', True), ('event_definition__isnull', True), ('property_definition__isnull', True), ('action__isnull', True), ('feature_flag__isnull', True)), models.Q(('dashboard__isnull', True), ('insight__isnull', False), ('event_definition__isnull', True), ('property_definition__isnull', True), ('action__isnull', True), ('feature_flag__isnull', True)), models.Q(('dashboard__isnull', True), ('insight__isnull', True), ('event_definition__isnull', False), ('property_definition__isnull', True), ('action__isnull', True), ('feature_flag__isnull', True)), models.Q(('dashboard__isnull', True), ('insight__isnull', True), ('event_definition__isnull', True), ('property_definition__isnull', False), ('action__isnull', True), ('feature_flag__isnull', True)), models.Q(('dashboard__isnull', True), ('insight__isnull', True), ('event_definition__isnull', True), ('property_definition__isnull', True), ('action__isnull', False), ('feature_flag__isnull', True)), models.Q(('dashboard__isnull', True), ('insight__isnull', True), ('event_definition__isnull', True), ('property_definition__isnull', True), ('action__isnull', True), ('feature_flag__isnull', False)), _connector='OR'), name='exactly_one_related_object'),
        ),
        migrations.CreateModel(
            name='DashboardTemplate',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('template_name', models.CharField(max_length=400, null=True)),
                ('dashboard_description', models.CharField(max_length=400, null=True)),
                ('dashboard_filters', models.JSONField(null=True)),
                ('tiles', models.JSONField(default=list)),
                ('tags', django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), default=list, size=None)),
                ('github_url', models.CharField(max_length=8201, null=True)),
                ('team', models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='dashboardtemplate',
            constraint=models.UniqueConstraint(fields=('template_name', 'team'), name='unique_template_name_per_team'),
        ),
        migrations.CreateModel(
            name='PersonOverride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('old_person_id', models.UUIDField(db_index=True)),
                ('override_person_id', models.UUIDField(db_index=True)),
                ('oldest_event', models.DateTimeField()),
                ('version', models.BigIntegerField(blank=True, null=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='personoverride',
            constraint=models.UniqueConstraint(fields=('team', 'old_person_id'), name='unique override per old_person_id'),
        ),
        migrations.AddField(
            model_name='propertydefinition',
            name='group_type_index',
            field=models.PositiveSmallIntegerField(null=True),
        ),
        migrations.RunSQL(
            sql='ALTER TABLE "posthog_propertydefinition" ADD COLUMN "type" smallint DEFAULT 1 NOT NULL CHECK ("type" >= 0) -- not-null-ignore',
            reverse_sql='ALTER TABLE "posthog_propertydefinition" DROP COLUMN "type"',
            state_operations=[migrations.AddField(
                model_name='propertydefinition',
                name='type',
                field=models.PositiveSmallIntegerField(choices=[(1, 'event'), (2, 'person'), (3, 'group')], default=1),
            )],
        ),
        migrations.AddConstraint(
            model_name='propertydefinition',
            constraint=models.CheckConstraint(check=models.Q(models.Q(('type', 3), _negated=True), ('group_type_index__isnull', False), _connector='OR'), name='group_type_index_set'),
        ),
        migrations.AddConstraint(
            model_name='propertydefinition',
            constraint=posthog.models.utils.UniqueConstraintByExpression(concurrently=True, expression='(team_id, name, type, coalesce(group_type_index, -1))', name='posthog_propertydefinition_uniq'),
        ),
        migrations.AlterUniqueTogether(
            name='propertydefinition',
            unique_together=set(),
        ),
        migrations.AlterField(
            model_name='plugin',
            name='error',
            field=models.JSONField(blank=True, default=None, null=True),
        ),
        migrations.AlterField(
            model_name='plugin',
            name='metrics',
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AlterField(
            model_name='plugin',
            name='public_jobs',
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AlterField(
            model_name='plugin',
            name='config_schema',
            field=models.JSONField(blank=True, default=dict),
        ),
        migrations.AlterField(
            model_name='team',
            name='event_names',
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name='team',
            name='event_names_with_usage',
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name='team',
            name='event_properties',
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name='team',
            name='event_properties_numerical',
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name='team',
            name='event_properties_with_usage',
            field=models.JSONField(blank=True, default=list),
        ),
        migrations.AlterField(
            model_name='team',
            name='primary_dashboard',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='primary_dashboard_teams', to='posthog.dashboard'),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name='propertydefinition',
            index=models.Index(models.F('team_id'), models.F('type'), django.db.models.functions.comparison.Coalesce(models.F('group_type_index'), -1), models.OrderBy(models.F('query_usage_30_day'), descending=True, nulls_last=True), models.OrderBy(models.F('name')), name='index_property_def_query'),
        ),
        migrations.AddField(
            model_name='insight',
            name='query',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.RunSQL(
            sql='\n            UPDATE posthog_dashboardtemplate\n            SET team_id = NULL\n            WHERE team_id IS NOT NULL\n            -- not-null-ignore\n            ',
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql='\nCREATE OR REPLACE FUNCTION is_override_person_not_used_as_old_person(team_id bigint, override_person_id uuid, old_person_id uuid)\nRETURNS BOOLEAN AS $$\n  SELECT NOT EXISTS (\n    SELECT 1\n      FROM "posthog_personoverride"\n      WHERE team_id = $1\n      AND override_person_id = $3\n    ) AND NOT EXISTS (\n        SELECT 1\n      FROM "posthog_personoverride"\n      WHERE team_id = $1\n      AND old_person_id = $2\n    );\n$$ LANGUAGE SQL;\n',
            reverse_sql='DROP FUNCTION is_override_person_not_used_as_old_person',
        ),
        migrations.AddConstraint(
            model_name='personoverride',
            constraint=models.CheckConstraint(check=models.Q(('old_person_id__exact', models.F('override_person_id')), _negated=True), name='old_person_id_different_from_override_person_id'),
        ),
        migrations.AddConstraint(
            model_name='personoverride',
            constraint=models.CheckConstraint(check=models.Q(models.Func(models.F('team_id'), models.F('override_person_id'), models.F('old_person_id'), function='is_override_person_not_used_as_old_person', output_field=models.BooleanField())), name='old_person_id_is_not_override_person_id'),
        ),
        migrations.AddField(
            model_name='organization',
            name='enforce_2fa',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='user',
            name='is_email_verified',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='user',
            name='pending_email',
            field=models.EmailField(blank=True, max_length=254, null=True, verbose_name='pending email address awaiting verification'),
        ),
        migrations.AddField(
            model_name='team',
            name='session_recording_version',
            field=models.CharField(blank=True, max_length=24, null=True),
        ),
        migrations.AddField(
            model_name='dashboardtemplate',
            name='created_at',
            field=models.DateTimeField(auto_now_add=True, null=True),
        ),
        migrations.AddField(
            model_name='dashboardtemplate',
            name='created_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='dashboardtemplate',
            name='deleted',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='dashboardtemplate',
            name='image_url',
            field=models.CharField(blank=True, max_length=8201, null=True),
        ),
        migrations.AddField(
            model_name='dashboardtemplate',
            name='variables',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='dashboardtemplate',
            name='dashboard_description',
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
        migrations.AlterField(
            model_name='dashboardtemplate',
            name='dashboard_filters',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='dashboardtemplate',
            name='tags',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=255), blank=True, null=True, size=None),
        ),
        migrations.AlterField(
            model_name='dashboardtemplate',
            name='template_name',
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
        migrations.AlterField(
            model_name='dashboardtemplate',
            name='tiles',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='featureflag',
            name='usage_dashboard',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.dashboard'),
        ),
        migrations.AlterField(
            model_name='pluginconfig',
            name='error',
            field=models.JSONField(blank=True, default=None, null=True),
        ),
        migrations.CreateModel(
            name='PersonOverrideMapping',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField()),
                ('team_id', models.BigIntegerField()),
            ],
        ),
        migrations.RemoveConstraint(
            model_name='personoverride',
            name='unique override per old_person_id',
        ),
        migrations.RemoveConstraint(
            model_name='personoverride',
            name='old_person_id_is_not_override_person_id',
        ),
        migrations.RemoveConstraint(
            model_name='personoverride',
            name='old_person_id_different_from_override_person_id',
        ),
        migrations.RunSQL(
            sql='DROP FUNCTION is_override_person_not_used_as_old_person',
            reverse_sql='\nCREATE OR REPLACE FUNCTION is_override_person_not_used_as_old_person(team_id bigint, override_person_id uuid, old_person_id uuid)\nRETURNS BOOLEAN AS $$\n  SELECT false;\n$$ LANGUAGE SQL;\n',
        ),
        migrations.RemoveField(
            model_name='personoverride',
            name='old_person_id',
        ),
        migrations.AddField(
            model_name='personoverride',
            name='old_person_id',
            field=models.ForeignKey(db_column='old_person_id', on_delete=django.db.models.deletion.CASCADE, related_name='person_override_old', to='posthog.personoverridemapping'),
        ),
        migrations.RemoveField(
            model_name='personoverride',
            name='override_person_id',
        ),
        migrations.AddField(
            model_name='personoverride',
            name='override_person_id',
            field=models.ForeignKey(db_column='override_person_id', on_delete=django.db.models.deletion.CASCADE, related_name='person_override_override', to='posthog.personoverridemapping'),
        ),
        migrations.AddConstraint(
            model_name='personoverride',
            constraint=models.UniqueConstraint(fields=('team', 'old_person_id'), name='unique override per old_person_id'),
        ),
        migrations.AddConstraint(
            model_name='personoverride',
            constraint=models.CheckConstraint(check=models.Q(('old_person_id__exact', models.F('override_person_id')), _negated=True), name='old_person_id_different_from_override_person_id'),
        ),
        migrations.RunSQL(
            sql='CREATE EXTENSION IF NOT EXISTS btree_gist',
            reverse_sql='DROP EXTENSION btree_gist',
        ),
        migrations.RunSQL(
            sql='CREATE EXTENSION IF NOT EXISTS intarray',
            reverse_sql='DROP EXTENSION intarray',
        ),
        migrations.RunSQL(
            sql='\n            ALTER TABLE posthog_personoverride\n            ADD CONSTRAINT exclude_override_person_id_from_being_old_person_id\n            EXCLUDE USING gist((array[old_person_id, override_person_id]) WITH &&, override_person_id WITH <>)\n            DEFERRABLE\n            INITIALLY DEFERRED\n            ',
            reverse_sql='ALTER TABLE posthog_personoverride DROP CONSTRAINT exclude_override_person_id_from_being_old_person_id',
        ),
        migrations.AddConstraint(
            model_name='personoverridemapping',
            constraint=models.UniqueConstraint(fields=('team_id', 'uuid'), name='unique_uuid'),
        ),
        migrations.AddField(
            model_name='team',
            name='autocapture_opt_out',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.RunPython(
            code=posthog.helpers.migration_seeds.create_starter_dashboard_template,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.AddField(
            model_name='dashboardtemplate',
            name='scope',
            field=models.CharField(blank=True, choices=[('team', 'Only team'), ('global', 'Global')], max_length=24, null=True),
        ),
        migrations.RunSQL(
            sql="\n                UPDATE posthog_dashboardtemplate SET scope = 'global' WHERE team_id IS NULL -- not-null-ignore\n            ",
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql="\n                UPDATE posthog_dashboardtemplate SET scope = 'team' WHERE team_id IS NOT NULL -- not-null-ignore\n            ",
            reverse_sql='',
        ),
        migrations.AddField(
            model_name='organization',
            name='available_product_features',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.JSONField(), blank=True, null=True, size=None),
        ),
        migrations.AddField(
            model_name='sharingconfiguration',
            name='recording',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='sharing_configurations', to='posthog.sessionrecording', to_field='session_id'),
        ),
        migrations.CreateModel(
            name='Notebook',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('short_id', models.CharField(blank=True, default=posthog.utils.generate_short_id, max_length=12)),
                ('title', models.CharField(blank=True, max_length=256, null=True)),
                ('content', models.JSONField(blank=True, default=None, null=True)),
                ('deleted', models.BooleanField(default=False)),
                ('version', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('last_modified_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('last_modified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='modified_notebooks', to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'unique_together': {('team', 'short_id')},
            },
        ),
        migrations.AddField(
            model_name='actionstep',
            name='href_matching',
            field=models.CharField(blank=True, choices=[('contains', 'contains'), ('regex', 'regex'), ('exact', 'exact')], max_length=400, null=True),
        ),
        migrations.AddField(
            model_name='actionstep',
            name='text_matching',
            field=models.CharField(blank=True, choices=[('contains', 'contains'), ('regex', 'regex'), ('exact', 'exact')], max_length=400, null=True),
        ),
        migrations.CreateModel(
            name='BatchExportDestination',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('type', models.CharField(choices=[('S3', 'S3')], help_text='A choice of supported BatchExportDestination types.', max_length=64)),
                ('config', models.JSONField(blank=True, default=dict, help_text='A JSON field to store all configuration parameters required to access a BatchExportDestination.')),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='The timestamp at which this BatchExportDestination was created.')),
                ('last_updated_at', models.DateTimeField(auto_now=True, help_text='The timestamp at which this BatchExportDestination was last updated.')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='BatchExport',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('team', models.ForeignKey(help_text='The team this belongs to.', on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('name', models.TextField(help_text='A human-readable name for this BatchExport.')),
                ('destination', models.ForeignKey(help_text='The destination to export data to.', on_delete=django.db.models.deletion.CASCADE, to='posthog.batchexportdestination')),
                ('interval', models.CharField(choices=[('hour', 'hour'), ('day', 'day'), ('week', 'week')], default='hour', help_text='The interval at which to export data.', max_length=64)),
                ('paused', models.BooleanField(default=False, help_text='Whether this BatchExport is paused or not.')),
                ('deleted', models.BooleanField(default=False, help_text='Whether this BatchExport is deleted or not.')),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='The timestamp at which this BatchExport was created.')),
                ('last_updated_at', models.DateTimeField(auto_now=True, help_text='The timestamp at which this BatchExport was last updated.')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='BatchExportRun',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('Cancelled', 'Cancelled'), ('Completed', 'Completed'), ('ContinuedAsNew', 'Continuedasnew'), ('Failed', 'Failed'), ('Terminated', 'Terminated'), ('TimedOut', 'Timedout'), ('Running', 'Running'), ('Starting', 'Starting')], help_text='The status of this run.', max_length=64)),
                ('records_completed', models.IntegerField(help_text='The number of records that have been exported.', null=True)),
                ('latest_error', models.TextField(help_text='The latest error that occurred during this run.', null=True)),
                ('data_interval_start', models.DateTimeField(help_text='The start of the data interval.')),
                ('data_interval_end', models.DateTimeField(help_text='The end of the data interval.')),
                ('cursor', models.TextField(help_text='An opaque cursor that may be used to resume.', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='The timestamp at which this BatchExportRun was created.')),
                ('finished_at', models.DateTimeField(help_text='The timestamp at which this BatchExportRun finished, successfully or not.', null=True)),
                ('last_updated_at', models.DateTimeField(auto_now=True, help_text='The timestamp at which this BatchExportRun was last updated.')),
                ('batch_export', models.ForeignKey(help_text='The BatchExport this run belongs to.', on_delete=django.db.models.deletion.CASCADE, to='posthog.batchexport')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='EarlyAccessFeature',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('stage', models.CharField(choices=[('draft', 'draft'), ('concept', 'concept'), ('alpha', 'alpha'), ('beta', 'beta'), ('general-availability', 'general availability')], max_length=40)),
                ('documentation_url', models.URLField(blank=True, max_length=800)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('feature_flag', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='features', related_query_name='feature', to='posthog.featureflag')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='features', related_query_name='feature', to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='user',
            name='requested_password_reset_at',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name='Survey',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=400)),
                ('description', models.TextField(blank=True)),
                ('type', models.CharField(choices=[('popover', 'popover'), ('button', 'button'), ('email', 'email'), ('full_screen', 'full screen')], max_length=40)),
                ('conditions', models.JSONField(blank=True, null=True)),
                ('questions', models.JSONField(blank=True, null=True)),
                ('appearance', models.JSONField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('start_date', models.DateTimeField(null=True)),
                ('end_date', models.DateTimeField(null=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('archived', models.BooleanField(default=False)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys', related_query_name='survey', to=settings.AUTH_USER_MODEL)),
                ('linked_flag', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_linked_flag', related_query_name='survey', to='posthog.featureflag')),
                ('targeting_flag', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_targeting_flag', related_query_name='survey', to='posthog.featureflag')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='surveys', related_query_name='survey', to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='survey',
            constraint=models.UniqueConstraint(fields=('team', 'name'), name='unique survey name for team'),
        ),
        migrations.AddField(
            model_name='team',
            name='autocapture_exceptions_opt_in',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name='FeatureFlagDashboards',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, null=True)),
                ('updated_at', models.DateTimeField(auto_now=True, null=True)),
                ('dashboard', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.dashboard')),
                ('feature_flag', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.featureflag')),
            ],
        ),
        migrations.AddField(
            model_name='featureflag',
            name='analytics_dashboards',
            field=models.ManyToManyField(related_name='analytics_dashboards', related_query_name='analytics_dashboard', through='posthog.FeatureFlagDashboards', to='posthog.dashboard'),
        ),
        migrations.AddConstraint(
            model_name='featureflagdashboards',
            constraint=models.UniqueConstraint(fields=('feature_flag', 'dashboard'), name='unique feature flag for a dashboard'),
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.AddField(
            model_name='user',
            name='has_seen_product_intro_for',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='dashboardtemplate',
            name='scope',
            field=models.CharField(blank=True, choices=[('team', 'Only team'), ('global', 'Global'), ('feature_flag', 'Feature Flag')], max_length=24, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='extra_settings',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='earlyaccessfeature',
            name='stage',
            field=models.CharField(choices=[('draft', 'draft'), ('concept', 'concept'), ('alpha', 'alpha'), ('beta', 'beta'), ('general-availability', 'general availability'), ('archived', 'archived')], max_length=40),
        ),
        migrations.RunPython(
            code=posthog.helpers.migration_seeds.create_starter_feature_flag_template,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.CreateModel(
            name='DataWarehouseCredential',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('access_key', posthog.helpers.encrypted_fields.EncryptedTextField(max_length=500)),
                ('access_secret', posthog.helpers.encrypted_fields.EncryptedTextField(max_length=500)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='DataWarehouseTable',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('deleted', models.BooleanField(blank=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=128)),
                ('format', models.CharField(choices=[('CSV', 'CSV'), ('Parquet', 'Parquet')], max_length=128)),
                ('url_pattern', models.CharField(max_length=500)),
                ('columns', models.JSONField(blank=True, default=dict, help_text='Dict of all columns with Clickhouse type (including Nullable())', null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('credential', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.datawarehousecredential')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='team',
            name='autocapture_exceptions_errors_to_ignore',
            field=models.JSONField(blank=True, null=True),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name='propertydefinition',
            index=models.Index(fields=['team_id', 'type', 'is_numerical'], name='posthog_pro_team_id_eac36d_idx'),
        ),
        migrations.AddField(
            model_name='featureflag',
            name='has_enriched_analytics',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.AddField(
            model_name='batchexport',
            name='end_at',
            field=models.DateTimeField(default=None, help_text="Time after which any Batch Export runs won't be triggered.", null=True),
        ),
        migrations.AddField(
            model_name='batchexport',
            name='last_paused_at',
            field=models.DateTimeField(default=None, help_text='The timestamp at which this BatchExport was last paused.', null=True),
        ),
        migrations.AddField(
            model_name='batchexport',
            name='start_at',
            field=models.DateTimeField(default=None, help_text="Time before which any Batch Export runs won't be triggered.", null=True),
        ),
        migrations.AddField(
            model_name='exportedasset',
            name='expires_after',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='asyncdeletion',
            name='deletion_type',
            field=models.PositiveSmallIntegerField(choices=[(0, 'Team'), (1, 'Person'), (2, 'Group'), (3, 'Cohort Stale'), (4, 'Cohort Full')]),
        ),
        migrations.AlterField(
            model_name='survey',
            name='type',
            field=models.CharField(choices=[('popover', 'popover'), ('button', 'button'), ('email', 'email'), ('full_screen', 'full screen'), ('api', 'api')], max_length=40),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='active_seconds',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='console_error_count',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='console_log_count',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='console_warn_count',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='inactive_seconds',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='mouse_activity_count',
            field=models.IntegerField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name='DataWarehouseSavedQuery',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('deleted', models.BooleanField(blank=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=128, validators=[products.data_warehouse.backend.models.datawarehouse_saved_query.validate_saved_query_name])),
                ('columns', models.JSONField(blank=True, default=dict, help_text='Dict of all columns with ClickHouse type (including Nullable())', null=True)),
                ('query', models.JSONField(blank=True, default=dict, help_text='HogQL query', null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='datawarehousesavedquery',
            constraint=models.UniqueConstraint(fields=('team', 'name'), name='posthog_datawarehouse_saved_query_unique_name'),
        ),
        migrations.CreateModel(
            name='UserScenePersonalisation',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('scene', models.CharField(max_length=200)),
                ('dashboard', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.dashboard')),
                ('team', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='scene_personalisation', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddConstraint(
            model_name='userscenepersonalisation',
            constraint=models.UniqueConstraint(fields=('team', 'user', 'scene'), name='posthog_unique_scene_personalisation'),
        ),
        migrations.AddField(
            model_name='action',
            name='bytecode',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='action',
            name='bytecode_error',
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='sessionrecording',
            name='storage_version',
            field=models.CharField(blank=True, max_length=20, null=True),
        ),
        migrations.AlterField(
            model_name='featureflag',
            name='usage_dashboard',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.dashboard'),
        ),
        migrations.AddField(
            model_name='team',
            name='has_completed_onboarding_for',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.AddField(
            model_name='datawarehousesavedquery',
            name='external_tables',
            field=models.JSONField(blank=True, default=list, help_text='List of all external tables', null=True),
        ),
        migrations.CreateModel(
            name='DataWarehouseViewLink',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('deleted', models.BooleanField(blank=True, null=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('table', models.CharField(max_length=128)),
                ('from_join_key', models.CharField(max_length=400)),
                ('to_join_key', models.CharField(max_length=400)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('saved_query', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.datawarehousesavedquery')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='team',
            name='week_start_day',
            field=models.SmallIntegerField(blank=True, choices=[(0, 'Sunday'), (1, 'Monday')], null=True),
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres'), ('BigQuery', 'Bigquery')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.AlterField(
            model_name='datawarehousetable',
            name='format',
            field=models.CharField(choices=[('CSV', 'CSV'), ('Parquet', 'Parquet'), ('JSONEachRow', 'JSON')], max_length=128),
        ),
        migrations.AlterField(
            model_name='survey',
            name='linked_flag',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_linked_flag', related_query_name='survey_linked_flag', to='posthog.featureflag'),
        ),
        migrations.AlterField(
            model_name='survey',
            name='targeting_flag',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_targeting_flag', related_query_name='survey_targeting_flag', to='posthog.featureflag'),
        ),
        migrations.AddField(
            model_name='notebook',
            name='text_content',
            field=models.TextField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='surveys_opt_in',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='messagingrecord',
            name='campaign_count',
            field=models.IntegerField(null=True),
        ),
        migrations.RunSQL(
            sql='\n            CREATE UNIQUE INDEX CONCURRENTLY idx_messagingrecord_unique_on_email_hash_campaign_key_campaign_count\n            ON posthog_messagingrecord (email_hash, campaign_key, campaign_count);\n            ',
            reverse_sql='\n            DROP INDEX CONCURRENTLY "idx_messagingrecord_unique_on_email_hash_campaign_key_campaign_count";\n            ',
        ),
        migrations.AlterField(
            model_name='batchexport',
            name='interval',
            field=models.CharField(choices=[('hour', 'hour'), ('day', 'day'), ('week', 'week'), ('every 5 minutes', 'every 5 minutes')], default='hour', help_text='The interval at which to export data.', max_length=64),
        ),
        migrations.AddField(
            model_name='organization',
            name='never_drop_data',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres'), ('BigQuery', 'Bigquery'), ('NoOp', 'Noop')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.CreateModel(
            name='BatchExportBackfill',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('start_at', models.DateTimeField(help_text='The start of the data interval.')),
                ('end_at', models.DateTimeField(help_text='The end of the data interval.')),
                ('status', models.CharField(choices=[('Cancelled', 'Cancelled'), ('Completed', 'Completed'), ('ContinuedAsNew', 'Continuedasnew'), ('Failed', 'Failed'), ('Terminated', 'Terminated'), ('TimedOut', 'Timedout'), ('Running', 'Running'), ('Starting', 'Starting')], help_text='The status of this backfill.', max_length=64)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='The timestamp at which this BatchExportBackfill was created.')),
                ('finished_at', models.DateTimeField(help_text='The timestamp at which this BatchExportBackfill finished, successfully or not.', null=True)),
                ('last_updated_at', models.DateTimeField(auto_now=True, help_text='The timestamp at which this BatchExportBackfill was last updated.')),
                ('batch_export', models.ForeignKey(help_text='The BatchExport this backfill belongs to.', on_delete=django.db.models.deletion.CASCADE, to='posthog.batchexport')),
                ('team', models.ForeignKey(help_text='The team this belongs to.', on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='team',
            name='session_recording_linked_flag',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='session_recording_minimum_duration_milliseconds',
            field=models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(15000)]),
        ),
        migrations.AddField(
            model_name='team',
            name='session_recording_sample_rate',
            field=models.DecimalField(blank=True, decimal_places=2, max_digits=3, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0')), django.core.validators.MaxValueValidator(Decimal('1'))]),
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres'), ('Redshift', 'Redshift'), ('BigQuery', 'Bigquery'), ('NoOp', 'Noop')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.AddField(
            model_name='team',
            name='external_data_workspace_id',
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
        migrations.CreateModel(
            name='ExternalDataSource',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('source_id', models.CharField(max_length=400)),
                ('connection_id', models.CharField(max_length=400)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('status', models.CharField(max_length=400)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('source_type', models.CharField(choices=[('Stripe', 'Stripe')], max_length=128)),
                ('are_tables_created', models.BooleanField(default=False)),
                ('destination_id', models.CharField(blank=True, max_length=400, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='pluginconfig',
            name='deleted',
            field=models.BooleanField(default=False, null=True),
        ),
        migrations.AddField(
            model_name='pluginconfig',
            name='description',
            field=models.CharField(blank=True, max_length=1000, null=True),
        ),
        migrations.AddField(
            model_name='pluginconfig',
            name='name',
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
        migrations.AlterField(
            model_name='experiment',
            name='feature_flag',
            field=models.ForeignKey(on_delete=django.db.models.deletion.RESTRICT, to='posthog.featureflag'),
        ),
        migrations.AddField(
            model_name='team',
            name='session_recording_network_payload_capture_config',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='team',
            name='external_data_workspace_last_synced_at',
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    SET CONSTRAINTS "posthog_experiment_created_by_id_b40aea95_fk_posthog_user_id" IMMEDIATE; -- existing-table-constraint-ignore\n                    ALTER TABLE "posthog_experiment" DROP CONSTRAINT "posthog_experiment_created_by_id_b40aea95_fk_posthog_user_id"; -- existing-table-constraint-ignore\n                    ALTER TABLE "posthog_experiment" ALTER COLUMN "created_by_id" DROP NOT NULL;\n                    ALTER TABLE "posthog_experiment" ADD CONSTRAINT "posthog_experiment_created_by_id_b40aea95_fk_posthog_user_id" FOREIGN KEY ("created_by_id") REFERENCES "posthog_user" ("id") DEFERRABLE INITIALLY DEFERRED NOT VALID; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        SET CONSTRAINTS "posthog_experiment_created_by_id_b40aea95_fk_posthog_user_id" IMMEDIATE;\n                        ALTER TABLE "posthog_experiment" DROP CONSTRAINT "posthog_experiment_created_by_id_b40aea95_fk_posthog_user_id";\n                        ALTER TABLE "posthog_experiment" ALTER COLUMN "created_by_id" SET NOT NULL;\n                        ALTER TABLE "posthog_experiment" ADD CONSTRAINT "posthog_experiment_created_by_id_b40aea95_fk_posthog_user_id" FOREIGN KEY ("created_by_id") REFERENCES "posthog_user" ("id") DEFERRABLE INITIALLY DEFERRED NOT VALID;\n                    ',
                ),
                migrations.RunSQL(
                    sql='SET CONSTRAINTS "posthog_featureflag_created_by_id_4571fe1a_fk_posthog_user_id" IMMEDIATE; -- existing-table-constraint-ignore\n                    ALTER TABLE "posthog_featureflag" DROP CONSTRAINT "posthog_featureflag_created_by_id_4571fe1a_fk_posthog_user_id"; -- existing-table-constraint-ignore\n                    ALTER TABLE "posthog_featureflag" ALTER COLUMN "created_by_id" DROP NOT NULL;\n                    ALTER TABLE "posthog_featureflag" ADD CONSTRAINT "posthog_featureflag_created_by_id_4571fe1a_fk_posthog_user_id" FOREIGN KEY ("created_by_id") REFERENCES "posthog_user" ("id") DEFERRABLE INITIALLY DEFERRED NOT VALID; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        SET CONSTRAINTS "posthog_featureflag_created_by_id_4571fe1a_fk_posthog_user_id" IMMEDIATE;\n                        ALTER TABLE "posthog_featureflag" DROP CONSTRAINT "posthog_featureflag_created_by_id_4571fe1a_fk_posthog_user_id";\n                        ALTER TABLE "posthog_featureflag" ALTER COLUMN "created_by_id" SET NOT NULL;\n                        ALTER TABLE "posthog_featureflag" ADD CONSTRAINT "posthog_featureflag_created_by_id_4571fe1a_fk_posthog_user_id" FOREIGN KEY ("created_by_id") REFERENCES "posthog_user" ("id") DEFERRABLE INITIALLY DEFERRED NOT VALID;\n                        -- existing-table-constraint-ignore\n                    ',
                ),
            ],
            state_operations=[
                migrations.AlterField(
                    model_name='experiment',
                    name='created_by',
                    field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
                ),
                migrations.AlterField(
                    model_name='featureflag',
                    name='created_by',
                    field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='action',
            name='created_by',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL),
        ),
        migrations.AddField(
            model_name='externaldatasource',
            name='job_inputs',
            field=posthog.helpers.encrypted_fields.EncryptedJSONField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='datawarehousetable',
            name='external_data_source',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.externaldatasource'),
        ),
        migrations.AlterField(
            model_name='team',
            name='timezone',
            field=models.CharField(choices=[('Africa/Abidjan', 'Africa/Abidjan'), ('Africa/Accra', 'Africa/Accra'), ('Africa/Addis_Ababa', 'Africa/Addis_Ababa'), ('Africa/Algiers', 'Africa/Algiers'), ('Africa/Asmara', 'Africa/Asmara'), ('Africa/Asmera', 'Africa/Asmera'), ('Africa/Bamako', 'Africa/Bamako'), ('Africa/Bangui', 'Africa/Bangui'), ('Africa/Banjul', 'Africa/Banjul'), ('Africa/Bissau', 'Africa/Bissau'), ('Africa/Blantyre', 'Africa/Blantyre'), ('Africa/Brazzaville', 'Africa/Brazzaville'), ('Africa/Bujumbura', 'Africa/Bujumbura'), ('Africa/Cairo', 'Africa/Cairo'), ('Africa/Casablanca', 'Africa/Casablanca'), ('Africa/Ceuta', 'Africa/Ceuta'), ('Africa/Conakry', 'Africa/Conakry'), ('Africa/Dakar', 'Africa/Dakar'), ('Africa/Dar_es_Salaam', 'Africa/Dar_es_Salaam'), ('Africa/Djibouti', 'Africa/Djibouti'), ('Africa/Douala', 'Africa/Douala'), ('Africa/El_Aaiun', 'Africa/El_Aaiun'), ('Africa/Freetown', 'Africa/Freetown'), ('Africa/Gaborone', 'Africa/Gaborone'), ('Africa/Harare', 'Africa/Harare'), ('Africa/Johannesburg', 'Africa/Johannesburg'), ('Africa/Juba', 'Africa/Juba'), ('Africa/Kampala', 'Africa/Kampala'), ('Africa/Khartoum', 'Africa/Khartoum'), ('Africa/Kigali', 'Africa/Kigali'), ('Africa/Kinshasa', 'Africa/Kinshasa'), ('Africa/Lagos', 'Africa/Lagos'), ('Africa/Libreville', 'Africa/Libreville'), ('Africa/Lome', 'Africa/Lome'), ('Africa/Luanda', 'Africa/Luanda'), ('Africa/Lubumbashi', 'Africa/Lubumbashi'), ('Africa/Lusaka', 'Africa/Lusaka'), ('Africa/Malabo', 'Africa/Malabo'), ('Africa/Maputo', 'Africa/Maputo'), ('Africa/Maseru', 'Africa/Maseru'), ('Africa/Mbabane', 'Africa/Mbabane'), ('Africa/Mogadishu', 'Africa/Mogadishu'), ('Africa/Monrovia', 'Africa/Monrovia'), ('Africa/Nairobi', 'Africa/Nairobi'), ('Africa/Ndjamena', 'Africa/Ndjamena'), ('Africa/Niamey', 'Africa/Niamey'), ('Africa/Nouakchott', 'Africa/Nouakchott'), ('Africa/Ouagadougou', 'Africa/Ouagadougou'), ('Africa/Porto-Novo', 'Africa/Porto-Novo'), ('Africa/Sao_Tome', 'Africa/Sao_Tome'), ('Africa/Timbuktu', 'Africa/Timbuktu'), ('Africa/Tripoli', 'Africa/Tripoli'), ('Africa/Tunis', 'Africa/Tunis'), ('Africa/Windhoek', 'Africa/Windhoek'), ('America/Adak', 'America/Adak'), ('America/Anchorage', 'America/Anchorage'), ('America/Anguilla', 'America/Anguilla'), ('America/Antigua', 'America/Antigua'), ('America/Araguaina', 'America/Araguaina'), ('America/Argentina/Buenos_Aires', 'America/Argentina/Buenos_Aires'), ('America/Argentina/Catamarca', 'America/Argentina/Catamarca'), ('America/Argentina/ComodRivadavia', 'America/Argentina/ComodRivadavia'), ('America/Argentina/Cordoba', 'America/Argentina/Cordoba'), ('America/Argentina/Jujuy', 'America/Argentina/Jujuy'), ('America/Argentina/La_Rioja', 'America/Argentina/La_Rioja'), ('America/Argentina/Mendoza', 'America/Argentina/Mendoza'), ('America/Argentina/Rio_Gallegos', 'America/Argentina/Rio_Gallegos'), ('America/Argentina/Salta', 'America/Argentina/Salta'), ('America/Argentina/San_Juan', 'America/Argentina/San_Juan'), ('America/Argentina/San_Luis', 'America/Argentina/San_Luis'), ('America/Argentina/Tucuman', 'America/Argentina/Tucuman'), ('America/Argentina/Ushuaia', 'America/Argentina/Ushuaia'), ('America/Aruba', 'America/Aruba'), ('America/Asuncion', 'America/Asuncion'), ('America/Atikokan', 'America/Atikokan'), ('America/Atka', 'America/Atka'), ('America/Bahia', 'America/Bahia'), ('America/Bahia_Banderas', 'America/Bahia_Banderas'), ('America/Barbados', 'America/Barbados'), ('America/Belem', 'America/Belem'), ('America/Belize', 'America/Belize'), ('America/Blanc-Sablon', 'America/Blanc-Sablon'), ('America/Boa_Vista', 'America/Boa_Vista'), ('America/Bogota', 'America/Bogota'), ('America/Boise', 'America/Boise'), ('America/Buenos_Aires', 'America/Buenos_Aires'), ('America/Cambridge_Bay', 'America/Cambridge_Bay'), ('America/Campo_Grande', 'America/Campo_Grande'), ('America/Cancun', 'America/Cancun'), ('America/Caracas', 'America/Caracas'), ('America/Catamarca', 'America/Catamarca'), ('America/Cayenne', 'America/Cayenne'), ('America/Cayman', 'America/Cayman'), ('America/Chicago', 'America/Chicago'), ('America/Chihuahua', 'America/Chihuahua'), ('America/Ciudad_Juarez', 'America/Ciudad_Juarez'), ('America/Coral_Harbour', 'America/Coral_Harbour'), ('America/Cordoba', 'America/Cordoba'), ('America/Costa_Rica', 'America/Costa_Rica'), ('America/Creston', 'America/Creston'), ('America/Cuiaba', 'America/Cuiaba'), ('America/Curacao', 'America/Curacao'), ('America/Danmarkshavn', 'America/Danmarkshavn'), ('America/Dawson', 'America/Dawson'), ('America/Dawson_Creek', 'America/Dawson_Creek'), ('America/Denver', 'America/Denver'), ('America/Detroit', 'America/Detroit'), ('America/Dominica', 'America/Dominica'), ('America/Edmonton', 'America/Edmonton'), ('America/Eirunepe', 'America/Eirunepe'), ('America/El_Salvador', 'America/El_Salvador'), ('America/Ensenada', 'America/Ensenada'), ('America/Fort_Nelson', 'America/Fort_Nelson'), ('America/Fort_Wayne', 'America/Fort_Wayne'), ('America/Fortaleza', 'America/Fortaleza'), ('America/Glace_Bay', 'America/Glace_Bay'), ('America/Godthab', 'America/Godthab'), ('America/Goose_Bay', 'America/Goose_Bay'), ('America/Grand_Turk', 'America/Grand_Turk'), ('America/Grenada', 'America/Grenada'), ('America/Guadeloupe', 'America/Guadeloupe'), ('America/Guatemala', 'America/Guatemala'), ('America/Guayaquil', 'America/Guayaquil'), ('America/Guyana', 'America/Guyana'), ('America/Halifax', 'America/Halifax'), ('America/Havana', 'America/Havana'), ('America/Hermosillo', 'America/Hermosillo'), ('America/Indiana/Indianapolis', 'America/Indiana/Indianapolis'), ('America/Indiana/Knox', 'America/Indiana/Knox'), ('America/Indiana/Marengo', 'America/Indiana/Marengo'), ('America/Indiana/Petersburg', 'America/Indiana/Petersburg'), ('America/Indiana/Tell_City', 'America/Indiana/Tell_City'), ('America/Indiana/Vevay', 'America/Indiana/Vevay'), ('America/Indiana/Vincennes', 'America/Indiana/Vincennes'), ('America/Indiana/Winamac', 'America/Indiana/Winamac'), ('America/Indianapolis', 'America/Indianapolis'), ('America/Inuvik', 'America/Inuvik'), ('America/Iqaluit', 'America/Iqaluit'), ('America/Jamaica', 'America/Jamaica'), ('America/Jujuy', 'America/Jujuy'), ('America/Juneau', 'America/Juneau'), ('America/Kentucky/Louisville', 'America/Kentucky/Louisville'), ('America/Kentucky/Monticello', 'America/Kentucky/Monticello'), ('America/Knox_IN', 'America/Knox_IN'), ('America/Kralendijk', 'America/Kralendijk'), ('America/La_Paz', 'America/La_Paz'), ('America/Lima', 'America/Lima'), ('America/Los_Angeles', 'America/Los_Angeles'), ('America/Louisville', 'America/Louisville'), ('America/Lower_Princes', 'America/Lower_Princes'), ('America/Maceio', 'America/Maceio'), ('America/Managua', 'America/Managua'), ('America/Manaus', 'America/Manaus'), ('America/Marigot', 'America/Marigot'), ('America/Martinique', 'America/Martinique'), ('America/Matamoros', 'America/Matamoros'), ('America/Mazatlan', 'America/Mazatlan'), ('America/Mendoza', 'America/Mendoza'), ('America/Menominee', 'America/Menominee'), ('America/Merida', 'America/Merida'), ('America/Metlakatla', 'America/Metlakatla'), ('America/Mexico_City', 'America/Mexico_City'), ('America/Miquelon', 'America/Miquelon'), ('America/Moncton', 'America/Moncton'), ('America/Monterrey', 'America/Monterrey'), ('America/Montevideo', 'America/Montevideo'), ('America/Montreal', 'America/Montreal'), ('America/Montserrat', 'America/Montserrat'), ('America/Nassau', 'America/Nassau'), ('America/New_York', 'America/New_York'), ('America/Nipigon', 'America/Nipigon'), ('America/Nome', 'America/Nome'), ('America/Noronha', 'America/Noronha'), ('America/North_Dakota/Beulah', 'America/North_Dakota/Beulah'), ('America/North_Dakota/Center', 'America/North_Dakota/Center'), ('America/North_Dakota/New_Salem', 'America/North_Dakota/New_Salem'), ('America/Nuuk', 'America/Nuuk'), ('America/Ojinaga', 'America/Ojinaga'), ('America/Panama', 'America/Panama'), ('America/Pangnirtung', 'America/Pangnirtung'), ('America/Paramaribo', 'America/Paramaribo'), ('America/Phoenix', 'America/Phoenix'), ('America/Port-au-Prince', 'America/Port-au-Prince'), ('America/Port_of_Spain', 'America/Port_of_Spain'), ('America/Porto_Acre', 'America/Porto_Acre'), ('America/Porto_Velho', 'America/Porto_Velho'), ('America/Puerto_Rico', 'America/Puerto_Rico'), ('America/Punta_Arenas', 'America/Punta_Arenas'), ('America/Rainy_River', 'America/Rainy_River'), ('America/Rankin_Inlet', 'America/Rankin_Inlet'), ('America/Recife', 'America/Recife'), ('America/Regina', 'America/Regina'), ('America/Resolute', 'America/Resolute'), ('America/Rio_Branco', 'America/Rio_Branco'), ('America/Rosario', 'America/Rosario'), ('America/Santa_Isabel', 'America/Santa_Isabel'), ('America/Santarem', 'America/Santarem'), ('America/Santiago', 'America/Santiago'), ('America/Santo_Domingo', 'America/Santo_Domingo'), ('America/Sao_Paulo', 'America/Sao_Paulo'), ('America/Scoresbysund', 'America/Scoresbysund'), ('America/Shiprock', 'America/Shiprock'), ('America/Sitka', 'America/Sitka'), ('America/St_Barthelemy', 'America/St_Barthelemy'), ('America/St_Johns', 'America/St_Johns'), ('America/St_Kitts', 'America/St_Kitts'), ('America/St_Lucia', 'America/St_Lucia'), ('America/St_Thomas', 'America/St_Thomas'), ('America/St_Vincent', 'America/St_Vincent'), ('America/Swift_Current', 'America/Swift_Current'), ('America/Tegucigalpa', 'America/Tegucigalpa'), ('America/Thule', 'America/Thule'), ('America/Thunder_Bay', 'America/Thunder_Bay'), ('America/Tijuana', 'America/Tijuana'), ('America/Toronto', 'America/Toronto'), ('America/Tortola', 'America/Tortola'), ('America/Vancouver', 'America/Vancouver'), ('America/Virgin', 'America/Virgin'), ('America/Whitehorse', 'America/Whitehorse'), ('America/Winnipeg', 'America/Winnipeg'), ('America/Yakutat', 'America/Yakutat'), ('America/Yellowknife', 'America/Yellowknife'), ('Antarctica/Casey', 'Antarctica/Casey'), ('Antarctica/Davis', 'Antarctica/Davis'), ('Antarctica/DumontDUrville', 'Antarctica/DumontDUrville'), ('Antarctica/Macquarie', 'Antarctica/Macquarie'), ('Antarctica/Mawson', 'Antarctica/Mawson'), ('Antarctica/McMurdo', 'Antarctica/McMurdo'), ('Antarctica/Palmer', 'Antarctica/Palmer'), ('Antarctica/Rothera', 'Antarctica/Rothera'), ('Antarctica/South_Pole', 'Antarctica/South_Pole'), ('Antarctica/Syowa', 'Antarctica/Syowa'), ('Antarctica/Troll', 'Antarctica/Troll'), ('Antarctica/Vostok', 'Antarctica/Vostok'), ('Arctic/Longyearbyen', 'Arctic/Longyearbyen'), ('Asia/Aden', 'Asia/Aden'), ('Asia/Almaty', 'Asia/Almaty'), ('Asia/Amman', 'Asia/Amman'), ('Asia/Anadyr', 'Asia/Anadyr'), ('Asia/Aqtau', 'Asia/Aqtau'), ('Asia/Aqtobe', 'Asia/Aqtobe'), ('Asia/Ashgabat', 'Asia/Ashgabat'), ('Asia/Ashkhabad', 'Asia/Ashkhabad'), ('Asia/Atyrau', 'Asia/Atyrau'), ('Asia/Baghdad', 'Asia/Baghdad'), ('Asia/Bahrain', 'Asia/Bahrain'), ('Asia/Baku', 'Asia/Baku'), ('Asia/Bangkok', 'Asia/Bangkok'), ('Asia/Barnaul', 'Asia/Barnaul'), ('Asia/Beirut', 'Asia/Beirut'), ('Asia/Bishkek', 'Asia/Bishkek'), ('Asia/Brunei', 'Asia/Brunei'), ('Asia/Calcutta', 'Asia/Calcutta'), ('Asia/Chita', 'Asia/Chita'), ('Asia/Choibalsan', 'Asia/Choibalsan'), ('Asia/Chongqing', 'Asia/Chongqing'), ('Asia/Chungking', 'Asia/Chungking'), ('Asia/Colombo', 'Asia/Colombo'), ('Asia/Dacca', 'Asia/Dacca'), ('Asia/Damascus', 'Asia/Damascus'), ('Asia/Dhaka', 'Asia/Dhaka'), ('Asia/Dili', 'Asia/Dili'), ('Asia/Dubai', 'Asia/Dubai'), ('Asia/Dushanbe', 'Asia/Dushanbe'), ('Asia/Famagusta', 'Asia/Famagusta'), ('Asia/Gaza', 'Asia/Gaza'), ('Asia/Harbin', 'Asia/Harbin'), ('Asia/Hebron', 'Asia/Hebron'), ('Asia/Ho_Chi_Minh', 'Asia/Ho_Chi_Minh'), ('Asia/Hong_Kong', 'Asia/Hong_Kong'), ('Asia/Hovd', 'Asia/Hovd'), ('Asia/Irkutsk', 'Asia/Irkutsk'), ('Asia/Istanbul', 'Asia/Istanbul'), ('Asia/Jakarta', 'Asia/Jakarta'), ('Asia/Jayapura', 'Asia/Jayapura'), ('Asia/Jerusalem', 'Asia/Jerusalem'), ('Asia/Kabul', 'Asia/Kabul'), ('Asia/Kamchatka', 'Asia/Kamchatka'), ('Asia/Karachi', 'Asia/Karachi'), ('Asia/Kashgar', 'Asia/Kashgar'), ('Asia/Kathmandu', 'Asia/Kathmandu'), ('Asia/Katmandu', 'Asia/Katmandu'), ('Asia/Khandyga', 'Asia/Khandyga'), ('Asia/Kolkata', 'Asia/Kolkata'), ('Asia/Krasnoyarsk', 'Asia/Krasnoyarsk'), ('Asia/Kuala_Lumpur', 'Asia/Kuala_Lumpur'), ('Asia/Kuching', 'Asia/Kuching'), ('Asia/Kuwait', 'Asia/Kuwait'), ('Asia/Macao', 'Asia/Macao'), ('Asia/Macau', 'Asia/Macau'), ('Asia/Magadan', 'Asia/Magadan'), ('Asia/Makassar', 'Asia/Makassar'), ('Asia/Manila', 'Asia/Manila'), ('Asia/Muscat', 'Asia/Muscat'), ('Asia/Nicosia', 'Asia/Nicosia'), ('Asia/Novokuznetsk', 'Asia/Novokuznetsk'), ('Asia/Novosibirsk', 'Asia/Novosibirsk'), ('Asia/Omsk', 'Asia/Omsk'), ('Asia/Oral', 'Asia/Oral'), ('Asia/Phnom_Penh', 'Asia/Phnom_Penh'), ('Asia/Pontianak', 'Asia/Pontianak'), ('Asia/Pyongyang', 'Asia/Pyongyang'), ('Asia/Qatar', 'Asia/Qatar'), ('Asia/Qostanay', 'Asia/Qostanay'), ('Asia/Qyzylorda', 'Asia/Qyzylorda'), ('Asia/Rangoon', 'Asia/Rangoon'), ('Asia/Riyadh', 'Asia/Riyadh'), ('Asia/Saigon', 'Asia/Saigon'), ('Asia/Sakhalin', 'Asia/Sakhalin'), ('Asia/Samarkand', 'Asia/Samarkand'), ('Asia/Seoul', 'Asia/Seoul'), ('Asia/Shanghai', 'Asia/Shanghai'), ('Asia/Singapore', 'Asia/Singapore'), ('Asia/Srednekolymsk', 'Asia/Srednekolymsk'), ('Asia/Taipei', 'Asia/Taipei'), ('Asia/Tashkent', 'Asia/Tashkent'), ('Asia/Tbilisi', 'Asia/Tbilisi'), ('Asia/Tehran', 'Asia/Tehran'), ('Asia/Tel_Aviv', 'Asia/Tel_Aviv'), ('Asia/Thimbu', 'Asia/Thimbu'), ('Asia/Thimphu', 'Asia/Thimphu'), ('Asia/Tokyo', 'Asia/Tokyo'), ('Asia/Tomsk', 'Asia/Tomsk'), ('Asia/Ujung_Pandang', 'Asia/Ujung_Pandang'), ('Asia/Ulaanbaatar', 'Asia/Ulaanbaatar'), ('Asia/Ulan_Bator', 'Asia/Ulan_Bator'), ('Asia/Urumqi', 'Asia/Urumqi'), ('Asia/Ust-Nera', 'Asia/Ust-Nera'), ('Asia/Vientiane', 'Asia/Vientiane'), ('Asia/Vladivostok', 'Asia/Vladivostok'), ('Asia/Yakutsk', 'Asia/Yakutsk'), ('Asia/Yangon', 'Asia/Yangon'), ('Asia/Yekaterinburg', 'Asia/Yekaterinburg'), ('Asia/Yerevan', 'Asia/Yerevan'), ('Atlantic/Azores', 'Atlantic/Azores'), ('Atlantic/Bermuda', 'Atlantic/Bermuda'), ('Atlantic/Canary', 'Atlantic/Canary'), ('Atlantic/Cape_Verde', 'Atlantic/Cape_Verde'), ('Atlantic/Faeroe', 'Atlantic/Faeroe'), ('Atlantic/Faroe', 'Atlantic/Faroe'), ('Atlantic/Jan_Mayen', 'Atlantic/Jan_Mayen'), ('Atlantic/Madeira', 'Atlantic/Madeira'), ('Atlantic/Reykjavik', 'Atlantic/Reykjavik'), ('Atlantic/South_Georgia', 'Atlantic/South_Georgia'), ('Atlantic/St_Helena', 'Atlantic/St_Helena'), ('Atlantic/Stanley', 'Atlantic/Stanley'), ('Australia/ACT', 'Australia/ACT'), ('Australia/Adelaide', 'Australia/Adelaide'), ('Australia/Brisbane', 'Australia/Brisbane'), ('Australia/Broken_Hill', 'Australia/Broken_Hill'), ('Australia/Canberra', 'Australia/Canberra'), ('Australia/Currie', 'Australia/Currie'), ('Australia/Darwin', 'Australia/Darwin'), ('Australia/Eucla', 'Australia/Eucla'), ('Australia/Hobart', 'Australia/Hobart'), ('Australia/LHI', 'Australia/LHI'), ('Australia/Lindeman', 'Australia/Lindeman'), ('Australia/Lord_Howe', 'Australia/Lord_Howe'), ('Australia/Melbourne', 'Australia/Melbourne'), ('Australia/NSW', 'Australia/NSW'), ('Australia/North', 'Australia/North'), ('Australia/Perth', 'Australia/Perth'), ('Australia/Queensland', 'Australia/Queensland'), ('Australia/South', 'Australia/South'), ('Australia/Sydney', 'Australia/Sydney'), ('Australia/Tasmania', 'Australia/Tasmania'), ('Australia/Victoria', 'Australia/Victoria'), ('Australia/West', 'Australia/West'), ('Australia/Yancowinna', 'Australia/Yancowinna'), ('Brazil/Acre', 'Brazil/Acre'), ('Brazil/DeNoronha', 'Brazil/DeNoronha'), ('Brazil/East', 'Brazil/East'), ('Brazil/West', 'Brazil/West'), ('CET', 'CET'), ('CST6CDT', 'CST6CDT'), ('Canada/Atlantic', 'Canada/Atlantic'), ('Canada/Central', 'Canada/Central'), ('Canada/Eastern', 'Canada/Eastern'), ('Canada/Mountain', 'Canada/Mountain'), ('Canada/Newfoundland', 'Canada/Newfoundland'), ('Canada/Pacific', 'Canada/Pacific'), ('Canada/Saskatchewan', 'Canada/Saskatchewan'), ('Canada/Yukon', 'Canada/Yukon'), ('Chile/Continental', 'Chile/Continental'), ('Chile/EasterIsland', 'Chile/EasterIsland'), ('Cuba', 'Cuba'), ('EET', 'EET'), ('EST', 'EST'), ('EST5EDT', 'EST5EDT'), ('Egypt', 'Egypt'), ('Eire', 'Eire'), ('Etc/GMT', 'Etc/GMT'), ('Etc/GMT+0', 'Etc/GMT+0'), ('Etc/GMT+1', 'Etc/GMT+1'), ('Etc/GMT+10', 'Etc/GMT+10'), ('Etc/GMT+11', 'Etc/GMT+11'), ('Etc/GMT+12', 'Etc/GMT+12'), ('Etc/GMT+2', 'Etc/GMT+2'), ('Etc/GMT+3', 'Etc/GMT+3'), ('Etc/GMT+4', 'Etc/GMT+4'), ('Etc/GMT+5', 'Etc/GMT+5'), ('Etc/GMT+6', 'Etc/GMT+6'), ('Etc/GMT+7', 'Etc/GMT+7'), ('Etc/GMT+8', 'Etc/GMT+8'), ('Etc/GMT+9', 'Etc/GMT+9'), ('Etc/GMT-0', 'Etc/GMT-0'), ('Etc/GMT-1', 'Etc/GMT-1'), ('Etc/GMT-10', 'Etc/GMT-10'), ('Etc/GMT-11', 'Etc/GMT-11'), ('Etc/GMT-12', 'Etc/GMT-12'), ('Etc/GMT-13', 'Etc/GMT-13'), ('Etc/GMT-14', 'Etc/GMT-14'), ('Etc/GMT-2', 'Etc/GMT-2'), ('Etc/GMT-3', 'Etc/GMT-3'), ('Etc/GMT-4', 'Etc/GMT-4'), ('Etc/GMT-5', 'Etc/GMT-5'), ('Etc/GMT-6', 'Etc/GMT-6'), ('Etc/GMT-7', 'Etc/GMT-7'), ('Etc/GMT-8', 'Etc/GMT-8'), ('Etc/GMT-9', 'Etc/GMT-9'), ('Etc/GMT0', 'Etc/GMT0'), ('Etc/Greenwich', 'Etc/Greenwich'), ('Etc/UCT', 'Etc/UCT'), ('Etc/UTC', 'Etc/UTC'), ('Etc/Universal', 'Etc/Universal'), ('Etc/Zulu', 'Etc/Zulu'), ('Europe/Amsterdam', 'Europe/Amsterdam'), ('Europe/Andorra', 'Europe/Andorra'), ('Europe/Astrakhan', 'Europe/Astrakhan'), ('Europe/Athens', 'Europe/Athens'), ('Europe/Belfast', 'Europe/Belfast'), ('Europe/Belgrade', 'Europe/Belgrade'), ('Europe/Berlin', 'Europe/Berlin'), ('Europe/Bratislava', 'Europe/Bratislava'), ('Europe/Brussels', 'Europe/Brussels'), ('Europe/Bucharest', 'Europe/Bucharest'), ('Europe/Budapest', 'Europe/Budapest'), ('Europe/Busingen', 'Europe/Busingen'), ('Europe/Chisinau', 'Europe/Chisinau'), ('Europe/Copenhagen', 'Europe/Copenhagen'), ('Europe/Dublin', 'Europe/Dublin'), ('Europe/Gibraltar', 'Europe/Gibraltar'), ('Europe/Guernsey', 'Europe/Guernsey'), ('Europe/Helsinki', 'Europe/Helsinki'), ('Europe/Isle_of_Man', 'Europe/Isle_of_Man'), ('Europe/Istanbul', 'Europe/Istanbul'), ('Europe/Jersey', 'Europe/Jersey'), ('Europe/Kaliningrad', 'Europe/Kaliningrad'), ('Europe/Kiev', 'Europe/Kiev'), ('Europe/Kirov', 'Europe/Kirov'), ('Europe/Kyiv', 'Europe/Kyiv'), ('Europe/Lisbon', 'Europe/Lisbon'), ('Europe/Ljubljana', 'Europe/Ljubljana'), ('Europe/London', 'Europe/London'), ('Europe/Luxembourg', 'Europe/Luxembourg'), ('Europe/Madrid', 'Europe/Madrid'), ('Europe/Malta', 'Europe/Malta'), ('Europe/Mariehamn', 'Europe/Mariehamn'), ('Europe/Minsk', 'Europe/Minsk'), ('Europe/Monaco', 'Europe/Monaco'), ('Europe/Moscow', 'Europe/Moscow'), ('Europe/Nicosia', 'Europe/Nicosia'), ('Europe/Oslo', 'Europe/Oslo'), ('Europe/Paris', 'Europe/Paris'), ('Europe/Podgorica', 'Europe/Podgorica'), ('Europe/Prague', 'Europe/Prague'), ('Europe/Riga', 'Europe/Riga'), ('Europe/Rome', 'Europe/Rome'), ('Europe/Samara', 'Europe/Samara'), ('Europe/San_Marino', 'Europe/San_Marino'), ('Europe/Sarajevo', 'Europe/Sarajevo'), ('Europe/Saratov', 'Europe/Saratov'), ('Europe/Simferopol', 'Europe/Simferopol'), ('Europe/Skopje', 'Europe/Skopje'), ('Europe/Sofia', 'Europe/Sofia'), ('Europe/Stockholm', 'Europe/Stockholm'), ('Europe/Tallinn', 'Europe/Tallinn'), ('Europe/Tirane', 'Europe/Tirane'), ('Europe/Tiraspol', 'Europe/Tiraspol'), ('Europe/Ulyanovsk', 'Europe/Ulyanovsk'), ('Europe/Uzhgorod', 'Europe/Uzhgorod'), ('Europe/Vaduz', 'Europe/Vaduz'), ('Europe/Vatican', 'Europe/Vatican'), ('Europe/Vienna', 'Europe/Vienna'), ('Europe/Vilnius', 'Europe/Vilnius'), ('Europe/Volgograd', 'Europe/Volgograd'), ('Europe/Warsaw', 'Europe/Warsaw'), ('Europe/Zagreb', 'Europe/Zagreb'), ('Europe/Zaporozhye', 'Europe/Zaporozhye'), ('Europe/Zurich', 'Europe/Zurich'), ('GB', 'GB'), ('GB-Eire', 'GB-Eire'), ('GMT', 'GMT'), ('GMT+0', 'GMT+0'), ('GMT-0', 'GMT-0'), ('GMT0', 'GMT0'), ('Greenwich', 'Greenwich'), ('HST', 'HST'), ('Hongkong', 'Hongkong'), ('Iceland', 'Iceland'), ('Indian/Antananarivo', 'Indian/Antananarivo'), ('Indian/Chagos', 'Indian/Chagos'), ('Indian/Christmas', 'Indian/Christmas'), ('Indian/Cocos', 'Indian/Cocos'), ('Indian/Comoro', 'Indian/Comoro'), ('Indian/Kerguelen', 'Indian/Kerguelen'), ('Indian/Mahe', 'Indian/Mahe'), ('Indian/Maldives', 'Indian/Maldives'), ('Indian/Mauritius', 'Indian/Mauritius'), ('Indian/Mayotte', 'Indian/Mayotte'), ('Indian/Reunion', 'Indian/Reunion'), ('Iran', 'Iran'), ('Israel', 'Israel'), ('Jamaica', 'Jamaica'), ('Japan', 'Japan'), ('Kwajalein', 'Kwajalein'), ('Libya', 'Libya'), ('MET', 'MET'), ('MST', 'MST'), ('MST7MDT', 'MST7MDT'), ('Mexico/BajaNorte', 'Mexico/BajaNorte'), ('Mexico/BajaSur', 'Mexico/BajaSur'), ('Mexico/General', 'Mexico/General'), ('NZ', 'NZ'), ('NZ-CHAT', 'NZ-CHAT'), ('Navajo', 'Navajo'), ('PRC', 'PRC'), ('PST8PDT', 'PST8PDT'), ('Pacific/Apia', 'Pacific/Apia'), ('Pacific/Auckland', 'Pacific/Auckland'), ('Pacific/Bougainville', 'Pacific/Bougainville'), ('Pacific/Chatham', 'Pacific/Chatham'), ('Pacific/Chuuk', 'Pacific/Chuuk'), ('Pacific/Easter', 'Pacific/Easter'), ('Pacific/Efate', 'Pacific/Efate'), ('Pacific/Enderbury', 'Pacific/Enderbury'), ('Pacific/Fakaofo', 'Pacific/Fakaofo'), ('Pacific/Fiji', 'Pacific/Fiji'), ('Pacific/Funafuti', 'Pacific/Funafuti'), ('Pacific/Galapagos', 'Pacific/Galapagos'), ('Pacific/Gambier', 'Pacific/Gambier'), ('Pacific/Guadalcanal', 'Pacific/Guadalcanal'), ('Pacific/Guam', 'Pacific/Guam'), ('Pacific/Honolulu', 'Pacific/Honolulu'), ('Pacific/Johnston', 'Pacific/Johnston'), ('Pacific/Kanton', 'Pacific/Kanton'), ('Pacific/Kiritimati', 'Pacific/Kiritimati'), ('Pacific/Kosrae', 'Pacific/Kosrae'), ('Pacific/Kwajalein', 'Pacific/Kwajalein'), ('Pacific/Majuro', 'Pacific/Majuro'), ('Pacific/Marquesas', 'Pacific/Marquesas'), ('Pacific/Midway', 'Pacific/Midway'), ('Pacific/Nauru', 'Pacific/Nauru'), ('Pacific/Niue', 'Pacific/Niue'), ('Pacific/Norfolk', 'Pacific/Norfolk'), ('Pacific/Noumea', 'Pacific/Noumea'), ('Pacific/Pago_Pago', 'Pacific/Pago_Pago'), ('Pacific/Palau', 'Pacific/Palau'), ('Pacific/Pitcairn', 'Pacific/Pitcairn'), ('Pacific/Pohnpei', 'Pacific/Pohnpei'), ('Pacific/Ponape', 'Pacific/Ponape'), ('Pacific/Port_Moresby', 'Pacific/Port_Moresby'), ('Pacific/Rarotonga', 'Pacific/Rarotonga'), ('Pacific/Saipan', 'Pacific/Saipan'), ('Pacific/Samoa', 'Pacific/Samoa'), ('Pacific/Tahiti', 'Pacific/Tahiti'), ('Pacific/Tarawa', 'Pacific/Tarawa'), ('Pacific/Tongatapu', 'Pacific/Tongatapu'), ('Pacific/Truk', 'Pacific/Truk'), ('Pacific/Wake', 'Pacific/Wake'), ('Pacific/Wallis', 'Pacific/Wallis'), ('Pacific/Yap', 'Pacific/Yap'), ('Poland', 'Poland'), ('Portugal', 'Portugal'), ('ROC', 'ROC'), ('ROK', 'ROK'), ('Singapore', 'Singapore'), ('Turkey', 'Turkey'), ('UCT', 'UCT'), ('US/Alaska', 'US/Alaska'), ('US/Aleutian', 'US/Aleutian'), ('US/Arizona', 'US/Arizona'), ('US/Central', 'US/Central'), ('US/East-Indiana', 'US/East-Indiana'), ('US/Eastern', 'US/Eastern'), ('US/Hawaii', 'US/Hawaii'), ('US/Indiana-Starke', 'US/Indiana-Starke'), ('US/Michigan', 'US/Michigan'), ('US/Mountain', 'US/Mountain'), ('US/Pacific', 'US/Pacific'), ('US/Samoa', 'US/Samoa'), ('UTC', 'UTC'), ('Universal', 'Universal'), ('W-SU', 'W-SU'), ('WET', 'WET'), ('Zulu', 'Zulu')], default='UTC', max_length=240),
        ),
        migrations.AddField(
            model_name='externaldatasource',
            name='prefix',
            field=models.CharField(blank=True, max_length=100, null=True),
        ),
        migrations.AddField(
            model_name='user',
            name='theme_mode',
            field=models.CharField(blank=True, choices=[('light', 'Light'), ('dark', 'Dark')], max_length=20, null=True),
        ),
        migrations.CreateModel(
            name='ExternalDataJob',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(max_length=400)),
                ('rows_synced', models.BigIntegerField(blank=True, null=True)),
                ('latest_error', models.TextField(help_text='The latest error that occurred during this run.', null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('pipeline', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.externaldatasource')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('workflow_id', models.CharField(blank=True, max_length=400, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='PendingPersonOverride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('team_id', models.BigIntegerField()),
                ('old_person_id', models.UUIDField()),
                ('override_person_id', models.UUIDField()),
                ('oldest_event', models.DateTimeField()),
            ],
        ),
        migrations.AddField(
            model_name='cohort',
            name='query',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.CreateModel(
            name='ScheduledChange',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('record_id', models.IntegerField()),
                ('model_name', models.CharField(choices=[('FeatureFlag', 'feature flag')], max_length=100)),
                ('payload', models.JSONField(default=dict)),
                ('scheduled_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('executed_at', models.DateTimeField(blank=True, null=True)),
                ('failure_reason', models.CharField(blank=True, max_length=400, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AlterField(
            model_name='survey',
            name='type',
            field=models.CharField(choices=[('popover', 'popover'), ('widget', 'widget'), ('button', 'button'), ('email', 'email'), ('full_screen', 'full screen'), ('api', 'api')], max_length=40),
        ),
        migrations.CreateModel(
            name='ExternalDataSchema',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=400)),
                ('should_sync', models.BooleanField(default=True)),
                ('latest_error', models.TextField(help_text='The latest error that occurred when syncing this schema.', null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('source', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='schemas', to='posthog.externaldatasource')),
                ('table', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.datawarehousetable')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('last_synced_at', models.DateTimeField(blank=True, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.CreateModel(
            name='FlatPersonOverride',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('team_id', models.BigIntegerField()),
                ('old_person_id', models.UUIDField()),
                ('override_person_id', models.UUIDField()),
                ('oldest_event', models.DateTimeField()),
                ('version', models.BigIntegerField(blank=True, null=True)),
            ],
            options={
                'indexes': [models.Index(fields=['team_id', 'override_person_id'], name='posthog_fla_team_id_224253_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='flatpersonoverride',
            constraint=models.UniqueConstraint(fields=('team_id', 'old_person_id'), name='flatpersonoverride_unique_old_person_by_team'),
        ),
        migrations.AddConstraint(
            model_name='flatpersonoverride',
            constraint=models.CheckConstraint(check=models.Q(('old_person_id__exact', models.F('override_person_id')), _negated=True), name='flatpersonoverride_check_circular_reference'),
        ),
        migrations.AlterField(
            model_name='user',
            name='theme_mode',
            field=models.CharField(blank=True, choices=[('light', 'Light'), ('dark', 'Dark'), ('system', 'System')], max_length=20, null=True),
        ),
        migrations.AlterField(
            model_name='scheduledchange',
            name='record_id',
            field=models.CharField(max_length=200),
        ),
        migrations.AlterField(
            model_name='scheduledchange',
            name='scheduled_at',
            field=models.DateTimeField(),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name='scheduledchange',
            index=models.Index(fields=['scheduled_at', 'executed_at'], name='posthog_sch_schedul_c3687e_idx'),
        ),
        migrations.CreateModel(
            name='Comment',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('content', models.TextField(blank=True, null=True)),
                ('version', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('deleted', models.BooleanField(blank=True, default=False, null=True)),
                ('item_id', models.CharField(max_length=72, null=True)),
                ('item_context', models.JSONField(null=True)),
                ('scope', models.CharField(max_length=79)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('source_comment', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.comment')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'indexes': [models.Index(fields=['team_id', 'scope', 'item_id'], name='posthog_com_team_id_be2206_idx')],
            },
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot')], max_length=128),
        ),
        migrations.AddField(
            model_name='user',
            name='strapi_id',
            field=models.PositiveSmallIntegerField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externaldataschema',
            name='table',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.datawarehousetable'),
        ),
        migrations.AddField(
            model_name='activitylog',
            name='was_impersonated',
            field=models.BooleanField(null=True),
        ),
        migrations.RunPython(
            code=django.db.migrations.operations.special.RunPython.noop,
            reverse_code=django.db.migrations.operations.special.RunPython.noop,
        ),
        migrations.AddField(
            model_name='team',
            name='session_replay_config',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres')], max_length=128),
        ),
        migrations.AddField(
            model_name='batchexport',
            name='schema',
            field=models.JSONField(default=None, help_text='A schema of custom fields to select when exporting data.', null=True),
        ),
        migrations.AlterField(
            model_name='batchexportdestination',
            name='type',
            field=models.CharField(choices=[('S3', 'S3'), ('Snowflake', 'Snowflake'), ('Postgres', 'Postgres'), ('Redshift', 'Redshift'), ('BigQuery', 'Bigquery'), ('HTTP', 'Http'), ('NoOp', 'Noop')], help_text='A choice of supported BatchExportDestination types.', max_length=64),
        ),
        migrations.AddField(
            model_name='personalapikey',
            name='scoped_organizations',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), null=True, size=None),
        ),
        migrations.AddField(
            model_name='personalapikey',
            name='scoped_teams',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.IntegerField(), null=True, size=None),
        ),
        migrations.AddField(
            model_name='personalapikey',
            name='scopes',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.CharField(max_length=100), null=True, size=None),
        ),
        migrations.AlterField(
            model_name='batchexportbackfill',
            name='status',
            field=models.CharField(choices=[('Cancelled', 'Cancelled'), ('Completed', 'Completed'), ('ContinuedAsNew', 'Continued As New'), ('Failed', 'Failed'), ('FailedRetryable', 'Failed Retryable'), ('Terminated', 'Terminated'), ('TimedOut', 'Timedout'), ('Running', 'Running'), ('Starting', 'Starting')], help_text='The status of this backfill.', max_length=64),
        ),
        migrations.AlterField(
            model_name='batchexportrun',
            name='status',
            field=models.CharField(choices=[('Cancelled', 'Cancelled'), ('Completed', 'Completed'), ('ContinuedAsNew', 'Continued As New'), ('Failed', 'Failed'), ('FailedRetryable', 'Failed Retryable'), ('Terminated', 'Terminated'), ('TimedOut', 'Timedout'), ('Running', 'Running'), ('Starting', 'Starting')], help_text='The status of this run.', max_length=64),
        ),
        migrations.AlterField(
            model_name='exportedasset',
            name='export_format',
            field=models.CharField(choices=[('image/png', 'image/png'), ('application/pdf', 'application/pdf'), ('text/csv', 'text/csv'), ('application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet')], max_length=100),
        ),
        migrations.CreateModel(
            name='DataWarehouseJoin',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('deleted', models.BooleanField(blank=True, null=True)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('source_table_name', models.CharField(max_length=400)),
                ('joining_table_name', models.CharField(max_length=400)),
                ('source_table_key', models.CharField(max_length=400)),
                ('joining_table_key', models.CharField(max_length=400)),
                ('field_name', models.CharField(max_length=400)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='organization',
            name='customer_trust_scores',
            field=models.JSONField(blank=True, default=dict, null=True),
        ),
        migrations.AddField(
            model_name='organization',
            name='is_hipaa',
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.AlterField(
            model_name='batchexportbackfill',
            name='end_at',
            field=models.DateTimeField(help_text='The end of the data interval.', null=True),
        ),
        migrations.AlterField(
            model_name='team',
            name='name',
            field=models.CharField(default='Default project', max_length=200, validators=[django.core.validators.MinLengthValidator(1, 'Project must have a name!')]),
        ),
        migrations.CreateModel(
            name='Project',
            fields=[
                ('id', models.BigIntegerField(primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(default='Default project', max_length=200, validators=[django.core.validators.MinLengthValidator(1, 'Project must have a name!')])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='projects', related_query_name='project', to='posthog.organization')),
            ],
        ),
        migrations.AddField(
            model_name='team',
            name='project',
            field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.CASCADE, related_name='teams', related_query_name='team', to='posthog.project'),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_team'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0397_projects_backfill op#1 path=database_operations[0]';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0397_projects_backfill op#1 path=database_operations[0]';\n        END IF;\n    END LOOP;\nEND\n$$;",
                    reverse_sql='',
                ),
            ],
            state_operations=[
                migrations.AlterField(
                    model_name='team',
                    name='project',
                    field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='teams', related_query_name='team', to='posthog.project'),
                ),
            ],
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk')], max_length=128),
        ),
        migrations.AddField(
            model_name='batchexportrun',
            name='records_total_count',
            field=models.IntegerField(help_text='The total count of records that should be exported in this BatchExportRun.', null=True),
        ),
        migrations.AddField(
            model_name='datawarehousetable',
            name='row_count',
            field=models.IntegerField(help_text='How many rows are currently synced in this table', null=True),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    ALTER TABLE "posthog_experiment" ADD COLUMN "exposure_cohort_id" integer NULL CONSTRAINT "posthog_experiment_exposure_cohort_id_19450b9e_fk_posthog_c" REFERENCES "posthog_cohort"("id") DEFERRABLE INITIALLY DEFERRED; -- existing-table-constraint-ignore\n                    SET CONSTRAINTS "posthog_experiment_exposure_cohort_id_19450b9e_fk_posthog_c" IMMEDIATE; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_experiment" DROP COLUMN IF EXISTS "exposure_cohort_id";\n                    ',
                ),
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY "posthog_experiment_exposure_cohort_id_19450b9e" ON "posthog_experiment" ("exposure_cohort_id");\n                    ',
                    reverse_sql='\n                        DROP INDEX CONCURRENTLY IF EXISTS "posthog_experiment_exposure_cohort_id_19450b9e";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='experiment',
                    name='exposure_cohort',
                    field=models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to='posthog.cohort'),
                ),
            ],
        ),
        migrations.AddField(
            model_name='externaldatajob',
            name='schema',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, to='posthog.externaldataschema'),
        ),
        migrations.AddField(
            model_name='externaldataschema',
            name='status',
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
        migrations.AddField(
            model_name='plugin',
            name='has_private_access',
            field=models.ManyToManyField(to='posthog.organization'),
        ),
        migrations.RemoveConstraint(
            model_name='propertydefinition',
            name='property_type_is_valid',
        ),
        migrations.AlterField(
            model_name='propertydefinition',
            name='property_type',
            field=models.CharField(blank=True, choices=[('DateTime', 'DateTime'), ('String', 'String'), ('Numeric', 'Numeric'), ('Boolean', 'Boolean'), ('Duration', 'Duration')], max_length=50, null=True),
        ),
        migrations.AlterField(
            model_name='propertydefinition',
            name='type',
            field=models.PositiveSmallIntegerField(choices=[(1, 'event'), (2, 'person'), (3, 'group'), (4, 'session')], default=1),
        ),
        django.contrib.postgres.operations.AddConstraintNotValid(
            model_name='propertydefinition',
            constraint=models.CheckConstraint(check=models.Q(('property_type__in', ['DateTime', 'String', 'Numeric', 'Boolean', 'Duration'])), name='property_type_is_valid'),
        ),
        migrations.AddField(
            model_name='team',
            name='heatmaps_opt_in',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='responses_limit',
            field=models.PositiveIntegerField(null=True),
        ),
        migrations.AlterModelOptions(
            name='team',
            options={'verbose_name': 'team (soon to be environment)', 'verbose_name_plural': 'teams (soon to be environments)'},
        ),
        migrations.AddField(
            model_name='team',
            name='modifiers',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='action',
            name='steps_json',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='actionstep',
            name='action',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='action_steps', to='posthog.action'),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_action'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0410_action_steps_population op#1';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0410_action_steps_population op#1';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql='CREATE INDEX CONCURRENTLY posthog_eventproperty_team_id_and_property_r32khd9s ON posthog_eventproperty(team_id, property)',
            reverse_sql='DROP INDEX "posthog_eventproperty_team_id_and_property_r32khd9s"',
        ),
        migrations.CreateModel(
            name='ProxyRecord',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('domain', models.CharField(max_length=64, unique=True)),
                ('target_cname', models.CharField(max_length=256)),
                ('status', models.CharField(choices=[('waiting', 'Waiting'), ('issuing', 'Issuing'), ('valid', 'Valid'), ('erroring', 'Erroring'), ('deleting', 'Deleting')], default='waiting')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('organization', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='proxy_records', to='posthog.organization')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='user',
            name='hedgehog_config',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='personalapikey',
            name='mask_value',
            field=models.CharField(editable=False, max_length=11, null=True),
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    ALTER TABLE "posthog_pluginconfig" ADD COLUMN "match_action_id" integer NULL CONSTRAINT "posthog_pluginconfig_match_action_id_1cbf8562_fk_posthog_a" REFERENCES "posthog_action"("id") DEFERRABLE INITIALLY DEFERRED; -- existing-table-constraint-ignore\n                    SET CONSTRAINTS "posthog_pluginconfig_match_action_id_1cbf8562_fk_posthog_a" IMMEDIATE; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_pluginconfig" DROP COLUMN IF EXISTS "match_action_id";\n                    ',
                ),
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY "posthog_pluginconfig_match_action_id_1cbf8562" ON "posthog_pluginconfig" ("match_action_id");\n                    ',
                    reverse_sql='\n                        DROP INDEX IF EXISTS "posthog_pluginconfig_match_action_id_1cbf8562";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='pluginconfig',
                    name='match_action',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='plugin_configs', to='posthog.action'),
                ),
            ],
        ),
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunSQL(
                    sql='\n                    ALTER TABLE "posthog_survey" ADD COLUMN "internal_targeting_flag_id" integer NULL CONSTRAINT "posthog_survey_internal_targeting_f_b3911925_fk_posthog_f" REFERENCES "posthog_featureflag"("id") DEFERRABLE INITIALLY DEFERRED; -- existing-table-constraint-ignore\n                    SET CONSTRAINTS "posthog_survey_internal_targeting_f_b3911925_fk_posthog_f" IMMEDIATE; -- existing-table-constraint-ignore\n                    ',
                    reverse_sql='\n                        ALTER TABLE "posthog_survey" DROP COLUMN IF EXISTS "internal_targeting_flag_id";\n                    ',
                ),
                migrations.RunSQL(
                    sql='\n                    CREATE INDEX CONCURRENTLY "posthog_survey_internal_targeting_flag_id_b3911925" ON "posthog_survey" ("internal_targeting_flag_id");\n                    ',
                    reverse_sql='\n                        DROP INDEX IF EXISTS "posthog_survey_internal_targeting_flag_id_b3911925";\n                    ',
                ),
            ],
            state_operations=[
                migrations.AddField(
                    model_name='survey',
                    name='internal_targeting_flag',
                    field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='surveys_internal_targeting_flag', related_query_name='survey_internal_targeting_flag', to='posthog.featureflag'),
                ),
            ],
        ),
        migrations.RemoveConstraint(
            model_name='organizationmembership',
            name='only_one_owner_per_organization',
        ),
        migrations.AddField(
            model_name='organizationinvite',
            name='level',
            field=models.PositiveSmallIntegerField(blank=True, choices=[(1, 'member'), (8, 'administrator'), (15, 'owner')], default=1, null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_organizationinvite'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0417_remove_organizationmembership_only_one_owner_per_organization_and_more op#3';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0417_remove_organizationmembership_only_one_owner_per_organization_and_more op#3';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql='ALTER TABLE posthog_organizationinvite ALTER COLUMN level SET NOT NULL -- existing-table-constraint-ignore',
            reverse_sql='ALTER TABLE posthog_organizationinvite ALTER COLUMN level DROP NOT NULL',
        ),
        migrations.AlterField(
            model_name='organizationinvite',
            name='level',
            field=models.PositiveSmallIntegerField(choices=[(1, 'member'), (8, 'administrator'), (15, 'owner')], default=1),
        ),
        migrations.AddField(
            model_name='pluginconfig',
            name='filters',
            field=models.JSONField(blank=True, null=True),
        ),
        migrations.RunSQL(
            sql='ALTER TABLE "posthog_organization" DROP COLUMN "available_features" CASCADE -- drop-column-ignore',
            reverse_sql='ALTER TABLE "posthog_organization" ADD COLUMN "available_features" VARCHAR(64)[] DEFAULT array[]::varchar(64)[]',
            state_operations=[migrations.RemoveField(
                model_name='organization',
                name='available_features',
            )],
        ),
        migrations.CreateModel(
            name='Alert',
            fields=[
                ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('target_value', models.TextField()),
                ('anomaly_condition', models.JSONField(default=dict)),
                ('insight', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.insight')),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AddField(
            model_name='proxyrecord',
            name='message',
            field=models.CharField(max_length=1024, null=True),
        ),
        migrations.AlterField(
            model_name='externaldatasource',
            name='source_type',
            field=models.CharField(choices=[('Stripe', 'Stripe'), ('Hubspot', 'Hubspot'), ('Postgres', 'Postgres'), ('Zendesk', 'Zendesk'), ('Snowflake', 'Snowflake')], max_length=128),
        ),
        migrations.AddField(
            model_name='survey',
            name='current_iteration',
            field=models.PositiveIntegerField(null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='current_iteration_start_date',
            field=models.DateTimeField(null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='iteration_count',
            field=models.PositiveIntegerField(null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='iteration_frequency_days',
            field=models.PositiveIntegerField(null=True),
        ),
        migrations.AddField(
            model_name='survey',
            name='iteration_start_dates',
            field=django.contrib.postgres.fields.ArrayField(base_field=models.DateTimeField(null=True), blank=True, default=None, null=True, size=None),
        ),
        migrations.AddField(
            model_name='externaldatasource',
            name='sync_frequency',
            field=models.CharField(blank=True, choices=[('day', 'Daily'), ('week', 'Weekly'), ('month', 'Monthly')], default='day', max_length=128),
        ),
        migrations.CreateModel(
            name='HogFunction',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(blank=True, max_length=400, null=True)),
                ('description', models.TextField(blank=True, default='')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('deleted', models.BooleanField(default=False)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('enabled', models.BooleanField(default=False)),
                ('hog', models.TextField()),
                ('bytecode', models.JSONField(blank=True, null=True)),
                ('inputs_schema', models.JSONField(null=True)),
                ('inputs', models.JSONField(null=True)),
                ('filters', models.JSONField(blank=True, null=True)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
                ('icon_url', models.TextField(blank=True, null=True)),
                ('template_id', models.CharField(blank=True, max_length=400, null=True)),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='externaldataschema',
            name='sync_type',
            field=models.CharField(blank=True, choices=[('full_refresh', 'full_refresh'), ('incremental', 'incremental')], default='full_refresh', max_length=128),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_externaldataschema'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0428_externaldataschema_sync_type op#2';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0428_externaldataschema_sync_type op#2';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.AlterField(
            model_name='datawarehousetable',
            name='format',
            field=models.CharField(choices=[('CSV', 'CSV'), ('CSVWithNames', 'CSVWithNames'), ('Parquet', 'Parquet'), ('JSONEachRow', 'JSON')], max_length=128),
        ),
        migrations.AddField(
            model_name='batchexport',
            name='model',
            field=models.CharField(blank=True, choices=[('events', 'Events'), ('persons', 'Persons')], default='events', help_text='Which model this BatchExport is exporting.', max_length=64, null=True),
        ),
        migrations.AddField(
            model_name='externaldataschema',
            name='sync_type_config',
            field=models.JSONField(blank=True, default=dict),
        ),
        migrations.AlterField(
            model_name='externaldataschema',
            name='sync_type',
            field=models.CharField(blank=True, choices=[('full_refresh', 'full_refresh'), ('incremental', 'incremental')], max_length=128, null=True),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_externaldataschema'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0431_externaldataschema_sync_type_payload op#3';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0431_externaldataschema_sync_type_payload op#3';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_externaldataschema'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0431_externaldataschema_sync_type_payload op#4';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0431_externaldataschema_sync_type_payload op#4';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.CreateModel(
            name='PersonlessDistinctId',
            fields=[
                ('id', models.BigAutoField(primary_key=True, serialize=False)),
                ('distinct_id', models.CharField(max_length=400)),
                ('is_merged', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('team', models.ForeignKey(db_index=False, on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
        ),
        migrations.AddConstraint(
            model_name='personlessdistinctid',
            constraint=models.UniqueConstraint(fields=('team', 'distinct_id'), name='unique personless distinct_id for team'),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name='dashboard',
            index=models.Index(condition=models.Q(('deleted', False)), fields=['-pinned', 'name', 'deleted', 'team_id'], name='idx_dashboard_deleted_team_id'),
        ),
        migrations.AddField(
            model_name='team',
            name='autocapture_web_vitals_opt_in',
            field=models.BooleanField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name='action',
            name='slack_message_format',
            field=models.CharField(blank=True, default='', max_length=1200),
        ),
        migrations.AlterField(
            model_name='proxyrecord',
            name='status',
            field=models.CharField(choices=[('waiting', 'Waiting'), ('issuing', 'Issuing'), ('valid', 'Valid'), ('erroring', 'Erroring'), ('deleting', 'Deleting'), ('timed_out', 'Timed Out')], default='waiting'),
        ),
        migrations.AddField(
            model_name='externaldataschema',
            name='sync_frequency',
            field=models.CharField(blank=True, choices=[('day', 'Daily'), ('week', 'Weekly'), ('month', 'Monthly')], default='day', max_length=128),
        ),
        migrations.AlterField(
            model_name='externaldatajob',
            name='pipeline',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='jobs', to='posthog.externaldatasource'),
        ),
        migrations.RunSQL(
            sql="DO $$\nDECLARE\n    _table text;\n    _resolved regclass;\n    _has_rows boolean;\nBEGIN\n    FOREACH _table IN ARRAY ARRAY['posthog_externaldataschema'] LOOP\n        _resolved := to_regclass(_table);\n        IF _resolved IS NULL THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty table % does not exist for %', _table, 'posthog.0437_externaldataschema_sync_frequency op#3';\n        END IF;\n        EXECUTE format('SELECT EXISTS (SELECT 1 FROM %s LIMIT 1)', _resolved) INTO _has_rows;\n        IF _has_rows THEN\n            RAISE EXCEPTION 'Bootstrap policy noop_if_empty blocked: table % is not empty for %', _table, 'posthog.0437_externaldataschema_sync_frequency op#3';\n        END IF;\n    END LOOP;\nEND\n$$;",
            reverse_sql='',
        ),
        migrations.CreateModel(
            name='ErrorTrackingGroup',
            fields=[
                ('id', models.UUIDField(default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('fingerprint', models.TextField()),
                ('merged_fingerprints', django.contrib.postgres.fields.ArrayField(base_field=models.TextField(), default=list, size=None)),
                ('status', models.CharField(choices=[('archived', 'Archived'), ('active', 'Active'), ('resolved', 'Resolved'), ('pending_release', 'Pending release')], default='active', max_length=40)),
                ('assignee', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('team', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='posthog.team')),
            ],
            options={
                'abstract': False,
            },
        ),
        migrations.AddField(
            model_name='survey',
            name='actions',
            field=models.ManyToManyField(to='posthog.action'),
        ),
        migrations.AddField(
            model_name='organizationinvite',
            name='private_project_access',
            field=models.JSONField(blank=True, default=list, help_text='List of team IDs and corresponding access levels to private projects.', null=True, validators=[posthog.models.organization_invite.validate_private_project_access]),
        ),
        migrations.AlterField(
            model_name='datawarehousetable',
            name='format',
            field=models.CharField(choices=[('CSV', 'CSV'), ('CSVWithNames', 'CSVWithNames'), ('Parquet', 'Parquet'), ('JSONEachRow', 'JSON'), ('Delta', 'Delta')], max_length=128),
        ),
        migrations.AlterField(
            model_name='survey',
            name='questions',
            field=models.JSONField(blank=True, help_text='\n        The `array` of questions included in the survey. Each question must conform to one of the defined question types: Basic, Link, Rating, or Multiple Choice.\n\n        Basic (open-ended question)\n        - `type`: `open`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Link (a question with a link)\n        - `type`: `link`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `link`: The URL associated with the question.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Rating (a question with a rating scale)\n        - `type`: `rating`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `display`: Display style of the rating (`number` or `emoji`).\n        - `scale`: The scale of the rating (`number`).\n        - `lowerBoundLabel`: Label for the lower bound of the scale.\n        - `upperBoundLabel`: Label for the upper bound of the scale.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Multiple choice\n        - `type`: `single_choice` or `multiple_choice`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `choices`: An array of choices for the question.\n        - `shuffleOptions`: Whether to shuffle the order of the choices (`boolean`).\n        - `hasOpenChoice`: Whether the question allows an open-ended response (`boolean`).\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Branching logic can be one of the following types:\n\n        Next question: Proceeds to the next question\n        ```json\n        {\n            "type": "next_question"\n        }\n        ```\n\n        End: Ends the survey, optionally displaying a confirmation message.\n        ```json\n        {\n            "type": "end"\n        }\n        ```\n\n        Response-based: Branches based on the response values. Available for the `rating` and `single_choice` question types.\n        ```json\n        {\n            "type": "response_based",\n            "responseValues": {\n                "responseKey": "value"\n            }\n        }\n        ```\n\n        Specific question: Proceeds to a specific question by index.\n        ```json\n        {\n            "type": "specific_question",\n            "index": 2\n        }\n        ```\n        ', null=True),
        ),
        migrations.AddField(
            model_name='externaldatajob',
            name='workflow_run_id',
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
    ]
