# Generated by Django 4.2.28 on 2026-02-18 08:16

import django.db.models.deletion
import django.contrib.postgres.fields
from django.conf import settings
from django.db import migrations, models

import posthog.models.utils
import posthog.models.organization_invite


class Migration(migrations.Migration):
    replaces = [
        ("posthog", "0438_errortrackinggroup"),
        ("posthog", "0439_survey_actions"),
        ("posthog", "0440_organizationinvite_private_project_access"),
        ("posthog", "0441_alter_datawarehousetable_format"),
        ("posthog", "0442_alter_survey_questions"),
        ("posthog", "0443_externaldatajob_workflow_run_id"),
    ]

    dependencies = [
        ("posthog", "0437_externaldataschema_sync_frequency"),
    ]

    operations = [
        migrations.CreateModel(
            name="ErrorTrackingGroup",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("fingerprint", models.TextField()),
                (
                    "merged_fingerprints",
                    django.contrib.postgres.fields.ArrayField(base_field=models.TextField(), default=list, size=None),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("archived", "Archived"),
                            ("active", "Active"),
                            ("resolved", "Resolved"),
                            ("pending_release", "Pending release"),
                        ],
                        default="active",
                        max_length=40,
                    ),
                ),
                (
                    "assignee",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL
                    ),
                ),
                ("team", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.AddField(
            model_name="survey",
            name="actions",
            field=models.ManyToManyField(to="posthog.action"),
        ),
        migrations.AddField(
            model_name="organizationinvite",
            name="private_project_access",
            field=models.JSONField(
                blank=True,
                default=list,
                help_text="List of team IDs and corresponding access levels to private projects.",
                null=True,
                validators=[posthog.models.organization_invite.validate_private_project_access],
            ),
        ),
        migrations.AlterField(
            model_name="datawarehousetable",
            name="format",
            field=models.CharField(
                choices=[
                    ("CSV", "CSV"),
                    ("CSVWithNames", "CSVWithNames"),
                    ("Parquet", "Parquet"),
                    ("JSONEachRow", "JSON"),
                    ("Delta", "Delta"),
                ],
                max_length=128,
            ),
        ),
        migrations.AlterField(
            model_name="survey",
            name="questions",
            field=models.JSONField(
                blank=True,
                help_text='\n        The `array` of questions included in the survey. Each question must conform to one of the defined question types: Basic, Link, Rating, or Multiple Choice.\n\n        Basic (open-ended question)\n        - `type`: `open`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Link (a question with a link)\n        - `type`: `link`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `link`: The URL associated with the question.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Rating (a question with a rating scale)\n        - `type`: `rating`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `display`: Display style of the rating (`number` or `emoji`).\n        - `scale`: The scale of the rating (`number`).\n        - `lowerBoundLabel`: Label for the lower bound of the scale.\n        - `upperBoundLabel`: Label for the upper bound of the scale.\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Multiple choice\n        - `type`: `single_choice` or `multiple_choice`\n        - `question`: The text of the question.\n        - `description`: Optional description of the question.\n        - `descriptionContentType`: Content type of the description (`html` or `text`).\n        - `optional`: Whether the question is optional (`boolean`).\n        - `buttonText`: Text displayed on the submit button.\n        - `choices`: An array of choices for the question.\n        - `shuffleOptions`: Whether to shuffle the order of the choices (`boolean`).\n        - `hasOpenChoice`: Whether the question allows an open-ended response (`boolean`).\n        - `branching`: Branching logic for the question. See branching types below for details.\n\n        Branching logic can be one of the following types:\n\n        Next question: Proceeds to the next question\n        ```json\n        {\n            "type": "next_question"\n        }\n        ```\n\n        End: Ends the survey, optionally displaying a confirmation message.\n        ```json\n        {\n            "type": "end"\n        }\n        ```\n\n        Response-based: Branches based on the response values. Available for the `rating` and `single_choice` question types.\n        ```json\n        {\n            "type": "response_based",\n            "responseValues": {\n                "responseKey": "value"\n            }\n        }\n        ```\n\n        Specific question: Proceeds to a specific question by index.\n        ```json\n        {\n            "type": "specific_question",\n            "index": 2\n        }\n        ```\n        ',
                null=True,
            ),
        ),
        migrations.AddField(
            model_name="externaldatajob",
            name="workflow_run_id",
            field=models.CharField(blank=True, max_length=400, null=True),
        ),
    ]
