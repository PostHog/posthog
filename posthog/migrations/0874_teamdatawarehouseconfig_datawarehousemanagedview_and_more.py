# Generated by Django 4.2.22 on 2025-10-08 05:14

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models

import posthog.models.utils


class Migration(migrations.Migration):
    dependencies = [
        ("posthog", "0873_alter_cohortpeople_options_and_more"),
    ]

    operations = [
        migrations.CreateModel(
            name="TeamDataWarehouseConfig",
            fields=[
                (
                    "team",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        primary_key=True,
                        serialize=False,
                        to="posthog.team",
                    ),
                ),
                ("revenue_analytics_package_view_enabled_at", models.DateTimeField(null=True)),
            ],
        ),
        migrations.CreateModel(
            name="DataWarehouseManagedView",
            fields=[
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("event_source", models.CharField(max_length=128, null=True)),
                (
                    "kind",
                    models.CharField(
                        choices=[
                            ("Revenue Analytics Charge", "Revenue Analytics Charge"),
                            ("Revenue Analytics Customer", "Revenue Analytics Customer"),
                            ("Revenue Analytics Product", "Revenue Analytics Product"),
                            ("Revenue Analytics Subscription", "Revenue Analytics Subscription"),
                            ("Revenue Analytics Revenue Item", "Revenue Analytics Revenue Item"),
                        ],
                        max_length=128,
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL
                    ),
                ),
                (
                    "external_data_source",
                    models.ForeignKey(
                        null=True, on_delete=django.db.models.deletion.CASCADE, to="posthog.externaldatasource"
                    ),
                ),
                ("team", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
            ],
        ),
        migrations.AddField(
            model_name="datawarehousesavedquery",
            name="managed_view",
            field=models.OneToOneField(
                blank=True,
                null=True,
                on_delete=django.db.models.deletion.SET_NULL,
                related_name="saved_query",
                to="posthog.datawarehousemanagedview",
            ),
        ),
        migrations.AddConstraint(
            model_name="datawarehousemanagedview",
            constraint=models.UniqueConstraint(
                fields=("team", "external_data_source", "event_source", "kind"),
                name="posthog_datawarehouse_view_package_uniqueness",
            ),
        ),
    ]
