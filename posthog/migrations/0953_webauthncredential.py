# Generated by Django 4.2.26 on 2025-12-18 20:06

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models

import posthog.models.utils


class Migration(migrations.Migration):
    dependencies = [
        ("posthog", "0952_add_billable_action_to_hogflows"),
    ]

    operations = [
        migrations.CreateModel(
            name="WebauthnCredential",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.uuid7, editable=False, primary_key=True, serialize=False
                    ),
                ),
                (
                    "credential_id",
                    models.BinaryField(
                        help_text="ID generated by the user's authenticator during credential creation. Stored as bytes."
                    ),
                ),
                (
                    "label",
                    models.CharField(help_text="The user-facing label assigned to this credential.", max_length=200),
                ),
                (
                    "public_key",
                    models.BinaryField(
                        help_text="The public key used to verify attestations from the user's authenticator. Stored as bytes."
                    ),
                ),
                (
                    "algorithm",
                    models.IntegerField(
                        help_text="The COSE algorithm identifier used for public-key verification (e.g., -7 for ES256, -257 for RS256)."
                    ),
                ),
                (
                    "counter",
                    models.IntegerField(
                        default=0,
                        help_text="Tracks the counter of the credential. Traditionally used to detect cloned authenticators, however for our use case we expect to see some inconsistencies here because of the behavior of different passkey managers.",
                    ),
                ),
                (
                    "transports",
                    models.JSONField(
                        default=list,
                        help_text="The transport methods that the authenticator uses to communicate with the browser (e.g., ['internal', 'hybrid']).",
                    ),
                ),
                (
                    "verified",
                    models.BooleanField(
                        default=False,
                        help_text="Whether the credential has been verified by the user after registration. Only verified credentials can be used for login.",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                (
                    "user",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="webauthn_credentials",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "unique_together": {("user", "credential_id")},
            },
        ),
    ]
