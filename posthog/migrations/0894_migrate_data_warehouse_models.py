# Generated by Django 4.2.22 on 2025-10-30 08:32

from django.db import migrations


def update_content_type(apps, schema_editor):
    ContentType = apps.get_model("contenttypes", "ContentType")
    for model in [
        "datamodelingjob",
        "datawarehousecredential",
        "datawarehousejoin",
        "datawarehousemanagedviewset",
        "datawarehousemodelpath",
        "datawarehousesavedquery",
        "datawarehousesavedquerydraft",
        "datawarehousetable",
        "datawarehouseviewlink",
        "externaldatajob",
        "externaldataschema",
        "externaldatasource",
        "externaldatasourcerevenueanalyticsconfig",
        "querytabstate",
    ]:
        try:
            ct = ContentType.objects.get(app_label="posthog", model=model)
            ct.app_label = "datawarehouse"
            ct.save()
        except ContentType.DoesNotExist:
            pass


def reverse_content_type(apps, schema_editor):
    ContentType = apps.get_model("contenttypes", "ContentType")
    for model in [
        "datamodelingjob",
        "datawarehousecredential",
        "datawarehousejoin",
        "datawarehousemanagedviewset",
        "datawarehousemodelpath",
        "datawarehousesavedquery",
        "datawarehousesavedquerydraft",
        "datawarehousetable",
        "datawarehouseviewlink",
        "externaldatajob",
        "externaldataschema",
        "externaldatasource",
        "externaldatasourcerevenueanalyticsconfig",
        "querytabstate",
    ]:
        try:
            ct = ContentType.objects.get(app_label="datawarehouse", model=model)
            ct.app_label = "posthog"
            ct.save()
        except ContentType.DoesNotExist:
            pass


class Migration(migrations.Migration):
    dependencies = [
        ("posthog", "0893_add_ingestion_lane_fields_to_event_ingestion_restriction"),
    ]

    operations = [
        migrations.SeparateDatabaseAndState(
            database_operations=[
                migrations.RunPython(update_content_type, reverse_content_type),
            ],
            state_operations=[
                migrations.RemoveField(
                    model_name="datawarehousecredential",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehousecredential",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="datawarehousejoin",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehousejoin",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="datawarehousemanagedviewset",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehousemanagedviewset",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="datawarehousemodelpath",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehousemodelpath",
                    name="saved_query",
                ),
                migrations.RemoveField(
                    model_name="datawarehousemodelpath",
                    name="table",
                ),
                migrations.RemoveField(
                    model_name="datawarehousemodelpath",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="datawarehousesavedquery",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehousesavedquery",
                    name="managed_viewset",
                ),
                migrations.RemoveField(
                    model_name="datawarehousesavedquery",
                    name="table",
                ),
                migrations.RemoveField(
                    model_name="datawarehousesavedquery",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="datawarehousesavedquerydraft",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehousesavedquerydraft",
                    name="saved_query",
                ),
                migrations.RemoveField(
                    model_name="datawarehousesavedquerydraft",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="datawarehousetable",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehousetable",
                    name="credential",
                ),
                migrations.RemoveField(
                    model_name="datawarehousetable",
                    name="external_data_source",
                ),
                migrations.RemoveField(
                    model_name="datawarehousetable",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="datawarehouseviewlink",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="datawarehouseviewlink",
                    name="saved_query",
                ),
                migrations.RemoveField(
                    model_name="datawarehouseviewlink",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="externaldatajob",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="externaldatajob",
                    name="pipeline",
                ),
                migrations.RemoveField(
                    model_name="externaldatajob",
                    name="schema",
                ),
                migrations.RemoveField(
                    model_name="externaldatajob",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="externaldataschema",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="externaldataschema",
                    name="source",
                ),
                migrations.RemoveField(
                    model_name="externaldataschema",
                    name="table",
                ),
                migrations.RemoveField(
                    model_name="externaldataschema",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="externaldatasource",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="externaldatasource",
                    name="team",
                ),
                migrations.RemoveField(
                    model_name="externaldatasourcerevenueanalyticsconfig",
                    name="external_data_source",
                ),
                migrations.RemoveField(
                    model_name="querytabstate",
                    name="created_by",
                ),
                migrations.RemoveField(
                    model_name="querytabstate",
                    name="team",
                ),
                migrations.DeleteModel(
                    name="DataModelingJob",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseCredential",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseJoin",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseManagedViewSet",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseModelPath",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseSavedQuery",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseSavedQueryDraft",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseTable",
                ),
                migrations.DeleteModel(
                    name="DataWarehouseViewLink",
                ),
                migrations.DeleteModel(
                    name="ExternalDataJob",
                ),
                migrations.DeleteModel(
                    name="ExternalDataSchema",
                ),
                migrations.DeleteModel(
                    name="ExternalDataSource",
                ),
                migrations.DeleteModel(
                    name="ExternalDataSourceRevenueAnalyticsConfig",
                ),
                migrations.DeleteModel(
                    name="QueryTabState",
                ),
            ],
        )
    ]
