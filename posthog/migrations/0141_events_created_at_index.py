# Generated by Django 3.0.11 on 2021-03-26 12:10

from django.contrib.postgres.operations import AddIndexConcurrently  # type: ignore
from django.db import connection, migrations, models


def migrate(apps, schema_editor):
    with connection.cursor() as cursor:
        cursor.execute(
            """SELECT exists(SELECT FROM information_schema.tables where table_name = \'posthog_event_default\')"""
        )
        exists = cursor.fetchone()
        if not exists[0]:
            cursor.execute("CREATE INDEX CONCURRENTLY posthog_eve_created_6a34ca_idx ON posthog_event(created_at)")
            return
        else:
            print("Skipping migration 0141 because of partitions!")


def backwards(apps, schema_editor):
    pass


class Migration(migrations.Migration):
    atomic = False

    dependencies = [
        ("posthog", "0140_team_data_attributes"),
    ]

    operations = [
        migrations.RunPython(migrate, backwards),
    ]
