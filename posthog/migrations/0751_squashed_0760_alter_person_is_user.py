# Generated by Django 4.2.28 on 2026-02-18 08:16

import django.db.models.deletion
import django.contrib.postgres.operations
from django.db import migrations, models

import posthog.models.utils


class Migration(migrations.Migration):
    atomic = False

    replaces = [
        ("posthog", "0751_errortrackingsuppressionrule"),
        ("posthog", "0752_organization_members_can_invite"),
        ("posthog", "0753_remove_posthog_person_email_index"),
        ("posthog", "0754_organization_is_platform"),
        ("posthog", "0755_add_recording_scope_annotations"),
        ("posthog", "0756_errortrackingsymbolset_last_used"),
        ("posthog", "0757_organization_session_cookie_age"),
        ("posthog", "0758_alter_externaldatasource_source_type"),
        ("posthog", "0759_add_errortrackingsymbolset_last_used_index"),
        ("posthog", "0760_alter_person_is_user"),
    ]

    dependencies = [
        ("posthog", "0750_dwh_model_statuses"),
    ]

    operations = [
        migrations.CreateModel(
            name="ErrorTrackingSuppressionRule",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("filters", models.JSONField()),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                ("order_key", models.IntegerField()),
                ("team", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
            ],
            options={
                "indexes": [models.Index(fields=["team_id"], name="posthog_err_team_id_503a5b_idx")],
            },
        ),
        migrations.AddField(
            model_name="organization",
            name="members_can_invite",
            field=models.BooleanField(blank=True, default=True, null=True),
        ),
        migrations.RunSQL(
            sql="DROP INDEX CONCURRENTLY IF EXISTS posthog_person_email;",
            reverse_sql="CREATE INDEX CONCURRENTLY IF NOT EXISTS posthog_person_email ON posthog_person((properties->>'email'));",
        ),
        migrations.AddField(
            model_name="organization",
            name="is_platform",
            field=models.BooleanField(blank=True, default=False, null=True),
        ),
        migrations.AddField(
            model_name="annotation",
            name="recording_id",
            field=models.UUIDField(blank=True, null=True),
        ),
        migrations.AlterField(
            model_name="annotation",
            name="scope",
            field=models.CharField(
                choices=[
                    ("dashboard_item", "insight"),
                    ("dashboard", "dashboard"),
                    ("project", "project"),
                    ("organization", "organization"),
                    ("recording", "recording"),
                ],
                default="dashboard_item",
                max_length=24,
            ),
        ),
        migrations.AddField(
            model_name="errortrackingsymbolset",
            name="last_used",
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="organization",
            name="session_cookie_age",
            field=models.IntegerField(
                blank=True,
                help_text="Custom session cookie age in seconds. If not set, the global setting SESSION_COOKIE_AGE will be used.",
                null=True,
            ),
        ),
        migrations.AlterField(
            model_name="externaldatasource",
            name="source_type",
            field=models.CharField(
                choices=[
                    ("Stripe", "Stripe"),
                    ("Hubspot", "Hubspot"),
                    ("Postgres", "Postgres"),
                    ("Zendesk", "Zendesk"),
                    ("Snowflake", "Snowflake"),
                    ("Salesforce", "Salesforce"),
                    ("MySQL", "MySQL"),
                    ("MSSQL", "MSSQL"),
                    ("Vitally", "Vitally"),
                    ("BigQuery", "BigQuery"),
                    ("Chargebee", "Chargebee"),
                    ("GoogleAds", "GoogleAds"),
                    ("TemporalIO", "TemporalIO"),
                    ("DoIt", "DoIt"),
                ],
                max_length=128,
            ),
        ),
        django.contrib.postgres.operations.AddIndexConcurrently(
            model_name="errortrackingsymbolset",
            index=models.Index(fields=["last_used"], name="posthog_err_last_us_c924f6_idx"),
        ),
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.AlterField(
                    model_name="person",
                    name="is_user",
                    field=models.IntegerField(blank=True, db_column="is_user_id", null=True),
                ),
            ],
        ),
    ]
