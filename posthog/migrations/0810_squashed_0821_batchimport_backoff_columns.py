# Generated by Django 4.2.28 on 2026-02-18 08:16

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models

import posthog.models.utils


class Migration(migrations.Migration):
    replaces = [
        ("posthog", "0810_alter_hogfunctiontemplate_icon_url"),
        ("posthog", "0811_personalapikey_last_rolled_at"),
        ("posthog", "0812_sessionrecordingviewed_bulk_viewed"),
        ("posthog", "0813_alter_messagecategory_category_type_and_more"),
        ("posthog", "0814_datawarehousesavedquerydraft"),
        ("posthog", "0815_sharingconfiguration_settings"),
        ("posthog", "0816_notebook_visibility"),
        ("posthog", "0817_resourcenotebook_and_more"),
        ("posthog", "0818_alter_integration_kind"),
        ("posthog", "0819_alter_integration_kind"),
        ("posthog", "0820_organization_allow_publicly_shared_resources"),
        ("posthog", "0821_batchimport_backoff_columns"),
    ]

    dependencies = [
        ("posthog", "0809_insight_query_metadata"),
    ]

    operations = [
        migrations.AlterField(
            model_name="hogfunctiontemplate",
            name="icon_url",
            field=models.CharField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="personalapikey",
            name="last_rolled_at",
            field=models.DateTimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name="sessionrecordingviewed",
            name="bulk_viewed",
            field=models.BooleanField(default=False),
        ),
        migrations.AlterField(
            model_name="messagecategory",
            name="category_type",
            field=models.CharField(
                choices=[("marketing", "Marketing"), ("transactional", "Transactional")],
                default="marketing",
                max_length=32,
            ),
        ),
        migrations.AlterField(
            model_name="messagerecipientpreference",
            name="preferences",
            field=models.JSONField(default=dict),
        ),
        migrations.CreateModel(
            name="DataWarehouseSavedQueryDraft",
            fields=[
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True, null=True)),
                ("deleted", models.BooleanField(blank=True, default=False, null=True)),
                ("deleted_at", models.DateTimeField(blank=True, null=True)),
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                ("query", models.JSONField(blank=True, default=dict, help_text="HogQL query draft")),
                ("name", models.CharField(blank=True, help_text="Name of the draft", max_length=255, null=True)),
                (
                    "edited_history_id",
                    models.CharField(
                        blank=True, help_text="view history id that the draft branched from", max_length=255, null=True
                    ),
                ),
                (
                    "created_by",
                    models.ForeignKey(
                        blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL
                    ),
                ),
                (
                    "saved_query",
                    models.ForeignKey(
                        blank=True,
                        help_text="Original saved query this draft is editing (optional)",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        to="posthog.datawarehousesavedquery",
                    ),
                ),
                ("team", models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to="posthog.team")),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.AddField(
            model_name="sharingconfiguration",
            name="settings",
            field=models.JSONField(blank=True, help_text="JSON settings for storing configuration options", null=True),
        ),
        migrations.AddField(
            model_name="notebook",
            name="visibility",
            field=models.CharField(
                choices=[("internal", "internal"), ("default", "default")], default="default", max_length=20
            ),
        ),
        migrations.CreateModel(
            name="ResourceNotebook",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=posthog.models.utils.UUIDT, editable=False, primary_key=True, serialize=False
                    ),
                ),
                (
                    "group",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="notebooks",
                        to="posthog.group",
                    ),
                ),
                (
                    "notebook",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE, related_name="resources", to="posthog.notebook"
                    ),
                ),
            ],
        ),
        migrations.AddConstraint(
            model_name="resourcenotebook",
            constraint=models.UniqueConstraint(
                condition=models.Q(("group__isnull", False)), fields=("notebook", "group"), name="unique_notebook_group"
            ),
        ),
        migrations.AddConstraint(
            model_name="resourcenotebook",
            constraint=models.CheckConstraint(
                check=models.Q(models.Q(("group__isnull", False)), _connector="OR"),
                name="exactly_one_notebook_related_resource",
            ),
        ),
        migrations.AlterUniqueTogether(
            name="resourcenotebook",
            unique_together={("notebook", "group")},
        ),
        migrations.AlterField(
            model_name="integration",
            name="kind",
            field=models.CharField(
                choices=[
                    ("slack", "Slack"),
                    ("salesforce", "Salesforce"),
                    ("hubspot", "Hubspot"),
                    ("google-pubsub", "Google Pubsub"),
                    ("google-cloud-storage", "Google Cloud Storage"),
                    ("google-ads", "Google Ads"),
                    ("google-sheets", "Google Sheets"),
                    ("snapchat", "Snapchat"),
                    ("linkedin-ads", "Linkedin Ads"),
                    ("intercom", "Intercom"),
                    ("email", "Email"),
                    ("linear", "Linear"),
                    ("github", "Github"),
                    ("meta-ads", "Meta Ads"),
                    ("twilio", "Twilio"),
                ],
                max_length=20,
            ),
        ),
        migrations.AlterField(
            model_name="integration",
            name="kind",
            field=models.CharField(
                choices=[
                    ("slack", "Slack"),
                    ("salesforce", "Salesforce"),
                    ("hubspot", "Hubspot"),
                    ("google-pubsub", "Google Pubsub"),
                    ("google-cloud-storage", "Google Cloud Storage"),
                    ("google-ads", "Google Ads"),
                    ("google-sheets", "Google Sheets"),
                    ("snapchat", "Snapchat"),
                    ("linkedin-ads", "Linkedin Ads"),
                    ("intercom", "Intercom"),
                    ("email", "Email"),
                    ("linear", "Linear"),
                    ("github", "Github"),
                    ("meta-ads", "Meta Ads"),
                    ("twilio", "Twilio"),
                    ("clickup", "Clickup"),
                ],
                max_length=20,
            ),
        ),
        migrations.AddField(
            model_name="organization",
            name="allow_publicly_shared_resources",
            field=models.BooleanField(default=True),
        ),
        migrations.AddField(
            model_name="batchimport",
            name="backoff_attempt",
            field=models.IntegerField(default=0),
        ),
        migrations.AddField(
            model_name="batchimport",
            name="backoff_until",
            field=models.DateTimeField(blank=True, null=True),
        ),
    ]
