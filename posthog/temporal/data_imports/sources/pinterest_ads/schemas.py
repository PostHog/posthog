from enum import StrEnum
from typing import Literal, NotRequired, TypedDict

from products.data_warehouse.backend.types import IncrementalFieldType


class PinterestAdsResource(StrEnum):
    Campaigns = "campaigns"
    AdGroups = "ad_groups"
    Ads = "ads"
    CampaignAnalytics = "campaign_analytics"
    AdGroupAnalytics = "ad_group_analytics"
    AdAnalytics = "ad_analytics"


class ResourceSchema(TypedDict):
    resource_name: str
    field_names: list[str]
    primary_key: list[str]
    filter_field_names: NotRequired[list[tuple[str, IncrementalFieldType]]]
    partition_keys: list[str]
    partition_mode: Literal["md5", "numerical", "datetime"] | None
    partition_format: Literal["month", "day"] | None
    partition_size: int
    is_analytics: bool


# Pinterest Ads resource schemas
RESOURCE_SCHEMAS: dict[PinterestAdsResource, ResourceSchema] = {
    PinterestAdsResource.Campaigns: {
        "resource_name": "campaigns",
        "field_names": [
            "id",
            "name",
            "status",
            "ad_account_id",
            "objective_type",
            "created_time",
            "updated_time",
            "start_time",
            "end_time",
            "summary_status",
            "is_campaign_budget_optimization",
            "is_flexible_daily_budgets",
            "default_ad_group_budget_in_micro_currency",
            "is_automated_campaign",
            "lifetime_spend_cap",
            "daily_spend_cap",
            "order_line_id",
            "tracking_urls",
        ],
        "primary_key": ["id"],
        "filter_field_names": [
            ("updated_time", IncrementalFieldType.Integer),
        ],
        "partition_keys": ["created_time"],
        "partition_mode": "datetime",
        "partition_format": "month",
        "is_analytics": False,
        "partition_size": 1,
    },
    PinterestAdsResource.AdGroups: {
        "resource_name": "ad_groups",
        "field_names": [
            "id",
            "name",
            "status",
            "ad_account_id",
            "campaign_id",
            "created_time",
            "updated_time",
            "start_time",
            "end_time",
            "budget_in_micro_currency",
            "bid_in_micro_currency",
            "budget_type",
            "billable_event",
            "optimization_goal_metadata",
            "pacing_delivery_type",
            "conversion_learning_mode_type",
            "summary_status",
            "feed_profile_id",
            "dca_assets",
            "targeting_spec",
            "lifetime_frequency_cap",
            "tracking_urls",
            "auto_targeting_enabled",
            "placement_group",
            "bid_strategy_type",
        ],
        "primary_key": ["id"],
        "filter_field_names": [
            ("updated_time", IncrementalFieldType.Integer),
        ],
        "partition_keys": ["created_time"],
        "partition_mode": "datetime",
        "partition_format": "month",
        "is_analytics": False,
        "partition_size": 1,
    },
    PinterestAdsResource.Ads: {
        "resource_name": "ads",
        "field_names": [
            "id",
            "ad_group_id",
            "android_deep_link",
            "carousel_android_deep_links",
            "carousel_destination_urls",
            "carousel_ios_deep_links",
            "click_tracking_url",
            "creative_type",
            "destination_url",
            "ios_deep_link",
            "is_pin_deleted",
            "is_removable",
            "name",
            "status",
            "tracking_urls",
            "view_tracking_url",
            "ad_account_id",
            "campaign_id",
            "collection_items_destination_url_template",
            "created_time",
            "pin_id",
            "rejected_reasons",
            "rejection_labels",
            "review_status",
            "summary_status",
            "updated_time",
        ],
        "primary_key": ["id"],
        "filter_field_names": [
            ("updated_time", IncrementalFieldType.Integer),
        ],
        "partition_keys": ["created_time"],
        "partition_mode": "datetime",
        "partition_format": "month",
        "is_analytics": False,
        "partition_size": 1,
    },
    PinterestAdsResource.CampaignAnalytics: {
        "resource_name": "campaign_analytics",
        "field_names": [
            "CAMPAIGN_ID",
            "DATE",
            "IMPRESSION_1",
            "IMPRESSION_2",
            "CLICKTHROUGH_1",
            "CLICKTHROUGH_2",
            "OUTBOUND_CLICK_1",
            "OUTBOUND_CLICK_2",
            "TOTAL_ENGAGEMENT",
            "SPEND_IN_MICRO_DOLLAR",
            "TOTAL_CLICKTHROUGH",
            "TOTAL_IMPRESSION",
            "ECTR",
            "ECPM",
            "ECPC",
            "ECPE",
            "TOTAL_CONVERSIONS",
            "CONVERSION_1",
            "CONVERSION_2",
            "VIDEO_MRC_VIEWS_1",
            "VIDEO_MRC_VIEWS_2",
            "VIDEO_3SEC_VIEWS_2",
            "VIDEO_P25_WATCHED_2",
            "VIDEO_P50_WATCHED_2",
            "VIDEO_P75_WATCHED_2",
            "VIDEO_P95_WATCHED_2",
            "VIDEO_P100_WATCHED_2",
            "ECPV",
        ],
        "primary_key": ["CAMPAIGN_ID", "DATE"],
        "filter_field_names": [
            ("DATE", IncrementalFieldType.Date),
        ],
        "partition_keys": ["DATE"],
        "partition_mode": "datetime",
        "partition_format": "month",
        "is_analytics": True,
        "partition_size": 1,
    },
    PinterestAdsResource.AdGroupAnalytics: {
        "resource_name": "ad_group_analytics",
        "field_names": [
            "AD_GROUP_ID",
            "DATE",
            "IMPRESSION_1",
            "IMPRESSION_2",
            "CLICKTHROUGH_1",
            "CLICKTHROUGH_2",
            "OUTBOUND_CLICK_1",
            "OUTBOUND_CLICK_2",
            "TOTAL_ENGAGEMENT",
            "SPEND_IN_MICRO_DOLLAR",
            "TOTAL_CLICKTHROUGH",
            "TOTAL_IMPRESSION",
            "ECTR",
            "ECPM",
            "ECPC",
            "ECPE",
            "TOTAL_CONVERSIONS",
            "CONVERSION_1",
            "CONVERSION_2",
            "VIDEO_MRC_VIEWS_1",
            "VIDEO_MRC_VIEWS_2",
            "VIDEO_3SEC_VIEWS_2",
            "VIDEO_P25_WATCHED_2",
            "VIDEO_P50_WATCHED_2",
            "VIDEO_P75_WATCHED_2",
            "VIDEO_P95_WATCHED_2",
            "VIDEO_P100_WATCHED_2",
            "ECPV",
        ],
        "primary_key": ["AD_GROUP_ID", "DATE"],
        "filter_field_names": [
            ("DATE", IncrementalFieldType.Date),
        ],
        "partition_keys": ["DATE"],
        "partition_mode": "datetime",
        "partition_format": "month",
        "is_analytics": True,
        "partition_size": 1,
    },
    PinterestAdsResource.AdAnalytics: {
        "resource_name": "ad_analytics",
        "field_names": [
            "AD_ID",
            "DATE",
            "IMPRESSION_1",
            "IMPRESSION_2",
            "CLICKTHROUGH_1",
            "CLICKTHROUGH_2",
            "OUTBOUND_CLICK_1",
            "OUTBOUND_CLICK_2",
            "TOTAL_ENGAGEMENT",
            "SPEND_IN_MICRO_DOLLAR",
            "TOTAL_CLICKTHROUGH",
            "TOTAL_IMPRESSION",
            "ECTR",
            "ECPM",
            "ECPC",
            "ECPE",
            "TOTAL_CONVERSIONS",
            "CONVERSION_1",
            "CONVERSION_2",
            "VIDEO_MRC_VIEWS_1",
            "VIDEO_MRC_VIEWS_2",
            "VIDEO_3SEC_VIEWS_2",
            "VIDEO_P25_WATCHED_2",
            "VIDEO_P50_WATCHED_2",
            "VIDEO_P75_WATCHED_2",
            "VIDEO_P95_WATCHED_2",
            "VIDEO_P100_WATCHED_2",
            "ECPV",
        ],
        "primary_key": ["AD_ID", "DATE"],
        "filter_field_names": [
            ("DATE", IncrementalFieldType.Date),
        ],
        "partition_keys": ["DATE"],
        "partition_mode": "datetime",
        "partition_format": "month",
        "is_analytics": True,
        "partition_size": 1,
    },
}
