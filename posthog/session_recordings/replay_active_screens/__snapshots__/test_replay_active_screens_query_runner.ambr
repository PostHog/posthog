# serializer version: 1
# name: TestReplayActiveScreensQueryRunner.test_query_performance
  '''
  SELECT cutQueryString(cutFragment(url)) AS screen,
         count(DISTINCT session_id) AS count
  FROM
    (SELECT session_replay_events.session_id AS session_id,
            arrayJoin(any(session_replay_events.all_urls)) AS url
     FROM session_replay_events
     WHERE and(equals(session_replay_events.team_id, 99999), greaterOrEquals(toTimeZone(session_replay_events.min_first_timestamp, 'UTC'), minus(toDateTime64('today', 6, 'UTC'), toIntervalDay(7))), lessOrEquals(toTimeZone(session_replay_events.min_first_timestamp, 'UTC'), toDateTime64('today', 6, 'UTC')))
     GROUP BY session_replay_events.session_id
     HAVING greater(dateDiff('second', min(toTimeZone(session_replay_events.min_first_timestamp, 'UTC')), max(toTimeZone(session_replay_events.max_last_timestamp, 'UTC'))), 5))
  GROUP BY screen
  ORDER BY count DESC
  LIMIT 10 SETTINGS readonly=2,
                    max_execution_time=60,
                    allow_experimental_object_type=1,
                    format_csv_allow_double_quotes=0,
                    max_ast_elements=4000000,
                    max_expanded_ast_elements=4000000,
                    max_bytes_before_external_group_by=0,
                    transform_null_in=1,
                    optimize_min_equality_disjunction_chain_length=4294967295,
                    allow_experimental_join_condition=1
  '''
# ---
