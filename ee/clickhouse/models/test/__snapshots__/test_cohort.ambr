# name: TestCohort.test_cohortpeople_action_count
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_cohortpeople_action_count.1
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_cohortpeople_action_count.10
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_cohortpeople_action_count.11
  '
  SELECT person_id
  FROM cohortpeople
  where cohort_id = 2
  '
---
# name: TestCohort.test_cohortpeople_action_count.2
  '
  SELECT person_id
  FROM cohortpeople
  where cohort_id = 2
  '
---
# name: TestCohort.test_cohortpeople_action_count.3
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_cohortpeople_action_count.4
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_cohortpeople_action_count.5
  '
  SELECT person_id
  FROM cohortpeople
  where cohort_id = 2
  '
---
# name: TestCohort.test_cohortpeople_action_count.6
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_cohortpeople_action_count.7
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_cohortpeople_action_count.8
  '
  SELECT person_id
  FROM cohortpeople
  where cohort_id = 2
  '
---
# name: TestCohort.test_cohortpeople_action_count.9
  '
  
  SELECT count(*)
  FROM
    (SELECT 1
     FROM cohortpeople
     WHERE team_id = 2
       AND cohort_id = 2
     GROUP BY person_id,
              cohort_id,
              team_id
     HAVING sum(sign) > 0)
  '
---
# name: TestCohort.test_static_cohort_precalculated
  '
  
  SELECT distinct_id
  FROM
    (SELECT distinct_id,
            argMax(person_id, version) as person_id
     FROM person_distinct_id2
     WHERE team_id = 2
     GROUP BY distinct_id
     HAVING argMax(is_deleted, version) = 0)
  WHERE person_id IN
      (SELECT person_id
       FROM person_static_cohort
       WHERE cohort_id = %(_cohort_id_0)s
         AND team_id = %(team_id)s)
  '
---
# name: TestCohortBehaviouralFilters.test_subquery_generator
  '
  SELECT id as person_id
  FROM person
  WHERE team_id = 2
    AND person_id IN
      (SELECT person_id
       FROM
         (SELECT person_id,
                 [countIf(dateTrunc('day', timestamp) >= '2022-03-28' AND dateTrunc('day', timestamp) < '2022-04-04'),countIf(dateTrunc('day', timestamp) >= '2022-04-04' AND dateTrunc('day', timestamp) < '2022-04-11'),countIf(dateTrunc('day', timestamp) >= '2022-04-11' AND dateTrunc('day', timestamp) < '2022-04-18')] AS period_values
          FROM events
          INNER JOIN
            (SELECT distinct_id,
                    argMax(person_id, version) as person_id
             FROM person_distinct_id2
             WHERE team_id = 2
             GROUP BY distinct_id
             HAVING argMax(is_deleted, version) = 0) as pdi ON events.distinct_id = pdi.distinct_id
          WHERE team_id = 2
            AND timestamp >= '2022-03-28 11:11:48'
            AND timestamp <= '2022-04-15 11:11:48'
            AND event = '$pageview'
          GROUP BY person_id)
       WHERE arrayFirstIndex(x-> if(x > 1, 1, 0), period_values) = 3
         AND arrayAll(x -> x = 0, arrayPopBack(period_values)) )
  '
---
