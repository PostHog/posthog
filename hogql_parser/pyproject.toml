[tool.cibuildwheel]
build = [ # Build CPython wheels on Linux and macOS, for x86 as well as ARM
    "cp3*-macosx_x86_64",
    "cp3*-macosx_arm64",
    "cp3*-manylinux_x86_64",
    "cp3*-manylinux_aarch64",
]
build-frontend = "build" # This is successor to building with pip

[tool.cibuildwheel.macos]
archs = [
    "x86_64",
    "arm64",
] # We could also build a universal wheel, but separate ones are lighter individually
before-all = ["brew install boost antlr antlr4-cpp-runtime"]

[tool.cibuildwheel.linux]
before-all = [
    # manylinux_2_28 is based on AlmaLinux 8, which uses Fedora's dnf as its package manager
    "dnf install -y boost-devel unzip cmake curl uuid pkg-config",
    "curl https://www.antlr.org/download/antlr4-cpp-runtime-4.13.1-source.zip --output antlr4-source.zip",
    "unzip antlr4-source.zip -d antlr4-source && cd antlr4-source",
    "cmake .",
    "DESTDIR=out make install",
    "cp -r out/usr/local/include/antlr4-runtime /usr/local/include",
    "cp out/usr/local/lib64/libantlr4-runtime.so* /usr/local/lib",
    "ldconfig",
]
archs = ["x86_64", "aarch64"]
manylinux-x86_64-image = "manylinux_2_28"
manylinux-aarch64-image = "manylinux_2_28"
