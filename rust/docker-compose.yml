version: '3'

services:
    setup_test_db:
        container_name: setup-test-db
        build:
            context: .
            dockerfile: Dockerfile.migrate-hooks
        restart: on-failure
        depends_on:
            db:
                condition: service_healthy
                restart: true
        environment:
            DATABASE_URL: postgres://posthog:posthog@db:5432/test_database

    echo_server:
        image: docker.io/library/caddy:2
        container_name: echo-server
        restart: on-failure
        ports:
            - '18081:8081'
        volumes:
            - ./docker/echo-server/Caddyfile:/etc/caddy/Caddyfile
